<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sand Sandbox - Physics Playground</title>
    <link rel="icon" href="https://emojicdn.elk.sh/üèñÔ∏è" type="image/png">
    <meta name="theme-color" content="#d4a574">
    <link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:wght@400;600;700&display=swap" rel="stylesheet">
    <meta property="og:title" content="Sand Sandbox - Physics Playground">
    <meta property="og:description" content="Draw with sand, water, fire and more in this physics simulation!">
    <meta property="og:url" content="https://sloppy.live/sand-sandbox">
    <meta property="og:image" content="https://image.pollinations.ai/prompt/falling%20sand%20particles%20colorful%20physics%20simulation%20game%20dark%20background?width=1200&height=630&referrer=sloppy.live">
    <style>
        :root {
            --bg: #0d0d0d;
            --surface: #1a1a1a;
            --border: rgba(255,255,255,0.08);
            --text: #e8e4dc;
            --text-dim: #7a7570;
            --accent: #d4a574;
            --accent-dim: #a67c52;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: var(--bg);
            font-family: 'Bricolage Grotesque', system-ui, sans-serif;
            overflow: hidden;
            touch-action: none;
            color: var(--text);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }
        .header {
            background: var(--surface);
            padding: 12px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }
        .header h1 {
            font-size: 1.3em;
            font-weight: 700;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .header-links {
            display: flex;
            gap: 15px;
        }
        .header-links a {
            color: var(--text-dim);
            text-decoration: none;
            font-size: 0.85em;
            transition: color 0.2s;
        }
        .header-links a:hover { color: var(--accent); }
        .toolbar {
            background: var(--surface);
            padding: 10px 15px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
            border-bottom: 1px solid var(--border);
            flex-shrink: 0;
        }
        .material-btn {
            background: var(--bg);
            border: 2px solid transparent;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85em;
            font-family: inherit;
            color: var(--text);
            transition: all 0.15s;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .material-btn:hover { border-color: var(--accent-dim); }
        .material-btn.active {
            border-color: var(--accent);
            background: rgba(212,165,116,0.15);
            color: var(--accent);
        }
        .material-dot {
            width: 12px;
            height: 12px;
            border-radius: 3px;
        }
        .divider {
            width: 1px;
            height: 28px;
            background: var(--border);
            margin: 0 5px;
        }
        .control-btn {
            background: transparent;
            border: 1px solid var(--border);
            padding: 8px 14px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85em;
            font-family: inherit;
            color: var(--text-dim);
            transition: all 0.15s;
        }
        .control-btn:hover {
            border-color: var(--accent-dim);
            color: var(--text);
        }
        .brush-control {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-dim);
            font-size: 0.85em;
        }
        input[type="range"] {
            -webkit-appearance: none;
            width: 80px;
            height: 6px;
            border-radius: 3px;
            background: var(--bg);
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            background: var(--accent);
            cursor: pointer;
        }
        .canvas-wrap {
            flex: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 15px;
            min-height: 0;
        }
        #sandbox {
            background: #0a0a0a;
            border-radius: 12px;
            cursor: crosshair;
            max-width: 100%;
            max-height: 100%;
            box-shadow: 0 0 60px rgba(0,0,0,0.5), inset 0 0 1px rgba(255,255,255,0.1);
        }
        .status-bar {
            background: var(--surface);
            padding: 8px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8em;
            color: var(--text-dim);
            border-top: 1px solid var(--border);
            flex-shrink: 0;
        }
        .particle-count { font-family: monospace; }
        .tips { opacity: 0.7; }
        @media (max-width: 768px) {
            .header h1 { font-size: 1.1em; }
            .toolbar { padding: 8px 10px; gap: 5px; }
            .material-btn { padding: 6px 10px; font-size: 0.8em; }
            .material-btn span:last-child { display: none; }
            .divider { display: none; }
            .canvas-wrap { padding: 10px; }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><span>üèñÔ∏è</span> Sand Sandbox</h1>
        <div class="header-links">
            <a href="https://sloppy.live">Stream</a>
            <a href="https://sloppy.live/overview">All Apps</a>
        </div>
    </div>

    <div class="toolbar">
        <button class="material-btn active" data-mat="sand">
            <span class="material-dot" style="background:#d4a574"></span>
            <span>Sand</span>
        </button>
        <button class="material-btn" data-mat="water">
            <span class="material-dot" style="background:#4a90d9"></span>
            <span>Water</span>
        </button>
        <button class="material-btn" data-mat="stone">
            <span class="material-dot" style="background:#6b6b6b"></span>
            <span>Stone</span>
        </button>
        <button class="material-btn" data-mat="wood">
            <span class="material-dot" style="background:#8b5a2b"></span>
            <span>Wood</span>
        </button>
        <button class="material-btn" data-mat="fire">
            <span class="material-dot" style="background:linear-gradient(#ff6b35,#ffcc00)"></span>
            <span>Fire</span>
        </button>
        <button class="material-btn" data-mat="oil">
            <span class="material-dot" style="background:#2a2a1a"></span>
            <span>Oil</span>
        </button>
        <button class="material-btn" data-mat="lava">
            <span class="material-dot" style="background:#ff4500"></span>
            <span>Lava</span>
        </button>
        <button class="material-btn" data-mat="ice">
            <span class="material-dot" style="background:#a8d8ea"></span>
            <span>Ice</span>
        </button>
        <button class="material-btn" data-mat="acid">
            <span class="material-dot" style="background:#7fff00"></span>
            <span>Acid</span>
        </button>
        <button class="material-btn" data-mat="powder">
            <span class="material-dot" style="background:#4a4a4a"></span>
            <span>Gunpowder</span>
        </button>
        <button class="material-btn" data-mat="plant">
            <span class="material-dot" style="background:#228b22"></span>
            <span>Plant</span>
        </button>
        <button class="material-btn" data-mat="eraser">
            <span class="material-dot" style="background:#1a1a1a;border:1px solid #444"></span>
            <span>Eraser</span>
        </button>

        <div class="divider"></div>

        <div class="brush-control">
            <span>Size</span>
            <input type="range" id="brushSize" min="1" max="25" value="6">
            <span id="brushVal">6</span>
        </div>

        <div class="divider"></div>

        <button class="control-btn" id="clearBtn">Clear</button>
        <button class="control-btn" id="gravityBtn">Gravity: ON</button>
    </div>

    <div class="canvas-wrap">
        <canvas id="sandbox" width="800" height="500"></canvas>
    </div>

    <div class="status-bar">
        <span class="tips">Click & drag to draw ‚Ä¢ Fire burns wood & oil ‚Ä¢ Water extinguishes fire ‚Ä¢ Acid dissolves most things</span>
        <span class="particle-count" id="particleCount">Particles: 0</span>
    </div>

    <script>
        const canvas = document.getElementById('sandbox');
        const ctx = canvas.getContext('2d');
        const W = canvas.width;
        const H = canvas.height;

        // Material types
        const EMPTY = 0, SAND = 1, WATER = 2, STONE = 3, FIRE = 4, LAVA = 5, ICE = 6, WOOD = 7, OIL = 8, ACID = 9, POWDER = 10, PLANT = 11, STEAM = 12;

        // Particle grid + color variation grid
        const grid = new Uint8Array(W * H);
        const colorVar = new Uint8Array(W * H); // 0-3 color variation per particle

        let currentMat = SAND;
        let brushSize = 6;
        let isDrawing = false;
        let gravity = true;
        let lastMouse = null;

        // Base colors with variations
        const matColors = {
            [EMPTY]: ['#0a0a0a'],
            [SAND]: ['#d4a574', '#c9976a', '#deb887', '#cba36d'],
            [WATER]: ['#4a90d9', '#5599e0', '#3d85d1', '#6aa8e8'],
            [STONE]: ['#6b6b6b', '#5f5f5f', '#757575', '#686868'],
            [FIRE]: ['#ff6b35', '#ff8c42', '#ffcc00', '#ff5722'],
            [LAVA]: ['#ff4500', '#ff5a1a', '#ff6b35', '#e63900'],
            [ICE]: ['#a8d8ea', '#b8e0f0', '#98d0e2', '#c0e8f8'],
            [WOOD]: ['#8b5a2b', '#7a4f26', '#9c6530', '#6b4423'],
            [OIL]: ['#2a2a1a', '#252518', '#2f2f1f', '#1f1f15'],
            [ACID]: ['#7fff00', '#8aff1a', '#6be600', '#9fff33'],
            [POWDER]: ['#4a4a4a', '#3d3d3d', '#555555', '#424242'],
            [PLANT]: ['#228b22', '#2e9d2e', '#1a7a1a', '#3cb043'],
            [STEAM]: ['#c8c8c8', '#d4d4d4', '#bcbcbc', '#e0e0e0']
        };

        const matNames = { sand: SAND, water: WATER, stone: STONE, fire: FIRE, lava: LAVA, ice: ICE, wood: WOOD, oil: OIL, acid: ACID, powder: POWDER, plant: PLANT, eraser: EMPTY };

        function idx(x, y) { return y * W + x; }
        function inBounds(x, y) { return x >= 0 && x < W && y >= 0 && y < H; }
        function get(x, y) { return inBounds(x, y) ? grid[idx(x, y)] : STONE; }
        function set(x, y, mat) {
            if (inBounds(x, y)) {
                const i = idx(x, y);
                grid[i] = mat;
                colorVar[i] = Math.floor(Math.random() * 4);
            }
        }
        function swap(x1, y1, x2, y2) {
            const i1 = idx(x1, y1), i2 = idx(x2, y2);
            const tmp = grid[i1]; grid[i1] = grid[i2]; grid[i2] = tmp;
            const tmpC = colorVar[i1]; colorVar[i1] = colorVar[i2]; colorVar[i2] = tmpC;
        }

        // Draw with interpolation for smooth lines
        function draw(x, y) {
            const r = brushSize;
            for (let dx = -r; dx <= r; dx++) {
                for (let dy = -r; dy <= r; dy++) {
                    if (dx*dx + dy*dy <= r*r) {
                        const px = Math.floor(x + dx), py = Math.floor(y + dy);
                        if (currentMat === EMPTY || Math.random() < 0.4) {
                            set(px, py, currentMat);
                        }
                    }
                }
            }
        }

        function drawLine(x0, y0, x1, y1) {
            const dist = Math.hypot(x1 - x0, y1 - y0);
            const steps = Math.max(1, Math.floor(dist / 2));
            for (let i = 0; i <= steps; i++) {
                const t = i / steps;
                draw(x0 + (x1 - x0) * t, y0 + (y1 - y0) * t);
            }
        }

        // Physics simulation
        function updatePhysics() {
            if (!gravity) return;

            // Process bottom to top for falling, top to bottom for rising
            for (let y = H - 2; y >= 0; y--) {
                // Randomize x direction to prevent bias
                const startX = Math.random() < 0.5 ? 0 : W - 1;
                const endX = startX === 0 ? W : -1;
                const stepX = startX === 0 ? 1 : -1;

                for (let x = startX; x !== endX; x += stepX) {
                    const mat = grid[idx(x, y)];
                    if (mat === EMPTY || mat === STONE) continue;

                    const below = get(x, y + 1);
                    const belowL = get(x - 1, y + 1);
                    const belowR = get(x + 1, y + 1);
                    const left = get(x - 1, y);
                    const right = get(x + 1, y);
                    const above = get(x, y - 1);

                    // SAND physics
                    if (mat === SAND) {
                        if (below === EMPTY) {
                            swap(x, y, x, y + 1);
                        } else if (below === WATER || below === OIL) {
                            swap(x, y, x, y + 1);
                        } else if (belowL === EMPTY && Math.random() < 0.5) {
                            swap(x, y, x - 1, y + 1);
                        } else if (belowR === EMPTY && Math.random() < 0.5) {
                            swap(x, y, x + 1, y + 1);
                        }
                    }
                    // WATER physics
                    else if (mat === WATER) {
                        if (below === EMPTY) {
                            swap(x, y, x, y + 1);
                        } else if (below === OIL) {
                            swap(x, y, x, y + 1);
                        } else if (belowL === EMPTY && Math.random() < 0.3) {
                            swap(x, y, x - 1, y + 1);
                        } else if (belowR === EMPTY && Math.random() < 0.3) {
                            swap(x, y, x + 1, y + 1);
                        } else if (left === EMPTY && Math.random() < 0.4) {
                            swap(x, y, x - 1, y);
                        } else if (right === EMPTY && Math.random() < 0.4) {
                            swap(x, y, x + 1, y);
                        }
                        // Water + Fire = Steam
                        if (below === FIRE || above === FIRE || left === FIRE || right === FIRE) {
                            set(x, y, STEAM);
                        }
                        // Water + Lava = Stone
                        if (below === LAVA) { set(x, y + 1, STONE); set(x, y, STEAM); }
                    }
                    // FIRE physics
                    else if (mat === FIRE) {
                        // Fire dies randomly
                        if (Math.random() < 0.03) {
                            set(x, y, EMPTY);
                            continue;
                        }
                        // Fire rises
                        if (above === EMPTY && Math.random() < 0.7) {
                            swap(x, y, x, y - 1);
                        } else if (Math.random() < 0.2) {
                            const dir = Math.random() < 0.5 ? -1 : 1;
                            if (get(x + dir, y - 1) === EMPTY) {
                                swap(x, y, x + dir, y - 1);
                            }
                        }
                        // Fire burns wood
                        [[0,1],[0,-1],[1,0],[-1,0]].forEach(([dx, dy]) => {
                            const neighbor = get(x + dx, y + dy);
                            if (neighbor === WOOD && Math.random() < 0.02) {
                                set(x + dx, y + dy, FIRE);
                            }
                            if (neighbor === OIL && Math.random() < 0.1) {
                                set(x + dx, y + dy, FIRE);
                            }
                            if (neighbor === POWDER && Math.random() < 0.3) {
                                set(x + dx, y + dy, FIRE);
                                // Explosion effect
                                for (let ex = -3; ex <= 3; ex++) {
                                    for (let ey = -3; ey <= 3; ey++) {
                                        if (Math.random() < 0.5) {
                                            const target = get(x + dx + ex, y + dy + ey);
                                            if (target !== STONE) set(x + dx + ex, y + dy + ey, FIRE);
                                        }
                                    }
                                }
                            }
                            if (neighbor === PLANT && Math.random() < 0.05) {
                                set(x + dx, y + dy, FIRE);
                            }
                        });
                    }
                    // LAVA physics
                    else if (mat === LAVA) {
                        if (below === EMPTY && Math.random() < 0.3) {
                            swap(x, y, x, y + 1);
                        } else if (left === EMPTY && Math.random() < 0.1) {
                            swap(x, y, x - 1, y);
                        } else if (right === EMPTY && Math.random() < 0.1) {
                            swap(x, y, x + 1, y);
                        }
                        // Lava melts ice
                        [[0,1],[0,-1],[1,0],[-1,0]].forEach(([dx, dy]) => {
                            const neighbor = get(x + dx, y + dy);
                            if (neighbor === ICE && Math.random() < 0.1) {
                                set(x + dx, y + dy, WATER);
                            }
                            if (neighbor === WATER) {
                                set(x + dx, y + dy, STONE);
                                if (Math.random() < 0.3) set(x, y, STONE);
                            }
                            if (neighbor === WOOD && Math.random() < 0.05) {
                                set(x + dx, y + dy, FIRE);
                            }
                        });
                    }
                    // OIL physics
                    else if (mat === OIL) {
                        if (below === EMPTY) {
                            swap(x, y, x, y + 1);
                        } else if (left === EMPTY && Math.random() < 0.3) {
                            swap(x, y, x - 1, y);
                        } else if (right === EMPTY && Math.random() < 0.3) {
                            swap(x, y, x + 1, y);
                        }
                    }
                    // ICE physics (static, but can melt)
                    else if (mat === ICE) {
                        // Check for nearby fire/lava
                        let nearHeat = false;
                        [[0,1],[0,-1],[1,0],[-1,0]].forEach(([dx, dy]) => {
                            const n = get(x + dx, y + dy);
                            if (n === FIRE || n === LAVA) nearHeat = true;
                        });
                        if (nearHeat && Math.random() < 0.05) {
                            set(x, y, WATER);
                        }
                    }
                    // ACID physics
                    else if (mat === ACID) {
                        if (below === EMPTY) {
                            swap(x, y, x, y + 1);
                        } else if (left === EMPTY && Math.random() < 0.3) {
                            swap(x, y, x - 1, y);
                        } else if (right === EMPTY && Math.random() < 0.3) {
                            swap(x, y, x + 1, y);
                        }
                        // Acid dissolves things
                        [[0,1],[0,-1],[1,0],[-1,0]].forEach(([dx, dy]) => {
                            const neighbor = get(x + dx, y + dy);
                            if (neighbor !== EMPTY && neighbor !== STONE && neighbor !== ACID && neighbor !== WATER && Math.random() < 0.03) {
                                set(x + dx, y + dy, EMPTY);
                                if (Math.random() < 0.3) set(x, y, EMPTY); // Acid consumed
                            }
                        });
                    }
                    // GUNPOWDER physics
                    else if (mat === POWDER) {
                        if (below === EMPTY) {
                            swap(x, y, x, y + 1);
                        } else if (belowL === EMPTY && Math.random() < 0.5) {
                            swap(x, y, x - 1, y + 1);
                        } else if (belowR === EMPTY && Math.random() < 0.5) {
                            swap(x, y, x + 1, y + 1);
                        }
                    }
                    // PLANT physics
                    else if (mat === PLANT) {
                        // Grow when touching water
                        let nearWater = false;
                        [[0,1],[0,-1],[1,0],[-1,0]].forEach(([dx, dy]) => {
                            if (get(x + dx, y + dy) === WATER) nearWater = true;
                        });
                        if (nearWater && Math.random() < 0.01) {
                            const growDir = [[0,-1],[1,0],[-1,0]][Math.floor(Math.random() * 3)];
                            if (get(x + growDir[0], y + growDir[1]) === EMPTY) {
                                set(x + growDir[0], y + growDir[1], PLANT);
                            }
                        }
                    }
                    // STEAM physics
                    else if (mat === STEAM) {
                        if (Math.random() < 0.02) {
                            set(x, y, EMPTY);
                            continue;
                        }
                        if (above === EMPTY && Math.random() < 0.8) {
                            swap(x, y, x, y - 1);
                        } else if (Math.random() < 0.3) {
                            const dir = Math.random() < 0.5 ? -1 : 1;
                            if (get(x + dir, y) === EMPTY) {
                                swap(x, y, x + dir, y);
                            }
                        }
                        // Steam condenses back to water at top
                        if (y < 10 && Math.random() < 0.01) {
                            set(x, y, WATER);
                        }
                    }
                }
            }
        }

        // Render
        const imageData = ctx.createImageData(W, H);
        const data = imageData.data;

        function render() {
            let count = 0;
            for (let i = 0; i < grid.length; i++) {
                const mat = grid[i];
                const colors = matColors[mat];
                const colorIdx = colorVar[i] % colors.length;
                const color = colors[colorIdx];

                const r = parseInt(color.slice(1, 3), 16);
                const g = parseInt(color.slice(3, 5), 16);
                const b = parseInt(color.slice(5, 7), 16);

                const di = i * 4;
                data[di] = r;
                data[di + 1] = g;
                data[di + 2] = b;
                data[di + 3] = 255;

                if (mat !== EMPTY) count++;
            }
            ctx.putImageData(imageData, 0, 0);
            document.getElementById('particleCount').textContent = `Particles: ${count.toLocaleString()}`;
        }

        // Main loop
        function loop() {
            updatePhysics();
            render();
            requestAnimationFrame(loop);
        }

        // Input handling
        function getPos(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.clientX ?? e.touches?.[0]?.clientX;
            const clientY = e.clientY ?? e.touches?.[0]?.clientY;
            return {
                x: (clientX - rect.left) * (W / rect.width),
                y: (clientY - rect.top) * (H / rect.height)
            };
        }

        canvas.addEventListener('mousedown', e => {
            isDrawing = true;
            const pos = getPos(e);
            draw(pos.x, pos.y);
            lastMouse = pos;
        });

        canvas.addEventListener('mousemove', e => {
            if (!isDrawing) return;
            const pos = getPos(e);
            if (lastMouse) drawLine(lastMouse.x, lastMouse.y, pos.x, pos.y);
            lastMouse = pos;
        });

        canvas.addEventListener('mouseup', () => { isDrawing = false; lastMouse = null; });
        canvas.addEventListener('mouseleave', () => { isDrawing = false; lastMouse = null; });

        canvas.addEventListener('touchstart', e => {
            e.preventDefault();
            isDrawing = true;
            const pos = getPos(e);
            draw(pos.x, pos.y);
            lastMouse = pos;
        });

        canvas.addEventListener('touchmove', e => {
            e.preventDefault();
            if (!isDrawing) return;
            const pos = getPos(e);
            if (lastMouse) drawLine(lastMouse.x, lastMouse.y, pos.x, pos.y);
            lastMouse = pos;
        });

        canvas.addEventListener('touchend', e => {
            e.preventDefault();
            isDrawing = false;
            lastMouse = null;
        });

        // Controls
        document.querySelectorAll('.material-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelector('.material-btn.active')?.classList.remove('active');
                btn.classList.add('active');
                currentMat = matNames[btn.dataset.mat];
            });
        });

        document.getElementById('brushSize').addEventListener('input', e => {
            brushSize = parseInt(e.target.value);
            document.getElementById('brushVal').textContent = brushSize;
        });

        document.getElementById('clearBtn').addEventListener('click', () => {
            grid.fill(EMPTY);
        });

        document.getElementById('gravityBtn').addEventListener('click', e => {
            gravity = !gravity;
            e.target.textContent = `Gravity: ${gravity ? 'ON' : 'OFF'}`;
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', e => {
            const shortcuts = { '1': 'sand', '2': 'water', '3': 'stone', '4': 'wood', '5': 'fire', '6': 'oil', '7': 'lava', '8': 'ice', '9': 'acid', '0': 'eraser' };
            if (shortcuts[e.key]) {
                document.querySelector('.material-btn.active')?.classList.remove('active');
                document.querySelector(`[data-mat="${shortcuts[e.key]}"]`)?.classList.add('active');
                currentMat = matNames[shortcuts[e.key]];
            }
            if (e.key === 'c') grid.fill(EMPTY);
            if (e.key === 'g') {
                gravity = !gravity;
                document.getElementById('gravityBtn').textContent = `Gravity: ${gravity ? 'ON' : 'OFF'}`;
            }
        });

        // Start
        loop();
    </script>
</body>
</html>
