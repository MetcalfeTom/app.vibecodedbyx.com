<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KNOWLEDGE CHAOS - Deep Wisdom TV</title>
    <link rel="icon" href="https://emojicdn.elk.sh/ðŸ§ ">

    <meta property="og:title" content="KNOWLEDGE CHAOS">
    <meta property="og:description" content="Watch deep knowledge videos and chat with seekers">
    <meta property="og:url" content="https://sloppy.live/knowledge-chaos">
    <meta property="og:image" content="https://emojicdn.elk.sh/ðŸ§ .png">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #0f0;
            overflow: hidden;
            height: 100vh;
        }

        .chaos-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.03;
            pointer-events: none;
            z-index: 1;
            animation: glitch 0.3s infinite;
        }

        @keyframes glitch {
            0%, 100% { transform: translate(0); }
            33% { transform: translate(-2px, 2px); }
            66% { transform: translate(2px, -2px); }
        }

        .container {
            position: relative;
            z-index: 2;
            height: 100vh;
            display: grid;
            grid-template-columns: 1fr 350px;
            grid-template-rows: auto 1fr;
            gap: 0;
        }

        .header {
            grid-column: 1 / -1;
            background: #000;
            border-bottom: 3px solid #0f0;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            animation: flicker 3s infinite;
        }

        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.95; }
        }

        .header h1 {
            font-size: 28px;
            color: #0f0;
            text-shadow: 0 0 10px #0f0;
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 49%, 100% { opacity: 1; }
            50%, 99% { opacity: 0.7; }
        }

        .status {
            font-size: 12px;
            color: #0f0;
        }

        .video-section {
            background: #000;
            border-right: 3px solid #0f0;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .video-controls {
            padding: 15px;
            border-bottom: 2px solid #0f0;
            background: #001100;
        }

        .video-input {
            width: 100%;
            background: #000;
            border: 2px solid #0f0;
            color: #0f0;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .video-input::placeholder {
            color: #0a0;
        }

        .load-btn {
            width: 100%;
            background: #0f0;
            color: #000;
            border: none;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .load-btn:hover {
            background: #0a0;
            box-shadow: 0 0 20px #0f0;
        }

        .video-container {
            flex: 1;
            position: relative;
            background: #000;
        }

        .video-container iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .preset-videos {
            padding: 15px;
            border-top: 2px solid #0f0;
            background: #001100;
            overflow-y: auto;
            max-height: 200px;
        }

        .preset-videos::-webkit-scrollbar {
            width: 8px;
        }

        .preset-videos::-webkit-scrollbar-track {
            background: #000;
        }

        .preset-videos::-webkit-scrollbar-thumb {
            background: #0f0;
        }

        .preset-btn {
            display: block;
            width: 100%;
            background: #001100;
            border: 1px solid #0f0;
            color: #0f0;
            padding: 8px;
            margin-bottom: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
        }

        .preset-btn:hover {
            background: #0f0;
            color: #000;
        }

        .chat-section {
            background: #000;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            padding: 15px;
            border-bottom: 2px solid #0f0;
            background: #001100;
            text-align: center;
            font-weight: bold;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { text-shadow: 0 0 5px #0f0; }
            50% { text-shadow: 0 0 15px #0f0; }
        }

        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            background: #000;
        }

        .chat-messages::-webkit-scrollbar {
            width: 8px;
        }

        .chat-messages::-webkit-scrollbar-track {
            background: #000;
        }

        .chat-messages::-webkit-scrollbar-thumb {
            background: #0f0;
        }

        .chat-message {
            margin-bottom: 12px;
            padding: 8px;
            border-left: 3px solid #0f0;
            background: #001100;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from { transform: translateX(20px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .chat-user {
            color: #0ff;
            font-weight: bold;
            margin-bottom: 5px;
            font-size: 12px;
        }

        .chat-text {
            color: #0f0;
            font-size: 14px;
            line-height: 1.4;
            word-wrap: break-word;
        }

        .chat-input-area {
            padding: 15px;
            border-top: 2px solid #0f0;
            background: #001100;
        }

        .chat-username {
            width: 100%;
            background: #000;
            border: 2px solid #0f0;
            color: #0f0;
            padding: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            margin-bottom: 8px;
        }

        .chat-input {
            width: 100%;
            background: #000;
            border: 2px solid #0f0;
            color: #0f0;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin-bottom: 8px;
            resize: vertical;
            min-height: 60px;
        }

        .send-btn {
            width: 100%;
            background: #0f0;
            color: #000;
            border: none;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .send-btn:hover {
            background: #0a0;
            box-shadow: 0 0 20px #0f0;
        }

        .back-link {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #0f0;
            color: #000;
            text-decoration: none;
            padding: 10px 20px;
            font-weight: bold;
            z-index: 1000;
            border: 2px solid #0f0;
            box-shadow: 0 0 10px #0f0;
            transition: all 0.3s;
        }

        .back-link:hover {
            background: #0a0;
            box-shadow: 0 0 20px #0f0;
        }

        @media (max-width: 968px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr 1fr;
            }

            .video-section {
                border-right: none;
                border-bottom: 3px solid #0f0;
            }
        }
    </style>
</head>
<body>
    <div class="chaos-bg">
        â–ˆâ–“â–’â–‘â–ˆâ–“â–’â–‘â–ˆâ–“â–’â–‘â–ˆâ–“â–’â–‘â–ˆâ–“â–’â–‘â–ˆâ–“â–’â–‘â–ˆâ–“â–’â–‘â–ˆâ–“â–’â–‘â–ˆâ–“â–’â–‘â–ˆâ–“â–’â–‘â–ˆâ–“â–’â–‘â–ˆâ–“â–’â–‘â–ˆâ–“â–’â–‘â–ˆâ–“â–’â–‘â–ˆâ–“â–’â–‘â–ˆâ–“â–’â–‘
    </div>

    <a href="https://sloppy.live" class="back-link">EXIT</a>
            <a href="https://sloppy.live/overview" style="color:#4ecdc4;text-decoration:none;margin-left:10px">ðŸŽ¨ View All Apps</a>

    <div class="container">
        <div class="header">
            <h1>ðŸ§  KNOWLEDGE CHAOS ðŸ§ </h1>
            <div class="status">âš¡ LIVE âš¡</div>
        </div>

        <div class="video-section">
            <div class="video-controls">
                <input
                    type="text"
                    class="video-input"
                    id="videoInput"
                    placeholder="Paste YouTube URL or Video ID..."
                >
                <button class="load-btn" onclick="loadVideo()">â–º LOAD VIDEO</button>
            </div>

            <div class="video-container" id="videoContainer">
                <iframe
                    id="videoFrame"
                    src="https://www.youtube.com/embed/h6fcK_fRYaI"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                    allowfullscreen>
                </iframe>
            </div>

            <div class="preset-videos">
                <button class="preset-btn" onclick="loadPreset('h6fcK_fRYaI')">â–¶ Alan Watts - Nature of Reality</button>
                <button class="preset-btn" onclick="loadPreset('wU0PYcCsL6o')">â–¶ Terence McKenna - Timewave Zero</button>
                <button class="preset-btn" onclick="loadPreset('jPpUNAFHgxM')">â–¶ Carl Sagan - Pale Blue Dot</button>
                <button class="preset-btn" onclick="loadPreset('rBpaUICxEhk')">â–¶ Richard Feynman - Beauty of Physics</button>
                <button class="preset-btn" onclick="loadPreset('3qHkcs3kG44')">â–¶ Ram Dass - Be Here Now</button>
                <button class="preset-btn" onclick="loadPreset('8CrOL-ydFMI')">â–¶ Jordan Peterson - Meaning Crisis</button>
            </div>
        </div>

        <div class="chat-section">
            <div class="chat-header">
                >>> KNOWLEDGE SEEKERS CHAT <<<
            </div>

            <div class="chat-messages" id="chatMessages">
                <div class="chat-message">
                    <div class="chat-user">SYSTEM</div>
                    <div class="chat-text">Welcome to Knowledge Chaos. Share wisdom. Seek truth.</div>
                </div>
            </div>

            <div class="chat-input-area">
                <input
                    type="text"
                    class="chat-username"
                    id="chatUsername"
                    placeholder="Your name..."
                    maxlength="20"
                >
                <textarea
                    class="chat-input"
                    id="chatInput"
                    placeholder="Share your thoughts on the knowledge..."
                    maxlength="500"
                ></textarea>
                <button class="send-btn" onclick="sendMessage()">>>> SEND <<<</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { supabase, supabaseSession } from '../../supabase-config.js';

        let user = null;

        // Initialize
        async function init() {
            try {
                const { user: currentUser } = await supabaseSession();
                user = currentUser;
                await loadMessages();
                subscribeToMessages();
            } catch (e) {
                console.error('Error initializing', e);
            }
        }

        // Load video
        window.loadVideo = function() {
            const input = document.getElementById('videoInput').value.trim();
            if (!input) return;

            let videoId = input;

            // Extract video ID from various YouTube URL formats
            if (input.includes('youtube.com/watch?v=')) {
                videoId = input.split('v=')[1].split('&')[0];
            } else if (input.includes('youtu.be/')) {
                videoId = input.split('youtu.be/')[1].split('?')[0];
            } else if (input.includes('youtube.com/embed/')) {
                videoId = input.split('embed/')[1].split('?')[0];
            }

            document.getElementById('videoFrame').src = `https://www.youtube.com/embed/${videoId}`;
            document.getElementById('videoInput').value = '';
        };

        window.loadPreset = function(videoId) {
            document.getElementById('videoFrame').src = `https://www.youtube.com/embed/${videoId}`;
        };

        // Load messages
        async function loadMessages() {
            try {
                const { data, error } = await supabase
                    .from('knowledge_messages')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(50);

                if (error) throw error;

                const container = document.getElementById('chatMessages');
                // Keep system message
                const systemMsg = container.firstElementChild;

                if (data && data.length > 0) {
                    data.reverse().forEach(msg => {
                        displayMessage(msg, true);
                    });
                }
            } catch (e) {
                console.error('Error loading messages', e);
            }
        }

        // Display message
        function displayMessage(msg, skipScroll = false) {
            const container = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message';

            messageDiv.innerHTML = `
                <div class="chat-user">${msg.username || 'Anonymous'}</div>
                <div class="chat-text">${msg.message}</div>
            `;

            container.appendChild(messageDiv);

            if (!skipScroll) {
                container.scrollTop = container.scrollHeight;
            }
        }

        // Send message
        window.sendMessage = async function() {
            const username = document.getElementById('chatUsername').value.trim() || 'Anonymous';
            const message = document.getElementById('chatInput').value.trim();

            if (!message || !user) return;

            try {
                const { error } = await supabase
                    .from('knowledge_messages')
                    .insert({
                        user_id: user.id,
                        username: username,
                        message: message
                    });

                if (error) throw error;

                document.getElementById('chatInput').value = '';
            } catch (e) {
                console.error('Error sending message', e);
            }
        };

        // Subscribe to messages
        function subscribeToMessages() {
            supabase
                .channel('knowledge_messages')
                .on('postgres_changes',
                    { event: 'INSERT', schema: 'public', table: 'knowledge_messages' },
                    (payload) => {
                        displayMessage(payload.new);
                    }
                )
                .subscribe();
        }

        // Enter to send
        document.getElementById('chatInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        document.getElementById('videoInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                loadVideo();
            }
        });

        // Initialize
        init();
    </script>
</body>
</html>
