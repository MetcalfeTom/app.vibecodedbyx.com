<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>PIRATE TAVERN - Brew Yer Fortune</title>
  <link rel="icon" href="https://emojicdn.elk.sh/üç∫">
  <meta property="og:title" content="PIRATE TAVERN - Brew Yer Fortune">
  <meta property="og:description" content="Build yer rum empire one tankard at a time!">
  <meta property="og:url" content="https://sloppy.live/nacho-empire">
  <meta property="og:image" content="https://emojicdn.elk.sh/üè¥‚Äç‚ò†Ô∏è?style=apple&size=512">
  <link href="https://fonts.googleapis.com/css2?family=Pirata+One&family=IM+Fell+English+SC&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      min-height: 100vh;
      background: linear-gradient(180deg, #1a0f0a 0%, #2a1810 50%, #0d0705 100%);
      font-family: 'IM Fell English SC', serif;
      display: flex;
      overflow: hidden;
      user-select: none;
    }
    .game-area {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      position: relative;
      background-image:
        repeating-linear-gradient(90deg, transparent, transparent 50px, rgba(60,40,20,0.1) 50px, rgba(60,40,20,0.1) 100px),
        repeating-linear-gradient(0deg, transparent, transparent 50px, rgba(60,40,20,0.05) 50px, rgba(60,40,20,0.05) 100px);
    }
    .title {
      font-family: 'Pirata One', cursive;
      font-size: 3rem;
      color: #d4a84b;
      text-shadow: 0 0 30px rgba(212,168,75,0.5), 3px 3px 0 #5c3a1e;
      letter-spacing: 0.1em;
      margin-bottom: 10px;
    }
    .rum-count {
      font-family: 'Pirata One', cursive;
      font-size: 2.5rem;
      color: #ffd700;
      text-shadow: 0 0 20px rgba(255,215,0,0.5);
      margin-bottom: 5px;
    }
    .per-second {
      font-size: 1rem;
      color: #c9a959;
      margin-bottom: 30px;
    }
    .barrel-container {
      position: relative;
      cursor: pointer;
      transition: transform 0.1s;
    }
    .barrel-container:active { transform: scale(0.95); }
    .rum-barrel {
      width: 280px;
      height: 280px;
      position: relative;
      filter: drop-shadow(0 0 40px rgba(212,168,75,0.6));
    }
    .barrel-glow {
      position: absolute;
      inset: -40px;
      background: radial-gradient(circle, rgba(212,168,75,0.3) 0%, transparent 70%);
      animation: pulse 2s ease-in-out infinite;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 0.5; }
      50% { transform: scale(1.1); opacity: 0.8; }
    }
    .click-power {
      position: absolute;
      bottom: -40px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.9rem;
      color: #d4a84b;
    }
    .shop-panel {
      width: 320px;
      height: 100vh;
      background: linear-gradient(180deg, #2a1810 0%, #1a0a00 100%);
      border-left: 3px solid #d4a84b;
      padding: 20px 15px;
      overflow-y: auto;
      background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0 0h60v60H0z' fill='none'/%3E%3Cpath d='M30 5L35 15H25z' fill='%23d4a84b' opacity='0.03'/%3E%3C/svg%3E");
    }
    .shop-title {
      font-family: 'Pirata One', cursive;
      font-size: 1.8rem;
      color: #d4a84b;
      text-align: center;
      margin-bottom: 15px;
    }
    .upgrade {
      background: linear-gradient(135deg, #3d2817 0%, #2a1810 100%);
      border: 2px solid #5c3a1e;
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .upgrade:hover { border-color: #d4a84b; transform: translateX(-5px); }
    .upgrade.locked { opacity: 0.5; cursor: not-allowed; }
    .upgrade.locked:hover { border-color: #5c3a1e; transform: none; }
    .upgrade-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 5px;
    }
    .upgrade-name {
      font-family: 'Pirata One', cursive;
      font-size: 1rem;
      color: #d4a84b;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .upgrade-count {
      font-size: 0.8rem;
      color: #8b7355;
      background: #1a0a00;
      padding: 2px 8px;
      border-radius: 10px;
    }
    .upgrade-cost {
      font-size: 0.9rem;
      color: #ff8c00;
    }
    .upgrade-desc {
      font-size: 0.75rem;
      color: #8b7355;
    }
    .upgrade-production {
      font-size: 0.7rem;
      color: #6a8a6a;
      margin-top: 3px;
    }
    .particles {
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
    }
    .particle {
      position: absolute;
      font-size: 1.5rem;
      animation: float-up 1s ease-out forwards;
    }
    @keyframes float-up {
      0% { opacity: 1; transform: translateY(0) scale(1); }
      100% { opacity: 0; transform: translateY(-100px) scale(0.5); }
    }
    .click-text {
      position: absolute;
      font-family: 'Pirata One', cursive;
      font-size: 2rem;
      color: #d4a84b;
      text-shadow: 2px 2px 0 #5c3a1e;
      pointer-events: none;
      animation: pop-up 0.6s ease-out forwards;
    }
    @keyframes pop-up {
      0% { opacity: 1; transform: translateY(0) scale(1); }
      100% { opacity: 0; transform: translateY(-80px) scale(1.5); }
    }
    .stats {
      position: absolute;
      bottom: 20px;
      left: 20px;
      font-size: 0.75rem;
      color: #5c3a1e;
    }
    .back-link {
      position: fixed;
      bottom: 5px;
      right: 330px;
      color: #d4a84b;
      text-decoration: none;
      font-size: 0.65rem;
      opacity: 0.4;
    }
    /* Rare Parrot Companion */
    .parrot {
      position: fixed;
      cursor: pointer;
      z-index: 1000;
      filter: drop-shadow(0 0 15px #ff6600) drop-shadow(0 0 30px #ffd700);
      animation: parrot-float 3s ease-in-out infinite, parrot-glow 1.5s ease-in-out infinite alternate;
      transition: transform 0.2s;
      pointer-events: auto;
    }
    .parrot:hover { transform: scale(1.2); }
    .parrot.caught {
      animation: parrot-catch 0.5s ease-out forwards;
      pointer-events: none;
    }
    @keyframes parrot-float {
      0%, 100% { transform: translateY(0) rotate(-5deg); }
      50% { transform: translateY(-20px) rotate(5deg); }
    }
    @keyframes parrot-glow {
      0% { filter: drop-shadow(0 0 20px #ff6600) drop-shadow(0 0 40px #ffd700); }
      100% { filter: drop-shadow(0 0 30px #ffd700) drop-shadow(0 0 50px #ff6600); }
    }
    @keyframes parrot-catch {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(2) rotate(360deg); opacity: 1; }
      100% { transform: scale(0) rotate(720deg); opacity: 0; }
    }
    .parrot-bonus {
      position: fixed;
      font-family: 'Pirata One', cursive;
      font-size: 2.5rem;
      color: #ffd700;
      text-shadow: 0 0 20px #ff6600, 3px 3px 0 #8b4513;
      pointer-events: none;
      z-index: 1001;
      animation: bonus-pop 1.5s ease-out forwards;
    }
    @keyframes bonus-pop {
      0% { transform: scale(0.5) translateY(0); opacity: 1; }
      30% { transform: scale(1.3) translateY(-30px); opacity: 1; }
      100% { transform: scale(1) translateY(-150px); opacity: 0; }
    }
    .parrot-sparkle {
      position: fixed;
      font-size: 1.5rem;
      pointer-events: none;
      z-index: 1000;
      animation: sparkle-burst 0.8s ease-out forwards;
    }
    @keyframes sparkle-burst {
      0% { transform: scale(1); opacity: 1; }
      100% { transform: scale(0) translateY(-50px); opacity: 0; }
    }
    .parrot-hint {
      position: fixed;
      bottom: 60px;
      left: 20px;
      font-size: 0.7rem;
      color: #ff6600;
      opacity: 0;
      transition: opacity 0.5s;
      font-family: 'Pirata One', cursive;
    }
    .parrot-hint.visible { opacity: 0.7; }

    @media (max-width: 700px) {
      body { flex-direction: column; }
      .shop-panel {
        width: 100%;
        height: auto;
        max-height: 40vh;
        border-left: none;
        border-top: 3px solid #d4a84b;
      }
      .rum-barrel { width: 200px; height: 200px; }
      .title { font-size: 2rem; }
      .rum-count { font-size: 1.8rem; }
      .back-link { right: 10px; }
    }
  </style>
</head>
<body>
  <div class="game-area">
    <div class="title">üè¥‚Äç‚ò†Ô∏è PIRATE TAVERN</div>
    <div class="rum-count"><span id="rum">0</span> grog</div>
    <div class="per-second" id="perSecond">0 barrels per second</div>

    <div class="barrel-container" id="barrel">
      <div class="barrel-glow"></div>
      <svg class="rum-barrel" viewBox="0 0 100 100">
        <defs>
          <linearGradient id="barrelGrad" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#8b5a2b"/>
            <stop offset="30%" style="stop-color:#6b4423"/>
            <stop offset="50%" style="stop-color:#8b5a2b"/>
            <stop offset="70%" style="stop-color:#5c3a1e"/>
            <stop offset="100%" style="stop-color:#4a2c0f"/>
          </linearGradient>
          <linearGradient id="bandGrad" x1="0%" y1="0%" x2="0%" y2="100%">
            <stop offset="0%" style="stop-color:#d4a84b"/>
            <stop offset="50%" style="stop-color:#ffd700"/>
            <stop offset="100%" style="stop-color:#b8860b"/>
          </linearGradient>
        </defs>
        <!-- Barrel body -->
        <ellipse cx="50" cy="50" rx="40" ry="45" fill="url(#barrelGrad)"/>
        <!-- Wood planks -->
        <path d="M15 30 Q50 25 85 30" stroke="#4a2c0f" stroke-width="1" fill="none"/>
        <path d="M12 45 Q50 40 88 45" stroke="#4a2c0f" stroke-width="1" fill="none"/>
        <path d="M12 55 Q50 60 88 55" stroke="#4a2c0f" stroke-width="1" fill="none"/>
        <path d="M15 70 Q50 75 85 70" stroke="#4a2c0f" stroke-width="1" fill="none"/>
        <!-- Metal bands -->
        <ellipse cx="50" cy="20" rx="35" ry="8" fill="none" stroke="url(#bandGrad)" stroke-width="4"/>
        <ellipse cx="50" cy="80" rx="35" ry="8" fill="none" stroke="url(#bandGrad)" stroke-width="4"/>
        <ellipse cx="50" cy="50" rx="40" ry="10" fill="none" stroke="url(#bandGrad)" stroke-width="3"/>
        <!-- Skull emblem -->
        <circle cx="50" cy="50" r="12" fill="#1a0f0a"/>
        <text x="50" y="55" font-size="16" fill="#d4a84b" text-anchor="middle">‚ò†</text>
        <!-- Highlight -->
        <ellipse cx="35" cy="35" rx="10" ry="15" fill="rgba(255,255,255,0.1)"/>
        <!-- Spigot -->
        <rect x="75" y="45" width="15" height="10" fill="#8b6914" rx="2"/>
        <circle cx="88" cy="50" r="3" fill="#d4a84b"/>
      </svg>
      <div class="click-power">+<span id="clickPower">1</span> per tap</div>
    </div>

    <div class="stats" id="stats">Taps: 0 | Total Grog: 0</div>
  </div>

  <div class="shop-panel">
    <div class="shop-title">‚öì CREW & SUPPLIES</div>
    <div id="upgradeList"></div>
  </div>

  <div class="particles" id="particles"></div>
  <div class="parrot-hint" id="parrotHint">~ Arr! A golden parrot be near... ~</div>
  <a href="https://sloppy.live" class="back-link">‚Üê sloppy.live</a>

<script>
let rum = 0;
let totalRum = 0;
let totalClicks = 0;
let rumPerSecond = 0;
let clickPower = 1;
let parrotsCaught = 0;
let parrotActive = false;

const upgrades = [
  { id: 'cabin', name: 'Cabin Boy', emoji: 'üßí', desc: 'Serves grog to thirsty sailors', baseCost: 15, baseProduction: 0.1, count: 0 },
  { id: 'cook', name: 'Ship Cook', emoji: 'üë®‚Äçüç≥', desc: 'Brews grog with secret recipe', baseCost: 100, baseProduction: 1, count: 0 },
  { id: 'cane', name: 'Sugarcane Field', emoji: 'üåæ', desc: 'Grows the finest sugar fer rum', baseCost: 1100, baseProduction: 8, count: 0 },
  { id: 'distillery', name: 'Rum Distillery', emoji: 'üè≠', desc: 'Industrial scale rum production', baseCost: 12000, baseProduction: 47, count: 0 },
  { id: 'mine', name: 'Gold Mine', emoji: '‚õèÔ∏è', desc: 'Funds yer rum operations', baseCost: 130000, baseProduction: 260, count: 0 },
  { id: 'hideout', name: 'Pirate Hideout', emoji: 'üèùÔ∏è', desc: 'Secret base with rum cellars', baseCost: 1400000, baseProduction: 1400, count: 0 },
  { id: 'witch', name: 'Sea Witch', emoji: 'üßô‚Äç‚ôÄÔ∏è', desc: 'Conjures rum from the depths', baseCost: 20000000, baseProduction: 7800, count: 0 },
  { id: 'kraken', name: 'Kraken Pact', emoji: 'ü¶ë', desc: 'The beast delivers tribute', baseCost: 330000000, baseProduction: 44000, count: 0 },
  { id: 'island', name: 'Treasure Island', emoji: 'üó∫Ô∏è', desc: 'Legendary rum springs eternal', baseCost: 5100000000, baseProduction: 260000, count: 0 },
  { id: 'seas', name: 'Seven Seas', emoji: 'üåä', desc: 'Rule all the rum in the world', baseCost: 75000000000, baseProduction: 1600000, count: 0 }
];

function formatNumber(n) {
  if (n < 1000) return Math.floor(n).toLocaleString();
  if (n < 1000000) return (n/1000).toFixed(1) + 'K';
  if (n < 1000000000) return (n/1000000).toFixed(2) + 'M';
  if (n < 1000000000000) return (n/1000000000).toFixed(2) + 'B';
  if (n < 1000000000000000) return (n/1000000000000).toFixed(2) + 'T';
  return (n/1000000000000000).toFixed(2) + 'Q';
}

function getCost(upgrade) {
  return Math.floor(upgrade.baseCost * Math.pow(1.15, upgrade.count));
}

function updateDisplay() {
  document.getElementById('rum').textContent = formatNumber(rum);
  document.getElementById('perSecond').textContent = formatNumber(rumPerSecond) + ' barrels per second';
  document.getElementById('clickPower').textContent = formatNumber(clickPower);
  document.getElementById('stats').innerHTML = `Taps: ${formatNumber(totalClicks)} | Grog: ${formatNumber(totalRum)} | Parrots: ${parrotsCaught}`;
}

function renderUpgrades() {
  const list = document.getElementById('upgradeList');
  list.innerHTML = upgrades.map(u => {
    const cost = getCost(u);
    const locked = rum < cost;
    const production = u.baseProduction * u.count;
    return `
      <div class="upgrade ${locked ? 'locked' : ''}" data-id="${u.id}">
        <div class="upgrade-header">
          <span class="upgrade-name">${u.emoji} ${u.name}</span>
          <span class="upgrade-count">${u.count}</span>
        </div>
        <div class="upgrade-cost">üç∫ ${formatNumber(cost)}</div>
        <div class="upgrade-desc">${u.desc}</div>
        <div class="upgrade-production">+${u.baseProduction}/s each | Total: ${formatNumber(production)}/s</div>
      </div>
    `;
  }).join('');

  document.querySelectorAll('.upgrade:not(.locked)').forEach(el => {
    el.onclick = () => buyUpgrade(el.dataset.id);
  });
}

function buyUpgrade(id) {
  const upgrade = upgrades.find(u => u.id === id);
  const cost = getCost(upgrade);

  if (rum >= cost) {
    rum -= cost;
    upgrade.count++;
    recalculateProduction();
    updateDisplay();
    renderUpgrades();
    saveGame();
  }
}

function recalculateProduction() {
  rumPerSecond = 0;
  upgrades.forEach(u => {
    rumPerSecond += u.baseProduction * u.count;
  });
  clickPower = 1 + Math.floor(rumPerSecond / 100);
}

function spawnParticle(x, y) {
  const particles = document.getElementById('particles');
  const p = document.createElement('div');
  p.className = 'particle';
  p.textContent = ['üç∫', 'ü•É', '‚öì', 'üí∞', 'üè¥‚Äç‚ò†Ô∏è'][Math.floor(Math.random() * 5)];
  p.style.left = (x + (Math.random() - 0.5) * 100) + 'px';
  p.style.top = y + 'px';
  particles.appendChild(p);
  setTimeout(() => p.remove(), 1000);
}

function spawnClickText(x, y, amount) {
  const text = document.createElement('div');
  text.className = 'click-text';
  text.textContent = '+' + formatNumber(amount);
  text.style.left = x + 'px';
  text.style.top = y + 'px';
  document.body.appendChild(text);
  setTimeout(() => text.remove(), 600);
}

function handleClick(e) {
  const rect = e.currentTarget.getBoundingClientRect();
  const x = rect.left + rect.width / 2;
  const y = rect.top + rect.height / 2;

  rum += clickPower;
  totalRum += clickPower;
  totalClicks++;

  for (let i = 0; i < 3; i++) {
    spawnParticle(x, y);
  }
  spawnClickText(e.clientX, e.clientY, clickPower);

  updateDisplay();
  renderUpgrades();
}

function gameLoop() {
  if (rumPerSecond > 0) {
    const gain = rumPerSecond / 60;
    rum += gain;
    totalRum += gain;
    updateDisplay();
    renderUpgrades();
  }
}

function saveGame() {
  const save = {
    rum,
    totalRum,
    totalClicks,
    parrotsCaught,
    upgrades: upgrades.map(u => ({ id: u.id, count: u.count }))
  };
  localStorage.setItem('pirateTavern', JSON.stringify(save));
}

function loadGame() {
  try {
    // Try new save first
    let save = JSON.parse(localStorage.getItem('pirateTavern'));
    // Fallback to old nacho save
    if (!save) {
      const oldSave = JSON.parse(localStorage.getItem('nachoEmpire'));
      if (oldSave) {
        save = {
          rum: oldSave.nachos || 0,
          totalRum: oldSave.totalNachos || 0,
          totalClicks: oldSave.totalClicks || 0,
          parrotsCaught: oldSave.seahorsesCaught || 0,
          upgrades: oldSave.upgrades
        };
      }
    }
    if (save) {
      rum = save.rum || 0;
      totalRum = save.totalRum || 0;
      totalClicks = save.totalClicks || 0;
      parrotsCaught = save.parrotsCaught || 0;
      if (save.upgrades) {
        save.upgrades.forEach(s => {
          const u = upgrades.find(up => up.id === s.id);
          if (u) u.count = s.count;
        });
      }
      recalculateProduction();
    }
  } catch (e) {
    console.log('No save found');
  }
}

// Rare Parrot Companion
function spawnParrot() {
  if (parrotActive) return;
  parrotActive = true;

  const hint = document.getElementById('parrotHint');
  hint.classList.add('visible');

  setTimeout(() => {
    hint.classList.remove('visible');

    const parrot = document.createElement('div');
    parrot.className = 'parrot';
    parrot.innerHTML = `<svg viewBox="0 0 64 64" width="80" height="80">
      <defs>
        <linearGradient id="parrotGrad" x1="0%" y1="0%" x2="100%" y2="100%">
          <stop offset="0%" style="stop-color:#ff6600"/>
          <stop offset="50%" style="stop-color:#ffd700"/>
          <stop offset="100%" style="stop-color:#ff3300"/>
        </linearGradient>
      </defs>
      <!-- Body -->
      <ellipse cx="32" cy="35" rx="14" ry="18" fill="url(#parrotGrad)"/>
      <!-- Head -->
      <circle cx="32" cy="18" r="12" fill="#ff6600"/>
      <!-- Beak -->
      <path d="M44 18 Q50 20 48 26 Q44 24 42 20" fill="#ffd700"/>
      <path d="M44 18 Q46 22 44 24" fill="#ff9900"/>
      <!-- Eye -->
      <circle cx="38" cy="16" r="4" fill="#fff"/>
      <circle cx="39" cy="15" r="2" fill="#000"/>
      <!-- Wing -->
      <path d="M20 30 Q10 35 15 50 Q25 48 28 40" fill="#00cc66"/>
      <path d="M22 32 Q14 36 18 46" stroke="#009944" stroke-width="1" fill="none"/>
      <!-- Tail feathers -->
      <path d="M32 52 Q28 65 22 70" stroke="#ff3300" stroke-width="4" stroke-linecap="round"/>
      <path d="M32 52 Q32 68 32 72" stroke="#ffd700" stroke-width="4" stroke-linecap="round"/>
      <path d="M32 52 Q36 65 42 70" stroke="#00cc66" stroke-width="4" stroke-linecap="round"/>
      <!-- Crest -->
      <path d="M26 8 Q24 2 28 4 M30 6 Q30 0 34 2 M34 8 Q38 2 36 6" stroke="#ff3300" stroke-width="2" fill="none" stroke-linecap="round"/>
    </svg>`;
    parrot.id = 'activeParrot';

    const maxX = window.innerWidth - 400;
    const maxY = window.innerHeight - 100;
    parrot.style.left = (100 + Math.random() * (maxX - 200)) + 'px';
    parrot.style.top = (100 + Math.random() * (maxY - 200)) + 'px';

    parrot.onclick = catchParrot;
    parrot.ontouchstart = (e) => { e.preventDefault(); catchParrot(e); };

    document.body.appendChild(parrot);

    setTimeout(() => {
      if (document.getElementById('activeParrot')) {
        parrot.style.transition = 'opacity 1s, transform 1s';
        parrot.style.opacity = '0';
        parrot.style.transform = 'translateX(200px)';
        setTimeout(() => {
          parrot.remove();
          parrotActive = false;
        }, 1000);
      }
    }, 12000);
  }, 2000);
}

function catchParrot(e) {
  const parrot = document.getElementById('activeParrot');
  if (!parrot) return;

  const rect = parrot.getBoundingClientRect();
  const x = rect.left + rect.width / 2;
  const y = rect.top + rect.height / 2;

  parrot.classList.add('caught');
  parrotsCaught++;

  const bonus = Math.max(100, Math.floor(rumPerSecond * 10 + 100));
  rum += bonus;
  totalRum += bonus;

  const bonusText = document.createElement('div');
  bonusText.className = 'parrot-bonus';
  bonusText.innerHTML = `PARROT CAUGHT!<br>+${formatNumber(bonus)} grog!`;
  bonusText.style.left = x + 'px';
  bonusText.style.top = y + 'px';
  document.body.appendChild(bonusText);
  setTimeout(() => bonusText.remove(), 1500);

  for (let i = 0; i < 12; i++) {
    const sparkle = document.createElement('div');
    sparkle.className = 'parrot-sparkle';
    sparkle.textContent = ['‚ú®', 'üí´', 'ü™ô', 'üí∞', 'ü¶ú', '‚≠ê'][Math.floor(Math.random() * 6)];
    sparkle.style.left = (x + (Math.random() - 0.5) * 150) + 'px';
    sparkle.style.top = (y + (Math.random() - 0.5) * 150) + 'px';
    document.body.appendChild(sparkle);
    setTimeout(() => sparkle.remove(), 800);
  }

  setTimeout(() => {
    parrot.remove();
    parrotActive = false;
  }, 500);

  updateDisplay();
  renderUpgrades();
  saveGame();
}

function scheduleNextParrot() {
  const delay = (30 + Math.random() * 60) * 1000;
  setTimeout(() => {
    spawnParrot();
    scheduleNextParrot();
  }, delay);
}

// Events
document.getElementById('barrel').addEventListener('click', handleClick);
document.getElementById('barrel').addEventListener('touchstart', e => {
  e.preventDefault();
  handleClick({ currentTarget: e.currentTarget, clientX: e.touches[0].clientX, clientY: e.touches[0].clientY });
});

// Init
loadGame();
updateDisplay();
renderUpgrades();

setInterval(gameLoop, 1000 / 60);
setInterval(saveGame, 10000);

setTimeout(() => {
  spawnParrot();
  scheduleNextParrot();
}, (20 + Math.random() * 20) * 1000);
</script>
</body>
</html>
