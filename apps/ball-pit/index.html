<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Neon Ball Pit</title>
  <link rel="icon" href="https://emojicdn.elk.sh/ðŸ”®">
  <meta property="og:title" content="Neon Ball Pit">
  <meta property="og:description" content="Dive into a physics-powered neon ball pit with gravity toggles">
  <meta property="og:url" content="https://sloppy.live/ball-pit">
  <meta property="og:image" content="https://emojicdn.elk.sh/ðŸ”®?style=apple&size=512">
  <script src="https://cdn.babylonjs.com/babylon.js"></script>
  <script src="https://cdn.babylonjs.com/cannon.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: #0a0a0f;
      overflow: hidden;
      font-family: 'Orbitron', sans-serif;
    }
    #renderCanvas {
      width: 100%;
      height: 100vh;
      display: block;
      touch-action: none;
    }
    .controls {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 12px;
      z-index: 100;
      flex-wrap: wrap;
      justify-content: center;
      padding: 0 10px;
    }
    .btn {
      padding: 12px 24px;
      background: rgba(0, 0, 0, 0.7);
      border: 2px solid #00ffff;
      color: #00ffff;
      font-family: 'Orbitron', sans-serif;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    .btn:hover {
      background: rgba(0, 255, 255, 0.2);
      box-shadow: 0 0 20px #00ffff;
    }
    .btn.active {
      background: #00ffff;
      color: #000;
    }
    .btn.add { border-color: #ff00ff; color: #ff00ff; }
    .btn.add:hover { background: rgba(255, 0, 255, 0.2); box-shadow: 0 0 20px #ff00ff; }
    .btn.reset { border-color: #ff4444; color: #ff4444; }
    .btn.reset:hover { background: rgba(255, 68, 68, 0.2); box-shadow: 0 0 20px #ff4444; }

    .stats {
      position: fixed;
      top: 20px;
      left: 20px;
      color: #00ffff;
      font-size: 0.75rem;
      background: rgba(0, 0, 0, 0.6);
      padding: 15px;
      border: 1px solid rgba(0, 255, 255, 0.3);
    }
    .stats div { margin: 5px 0; }
    .stats span { color: #ff00ff; }

    .title {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      color: #00ffff;
      font-size: 1.5rem;
      font-weight: 700;
      text-shadow: 0 0 30px #00ffff, 0 0 60px #00ffff;
      letter-spacing: 4px;
    }

    .back-link {
      position: fixed;
      top: 20px;
      right: 20px;
      color: #666;
      text-decoration: none;
      font-size: 0.7rem;
      transition: color 0.3s;
    }
    .back-link:hover { color: #00ffff; }

    .instructions {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      color: #666;
      font-size: 0.65rem;
      text-align: center;
    }

    @media (max-width: 600px) {
      .title { font-size: 1rem; }
      .btn { padding: 10px 16px; font-size: 0.7rem; }
      .stats { font-size: 0.65rem; padding: 10px; }
    }
  </style>
</head>
<body>
  <canvas id="renderCanvas"></canvas>

  <div class="title">NEON BALL PIT</div>

  <div class="stats">
    <div>BALLS: <span id="ball-count">0</span></div>
    <div>GRAVITY: <span id="gravity-status">ON</span></div>
  </div>

  <a href="https://sloppy.live" class="back-link">sloppy.live</a>

  <div class="instructions">Click/tap to spawn balls | Drag to rotate view</div>

  <div class="controls">
    <button class="btn add" onclick="spawnBalls(10)">+10 Balls</button>
    <button class="btn" id="gravity-btn" onclick="toggleGravity()">Gravity: ON</button>
    <button class="btn" id="antigrav-btn" onclick="setAntiGravity()">Anti-Gravity</button>
    <button class="btn" id="chaos-btn" onclick="toggleChaos()">Chaos Mode</button>
    <button class="btn reset" onclick="resetPit()">Reset</button>
  </div>

  <script>
    const canvas = document.getElementById('renderCanvas');
    const engine = new BABYLON.Engine(canvas, true);

    let scene, camera, physicsPlugin;
    let balls = [];
    let gravityOn = true;
    let chaosMode = false;
    let chaosInterval = null;

    const neonColors = [
      new BABYLON.Color3(0, 1, 1),      // Cyan
      new BABYLON.Color3(1, 0, 1),      // Magenta
      new BABYLON.Color3(0, 1, 0.5),    // Mint
      new BABYLON.Color3(1, 0.3, 0.5),  // Hot pink
      new BABYLON.Color3(0.5, 0, 1),    // Purple
      new BABYLON.Color3(1, 1, 0),      // Yellow
      new BABYLON.Color3(1, 0.5, 0),    // Orange
      new BABYLON.Color3(0, 0.5, 1),    // Blue
    ];

    function createScene() {
      scene = new BABYLON.Scene(engine);
      scene.clearColor = new BABYLON.Color4(0.02, 0.02, 0.05, 1);

      // Enable physics
      scene.enablePhysics(new BABYLON.Vector3(0, -9.81, 0), new BABYLON.CannonJSPlugin());
      physicsPlugin = scene.getPhysicsEngine();

      // Camera
      camera = new BABYLON.ArcRotateCamera('camera', Math.PI / 4, Math.PI / 3, 25, BABYLON.Vector3.Zero(), scene);
      camera.attachControl(canvas, true);
      camera.lowerRadiusLimit = 10;
      camera.upperRadiusLimit = 50;

      // Ambient light
      const ambient = new BABYLON.HemisphericLight('ambient', new BABYLON.Vector3(0, 1, 0), scene);
      ambient.intensity = 0.3;

      // Point lights for glow effect
      const light1 = new BABYLON.PointLight('light1', new BABYLON.Vector3(10, 10, 10), scene);
      light1.diffuse = new BABYLON.Color3(0, 1, 1);
      light1.intensity = 0.8;

      const light2 = new BABYLON.PointLight('light2', new BABYLON.Vector3(-10, 10, -10), scene);
      light2.diffuse = new BABYLON.Color3(1, 0, 1);
      light2.intensity = 0.8;

      // Create pit container
      createPit();

      // Spawn initial balls
      spawnBalls(30);

      // Click to spawn
      scene.onPointerDown = (evt, pickInfo) => {
        if (pickInfo.hit && evt.button === 0) {
          const pos = pickInfo.pickedPoint;
          spawnBall(pos.x + (Math.random() - 0.5) * 2, 8, pos.z + (Math.random() - 0.5) * 2);
        }
      };

      return scene;
    }

    function createPit() {
      const wallMat = new BABYLON.StandardMaterial('wallMat', scene);
      wallMat.diffuseColor = new BABYLON.Color3(0.1, 0.1, 0.15);
      wallMat.emissiveColor = new BABYLON.Color3(0.02, 0.02, 0.05);
      wallMat.alpha = 0.6;

      const floorMat = new BABYLON.StandardMaterial('floorMat', scene);
      floorMat.diffuseColor = new BABYLON.Color3(0.05, 0.05, 0.1);
      floorMat.emissiveColor = new BABYLON.Color3(0, 0.05, 0.05);

      // Floor
      const floor = BABYLON.MeshBuilder.CreateBox('floor', { width: 12, height: 0.5, depth: 12 }, scene);
      floor.position.y = -3;
      floor.material = floorMat;
      floor.physicsImpostor = new BABYLON.PhysicsImpostor(floor, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.6 }, scene);

      // Walls
      const wallConfigs = [
        { w: 12, h: 6, d: 0.3, x: 0, y: 0, z: 6 },
        { w: 12, h: 6, d: 0.3, x: 0, y: 0, z: -6 },
        { w: 0.3, h: 6, d: 12, x: 6, y: 0, z: 0 },
        { w: 0.3, h: 6, d: 12, x: -6, y: 0, z: 0 },
      ];

      wallConfigs.forEach((cfg, i) => {
        const wall = BABYLON.MeshBuilder.CreateBox(`wall${i}`, { width: cfg.w, height: cfg.h, depth: cfg.d }, scene);
        wall.position = new BABYLON.Vector3(cfg.x, cfg.y, cfg.z);
        wall.material = wallMat;
        wall.physicsImpostor = new BABYLON.PhysicsImpostor(wall, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 0, restitution: 0.5 }, scene);
      });

      // Neon edge lines
      const edgeColor = new BABYLON.Color3(0, 1, 1);
      const edges = [
        [[-6, -2.75, -6], [6, -2.75, -6]],
        [[6, -2.75, -6], [6, -2.75, 6]],
        [[6, -2.75, 6], [-6, -2.75, 6]],
        [[-6, -2.75, 6], [-6, -2.75, -6]],
        [[-6, 3, -6], [6, 3, -6]],
        [[6, 3, -6], [6, 3, 6]],
        [[6, 3, 6], [-6, 3, 6]],
        [[-6, 3, 6], [-6, 3, -6]],
      ];

      edges.forEach((edge, i) => {
        const points = edge.map(p => new BABYLON.Vector3(p[0], p[1], p[2]));
        const line = BABYLON.MeshBuilder.CreateLines(`edge${i}`, { points }, scene);
        line.color = i < 4 ? new BABYLON.Color3(0, 1, 1) : new BABYLON.Color3(1, 0, 1);
      });
    }

    function spawnBall(x, y, z) {
      const radius = 0.3 + Math.random() * 0.3;
      const ball = BABYLON.MeshBuilder.CreateSphere(`ball${balls.length}`, { diameter: radius * 2 }, scene);
      ball.position = new BABYLON.Vector3(x, y, z);

      // Random neon material
      const mat = new BABYLON.StandardMaterial(`ballMat${balls.length}`, scene);
      const color = neonColors[Math.floor(Math.random() * neonColors.length)];
      mat.diffuseColor = color;
      mat.emissiveColor = color.scale(0.5);
      mat.specularColor = new BABYLON.Color3(1, 1, 1);
      ball.material = mat;

      // Physics
      ball.physicsImpostor = new BABYLON.PhysicsImpostor(
        ball,
        BABYLON.PhysicsImpostor.SphereImpostor,
        { mass: 1, restitution: 0.7, friction: 0.3 },
        scene
      );

      // Random initial velocity
      ball.physicsImpostor.setLinearVelocity(new BABYLON.Vector3(
        (Math.random() - 0.5) * 5,
        Math.random() * 2,
        (Math.random() - 0.5) * 5
      ));

      balls.push(ball);
      updateStats();
    }

    function spawnBalls(count) {
      for (let i = 0; i < count; i++) {
        const x = (Math.random() - 0.5) * 8;
        const y = 5 + Math.random() * 5;
        const z = (Math.random() - 0.5) * 8;
        spawnBall(x, y, z);
      }
    }

    function toggleGravity() {
      gravityOn = !gravityOn;
      physicsPlugin.setGravity(new BABYLON.Vector3(0, gravityOn ? -9.81 : 0, 0));
      document.getElementById('gravity-btn').textContent = `Gravity: ${gravityOn ? 'ON' : 'OFF'}`;
      document.getElementById('gravity-btn').classList.toggle('active', gravityOn);
      document.getElementById('antigrav-btn').classList.remove('active');
      updateStats();
    }

    function setAntiGravity() {
      gravityOn = false;
      physicsPlugin.setGravity(new BABYLON.Vector3(0, 5, 0));
      document.getElementById('gravity-btn').textContent = 'Gravity: OFF';
      document.getElementById('gravity-btn').classList.remove('active');
      document.getElementById('antigrav-btn').classList.add('active');
      document.getElementById('gravity-status').textContent = 'REVERSE';
    }

    function toggleChaos() {
      chaosMode = !chaosMode;
      document.getElementById('chaos-btn').classList.toggle('active', chaosMode);

      if (chaosMode) {
        chaosInterval = setInterval(() => {
          balls.forEach(ball => {
            if (ball.physicsImpostor) {
              ball.physicsImpostor.applyImpulse(
                new BABYLON.Vector3(
                  (Math.random() - 0.5) * 8,
                  Math.random() * 6,
                  (Math.random() - 0.5) * 8
                ),
                ball.getAbsolutePosition()
              );
            }
          });
        }, 500);
      } else {
        clearInterval(chaosInterval);
      }
    }

    function resetPit() {
      // Remove all balls
      balls.forEach(ball => {
        ball.physicsImpostor.dispose();
        ball.dispose();
      });
      balls = [];

      // Reset gravity
      gravityOn = true;
      physicsPlugin.setGravity(new BABYLON.Vector3(0, -9.81, 0));
      document.getElementById('gravity-btn').textContent = 'Gravity: ON';
      document.getElementById('gravity-btn').classList.add('active');
      document.getElementById('antigrav-btn').classList.remove('active');

      // Reset chaos
      chaosMode = false;
      clearInterval(chaosInterval);
      document.getElementById('chaos-btn').classList.remove('active');

      // Spawn fresh balls
      spawnBalls(30);
      updateStats();
    }

    function updateStats() {
      document.getElementById('ball-count').textContent = balls.length;
      document.getElementById('gravity-status').textContent = gravityOn ? 'ON' : 'OFF';
    }

    // Initialize
    createScene();

    engine.runRenderLoop(() => {
      scene.render();
    });

    window.addEventListener('resize', () => {
      engine.resize();
    });
  </script>
</body>
</html>
