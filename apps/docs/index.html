<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sloppy Universal Layer Docs</title>
  <link rel="icon" href="https://emojicdn.elk.sh/ðŸ“œ">
  <script src="/vibelib-extended.js"></script>
  <script src="/apps/sloppy-header/sloppy-bar.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0d1117;
      --panel: #161b22;
      --border: #30363d;
      --text: #c9d1d9;
      --accent: #58a6ff;
      --code-bg: #1f2428;
    }
    body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; margin: 0; display: flex; }

    .sidebar { width: 250px; border-right: 1px solid var(--border); padding: 20px; position: fixed; height: 100vh; overflow-y: auto; }
    .sidebar h3 { font-size: 0.9rem; text-transform: uppercase; color: #8b949e; margin-bottom: 10px; }
    .sidebar a { display: block; padding: 5px 0; color: var(--text); text-decoration: none; font-size: 0.95rem; }
    .sidebar a:hover { color: var(--accent); }

    .main { margin-left: 250px; padding: 40px; max-width: 800px; }
    h1, h2, h3 { color: #fff; margin-top: 40px; }
    h1 { border-bottom: 1px solid var(--border); padding-bottom: 10px; }

    code { font-family: 'JetBrains Mono', monospace; background: rgba(110,118,129,0.4); padding: 0.2em 0.4em; border-radius: 6px; font-size: 85%; }
    pre { background: var(--code-bg); padding: 16px; border-radius: 6px; overflow-x: auto; border: 1px solid var(--border); }
    pre code { background: none; padding: 0; }

    .test-runner { background: var(--panel); border: 1px solid var(--border); border-radius: 8px; padding: 20px; margin-top: 20px; }
    .btn { background: #238636; color: #fff; border: 1px solid rgba(240,246,252,0.1); padding: 5px 16px; border-radius: 6px; font-weight: 600; cursor: pointer; }
    .btn:hover { background: #2ea043; }
    .btn-secondary { background: #30363d; }
    .btn-secondary:hover { background: #3b434b; }

    #console-output { font-family: 'JetBrains Mono', monospace; background: #000; color: #0f0; padding: 10px; border-radius: 4px; margin-top: 10px; min-height: 100px; white-space: pre-wrap; font-size: 0.85rem; }
  </style>
</head>
<body>

  <div class="sidebar">
    <h3>Documentation</h3>
    <a href="#intro">Introduction</a>
    <a href="#auth">Authentication</a>
    <a href="#economy">Economy</a>
    <a href="#identity">Identity</a>
    <a href="#desktop">Desktop / Nav</a>

    <h3>Tools</h3>
    <a href="#runner">Test Runner</a>
  </div>

  <div class="main">
    <h1 id="intro">Universal Layer Documentation</h1>
    <p>Welcome to the developer manual for the Sloppy Universal Layer. This bridge connects all apps in the ecosystem to a shared identity and economy.</p>

    <h2 id="auth">Authentication</h2>
    <p>Authentication is handled by Supabase and shared across the domain via cookies.</p>
    <pre><code>// Check current user
const user = await window.VibeLib.Auth.getUser();

// Login (Google)
window.VibeLib.Auth.login('google');

// Access Supabase directly
const { data } = await window.supabase.from('some_table').select('*');</code></pre>

    <h2 id="economy">Economy</h2>
    <p>Manage Karma (Participation Score) and Inventory.</p>

    <h3>Tracking Actions</h3>
    <pre><code>// Award Karma for user actions
window.VibeLib.Economy.track('participation', 10, 'Completed Level 1');</code></pre>

    <h3>Fetching Balance & Inventory</h3>
    <pre><code>// Get current user's economy state
const { balance, inventory } = await window.VibeLib.Economy.get();
console.log(balance); // 1500
console.log(inventory); // ['gold_crown', 'blue_theme']</code></pre>

    <h3>Purchasing Items</h3>
    <pre><code>// Buy an item (deducts cost, adds to inventory)
try {
  await window.VibeLib.Economy.purchase('gold_crown', 10000);
} catch (err) {
  console.error(err.message);
}</code></pre>

    <h2 id="identity">Identity</h2>
    <p>Manage universal profiles (bio, avatar, theme).</p>
    <pre><code>// Get profile (defaults to current user)
const profile = await window.VibeLib.Identity.get();

// Get another user's profile
const otherProfile = await window.VibeLib.Identity.get('user-uuid-here');

// Update profile
await window.VibeLib.Identity.update({
  bio: "Hello World",
  avatar_url: "https://example.com/me.png"
});</code></pre>

    <h2 id="runner">Test Runner</h2>
    <div class="test-runner">
      <p>Use this console to verify the bridge integration.</p>
      <div style="display:flex; gap:10px; margin-bottom:10px;">
        <button class="btn" onclick="runTest('fetchProfile')">Fetch My Profile</button>
        <button class="btn" onclick="runTest('reward')">Test Reward (+1 Karma)</button>
        <button class="btn btn-secondary" onclick="runTest('checkBalance')">Check Balance</button>
      </div>
      <div id="console-output">// Console Ready...</div>
    </div>

  </div>

  <script>
    function log(msg) {
        const out = document.getElementById('console-output');
        const time = new Date().toLocaleTimeString();
        out.innerText += `\n[${time}] ${msg}`;
        out.scrollTop = out.scrollHeight;
    }

    window.runTest = async function(testName) {
        if (!window.VibeLib) { log('Error: VibeLib not loaded'); return; }

        try {
            if (testName === 'fetchProfile') {
                log('Fetching profile...');
                const profile = await window.VibeLib.Identity.get();
                log('Profile: ' + JSON.stringify(profile, null, 2));
            }

            if (testName === 'reward') {
                log('Tracking participation (+1)...');
                await window.VibeLib.Economy.track('participation', 1, 'Test Runner');
                log('Done. Check balance to verify.');
            }

            if (testName === 'checkBalance') {
                log('Fetching economy state...');
                const state = await window.VibeLib.Economy.get();
                log('Economy: ' + JSON.stringify(state, null, 2));
            }
        } catch (e) {
            log('Error: ' + e.message);
        }
    };
  </script>
</body>
</html>
