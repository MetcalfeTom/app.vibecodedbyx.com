<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Plunder Pinball - Pirate Bounty</title>
  <link rel="icon" href="https://emojicdn.elk.sh/ðŸ´â€â˜ ï¸">
  <meta property="og:title" content="Plunder Pinball">
  <meta property="og:description" content="Pirate pinball with cannonballs - plunder the treasure!">
  <meta property="og:url" content="https://sloppy.live/quarantine-pinball">
  <meta property="og:image" content="https://sloppy.live/quarantine-pinball/og-image.png">
  <link href="https://fonts.googleapis.com/css2?family=Pirate+One&family=IM+Fell+English+SC&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: #1a0f0a;
      overflow: hidden;
      font-family: 'IM Fell English SC', serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      touch-action: none;
    }
    #game-container {
      position: relative;
      max-width: 500px;
      width: 100%;
    }
    canvas {
      display: block;
      width: 100%;
      border: 4px solid #8b5a2b;
      border-radius: 10px;
      box-shadow: 0 0 30px rgba(139, 90, 43, 0.5), inset 0 0 50px rgba(212, 168, 75, 0.1);
    }
    #ui {
      position: absolute;
      top: 10px;
      left: 10px;
      right: 10px;
      display: flex;
      justify-content: space-between;
      pointer-events: none;
      z-index: 10;
    }
    .score-box {
      background: rgba(26, 15, 10, 0.9);
      border: 2px solid #d4a84b;
      border-radius: 5px;
      padding: 8px 15px;
      color: #d4a84b;
      text-shadow: 0 0 10px rgba(212, 168, 75, 0.5);
    }
    .score-label {
      font-size: 10px;
      opacity: 0.7;
      font-family: 'Pirate One', cursive;
    }
    .score-value {
      font-size: 24px;
      font-family: 'Pirate One', cursive;
    }
    #lives {
      color: #c0392b;
      text-shadow: 0 0 10px rgba(192, 57, 43, 0.5);
    }
    #message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      color: #d4a84b;
      text-shadow: 2px 2px 0 #2a1810, 0 0 20px rgba(212, 168, 75, 0.5);
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 20;
    }
    #message.show { opacity: 1; }
    #message h2 {
      font-size: 32px;
      margin-bottom: 10px;
      font-family: 'Pirate One', cursive;
    }
    #message p {
      font-size: 14px;
    }
    #start-btn {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: linear-gradient(135deg, #8b5a2b, #d4a84b);
      border: 3px solid #5c3a1e;
      color: #1a0f0a;
      padding: 15px 40px;
      font-family: 'Pirate One', cursive;
      font-size: 20px;
      cursor: pointer;
      text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.3);
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
      transition: all 0.3s;
      z-index: 30;
    }
    #start-btn:hover {
      transform: translate(-50%, -50%) scale(1.05);
      box-shadow: 0 6px 30px rgba(212, 168, 75, 0.5);
    }
    #controls-hint {
      position: absolute;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      color: #8b7355;
      font-size: 11px;
      pointer-events: none;
    }
    #backlink {
      position: fixed;
      bottom: 10px;
      right: 10px;
      color: #8b7355;
      text-decoration: none;
      font-size: 12px;
      opacity: 0.5;
      z-index: 100;
    }
    #mobile-controls {
      display: none;
      position: absolute;
      bottom: 60px;
      left: 0;
      right: 0;
      justify-content: space-between;
      padding: 0 10px;
      z-index: 20;
    }
    .flipper-btn {
      width: 80px;
      height: 60px;
      background: rgba(139, 90, 43, 0.3);
      border: 2px solid #d4a84b;
      border-radius: 10px;
      color: #d4a84b;
      font-size: 24px;
      font-family: 'Pirate One', cursive;
    }
    .flipper-btn:active {
      background: rgba(212, 168, 75, 0.4);
    }
    @media (max-width: 600px) {
      #mobile-controls { display: flex; }
      #controls-hint { display: none; }
    }
  </style>
</head>
<body>
  <div id="game-container">
    <canvas id="game"></canvas>
    <div id="ui">
      <div class="score-box">
        <div class="score-label">DOUBLOONS</div>
        <div class="score-value" id="score">0</div>
      </div>
      <div class="score-box">
        <div class="score-label">CANNONBALLS</div>
        <div class="score-value" id="lives">ðŸ’£ðŸ’£ðŸ’£</div>
      </div>
    </div>
    <div id="message">
      <h2>AHOY MATEY!</h2>
      <p>Press SPACE or tap to fire cannon</p>
    </div>
    <button id="start-btn">SET SAIL!</button>
    <div id="controls-hint">A/LEFT = Port Plank â€¢ D/RIGHT = Starboard Plank â€¢ SPACE = Fire</div>
    <div id="mobile-controls">
      <button class="flipper-btn" id="left-btn">â—€</button>
      <button class="flipper-btn" id="right-btn">â–¶</button>
    </div>
  </div>
  <a id="backlink" href="https://sloppy.live">sloppy.live</a>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    const W = 500;
    const H = 700;
    canvas.width = W;
    canvas.height = H;

    let gameStarted = false;
    let score = 0;
    let lives = 3;
    let balls = [];
    let particles = [];

    const flippers = {
      left: {
        x: 150, y: 620, length: 70,
        angle: 0.4, targetAngle: 0.4, restAngle: 0.4, activeAngle: -0.6
      },
      right: {
        x: 350, y: 620, length: 70,
        angle: Math.PI - 0.4, targetAngle: Math.PI - 0.4,
        restAngle: Math.PI - 0.4, activeAngle: Math.PI + 0.6
      }
    };

    const bumpers = [
      { x: 150, y: 200, radius: 35, color: '#d4a84b', points: 100, type: 'chest' },
      { x: 350, y: 200, radius: 35, color: '#c0392b', points: 100, type: 'barrel' },
      { x: 250, y: 280, radius: 40, color: '#8b5a2b', points: 150, type: 'wheel' },
      { x: 180, y: 350, radius: 25, color: '#2e86ab', points: 75, type: 'gem' },
      { x: 320, y: 350, radius: 25, color: '#27ae60', points: 75, type: 'gem' }
    ];

    const targets = [];
    for (let i = 0; i < 5; i++) {
      targets.push({
        x: 100 + i * 75, y: 120, width: 40, height: 15,
        hit: false, color: '#d4a84b'
      });
    }

    const launcher = { x: 475, y: 600, power: 0, charging: false };

    const keys = {};
    window.addEventListener('keydown', e => {
      keys[e.code] = true;
      if (e.code === 'Space') e.preventDefault();
    });
    window.addEventListener('keyup', e => {
      keys[e.code] = false;
      if (e.code === 'Space' && launcher.charging) launchBall();
    });

    document.getElementById('left-btn').addEventListener('touchstart', e => { e.preventDefault(); keys['KeyA'] = true; });
    document.getElementById('left-btn').addEventListener('touchend', e => { e.preventDefault(); keys['KeyA'] = false; });
    document.getElementById('right-btn').addEventListener('touchstart', e => { e.preventDefault(); keys['KeyD'] = true; });
    document.getElementById('right-btn').addEventListener('touchend', e => { e.preventDefault(); keys['KeyD'] = false; });

    canvas.addEventListener('touchstart', e => {
      if (!gameStarted) return;
      const rect = canvas.getBoundingClientRect();
      const x = (e.touches[0].clientX - rect.left) / rect.width * W;
      if (x > W * 0.8) launcher.charging = true;
    });

    canvas.addEventListener('touchend', e => {
      if (launcher.charging) launchBall();
    });

    document.getElementById('start-btn').addEventListener('click', startGame);

    function startGame() {
      document.getElementById('start-btn').style.display = 'none';
      gameStarted = true;
      score = 0;
      lives = 3;
      balls = [];
      spawnBall();
      updateUI();
    }

    function spawnBall() {
      balls.push({
        x: launcher.x, y: launcher.y - 20,
        vx: 0, vy: 0, radius: 12,
        launched: false, rotation: 0
      });
    }

    function launchBall() {
      launcher.charging = false;
      const power = Math.max(15, launcher.power * 0.3);
      balls.forEach(ball => {
        if (!ball.launched) {
          ball.vy = -power;
          ball.vx = -2 + Math.random() * -3;
          ball.launched = true;
        }
      });
      launcher.power = 0;
    }

    function createParticles(x, y, color, count = 10) {
      for (let i = 0; i < count; i++) {
        const angle = Math.random() * Math.PI * 2;
        const speed = 2 + Math.random() * 4;
        particles.push({
          x, y, vx: Math.cos(angle) * speed, vy: Math.sin(angle) * speed,
          life: 1, color, size: 3 + Math.random() * 4
        });
      }
    }

    function update() {
      if (!gameStarted) return;

      flippers.left.targetAngle = keys['KeyA'] || keys['ArrowLeft'] ? flippers.left.activeAngle : flippers.left.restAngle;
      flippers.right.targetAngle = keys['KeyD'] || keys['ArrowRight'] ? flippers.right.activeAngle : flippers.right.restAngle;

      flippers.left.angle += (flippers.left.targetAngle - flippers.left.angle) * 0.4;
      flippers.right.angle += (flippers.right.targetAngle - flippers.right.angle) * 0.4;

      if (keys['Space'] && balls.some(b => !b.launched)) {
        launcher.charging = true;
        launcher.power = Math.min(100, launcher.power + 3);
      }

      balls.forEach(ball => {
        if (!ball.launched) return;

        ball.vy += 0.25;
        ball.x += ball.vx;
        ball.y += ball.vy;
        ball.rotation += ball.vx * 0.05;

        if (ball.x < ball.radius + 20) { ball.x = ball.radius + 20; ball.vx *= -0.8; }
        if (ball.x > W - ball.radius - 20) { ball.x = W - ball.radius - 20; ball.vx *= -0.8; }
        if (ball.y < ball.radius + 20) { ball.y = ball.radius + 20; ball.vy *= -0.8; }

        bumpers.forEach(bumper => {
          const dx = ball.x - bumper.x;
          const dy = ball.y - bumper.y;
          const dist = Math.sqrt(dx * dx + dy * dy);
          const minDist = ball.radius + bumper.radius;

          if (dist < minDist) {
            const angle = Math.atan2(dy, dx);
            const force = 12;
            ball.vx = Math.cos(angle) * force;
            ball.vy = Math.sin(angle) * force;
            ball.x = bumper.x + Math.cos(angle) * minDist;
            ball.y = bumper.y + Math.sin(angle) * minDist;

            score += bumper.points;
            createParticles(bumper.x, bumper.y, bumper.color, 15);
            bumper.flash = 1;
          }
        });

        targets.forEach(target => {
          if (target.hit) return;
          if (ball.x > target.x - target.width/2 && ball.x < target.x + target.width/2 &&
              ball.y > target.y - target.height/2 && ball.y < target.y + target.height/2) {
            target.hit = true;
            ball.vy *= -1;
            score += 200;
            createParticles(target.x, target.y, target.color, 20);

            if (targets.every(t => t.hit)) {
              targets.forEach(t => t.hit = false);
              score += 1000;
            }
          }
        });

        [flippers.left, flippers.right].forEach((flipper, idx) => {
          const endX = flipper.x + Math.cos(flipper.angle) * flipper.length;
          const endY = flipper.y + Math.sin(flipper.angle) * flipper.length;

          const A = ball.x - flipper.x;
          const B = ball.y - flipper.y;
          const C = endX - flipper.x;
          const D = endY - flipper.y;

          const dot = A * C + B * D;
          const len_sq = C * C + D * D;
          let t = Math.max(0, Math.min(1, dot / len_sq));

          const closestX = flipper.x + t * C;
          const closestY = flipper.y + t * D;

          const dx = ball.x - closestX;
          const dy = ball.y - closestY;
          const dist = Math.sqrt(dx * dx + dy * dy);

          if (dist < ball.radius + 8) {
            const isMoving = Math.abs(flipper.angle - flipper.targetAngle) > 0.1;
            const bounceForce = isMoving ? 18 : 8;

            const angle = Math.atan2(dy, dx);
            ball.vx = Math.cos(angle) * bounceForce + (isMoving ? (idx === 0 ? 5 : -5) : 0);
            ball.vy = Math.sin(angle) * bounceForce - 3;

            ball.x = closestX + Math.cos(angle) * (ball.radius + 10);
            ball.y = closestY + Math.sin(angle) * (ball.radius + 10);

            createParticles(closestX, closestY, '#d4a84b', 8);
          }
        });

        ball.vx *= 0.995;
        ball.vy *= 0.995;

        const speed = Math.sqrt(ball.vx * ball.vx + ball.vy * ball.vy);
        if (speed > 25) {
          ball.vx = (ball.vx / speed) * 25;
          ball.vy = (ball.vy / speed) * 25;
        }
      });

      balls = balls.filter(ball => {
        if (ball.y > H + 50) {
          lives--;
          updateUI();
          if (lives <= 0) gameOver();
          return false;
        }
        return true;
      });

      if (balls.length === 0 && lives > 0) spawnBall();

      bumpers.forEach(b => {
        if (b.flash) b.flash *= 0.9;
        if (b.flash < 0.01) b.flash = 0;
      });

      particles = particles.filter(p => {
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.1;
        p.life -= 0.03;
        return p.life > 0;
      });

      updateUI();
    }

    function updateUI() {
      document.getElementById('score').textContent = score.toLocaleString();
      document.getElementById('lives').textContent = 'ðŸ’£'.repeat(Math.max(0, lives));
    }

    function gameOver() {
      gameStarted = false;
      const msg = document.getElementById('message');
      msg.querySelector('h2').textContent = 'YE WALKED THE PLANK!';
      msg.querySelector('p').textContent = `Booty Plundered: ${score.toLocaleString()} doubloons`;
      msg.classList.add('show');

      setTimeout(() => {
        msg.classList.remove('show');
        document.getElementById('start-btn').style.display = 'block';
        document.getElementById('start-btn').textContent = 'SAIL AGAIN!';
      }, 3000);
    }

    function drawCannonball(x, y, radius, rotation) {
      ctx.save();
      ctx.translate(x, y);
      ctx.rotate(rotation);

      ctx.shadowColor = '#333';
      ctx.shadowBlur = 10;

      const gradient = ctx.createRadialGradient(-3, -3, 0, 0, 0, radius);
      gradient.addColorStop(0, '#555');
      gradient.addColorStop(0.5, '#333');
      gradient.addColorStop(1, '#111');

      ctx.fillStyle = gradient;
      ctx.beginPath();
      ctx.arc(0, 0, radius, 0, Math.PI * 2);
      ctx.fill();

      ctx.strokeStyle = '#666';
      ctx.lineWidth = 2;
      ctx.stroke();

      // Fuse spark
      ctx.fillStyle = '#f80';
      ctx.shadowColor = '#f80';
      ctx.shadowBlur = 8;
      ctx.beginPath();
      ctx.arc(radius * 0.6, -radius * 0.6, 3, 0, Math.PI * 2);
      ctx.fill();

      ctx.restore();
    }

    function draw() {
      // Ocean background
      ctx.fillStyle = '#0d2137';
      ctx.fillRect(0, 0, W, H);

      // Wood plank pattern
      ctx.strokeStyle = 'rgba(139, 90, 43, 0.15)';
      ctx.lineWidth = 2;
      for (let i = 0; i < H; i += 40) {
        ctx.beginPath();
        ctx.moveTo(0, i);
        ctx.lineTo(W, i);
        ctx.stroke();
      }

      // Skull watermark
      ctx.save();
      ctx.translate(W/2, H/2 - 50);
      ctx.globalAlpha = 0.08;
      ctx.font = '150px serif';
      ctx.textAlign = 'center';
      ctx.fillStyle = '#d4a84b';
      ctx.fillText('â˜ ', 0, 50);
      ctx.globalAlpha = 1;
      ctx.restore();

      // Ship hull walls
      ctx.fillStyle = '#3d2817';
      ctx.strokeStyle = '#8b5a2b';
      ctx.lineWidth = 4;

      // Left wall
      ctx.beginPath();
      ctx.moveTo(20, 0);
      ctx.lineTo(20, H);
      ctx.lineTo(0, H);
      ctx.lineTo(0, 0);
      ctx.closePath();
      ctx.fill();
      ctx.stroke();

      // Right wall
      ctx.beginPath();
      ctx.moveTo(W - 20, 0);
      ctx.lineTo(W - 20, 500);
      ctx.lineTo(450, 550);
      ctx.lineTo(450, H);
      ctx.lineTo(W, H);
      ctx.lineTo(W, 0);
      ctx.closePath();
      ctx.fill();
      ctx.stroke();

      // Top wall
      ctx.beginPath();
      ctx.rect(0, 0, W, 20);
      ctx.fill();
      ctx.stroke();

      // Treasure targets (gold bars)
      targets.forEach(target => {
        ctx.fillStyle = target.hit ? '#2a1810' : '#d4a84b';
        ctx.shadowColor = target.hit ? 'transparent' : 'rgba(212, 168, 75, 0.8)';
        ctx.shadowBlur = target.hit ? 0 : 15;

        ctx.fillRect(target.x - target.width/2, target.y - target.height/2, target.width, target.height);

        ctx.strokeStyle = target.hit ? '#3d2817' : '#fff';
        ctx.lineWidth = 2;
        ctx.strokeRect(target.x - target.width/2, target.y - target.height/2, target.width, target.height);
      });
      ctx.shadowBlur = 0;

      // Bumpers (treasure/barrels)
      bumpers.forEach(bumper => {
        const flash = bumper.flash || 0;

        ctx.shadowColor = bumper.color;
        ctx.shadowBlur = 15 + flash * 25;

        const gradient = ctx.createRadialGradient(bumper.x, bumper.y, 0, bumper.x, bumper.y, bumper.radius);
        gradient.addColorStop(0, flash > 0.5 ? '#fff' : bumper.color);
        gradient.addColorStop(0.6, bumper.color);
        gradient.addColorStop(1, '#1a0f0a');

        ctx.fillStyle = gradient;
        ctx.beginPath();
        ctx.arc(bumper.x, bumper.y, bumper.radius, 0, Math.PI * 2);
        ctx.fill();

        ctx.strokeStyle = '#5c3a1e';
        ctx.lineWidth = 4;
        ctx.stroke();

        // Icon in center
        ctx.font = `${bumper.radius}px serif`;
        ctx.textAlign = 'center';
        ctx.fillStyle = '#fff';
        const icons = { chest: 'ðŸ’°', barrel: 'ðŸ›¢ï¸', wheel: 'âš“', gem: 'ðŸ’Ž' };
        ctx.fillText(icons[bumper.type] || 'â—', bumper.x, bumper.y + bumper.radius * 0.35);
      });
      ctx.shadowBlur = 0;

      // Wooden flippers (planks)
      [flippers.left, flippers.right].forEach(flipper => {
        const endX = flipper.x + Math.cos(flipper.angle) * flipper.length;
        const endY = flipper.y + Math.sin(flipper.angle) * flipper.length;

        ctx.shadowColor = '#d4a84b';
        ctx.shadowBlur = 10;

        ctx.strokeStyle = '#8b5a2b';
        ctx.lineWidth = 18;
        ctx.lineCap = 'round';
        ctx.beginPath();
        ctx.moveTo(flipper.x, flipper.y);
        ctx.lineTo(endX, endY);
        ctx.stroke();

        ctx.strokeStyle = '#d4a84b';
        ctx.lineWidth = 8;
        ctx.beginPath();
        ctx.moveTo(flipper.x, flipper.y);
        ctx.lineTo(endX, endY);
        ctx.stroke();

        // Pivot (brass)
        ctx.fillStyle = '#c0392b';
        ctx.beginPath();
        ctx.arc(flipper.x, flipper.y, 10, 0, Math.PI * 2);
        ctx.fill();
      });
      ctx.shadowBlur = 0;

      // Cannon launcher
      ctx.fillStyle = '#2a1810';
      ctx.fillRect(455, 550, 40, H - 550);

      ctx.fillStyle = '#8b5a2b';
      ctx.shadowColor = '#d4a84b';
      ctx.shadowBlur = 8;
      const springY = 650 - launcher.power * 0.5;
      ctx.fillRect(465, springY, 20, 30);
      ctx.shadowBlur = 0;

      if (launcher.charging) {
        ctx.fillStyle = `hsl(${30 + launcher.power * 0.3}, 80%, ${40 + launcher.power * 0.3}%)`;
        ctx.fillRect(455, 550, 40, -launcher.power);
      }

      // Davy Jones' Locker warning
      ctx.fillStyle = '#1a5276';
      ctx.globalAlpha = 0.4 + Math.sin(Date.now() * 0.008) * 0.2;
      ctx.fillRect(100, H - 10, 250, 10);
      ctx.globalAlpha = 1;

      ctx.fillStyle = '#1a5276';
      ctx.font = '12px "IM Fell English SC"';
      ctx.textAlign = 'center';
      ctx.fillText('â˜  DAVY JONES\' LOCKER â˜ ', 225, H - 20);

      // Particles (gold coins/sparks)
      particles.forEach(p => {
        ctx.globalAlpha = p.life;
        ctx.fillStyle = p.color;
        ctx.shadowColor = p.color;
        ctx.shadowBlur = 8;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size * p.life, 0, Math.PI * 2);
        ctx.fill();
      });
      ctx.globalAlpha = 1;
      ctx.shadowBlur = 0;

      // Cannonballs
      balls.forEach(ball => {
        drawCannonball(ball.x, ball.y, ball.radius, ball.rotation);
      });

      // Title
      ctx.fillStyle = '#d4a84b';
      ctx.shadowColor = 'rgba(212, 168, 75, 0.5)';
      ctx.shadowBlur = 15;
      ctx.font = 'bold 22px "Pirate One"';
      ctx.textAlign = 'center';
      ctx.fillText('PLUNDER DECK', W/2, 55);
      ctx.shadowBlur = 0;
    }

    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    gameLoop();
  </script>
</body>
</html>
