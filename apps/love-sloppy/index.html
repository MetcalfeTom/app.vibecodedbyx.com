<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Why Everyone Loves Sloppy</title>
  <link rel="icon" href="https://emojicdn.elk.sh/üíï">
  <meta property="og:title" content="Why Everyone Loves Sloppy">
  <meta property="og:description" content="A cozy place to share why you love Sloppy">
  <meta property="og:url" content="https://app.sloppy.live/love-sloppy">
  <meta property="og:image" content="https://emojicdn.elk.sh/üíï?style=apple&size=512">
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700&family=Fraunces:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg: #fef9f3;
      --text: #4a4a4a;
      --text-light: #8a8a8a;
      --accent: #e8b4b8;
      --accent-hover: #d9a3a7;
      --card: #ffffff;
      --border: #f0e6e0;
      --lavender: #d4c4e8;
      --mint: #c8e6d4;
      --peach: #f5d5c8;
      --sky: #c4dae8;
      --lemon: #f5f0c4;
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      line-height: 1.7;
      min-height: 100vh;
    }

    .container {
      max-width: 680px;
      margin: 0 auto;
      padding: 60px 24px;
    }

    header {
      text-align: center;
      margin-bottom: 60px;
    }

    h1 {
      font-family: 'Fraunces', serif;
      font-size: 2.5rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 16px;
      letter-spacing: -0.5px;
    }

    .subtitle {
      color: var(--text-light);
      font-size: 1.1rem;
      max-width: 400px;
      margin: 0 auto;
    }

    .heart {
      display: inline-block;
      color: var(--accent);
      animation: heartbeat 1.5s ease-in-out infinite;
    }

    @keyframes heartbeat {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .reasons {
      margin-bottom: 60px;
    }

    .reasons h2 {
      font-family: 'Fraunces', serif;
      font-size: 1.3rem;
      margin-bottom: 24px;
      color: var(--text);
    }

    .reason-list {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .reason {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 14px;
      transition: transform 0.2s ease;
    }

    .reason:hover {
      transform: translateX(4px);
    }

    .reason-icon {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      flex-shrink: 0;
    }

    .reason:nth-child(1) .reason-icon { background: var(--lavender); }
    .reason:nth-child(2) .reason-icon { background: var(--mint); }
    .reason:nth-child(3) .reason-icon { background: var(--peach); }
    .reason:nth-child(4) .reason-icon { background: var(--sky); }
    .reason:nth-child(5) .reason-icon { background: var(--lemon); }

    .reason-text {
      font-size: 0.95rem;
    }

    .guestbook {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 32px;
      margin-bottom: 40px;
    }

    .guestbook h2 {
      font-family: 'Fraunces', serif;
      font-size: 1.3rem;
      margin-bottom: 20px;
    }

    .guestbook-form {
      display: flex;
      flex-direction: column;
      gap: 14px;
      margin-bottom: 30px;
    }

    .form-row {
      display: flex;
      gap: 12px;
    }

    @media (max-width: 500px) {
      .form-row {
        flex-direction: column;
      }
    }

    input, textarea {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--border);
      border-radius: 10px;
      font-family: 'DM Sans', sans-serif;
      font-size: 0.95rem;
      background: var(--bg);
      color: var(--text);
      outline: none;
      transition: border-color 0.2s;
    }

    input:focus, textarea:focus {
      border-color: var(--accent);
    }

    textarea {
      resize: vertical;
      min-height: 80px;
    }

    .color-picker {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .color-picker span {
      font-size: 0.85rem;
      color: var(--text-light);
    }

    .color-option {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      border: 2px solid transparent;
      cursor: pointer;
      transition: transform 0.2s, border-color 0.2s;
    }

    .color-option:hover {
      transform: scale(1.1);
    }

    .color-option.selected {
      border-color: var(--text);
    }

    .color-option.lavender { background: var(--lavender); }
    .color-option.mint { background: var(--mint); }
    .color-option.peach { background: var(--peach); }
    .color-option.sky { background: var(--sky); }
    .color-option.lemon { background: var(--lemon); }

    .submit-btn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 10px;
      font-family: 'DM Sans', sans-serif;
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.2s;
      align-self: flex-start;
    }

    .submit-btn:hover {
      background: var(--accent-hover);
    }

    .submit-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .entries {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .entry {
      padding: 16px;
      border-radius: 12px;
      border-left: 4px solid;
    }

    .entry.lavender { background: #f8f4fc; border-color: var(--lavender); }
    .entry.mint { background: #f4faf6; border-color: var(--mint); }
    .entry.peach { background: #fdf8f5; border-color: var(--peach); }
    .entry.sky { background: #f4f8fc; border-color: var(--sky); }
    .entry.lemon { background: #fcfbf4; border-color: var(--lemon); }

    .entry-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .entry-name {
      font-weight: 600;
      font-size: 0.95rem;
    }

    .entry-date {
      font-size: 0.8rem;
      color: var(--text-light);
    }

    .entry-message {
      font-size: 0.9rem;
      color: var(--text);
    }

    .loading {
      text-align: center;
      padding: 20px;
      color: var(--text-light);
    }

    .no-entries {
      text-align: center;
      padding: 30px;
      color: var(--text-light);
      font-style: italic;
    }

    footer {
      text-align: center;
      padding: 20px;
      color: var(--text-light);
      font-size: 0.85rem;
    }

    footer a {
      color: var(--accent);
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }

    .auth-notice {
      font-size: 0.8rem;
      color: var(--text-light);
      margin-top: 8px;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Why Everyone Loves Sloppy <span class="heart">‚ô•</span></h1>
      <p class="subtitle">A cozy corner of the internet to share the love</p>
    </header>

    <section class="reasons">
      <h2>Here's what makes Sloppy special</h2>
      <div class="reason-list">
        <div class="reason">
          <div class="reason-icon">‚ú®</div>
          <div class="reason-text">Always building cool stuff with the community</div>
        </div>
        <div class="reason">
          <div class="reason-icon">üé®</div>
          <div class="reason-text">Creates beautiful neon apps that spark joy</div>
        </div>
        <div class="reason">
          <div class="reason-icon">üí¨</div>
          <div class="reason-text">Listens to chat and makes ideas come to life</div>
        </div>
        <div class="reason">
          <div class="reason-icon">üéÆ</div>
          <div class="reason-text">Makes fun games everyone can enjoy</div>
        </div>
        <div class="reason">
          <div class="reason-icon">ü§ù</div>
          <div class="reason-text">Brings people together through creativity</div>
        </div>
      </div>
    </section>

    <section class="guestbook">
      <h2>Leave a message üìù</h2>

      <form class="guestbook-form" id="guestbook-form">
        <div class="form-row">
          <input type="text" id="name-input" placeholder="Your name" maxlength="50" required>
        </div>
        <textarea id="message-input" placeholder="Why do you love Sloppy?" maxlength="500" required></textarea>
        <div class="color-picker">
          <span>Pick a color:</span>
          <div class="color-option lavender selected" data-color="lavender"></div>
          <div class="color-option mint" data-color="mint"></div>
          <div class="color-option peach" data-color="peach"></div>
          <div class="color-option sky" data-color="sky"></div>
          <div class="color-option lemon" data-color="lemon"></div>
        </div>
        <button type="submit" class="submit-btn" id="submit-btn">Sign the guestbook</button>
        <p class="auth-notice" id="auth-notice"></p>
      </form>

      <div class="entries" id="entries">
        <div class="loading">Loading messages...</div>
      </div>
    </section>

    <footer>
      Made with love for <a href="https://sloppy.live">sloppy.live</a>
    </footer>
  </div>

  <script src="/supabase-config.js"></script>
  <script>
    let selectedColor = 'lavender';
    let currentUser = null;

    // Color picker
    document.querySelectorAll('.color-option').forEach(option => {
      option.addEventListener('click', () => {
        document.querySelectorAll('.color-option').forEach(o => o.classList.remove('selected'));
        option.classList.add('selected');
        selectedColor = option.dataset.color;
      });
    });

    // Format date
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString('en-US', {
        month: 'short',
        day: 'numeric',
        year: 'numeric'
      });
    }

    // Render entries
    function renderEntries(entries) {
      const container = document.getElementById('entries');

      if (entries.length === 0) {
        container.innerHTML = '<div class="no-entries">Be the first to sign the guestbook!</div>';
        return;
      }

      container.innerHTML = entries.map(entry => `
        <div class="entry ${entry.color || 'lavender'}">
          <div class="entry-header">
            <span class="entry-name">${escapeHtml(entry.name)}</span>
            <span class="entry-date">${formatDate(entry.created_at)}</span>
          </div>
          <p class="entry-message">${escapeHtml(entry.message)}</p>
        </div>
      `).join('');
    }

    // Escape HTML to prevent XSS
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // Load entries
    async function loadEntries() {
      try {
        const { data, error } = await supabase
          .from('love_sloppy_guestbook')
          .select('*')
          .order('created_at', { ascending: false })
          .limit(50);

        if (error) throw error;
        renderEntries(data || []);
      } catch (err) {
        console.error('Error loading entries:', err);
        document.getElementById('entries').innerHTML =
          '<div class="no-entries">Could not load messages. Please try again later.</div>';
      }
    }

    // Initialize auth
    async function initAuth() {
      const { data: { user } } = await supabase.auth.getUser();

      if (user) {
        currentUser = user;
        document.getElementById('auth-notice').textContent = '';
      } else {
        // Sign in anonymously
        const { data, error } = await supabase.auth.signInAnonymously();
        if (data?.user) {
          currentUser = data.user;
        } else {
          document.getElementById('auth-notice').textContent = 'Sign in to leave a message';
          document.getElementById('submit-btn').disabled = true;
        }
      }
    }

    // Submit entry
    document.getElementById('guestbook-form').addEventListener('submit', async (e) => {
      e.preventDefault();

      if (!currentUser) {
        alert('Please wait for authentication...');
        return;
      }

      const name = document.getElementById('name-input').value.trim();
      const message = document.getElementById('message-input').value.trim();

      if (!name || !message) return;

      const submitBtn = document.getElementById('submit-btn');
      submitBtn.disabled = true;
      submitBtn.textContent = 'Sending...';

      try {
        const { error } = await supabase
          .from('love_sloppy_guestbook')
          .insert({
            name,
            message,
            color: selectedColor,
            user_id: currentUser.id
          });

        if (error) throw error;

        // Clear form
        document.getElementById('name-input').value = '';
        document.getElementById('message-input').value = '';

        // Reload entries
        await loadEntries();

      } catch (err) {
        console.error('Error submitting:', err);
        alert('Could not submit message. Please try again.');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Sign the guestbook';
      }
    });

    // Initialize
    initAuth();
    loadEntries();
  </script>
<script src="/apps/sloppy-header/sloppy-bar.js"></script>
<script src="/vibelib-extended.js"></script>
<script>
  // Compatibility Patch for Legacy Apps
  window.addEventListener("load", () => {
    if (window.SloppyKarma && window.VibeLib.Economy) {
      // Redirect old calls to new engine
      window.SloppyKarma.track = window.VibeLib.Economy.track;
    }
  });
</script>
</body>
</html>
