<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Kaneidog Music Vault</title>
  <meta name="description" content="Retro music player with stunning visualizer">
  <meta property="og:title" content="Kaneidog Music Vault">
  <meta property="og:description" content="Drop your tracks and watch the retro visualizer come alive">
  <meta property="og:url" content="https://sloppy.live/kaneidog-vault">
  <meta property="og:image" content="https://sloppy.live/kaneidog-vault/og-image.png">
  <link rel="icon" href="https://emojicdn.elk.sh/üéµ">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=VT323&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --neon-pink: #ff00ff;
      --neon-cyan: #00ffff;
      --neon-yellow: #ffff00;
      --neon-orange: #ff6600;
      --dark-bg: #0a0a12;
      --panel-bg: #12121a;
    }

    body {
      min-height: 100vh;
      background: var(--dark-bg);
      font-family: 'Orbitron', sans-serif;
      color: #fff;
      overflow-x: hidden;
      overflow-y: auto;
    }

    /* CRT Effect */
    .crt-overlay {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 1000;
      background:
        repeating-linear-gradient(
          0deg,
          rgba(0, 0, 0, 0.1) 0px,
          rgba(0, 0, 0, 0.1) 1px,
          transparent 1px,
          transparent 2px
        );
    }

    .crt-overlay::after {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse at center, transparent 0%, rgba(0,0,0,0.3) 100%);
    }

    .container {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      padding: 20px;
      gap: 20px;
    }

    /* Mode Tabs */
    .mode-tabs {
      display: flex;
      justify-content: center;
      gap: 0;
      margin-bottom: 10px;
    }

    .mode-tab {
      padding: 12px 30px;
      background: transparent;
      border: 2px solid #333;
      color: #666;
      font-family: 'Orbitron', sans-serif;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      letter-spacing: 2px;
    }

    .mode-tab:first-child {
      border-radius: 25px 0 0 25px;
      border-right: none;
    }

    .mode-tab:last-child {
      border-radius: 0 25px 25px 0;
    }

    .mode-tab:hover {
      border-color: #555;
      color: #888;
    }

    .mode-tab.active {
      background: linear-gradient(180deg, var(--neon-pink), #aa00aa);
      border-color: var(--neon-pink);
      color: #fff;
      box-shadow: 0 0 20px rgba(255, 0, 255, 0.4);
    }

    .mode-tab.active.youtube {
      background: linear-gradient(180deg, #ff0000, #aa0000);
      border-color: #ff0000;
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.4);
    }

    /* Content Sections */
    .content-section {
      display: none;
    }

    .content-section.active {
      display: block;
    }

    /* YouTube Section */
    .youtube-section {
      flex: 1;
    }

    .youtube-channel-banner {
      background: linear-gradient(135deg, #1a1a25 0%, #0f0f18 100%);
      border: 2px solid #ff0000;
      border-radius: 15px;
      padding: 25px;
      text-align: center;
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
    }

    .youtube-channel-banner::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(45deg, transparent 40%, rgba(255, 0, 0, 0.1) 50%, transparent 60%);
      animation: shine 3s infinite;
    }

    @keyframes shine {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .channel-icon {
      font-size: 4rem;
      margin-bottom: 15px;
    }

    .channel-name {
      font-size: 1.8rem;
      font-weight: 700;
      color: #fff;
      margin-bottom: 10px;
      text-shadow: 0 0 20px rgba(255, 0, 0, 0.5);
    }

    .channel-link {
      display: inline-block;
      padding: 12px 35px;
      background: linear-gradient(180deg, #ff0000, #cc0000);
      color: #fff;
      text-decoration: none;
      border-radius: 30px;
      font-family: 'VT323', monospace;
      font-size: 1.3rem;
      transition: all 0.2s;
      box-shadow: 0 4px 15px rgba(255, 0, 0, 0.4);
    }

    .channel-link:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 25px rgba(255, 0, 0, 0.6);
    }

    .channel-tagline {
      font-family: 'VT323', monospace;
      font-size: 1.1rem;
      color: #ff6666;
      letter-spacing: 3px;
      margin-top: 5px;
    }

    .channel-cta {
      text-align: center;
      margin-top: 20px;
      padding: 20px;
      background: var(--panel-bg);
      border: 2px solid #333;
      border-radius: 15px;
    }

    .channel-link-large {
      display: inline-block;
      padding: 18px 50px;
      background: linear-gradient(180deg, #ff0000, #cc0000);
      color: #fff;
      text-decoration: none;
      border-radius: 35px;
      font-family: 'Orbitron', sans-serif;
      font-size: 1.1rem;
      font-weight: 600;
      transition: all 0.2s;
      box-shadow: 0 4px 20px rgba(255, 0, 0, 0.4);
      letter-spacing: 1px;
    }

    .channel-link-large:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 30px rgba(255, 0, 0, 0.6);
    }

    .channel-hint {
      font-family: 'VT323', monospace;
      font-size: 1rem;
      color: #666;
      margin-top: 15px;
    }

    .youtube-embed-container {
      background: #000;
      border: 2px solid #333;
      border-radius: 15px;
      overflow: hidden;
      aspect-ratio: 16/9;
      max-height: 450px;
    }

    .youtube-embed-container iframe {
      width: 100%;
      height: 100%;
      border: none;
    }

    .youtube-placeholder {
      width: 100%;
      height: 100%;
      min-height: 300px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #555;
    }

    .youtube-placeholder-icon {
      font-size: 4rem;
      margin-bottom: 15px;
      opacity: 0.5;
    }

    .youtube-placeholder p {
      font-family: 'VT323', monospace;
      font-size: 1.2rem;
    }

    /* Header */
    header {
      text-align: center;
      padding: 15px;
      background: linear-gradient(180deg, var(--panel-bg) 0%, transparent 100%);
      border-bottom: 2px solid var(--neon-pink);
      position: relative;
    }

    header::before {
      content: '';
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--neon-pink);
      box-shadow: 0 0 20px var(--neon-pink), 0 0 40px var(--neon-pink);
    }

    .logo {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }

    .logo-icon {
      font-size: 2.5rem;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    h1 {
      font-size: 2rem;
      font-weight: 900;
      background: linear-gradient(90deg, var(--neon-pink), var(--neon-cyan), var(--neon-yellow));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 30px rgba(255, 0, 255, 0.5);
      letter-spacing: 3px;
    }

    .tagline {
      font-family: 'VT323', monospace;
      font-size: 1rem;
      color: var(--neon-cyan);
      margin-top: 5px;
      letter-spacing: 2px;
    }

    /* Visualizer */
    .visualizer-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      background: var(--panel-bg);
      border: 2px solid #333;
      border-radius: 10px;
      overflow: hidden;
    }

    .visualizer-container::before {
      content: '';
      position: absolute;
      inset: 0;
      background:
        linear-gradient(45deg, transparent 48%, rgba(255,0,255,0.03) 50%, transparent 52%),
        linear-gradient(-45deg, transparent 48%, rgba(0,255,255,0.03) 50%, transparent 52%);
      background-size: 30px 30px;
    }

    canvas {
      width: 100%;
      height: 100%;
      display: block;
    }

    .no-audio {
      position: absolute;
      text-align: center;
      color: #555;
    }

    .no-audio-icon {
      font-size: 4rem;
      margin-bottom: 15px;
      opacity: 0.5;
    }

    .no-audio p {
      font-family: 'VT323', monospace;
      font-size: 1.5rem;
    }

    .hidden {
      display: none !important;
    }

    /* Controls Panel */
    .controls-panel {
      background: var(--panel-bg);
      border: 2px solid #333;
      border-radius: 10px;
      padding: 20px;
    }

    /* Now Playing */
    .now-playing {
      text-align: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #333;
    }

    .now-playing-label {
      font-family: 'VT323', monospace;
      font-size: 0.9rem;
      color: var(--neon-pink);
      margin-bottom: 5px;
    }

    .track-name {
      font-size: 1.1rem;
      color: var(--neon-cyan);
      text-shadow: 0 0 10px var(--neon-cyan);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      max-width: 100%;
    }

    .track-name.scrolling {
      animation: scroll-text 10s linear infinite;
    }

    @keyframes scroll-text {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }

    /* Progress Bar */
    .progress-container {
      margin-bottom: 15px;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: #1a1a25;
      border-radius: 4px;
      cursor: pointer;
      overflow: hidden;
      position: relative;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--neon-pink), var(--neon-cyan));
      border-radius: 4px;
      width: 0%;
      transition: width 0.1s;
      box-shadow: 0 0 10px var(--neon-pink);
    }

    .time-display {
      display: flex;
      justify-content: space-between;
      font-family: 'VT323', monospace;
      font-size: 1rem;
      color: #666;
      margin-top: 5px;
    }

    /* Buttons */
    .buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
    }

    .btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: 2px solid var(--neon-pink);
      background: transparent;
      color: var(--neon-pink);
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .btn:hover {
      background: rgba(255, 0, 255, 0.2);
      box-shadow: 0 0 20px var(--neon-pink);
    }

    .btn.play-btn {
      width: 80px;
      height: 80px;
      font-size: 2rem;
      border-color: var(--neon-cyan);
      color: var(--neon-cyan);
    }

    .btn.play-btn:hover {
      background: rgba(0, 255, 255, 0.2);
      box-shadow: 0 0 25px var(--neon-cyan);
    }

    /* Volume */
    .volume-container {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
    }

    .volume-icon {
      font-size: 1.5rem;
      color: var(--neon-yellow);
    }

    .volume-slider {
      flex: 1;
      -webkit-appearance: none;
      height: 6px;
      background: #1a1a25;
      border-radius: 3px;
      cursor: pointer;
    }

    .volume-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      background: var(--neon-yellow);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 10px var(--neon-yellow);
    }

    /* File Input */
    .file-input-container {
      text-align: center;
    }

    .file-label {
      display: inline-block;
      padding: 12px 30px;
      background: linear-gradient(180deg, #2a2a3a 0%, #1a1a25 100%);
      border: 2px solid var(--neon-orange);
      border-radius: 30px;
      color: var(--neon-orange);
      font-family: 'VT323', monospace;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .file-label:hover {
      background: rgba(255, 102, 0, 0.2);
      box-shadow: 0 0 20px var(--neon-orange);
    }

    .file-input {
      display: none;
    }

    /* Visualizer Mode Selector */
    .viz-modes {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 15px;
    }

    .viz-mode-btn {
      padding: 8px 16px;
      background: transparent;
      border: 1px solid #444;
      border-radius: 20px;
      color: #666;
      font-family: 'VT323', monospace;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .viz-mode-btn:hover {
      border-color: #888;
      color: #888;
    }

    .viz-mode-btn.active {
      border-color: var(--neon-pink);
      color: var(--neon-pink);
      box-shadow: 0 0 10px rgba(255, 0, 255, 0.3);
    }

    /* Footer */
    .footer {
      text-align: center;
      padding: 10px;
      font-family: 'VT323', monospace;
      font-size: 0.9rem;
      color: #444;
    }

    .footer a {
      color: var(--neon-pink);
      text-decoration: none;
    }

    .footer a:hover {
      text-shadow: 0 0 10px var(--neon-pink);
    }

    .credit {
      color: var(--neon-cyan);
      margin-bottom: 5px;
    }

    /* Responsive */
    @media (max-width: 600px) {
      h1 {
        font-size: 1.4rem;
      }

      .container {
        padding: 10px;
        gap: 10px;
      }

      .btn {
        width: 50px;
        height: 50px;
        font-size: 1.2rem;
      }

      .btn.play-btn {
        width: 65px;
        height: 65px;
        font-size: 1.5rem;
      }

      .controls-panel {
        padding: 15px;
      }
    }

    /* Animated background */
    .bg-animation {
      position: fixed;
      inset: 0;
      z-index: -1;
      overflow: hidden;
    }

    .bg-line {
      position: absolute;
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--neon-pink), transparent);
      opacity: 0.1;
      animation: scan 8s linear infinite;
    }

    @keyframes scan {
      0% { transform: translateY(-100vh); }
      100% { transform: translateY(100vh); }
    }
  </style>
</head>
<body>
  <div class="crt-overlay"></div>

  <div class="bg-animation" id="bgAnimation"></div>

  <div class="container">
    <header>
      <div class="logo">
        <span class="logo-icon">üéµ</span>
        <div>
          <h1>KANEIDOG MUSIC VAULT</h1>
          <p class="tagline">// REQUESTED BY RADIOKANELIVE //</p>
        </div>
        <span class="logo-icon">üéµ</span>
      </div>
    </header>

    <!-- Mode Tabs -->
    <div class="mode-tabs">
      <button class="mode-tab active" data-mode="local">üìÇ LOCAL FILES</button>
      <button class="mode-tab youtube" data-mode="youtube">‚ñ∂Ô∏è YOUTUBE</button>
    </div>

    <!-- Local Files Section -->
    <div class="content-section active" id="localSection">
      <div class="visualizer-container">
        <canvas id="visualizer"></canvas>
        <div class="no-audio" id="noAudio">
          <div class="no-audio-icon">üìÄ</div>
          <p>DROP A TRACK TO BEGIN</p>
        </div>
      </div>

      <div class="controls-panel">
        <div class="now-playing">
          <div class="now-playing-label">NOW PLAYING</div>
          <div class="track-name" id="trackName">No track loaded</div>
        </div>

        <div class="progress-container">
          <div class="progress-bar" id="progressBar">
            <div class="progress-fill" id="progressFill"></div>
          </div>
          <div class="time-display">
            <span id="currentTime">0:00</span>
            <span id="duration">0:00</span>
          </div>
        </div>

        <div class="buttons">
          <button class="btn" id="prevBtn">‚èÆ</button>
          <button class="btn play-btn" id="playBtn">‚ñ∂</button>
          <button class="btn" id="nextBtn">‚è≠</button>
        </div>

        <div class="volume-container">
          <span class="volume-icon">üîä</span>
          <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="80">
        </div>

        <div class="file-input-container">
          <label class="file-label" for="fileInput">
            üìÇ LOAD TRACK
          </label>
          <input type="file" id="fileInput" class="file-input" accept="audio/*" multiple>
        </div>

        <div class="viz-modes">
          <button class="viz-mode-btn active" data-mode="bars">BARS</button>
          <button class="viz-mode-btn" data-mode="wave">WAVE</button>
          <button class="viz-mode-btn" data-mode="circular">CIRCULAR</button>
          <button class="viz-mode-btn" data-mode="spectrum">SPECTRUM</button>
        </div>
      </div>
    </div>

    <!-- YouTube Section -->
    <div class="content-section" id="youtubeSection">
      <div class="youtube-section">
        <div class="youtube-channel-banner">
          <div class="channel-icon">üé§</div>
          <div class="channel-name">KANEIDOG</div>
          <p class="channel-tagline">OFFICIAL MUSIC RELEASES</p>
        </div>

        <div class="youtube-embed-container" id="youtubeEmbedContainer">
          <iframe
            src="https://www.youtube.com/embed?listType=user_uploads&list=Kaneidog"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen>
          </iframe>
        </div>

        <div class="channel-cta">
          <a href="https://www.youtube.com/@Kaneidog/releases" target="_blank" rel="noopener" class="channel-link-large">
            ‚ñ∂Ô∏è OPEN FULL CHANNEL ON YOUTUBE
          </a>
          <p class="channel-hint">Click above to browse all releases and playlists</p>
        </div>
      </div>
    </div>

    <div class="footer">
      <div class="credit">üéß KANEIDOG MUSIC VAULT üéß</div>
      <a href="https://sloppy.live">sloppy.live</a>
    </div>
  </div>

  <script>
    // Audio setup
    let audioContext = null;
    let analyser = null;
    let source = null;
    let audio = new Audio();
    let playlist = [];
    let currentTrackIndex = 0;
    let vizMode = 'bars';

    // Canvas
    const canvas = document.getElementById('visualizer');
    const ctx = canvas.getContext('2d');

    // Elements
    const playBtn = document.getElementById('playBtn');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const volumeSlider = document.getElementById('volumeSlider');
    const fileInput = document.getElementById('fileInput');
    const progressBar = document.getElementById('progressBar');
    const progressFill = document.getElementById('progressFill');
    const currentTimeEl = document.getElementById('currentTime');
    const durationEl = document.getElementById('duration');
    const trackNameEl = document.getElementById('trackName');
    const noAudioEl = document.getElementById('noAudio');
    const vizModeBtns = document.querySelectorAll('.viz-mode-btn');

    // Init audio context
    function initAudio() {
      if (audioContext) return;
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
      analyser = audioContext.createAnalyser();
      analyser.fftSize = 512;
      analyser.smoothingTimeConstant = 0.8;

      source = audioContext.createMediaElementSource(audio);
      source.connect(analyser);
      analyser.connect(audioContext.destination);
    }

    // Load track
    function loadTrack(file) {
      initAudio();
      const url = URL.createObjectURL(file);
      audio.src = url;
      trackNameEl.textContent = file.name.replace(/\.[^/.]+$/, '');
      noAudioEl.classList.add('hidden');
      audio.load();
    }

    // Play/Pause
    function togglePlay() {
      if (!audio.src) return;
      initAudio();

      if (audioContext.state === 'suspended') {
        audioContext.resume();
      }

      if (audio.paused) {
        audio.play();
        playBtn.textContent = '‚è∏';
      } else {
        audio.pause();
        playBtn.textContent = '‚ñ∂';
      }
    }

    // Format time
    function formatTime(seconds) {
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    }

    // Update progress
    function updateProgress() {
      if (audio.duration) {
        const percent = (audio.currentTime / audio.duration) * 100;
        progressFill.style.width = `${percent}%`;
        currentTimeEl.textContent = formatTime(audio.currentTime);
        durationEl.textContent = formatTime(audio.duration);
      }
    }

    // Seek
    progressBar.addEventListener('click', (e) => {
      if (!audio.duration) return;
      const rect = progressBar.getBoundingClientRect();
      const percent = (e.clientX - rect.left) / rect.width;
      audio.currentTime = percent * audio.duration;
    });

    // Volume
    volumeSlider.addEventListener('input', (e) => {
      audio.volume = e.target.value / 100;
    });
    audio.volume = 0.8;

    // File input
    fileInput.addEventListener('change', (e) => {
      const files = Array.from(e.target.files);
      if (files.length > 0) {
        playlist = files;
        currentTrackIndex = 0;
        loadTrack(playlist[0]);
        audio.play();
        playBtn.textContent = '‚è∏';
      }
    });

    // Prev/Next
    prevBtn.addEventListener('click', () => {
      if (playlist.length === 0) return;
      currentTrackIndex = (currentTrackIndex - 1 + playlist.length) % playlist.length;
      loadTrack(playlist[currentTrackIndex]);
      audio.play();
      playBtn.textContent = '‚è∏';
    });

    nextBtn.addEventListener('click', () => {
      if (playlist.length === 0) return;
      currentTrackIndex = (currentTrackIndex + 1) % playlist.length;
      loadTrack(playlist[currentTrackIndex]);
      audio.play();
      playBtn.textContent = '‚è∏';
    });

    // Auto next
    audio.addEventListener('ended', () => {
      if (playlist.length > 1) {
        nextBtn.click();
      } else {
        playBtn.textContent = '‚ñ∂';
      }
    });

    // Play button
    playBtn.addEventListener('click', togglePlay);

    // Keyboard
    document.addEventListener('keydown', (e) => {
      if (e.code === 'Space') {
        e.preventDefault();
        togglePlay();
      }
    });

    // Viz mode buttons
    vizModeBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        vizModeBtns.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        vizMode = btn.dataset.mode;
      });
    });

    // Resize canvas
    function resizeCanvas() {
      const container = canvas.parentElement;
      canvas.width = container.clientWidth;
      canvas.height = container.clientHeight;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // Visualizer
    function drawVisualizer() {
      requestAnimationFrame(drawVisualizer);

      const width = canvas.width;
      const height = canvas.height;

      // Clear
      ctx.fillStyle = 'rgba(10, 10, 18, 0.2)';
      ctx.fillRect(0, 0, width, height);

      if (!analyser) {
        // Draw idle animation
        drawIdleAnimation();
        return;
      }

      const bufferLength = analyser.frequencyBinCount;
      const dataArray = new Uint8Array(bufferLength);
      analyser.getByteFrequencyData(dataArray);

      // Check if there's actual audio
      const sum = dataArray.reduce((a, b) => a + b, 0);
      if (sum === 0) {
        drawIdleAnimation();
        return;
      }

      switch (vizMode) {
        case 'bars':
          drawBars(dataArray, bufferLength, width, height);
          break;
        case 'wave':
          drawWave(dataArray, bufferLength, width, height);
          break;
        case 'circular':
          drawCircular(dataArray, bufferLength, width, height);
          break;
        case 'spectrum':
          drawSpectrum(dataArray, bufferLength, width, height);
          break;
      }
    }

    function drawIdleAnimation() {
      const width = canvas.width;
      const height = canvas.height;
      const time = Date.now() / 1000;

      // Draw pulsing circles
      for (let i = 0; i < 3; i++) {
        const radius = 50 + i * 40 + Math.sin(time + i) * 20;
        const alpha = 0.1 - i * 0.03;
        ctx.strokeStyle = `rgba(255, 0, 255, ${alpha})`;
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.arc(width / 2, height / 2, radius, 0, Math.PI * 2);
        ctx.stroke();
      }
    }

    function drawBars(dataArray, bufferLength, width, height) {
      const barCount = 64;
      const barWidth = width / barCount;
      const step = Math.floor(bufferLength / barCount);

      for (let i = 0; i < barCount; i++) {
        const value = dataArray[i * step];
        const barHeight = (value / 255) * height * 0.9;

        // Gradient color based on frequency
        const hue = (i / barCount) * 180 + 280; // Pink to cyan
        const lightness = 50 + (value / 255) * 30;

        // Main bar
        ctx.fillStyle = `hsl(${hue}, 100%, ${lightness}%)`;
        ctx.shadowColor = `hsl(${hue}, 100%, 50%)`;
        ctx.shadowBlur = 15;

        const x = i * barWidth;
        const y = height - barHeight;

        // Draw from bottom
        ctx.fillRect(x + 2, y, barWidth - 4, barHeight);

        // Mirror on top (reflection)
        ctx.globalAlpha = 0.3;
        ctx.fillRect(x + 2, 0, barWidth - 4, barHeight * 0.3);
        ctx.globalAlpha = 1;
      }
      ctx.shadowBlur = 0;
    }

    function drawWave(dataArray, bufferLength, width, height) {
      analyser.getByteTimeDomainData(dataArray);

      ctx.lineWidth = 3;
      ctx.strokeStyle = '#00ffff';
      ctx.shadowColor = '#00ffff';
      ctx.shadowBlur = 20;

      ctx.beginPath();
      const sliceWidth = width / bufferLength;
      let x = 0;

      for (let i = 0; i < bufferLength; i++) {
        const v = dataArray[i] / 128.0;
        const y = v * height / 2;

        if (i === 0) {
          ctx.moveTo(x, y);
        } else {
          ctx.lineTo(x, y);
        }
        x += sliceWidth;
      }

      ctx.lineTo(width, height / 2);
      ctx.stroke();

      // Second wave (offset)
      ctx.strokeStyle = '#ff00ff';
      ctx.shadowColor = '#ff00ff';
      ctx.beginPath();
      x = 0;

      for (let i = 0; i < bufferLength; i++) {
        const v = dataArray[i] / 128.0;
        const y = v * height / 2 + 10;

        if (i === 0) {
          ctx.moveTo(x, y);
        } else {
          ctx.lineTo(x, y);
        }
        x += sliceWidth;
      }
      ctx.stroke();
      ctx.shadowBlur = 0;
    }

    function drawCircular(dataArray, bufferLength, width, height) {
      const centerX = width / 2;
      const centerY = height / 2;
      const radius = Math.min(width, height) * 0.25;

      const barCount = 180;
      const step = Math.floor(bufferLength / barCount);

      for (let i = 0; i < barCount; i++) {
        const value = dataArray[i * step];
        const barHeight = (value / 255) * radius;

        const angle = (i / barCount) * Math.PI * 2 - Math.PI / 2;
        const hue = (i / barCount) * 180 + 280;

        ctx.strokeStyle = `hsl(${hue}, 100%, ${50 + (value / 255) * 30}%)`;
        ctx.lineWidth = 3;
        ctx.shadowColor = `hsl(${hue}, 100%, 50%)`;
        ctx.shadowBlur = 10;

        const x1 = centerX + Math.cos(angle) * radius;
        const y1 = centerY + Math.sin(angle) * radius;
        const x2 = centerX + Math.cos(angle) * (radius + barHeight);
        const y2 = centerY + Math.sin(angle) * (radius + barHeight);

        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.stroke();

        // Inner bars
        const x3 = centerX + Math.cos(angle) * (radius - barHeight * 0.5);
        const y3 = centerY + Math.sin(angle) * (radius - barHeight * 0.5);

        ctx.globalAlpha = 0.5;
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x3, y3);
        ctx.stroke();
        ctx.globalAlpha = 1;
      }

      // Center circle
      ctx.fillStyle = '#12121a';
      ctx.beginPath();
      ctx.arc(centerX, centerY, radius * 0.6, 0, Math.PI * 2);
      ctx.fill();

      ctx.strokeStyle = '#ff00ff';
      ctx.lineWidth = 2;
      ctx.shadowColor = '#ff00ff';
      ctx.shadowBlur = 15;
      ctx.stroke();

      ctx.shadowBlur = 0;
    }

    function drawSpectrum(dataArray, bufferLength, width, height) {
      // Draw filled spectrum
      ctx.beginPath();
      ctx.moveTo(0, height);

      const step = Math.floor(bufferLength / width);
      for (let x = 0; x < width; x++) {
        const value = dataArray[x * step] || 0;
        const y = height - (value / 255) * height * 0.9;
        ctx.lineTo(x, y);
      }

      ctx.lineTo(width, height);
      ctx.closePath();

      // Gradient fill
      const gradient = ctx.createLinearGradient(0, 0, 0, height);
      gradient.addColorStop(0, 'rgba(255, 0, 255, 0.8)');
      gradient.addColorStop(0.5, 'rgba(0, 255, 255, 0.5)');
      gradient.addColorStop(1, 'rgba(255, 255, 0, 0.2)');

      ctx.fillStyle = gradient;
      ctx.fill();

      // Outline
      ctx.strokeStyle = '#00ffff';
      ctx.lineWidth = 2;
      ctx.shadowColor = '#00ffff';
      ctx.shadowBlur = 10;

      ctx.beginPath();
      ctx.moveTo(0, height);
      for (let x = 0; x < width; x++) {
        const value = dataArray[x * step] || 0;
        const y = height - (value / 255) * height * 0.9;
        ctx.lineTo(x, y);
      }
      ctx.stroke();
      ctx.shadowBlur = 0;
    }

    // Background animation
    function createBgLines() {
      const container = document.getElementById('bgAnimation');
      for (let i = 0; i < 10; i++) {
        const line = document.createElement('div');
        line.className = 'bg-line';
        line.style.left = `${Math.random() * 100}%`;
        line.style.width = `${100 + Math.random() * 200}px`;
        line.style.animationDelay = `${Math.random() * 8}s`;
        line.style.animationDuration = `${6 + Math.random() * 4}s`;
        container.appendChild(line);
      }
    }

    // Update loop
    setInterval(updateProgress, 100);

    // === MODE TABS ===
    const modeTabs = document.querySelectorAll('.mode-tab');
    const localSection = document.getElementById('localSection');
    const youtubeSection = document.getElementById('youtubeSection');

    modeTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        modeTabs.forEach(t => t.classList.remove('active'));
        tab.classList.add('active');

        const mode = tab.dataset.mode;
        if (mode === 'local') {
          localSection.classList.add('active');
          youtubeSection.classList.remove('active');
        } else {
          localSection.classList.remove('active');
          youtubeSection.classList.add('active');
          // Pause local audio when switching to YouTube
          audio.pause();
          playBtn.textContent = '‚ñ∂';
        }
      });
    });

    // Init
    createBgLines();
    drawVisualizer();
  </script>
</body>
</html>
