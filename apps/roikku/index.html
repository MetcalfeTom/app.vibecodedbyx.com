<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Roikku - Japanese Phrases</title>
  <link rel="icon" href="https://emojicdn.elk.sh/üóæ">
  <meta property="og:title" content="Roikku - Japanese Phrases">
  <meta property="og:description" content="Learn everyday Japanese phrases naturally!">
  <meta property="og:url" content="https://sloppy.live/roikku">
  <meta property="og:image" content="https://emojicdn.elk.sh/üóæ?style=apple&size=512">
  <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Zen Maru Gothic', 'Noto Sans JP', sans-serif;
      background: linear-gradient(180deg, #0a0a1a 0%, #1a0a20 50%, #0a1520 100%);
      color: #fff;
      min-height: 100vh;
    }

    .app-container {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 25px;
    }

    .logo {
      font-size: 2.5rem;
      font-weight: 700;
      background: linear-gradient(90deg, #ff6b9d, #ffa07a, #ffcc00);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: drop-shadow(0 0 20px rgba(255, 107, 157, 0.5));
      margin-bottom: 5px;
    }

    .tagline {
      font-size: 0.9rem;
      color: #888;
    }

    .categories {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 20px;
      justify-content: center;
    }

    .category-btn {
      padding: 10px 18px;
      background: rgba(255, 107, 157, 0.1);
      border: 1px solid rgba(255, 107, 157, 0.3);
      border-radius: 20px;
      color: #ff6b9d;
      font-family: inherit;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .category-btn:hover {
      background: rgba(255, 107, 157, 0.2);
    }

    .category-btn.active {
      background: #ff6b9d;
      color: #000;
      border-color: #ff6b9d;
    }

    .phrase-card {
      background: rgba(20, 20, 35, 0.8);
      border: 1px solid rgba(255, 107, 157, 0.2);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 0 40px rgba(255, 107, 157, 0.1);
    }

    .phrase-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .phrase-category {
      font-size: 0.75rem;
      color: #ffa07a;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .phrase-number {
      font-size: 0.8rem;
      color: #666;
    }

    .japanese {
      font-size: 2.2rem;
      font-weight: 700;
      color: #fff;
      margin-bottom: 10px;
      line-height: 1.4;
      text-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
    }

    .romaji {
      font-size: 1.1rem;
      color: #ff6b9d;
      margin-bottom: 15px;
      font-style: italic;
    }

    .english {
      font-size: 1.2rem;
      color: #aaa;
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .pronunciation-tip {
      background: rgba(255, 204, 0, 0.1);
      border-left: 3px solid #ffcc00;
      padding: 15px;
      border-radius: 0 10px 10px 0;
      margin-bottom: 20px;
    }

    .tip-label {
      font-size: 0.7rem;
      color: #ffcc00;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .tip-text {
      font-size: 0.9rem;
      color: #ccc;
      line-height: 1.5;
    }

    .context {
      background: rgba(0, 255, 200, 0.05);
      border-left: 3px solid #00ffc8;
      padding: 15px;
      border-radius: 0 10px 10px 0;
      margin-bottom: 20px;
    }

    .context-label {
      font-size: 0.7rem;
      color: #00ffc8;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    .context-text {
      font-size: 0.9rem;
      color: #aaa;
      line-height: 1.5;
    }

    .phrase-actions {
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    .btn {
      padding: 12px 25px;
      border: none;
      border-radius: 25px;
      font-family: inherit;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-speak {
      background: linear-gradient(135deg, #ff6b9d, #ffa07a);
      color: #000;
    }

    .btn-speak:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(255, 107, 157, 0.4);
    }

    .btn-nav {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .btn-nav:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .navigation {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
    }

    .nav-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: rgba(255, 107, 157, 0.1);
      border: 1px solid rgba(255, 107, 157, 0.3);
      color: #ff6b9d;
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .nav-btn:hover {
      background: rgba(255, 107, 157, 0.2);
      transform: scale(1.1);
    }

    .progress-bar {
      height: 4px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 2px;
      overflow: hidden;
      margin-bottom: 20px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #ff6b9d, #ffcc00);
      border-radius: 2px;
      transition: width 0.3s ease;
    }

    .quick-phrases {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }

    .quick-phrase {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 15px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }

    .quick-phrase:hover {
      background: rgba(255, 107, 157, 0.1);
      border-color: rgba(255, 107, 157, 0.3);
    }

    .quick-jp {
      font-size: 1.3rem;
      margin-bottom: 5px;
    }

    .quick-en {
      font-size: 0.75rem;
      color: #888;
    }

    .section-title {
      font-size: 0.8rem;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 15px;
      text-align: center;
    }

    .back-link {
      position: fixed;
      bottom: 15px;
      right: 15px;
      color: #444;
      text-decoration: none;
      font-size: 0.75rem;
      z-index: 100;
    }

    .back-link:hover { color: #ff6b9d; }

    /* Search bar */
    .search-container {
      margin-bottom: 20px;
      position: relative;
    }

    .search-input {
      width: 100%;
      padding: 14px 20px 14px 45px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 107, 157, 0.3);
      border-radius: 25px;
      color: #fff;
      font-family: inherit;
      font-size: 1rem;
      transition: all 0.2s;
    }

    .search-input:focus {
      outline: none;
      border-color: #ff6b9d;
      background: rgba(255, 107, 157, 0.1);
    }

    .search-input::placeholder {
      color: #666;
    }

    .search-icon {
      position: absolute;
      left: 18px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1rem;
      color: #666;
    }

    .search-results {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: rgba(20, 20, 35, 0.98);
      border: 1px solid rgba(255, 107, 157, 0.3);
      border-radius: 15px;
      margin-top: 5px;
      max-height: 300px;
      overflow-y: auto;
      z-index: 200;
      display: none;
    }

    .search-results.show {
      display: block;
    }

    .search-result-item {
      padding: 12px 18px;
      cursor: pointer;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      transition: all 0.2s;
    }

    .search-result-item:hover {
      background: rgba(255, 107, 157, 0.1);
    }

    .search-result-item:last-child {
      border-bottom: none;
    }

    .search-result-jp {
      font-size: 1.1rem;
      margin-bottom: 3px;
    }

    .search-result-en {
      font-size: 0.8rem;
      color: #888;
    }

    .search-result-cat {
      font-size: 0.65rem;
      color: #ff6b9d;
      text-transform: uppercase;
    }

    /* Mode toggle */
    .mode-toggle {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    .mode-btn {
      padding: 10px 25px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      color: #888;
      font-family: inherit;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .mode-btn:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .mode-btn.active {
      background: #ff6b9d;
      color: #000;
      border-color: #ff6b9d;
    }

    /* Quiz mode */
    .quiz-card {
      background: rgba(20, 20, 35, 0.8);
      border: 1px solid rgba(255, 204, 0, 0.3);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 0 40px rgba(255, 204, 0, 0.1);
      text-align: center;
    }

    .quiz-question {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .quiz-prompt {
      font-size: 0.9rem;
      color: #888;
      margin-bottom: 25px;
    }

    .quiz-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .quiz-option {
      padding: 15px 20px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      color: #fff;
      font-family: inherit;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
    }

    .quiz-option:hover {
      background: rgba(255, 107, 157, 0.1);
      border-color: rgba(255, 107, 157, 0.3);
    }

    .quiz-option.correct {
      background: rgba(0, 255, 136, 0.2);
      border-color: #00ff88;
      color: #00ff88;
    }

    .quiz-option.wrong {
      background: rgba(255, 51, 102, 0.2);
      border-color: #ff3366;
      color: #ff3366;
    }

    .quiz-option.disabled {
      pointer-events: none;
      opacity: 0.6;
    }

    .quiz-stats {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-bottom: 20px;
    }

    .quiz-stat {
      text-align: center;
    }

    .quiz-stat-value {
      font-size: 1.8rem;
      font-weight: 700;
    }

    .quiz-stat-value.correct-color {
      color: #00ff88;
      text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
    }

    .quiz-stat-value.wrong-color {
      color: #ff3366;
      text-shadow: 0 0 10px rgba(255, 51, 102, 0.5);
    }

    .quiz-stat-value.streak-color {
      color: #ffcc00;
      text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
    }

    .quiz-stat-label {
      font-size: 0.7rem;
      color: #666;
      text-transform: uppercase;
    }

    .quiz-feedback {
      padding: 15px;
      border-radius: 12px;
      margin-top: 20px;
      display: none;
    }

    .quiz-feedback.show {
      display: block;
    }

    .quiz-feedback.correct {
      background: rgba(0, 255, 136, 0.1);
      border: 1px solid rgba(0, 255, 136, 0.3);
      color: #00ff88;
    }

    .quiz-feedback.wrong {
      background: rgba(255, 51, 102, 0.1);
      border: 1px solid rgba(255, 51, 102, 0.3);
      color: #ff3366;
    }

    .next-question-btn {
      margin-top: 20px;
      padding: 12px 30px;
      background: linear-gradient(135deg, #ffcc00, #ffa07a);
      border: none;
      border-radius: 25px;
      color: #000;
      font-family: inherit;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: none;
    }

    .next-question-btn.show {
      display: inline-block;
    }

    .next-question-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(255, 204, 0, 0.4);
    }

    /* Voice Toggle */
    .voice-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
      font-size: 0.85rem;
      color: #888;
    }

    .voice-toggle-label {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .voice-switch {
      position: relative;
      width: 60px;
      height: 28px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 14px;
      cursor: pointer;
      transition: all 0.3s;
      border: 1px solid rgba(255, 107, 157, 0.3);
    }

    .voice-switch::before {
      content: '‚ôÄ';
      position: absolute;
      left: 4px;
      top: 50%;
      transform: translateY(-50%);
      width: 20px;
      height: 20px;
      background: linear-gradient(135deg, #ff6b9d, #ffa07a);
      border-radius: 50%;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.7rem;
      color: #000;
    }

    .voice-switch.male::before {
      content: '‚ôÇ';
      left: 36px;
      background: linear-gradient(135deg, #6b9dff, #7affa0);
    }

    .voice-gender-text {
      min-width: 50px;
      color: #ff6b9d;
      font-weight: 500;
    }

    .voice-switch.male + .voice-gender-text {
      color: #6b9dff;
    }

    /* Kana Reference Panel */
    .kana-toggle {
      position: fixed;
      top: 50%;
      right: 0;
      transform: translateY(-50%);
      background: linear-gradient(135deg, #ff6b9d, #ffa07a);
      color: #000;
      border: none;
      padding: 15px 8px;
      border-radius: 12px 0 0 12px;
      cursor: pointer;
      font-family: inherit;
      font-size: 0.8rem;
      font-weight: 600;
      writing-mode: vertical-rl;
      z-index: 300;
      transition: all 0.2s;
    }

    .kana-toggle:hover {
      padding-right: 12px;
      box-shadow: -5px 0 20px rgba(255, 107, 157, 0.4);
    }

    .kana-toggle.open {
      right: 320px;
    }

    .kana-panel {
      position: fixed;
      top: 0;
      right: -320px;
      width: 320px;
      height: 100vh;
      background: rgba(15, 15, 25, 0.98);
      border-left: 1px solid rgba(255, 107, 157, 0.3);
      overflow-y: auto;
      z-index: 290;
      transition: right 0.3s ease;
      padding: 20px;
    }

    .kana-panel.open {
      right: 0;
    }

    .kana-panel-header {
      text-align: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .kana-panel-title {
      font-size: 1.2rem;
      color: #ff6b9d;
      margin-bottom: 5px;
    }

    .kana-tabs {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin-bottom: 15px;
    }

    .kana-tab {
      padding: 8px 20px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      color: #888;
      font-family: inherit;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .kana-tab:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .kana-tab.active {
      background: #ff6b9d;
      color: #000;
      border-color: #ff6b9d;
    }

    .kana-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 4px;
    }

    .kana-cell {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 8px;
      padding: 8px 4px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .kana-cell:hover {
      background: rgba(255, 107, 157, 0.15);
      border-color: rgba(255, 107, 157, 0.4);
    }

    .kana-char {
      font-size: 1.3rem;
      margin-bottom: 2px;
    }

    .kana-romaji {
      font-size: 0.6rem;
      color: #666;
    }

    .kana-section {
      display: none;
    }

    .kana-section.active {
      display: block;
    }

    .kana-row-label {
      grid-column: 1 / -1;
      font-size: 0.7rem;
      color: #ffcc00;
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 10px 0 5px;
      text-align: left;
    }

    @media (max-width: 500px) {
      .logo { font-size: 2rem; }
      .japanese { font-size: 1.8rem; }
      .quick-phrases { grid-template-columns: 1fr; }
      .kana-panel { width: 280px; right: -280px; }
      .kana-toggle.open { right: 280px; }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="header">
      <h1 class="logo">üóæ Roikku</h1>
      <p class="tagline">Learn Japanese phrases for everyday life</p>
    </div>

    <!-- Search Bar -->
    <div class="search-container">
      <span class="search-icon">üîç</span>
      <input type="text" class="search-input" id="searchInput" placeholder="Search phrases...">
      <div class="search-results" id="searchResults"></div>
    </div>

    <!-- Mode Toggle -->
    <div class="mode-toggle">
      <button class="mode-btn active" data-mode="learn" id="learnModeBtn">üìö Learn</button>
      <button class="mode-btn" data-mode="quiz" id="quizModeBtn">üéØ Quiz</button>
    </div>

    <!-- Voice Toggle -->
    <div class="voice-toggle">
      <span class="voice-toggle-label">üîä Voice:</span>
      <div class="voice-switch" id="voiceSwitch"></div>
      <span class="voice-gender-text" id="voiceGenderText">Female</span>
    </div>

    <!-- Learn Mode Content -->
    <div id="learnMode">
      <div class="categories" id="categories">
      <button class="category-btn active" data-category="greetings">Greetings</button>
      <button class="category-btn" data-category="shopping">Shopping</button>
      <button class="category-btn" data-category="restaurant">Restaurant</button>
      <button class="category-btn" data-category="directions">Directions</button>
      <button class="category-btn" data-category="social">Social</button>
      <button class="category-btn" data-category="emergency">Emergency</button>
    </div>

    <div class="progress-bar">
      <div class="progress-fill" id="progressFill" style="width: 0%"></div>
    </div>

    <div class="phrase-card" id="phraseCard">
      <!-- Phrase content loaded dynamically -->
    </div>

    <div class="navigation">
      <button class="nav-btn" id="prevBtn">‚Üê</button>
      <button class="btn btn-speak" id="speakBtn">üîä Listen</button>
      <button class="nav-btn" id="nextBtn">‚Üí</button>
    </div>

    <div class="section-title">Quick Phrases</div>
    <div class="quick-phrases" id="quickPhrases">
      <!-- Quick phrases loaded dynamically -->
    </div>
    </div><!-- End Learn Mode -->

    <!-- Quiz Mode Content -->
    <div id="quizMode" style="display: none;">
      <div class="quiz-stats">
        <div class="quiz-stat">
          <div class="quiz-stat-value correct-color" id="quizCorrect">0</div>
          <div class="quiz-stat-label">Correct</div>
        </div>
        <div class="quiz-stat">
          <div class="quiz-stat-value wrong-color" id="quizWrong">0</div>
          <div class="quiz-stat-label">Wrong</div>
        </div>
        <div class="quiz-stat">
          <div class="quiz-stat-value streak-color" id="quizStreak">0</div>
          <div class="quiz-stat-label">Streak</div>
        </div>
      </div>

      <div class="quiz-card" id="quizCard">
        <div class="quiz-question" id="quizQuestion">„Åì„Çì„Å´„Å°„ÅØ</div>
        <div class="quiz-prompt">What does this mean?</div>
        <div class="quiz-options" id="quizOptions">
          <!-- Options loaded dynamically -->
        </div>
        <div class="quiz-feedback" id="quizFeedback"></div>
        <button class="next-question-btn" id="nextQuestionBtn">Next Question ‚Üí</button>
      </div>

      <button class="btn btn-speak" id="quizSpeakBtn" style="margin: 0 auto; display: flex;">üîä Listen</button>
    </div>
  </div>

  <!-- Kana Reference Toggle -->
  <button class="kana-toggle" id="kanaToggle">„ÅÇ„Ç¢ Kana</button>

  <!-- Kana Reference Panel -->
  <div class="kana-panel" id="kanaPanel">
    <div class="kana-panel-header">
      <div class="kana-panel-title">Japanese Characters</div>
    </div>

    <div class="kana-tabs">
      <button class="kana-tab active" data-kana="hiragana">„Å≤„Çâ„Åå„Å™</button>
      <button class="kana-tab" data-kana="katakana">„Ç´„Çø„Ç´„Éä</button>
    </div>

    <div class="kana-section active" id="hiraganaSection">
      <div class="kana-grid" id="hiraganaGrid"></div>
    </div>

    <div class="kana-section" id="katakanaSection">
      <div class="kana-grid" id="katakanaGrid"></div>
    </div>
  </div>

  <a href="https://sloppy.live" class="back-link">‚Üê sloppy.live</a>

  <script>
    const phrases = {
      greetings: [
        {
          japanese: '„Åä„ÅØ„Çà„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô',
          romaji: 'Ohayou gozaimasu',
          english: 'Good morning (polite)',
          tip: 'Pronounce "ou" as a long "o" sound. The "u" at the end is almost silent.',
          context: 'Use this until about 10-11 AM. With close friends, you can shorten it to just "„Åä„ÅØ„Çà„ÅÜ" (Ohayou).'
        },
        {
          japanese: '„Åì„Çì„Å´„Å°„ÅØ',
          romaji: 'Konnichiwa',
          english: 'Hello / Good afternoon',
          tip: 'The "n" before "ni" is held slightly longer. Say "kon-ni-chi-wa" with equal beats.',
          context: 'The most versatile greeting! Use from late morning until early evening.'
        },
        {
          japanese: '„Åì„Çì„Å∞„Çì„ÅØ',
          romaji: 'Konbanwa',
          english: 'Good evening',
          tip: 'Similar rhythm to „Åì„Çì„Å´„Å°„ÅØ. The "n" before "ba" is a full beat.',
          context: 'Use after sunset. Great for evening social situations.'
        },
        {
          japanese: '„ÅäÂÖÉÊ∞ó„Åß„Åô„ÅãÔºü',
          romaji: 'O-genki desu ka?',
          english: 'How are you?',
          tip: 'The "ge" sounds like "geh". Rise your pitch slightly at the end for the question.',
          context: 'More formal than in English - often used when you haven\'t seen someone in a while.'
        },
        {
          japanese: '„ÅØ„Åò„ÇÅ„Åæ„Åó„Å¶',
          romaji: 'Hajimemashite',
          english: 'Nice to meet you',
          tip: 'Break it down: Ha-ji-me-ma-shi-te. The "shi" is soft, not "shee".',
          context: 'Used when meeting someone for the first time. Often followed by your name.'
        },
        {
          japanese: '„Çà„Çç„Åó„Åè„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô',
          romaji: 'Yoroshiku onegaishimasu',
          english: 'Please take care of me / Nice to meet you',
          tip: 'This phrase has many uses! "Yo-ro-shi-ku o-ne-gai-shi-ma-su" - keep it flowing.',
          context: 'Essential phrase! Use after introductions, when asking favors, or starting work together.'
        },
        {
          japanese: '„Åï„Çà„ÅÜ„Å™„Çâ',
          romaji: 'Sayounara',
          english: 'Goodbye',
          tip: 'The "you" is a long "o" sound. "Sa-y≈ç-na-ra" with the ≈ç held longer.',
          context: 'Formal goodbye. For casual farewells, use „Åò„ÇÉ„ÅÇ„Å≠ (Jaa ne) or „Åæ„Åü„Å≠ (Mata ne).'
        },
        {
          japanese: '„Åä„ÇÑ„Åô„Åø„Å™„Åï„ÅÑ',
          romaji: 'Oyasuminasai',
          english: 'Good night',
          tip: 'O-ya-su-mi-na-sai - the "su" is very soft, almost whispered.',
          context: 'Use when parting for the night or going to bed. Casual: „Åä„ÇÑ„Åô„Åø (Oyasumi).'
        }
      ],
      shopping: [
        {
          japanese: '„ÅÑ„Åè„Çâ„Åß„Åô„ÅãÔºü',
          romaji: 'Ikura desu ka?',
          english: 'How much is it?',
          tip: 'I-ku-ra de-su ka? The "ra" is a light flap, between "r" and "l".',
          context: 'Essential for any shopping! Point at the item when asking.'
        },
        {
          japanese: '„Åì„Çå„Çí„Åè„Å†„Åï„ÅÑ',
          romaji: 'Kore o kudasai',
          english: 'I\'ll take this, please',
          tip: 'Ko-re o ku-da-sai. "Kudasai" is the polite "please give me".',
          context: 'Point at what you want. Great for restaurants and shops.'
        },
        {
          japanese: '„Ç´„Éº„Éâ„ÅßÊâï„Åà„Åæ„Åô„ÅãÔºü',
          romaji: 'Kaado de haraemasu ka?',
          english: 'Can I pay by card?',
          tip: '"Kaado" is the borrowed English word "card". Ha-ra-e-ma-su.',
          context: 'Japan is still quite cash-based, so always good to ask first!'
        },
        {
          japanese: 'Ë©¶ÁùÄ„Åó„Å¶„ÇÇ„ÅÑ„ÅÑ„Åß„Åô„ÅãÔºü',
          romaji: 'Shichaku shite mo ii desu ka?',
          english: 'May I try this on?',
          tip: 'Shi-cha-ku shi-te mo ii de-su ka? "Shichaku" = trying on clothes.',
          context: 'Useful in clothing stores. Staff will show you to the fitting room.'
        },
        {
          japanese: 'Ë¢ã„Çí„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô',
          romaji: 'Fukuro o onegaishimasu',
          english: 'A bag, please',
          tip: 'Fu-ku-ro. Note: many stores now charge for bags!',
          context: 'Since 2020, plastic bags cost extra in Japan. Bring your own or ask politely.'
        },
        {
          japanese: '„É¨„Ç∑„Éº„Éà„Çí„Åè„Å†„Åï„ÅÑ',
          romaji: 'Reshiito o kudasai',
          english: 'Receipt, please',
          tip: '"Reshiito" comes from English "receipt". Re-shii-to.',
          context: 'Useful for business expenses or returns. Keep your receipts!'
        }
      ],
      restaurant: [
        {
          japanese: '„ÅÑ„Åü„Å†„Åç„Åæ„Åô',
          romaji: 'Itadakimasu',
          english: 'Thanks for the food (before eating)',
          tip: 'I-ta-da-ki-ma-su. Said with gratitude before every meal!',
          context: 'Essential! Said before eating. Shows appreciation for the food and those who prepared it.'
        },
        {
          japanese: '„Åî„Å°„Åù„ÅÜ„Åï„Åæ„Åß„Åó„Åü',
          romaji: 'Gochisousama deshita',
          english: 'Thanks for the meal (after eating)',
          tip: 'Go-chi-sou-sa-ma de-shi-ta. Longer phrase, but very important!',
          context: 'Said after finishing a meal. Very polite to say to restaurant staff when leaving.'
        },
        {
          japanese: '„Åô„Åø„Åæ„Åõ„Çì',
          romaji: 'Sumimasen',
          english: 'Excuse me',
          tip: 'Su-mi-ma-sen. Versatile! Also means "sorry" and "thank you".',
          context: 'Use to call a waiter, apologize for small things, or express gratitude.'
        },
        {
          japanese: '„É°„Éã„É•„Éº„Çí„Åè„Å†„Åï„ÅÑ',
          romaji: 'Menyuu o kudasai',
          english: 'Menu, please',
          tip: '"Menyuu" is from English "menu". Me-nyuu o ku-da-sai.',
          context: 'Use when seated. Many restaurants also have picture menus!'
        },
        {
          japanese: '„Åä„Åô„Åô„ÇÅ„ÅØ‰Ωï„Åß„Åô„ÅãÔºü',
          romaji: 'Osusume wa nan desu ka?',
          english: 'What do you recommend?',
          tip: 'O-su-su-me wa nan de-su ka? "Osusume" = recommendation.',
          context: 'Great way to discover local favorites! Staff love sharing their recommendations.'
        },
        {
          japanese: '„Åä‰ºöË®à„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô',
          romaji: 'O-kaikei onegaishimasu',
          english: 'Check, please',
          tip: 'O-kai-kei o-ne-gai-shi-ma-su. Or just gesture writing on your palm!',
          context: 'In Japan, you often pay at the register near the exit, not at your table.'
        },
        {
          japanese: '„Ç¢„É¨„É´„ÇÆ„Éº„Åå„ÅÇ„Çä„Åæ„Åô',
          romaji: 'Arerugii ga arimasu',
          english: 'I have an allergy',
          tip: '"Arerugii" is from English "allergy". A-re-ru-gii.',
          context: 'Important for food safety! Follow with the specific allergy.'
        },
        {
          japanese: 'ÁæéÂë≥„Åó„ÅÑÔºÅ',
          romaji: 'Oishii!',
          english: 'Delicious!',
          tip: 'O-i-shii! Let your enjoyment show in your voice!',
          context: 'Chefs love hearing this! A simple way to show appreciation.'
        }
      ],
      directions: [
        {
          japanese: '„Åô„Åø„Åæ„Åõ„Çì„ÄÅÈÅì„Å´Ëø∑„ÅÑ„Åæ„Åó„Åü',
          romaji: 'Sumimasen, michi ni mayoimashita',
          english: 'Excuse me, I\'m lost',
          tip: 'Mi-chi ni ma-yo-i-ma-shi-ta. "Michi" = road/way, "mayou" = to be lost.',
          context: 'Japanese people are very helpful! Don\'t be shy to ask.'
        },
        {
          japanese: 'ÈßÖ„ÅØ„Å©„Åì„Åß„Åô„ÅãÔºü',
          romaji: 'Eki wa doko desu ka?',
          english: 'Where is the station?',
          tip: 'E-ki wa do-ko de-su ka? "Eki" = train station.',
          context: 'Train stations are central landmarks. Replace ÈßÖ with other places as needed.'
        },
        {
          japanese: '„Åæ„Å£„Åô„ÅêË°å„Å£„Å¶„Åè„Å†„Åï„ÅÑ',
          romaji: 'Massugu itte kudasai',
          english: 'Please go straight',
          tip: 'Mas-su-gu it-te ku-da-sai. Double consonants are held slightly longer.',
          context: 'You might hear this in directions. "Massugu" = straight ahead.'
        },
        {
          japanese: 'Âè≥„Å´Êõ≤„Åå„Å£„Å¶„Åè„Å†„Åï„ÅÑ',
          romaji: 'Migi ni magatte kudasai',
          english: 'Please turn right',
          tip: 'Mi-gi ni ma-gat-te. "Migi" = right, "Hidari" = left.',
          context: 'Essential direction vocabulary! Combine with other phrases.'
        },
        {
          japanese: 'Â∑¶„Å´Êõ≤„Åå„Å£„Å¶„Åè„Å†„Åï„ÅÑ',
          romaji: 'Hidari ni magatte kudasai',
          english: 'Please turn left',
          tip: 'Hi-da-ri ni ma-gat-te. Remember: Hidari = left, Migi = right.',
          context: 'Practice both right and left until they become automatic!'
        },
        {
          japanese: '„Åì„Åì„Åã„ÇâËøë„ÅÑ„Åß„Åô„ÅãÔºü',
          romaji: 'Koko kara chikai desu ka?',
          english: 'Is it close from here?',
          tip: 'Ko-ko ka-ra chi-kai de-su ka? "Chikai" = close/near.',
          context: 'Good follow-up question after getting directions.'
        },
        {
          japanese: 'Ê≠©„ÅÑ„Å¶‰ΩïÂàÜ„Åß„Åô„ÅãÔºü',
          romaji: 'Aruite nanpun desu ka?',
          english: 'How many minutes by walking?',
          tip: 'A-ru-i-te nan-pun de-su ka? "Aruite" = by walking.',
          context: 'Japanese often give time estimates rather than distance.'
        }
      ],
      social: [
        {
          japanese: '„ÅäÂêçÂâç„ÅØ‰Ωï„Åß„Åô„ÅãÔºü',
          romaji: 'O-namae wa nan desu ka?',
          english: 'What is your name?',
          tip: 'O-na-ma-e wa nan de-su ka? The "O" is honorific.',
          context: 'Polite way to ask someone\'s name. Introduce yourself first!'
        },
        {
          japanese: 'ÁßÅ„ÅØ„Äá„Äá„Åß„Åô',
          romaji: 'Watashi wa __ desu',
          english: 'I am __',
          tip: 'Wa-ta-shi wa [name] de-su. Simple self-introduction!',
          context: 'Fill in your name. Often followed by „Çà„Çç„Åó„Åè„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô.'
        },
        {
          japanese: 'Êó•Êú¨Ë™û„ÅåÂ∞ë„ÅóË©±„Åõ„Åæ„Åô',
          romaji: 'Nihongo ga sukoshi hanasemasu',
          english: 'I can speak a little Japanese',
          tip: 'Ni-hon-go ga su-ko-shi ha-na-se-ma-su. Be humble!',
          context: 'Japanese appreciate any effort to speak their language!'
        },
        {
          japanese: '„ÇÇ„ÅÜ‰∏ÄÂ∫¶„ÅäÈ°ò„ÅÑ„Åó„Åæ„Åô',
          romaji: 'Mou ichido onegaishimasu',
          english: 'Once more, please',
          tip: 'Mou i-chi-do o-ne-gai-shi-ma-su. Very useful for learning!',
          context: 'Use when you didn\'t catch what someone said. People will happily repeat.'
        },
        {
          japanese: '„ÇÜ„Å£„Åè„ÇäË©±„Åó„Å¶„Åè„Å†„Åï„ÅÑ',
          romaji: 'Yukkuri hanashite kudasai',
          english: 'Please speak slowly',
          tip: 'Yuk-ku-ri ha-na-shi-te ku-da-sai. "Yukkuri" = slowly.',
          context: 'Don\'t be shy to ask! People will adjust their speed.'
        },
        {
          japanese: 'Ë∂£Âë≥„ÅØ‰Ωï„Åß„Åô„ÅãÔºü',
          romaji: 'Shumi wa nan desu ka?',
          english: 'What are your hobbies?',
          tip: 'Shu-mi wa nan de-su ka? Great conversation starter!',
          context: 'Japanese love discussing hobbies. Share yours too!'
        },
        {
          japanese: '„Åä‰ªï‰∫ã„ÅØ‰Ωï„Åß„Åô„ÅãÔºü',
          romaji: 'O-shigoto wa nan desu ka?',
          english: 'What is your job?',
          tip: 'O-shi-go-to wa nan de-su ka? "Shigoto" = work/job.',
          context: 'Common question when getting to know someone.'
        },
        {
          japanese: 'Ê•Ω„Åó„Åã„Å£„Åü„Åß„Åô',
          romaji: 'Tanoshikatta desu',
          english: 'It was fun',
          tip: 'Ta-no-shi-kat-ta de-su. Past tense of "tanoshii" (fun).',
          context: 'Great way to end a gathering or activity. Shows gratitude!'
        }
      ],
      emergency: [
        {
          japanese: 'Âä©„Åë„Å¶„Åè„Å†„Åï„ÅÑÔºÅ',
          romaji: 'Tasukete kudasai!',
          english: 'Help me, please!',
          tip: 'Ta-su-ke-te ku-da-sai! Say it loudly and clearly.',
          context: 'Emergency phrase. Japan is very safe, but good to know.'
        },
        {
          japanese: 'Ë≠¶ÂØü„ÇíÂëº„Çì„Åß„Åè„Å†„Åï„ÅÑ',
          romaji: 'Keisatsu o yonde kudasai',
          english: 'Please call the police',
          tip: 'Kei-sa-tsu o yon-de ku-da-sai. Emergency number: 110.',
          context: 'Police in Japan are helpful and approachable.'
        },
        {
          japanese: 'ÊïëÊÄ•Ëªä„ÇíÂëº„Çì„Åß„Åè„Å†„Åï„ÅÑ',
          romaji: 'Kyuukyuusha o yonde kudasai',
          english: 'Please call an ambulance',
          tip: 'Kyuu-kyuu-sha. Emergency number: 119 (fire/ambulance).',
          context: 'For medical emergencies. Ambulances are free in Japan.'
        },
        {
          japanese: 'ÁóÖÈô¢„ÅØ„Å©„Åì„Åß„Åô„ÅãÔºü',
          romaji: 'Byouin wa doko desu ka?',
          english: 'Where is the hospital?',
          tip: 'Byou-in wa do-ko de-su ka? "Byouin" = hospital.',
          context: 'Many hospitals have English-speaking staff in major cities.'
        },
        {
          japanese: 'Ê∞óÂàÜ„ÅåÊÇ™„ÅÑ„Åß„Åô',
          romaji: 'Kibun ga warui desu',
          english: 'I don\'t feel well',
          tip: 'Ki-bun ga wa-ru-i de-su. "Kibun" = feeling.',
          context: 'Use to explain you\'re unwell. People will want to help.'
        },
        {
          japanese: 'Ëñ¨Â±Ä„ÅØ„Å©„Åì„Åß„Åô„ÅãÔºü',
          romaji: 'Yakkyoku wa doko desu ka?',
          english: 'Where is a pharmacy?',
          tip: 'Yak-kyo-ku wa do-ko de-su ka? Look for „Éâ„É©„ÉÉ„Ç∞„Çπ„Éà„Ç¢ too.',
          context: 'Pharmacies are common. Drugstores often have basic medicine.'
        }
      ]
    };

    let currentCategory = 'greetings';
    let currentIndex = 0;
    let currentMode = 'learn';
    let voiceGender = 'female'; // default to female

    // Quiz state
    let quizCorrect = 0;
    let quizWrong = 0;
    let quizStreak = 0;
    let currentQuizPhrase = null;

    // Cache available voices
    let japaneseVoices = [];

    const phraseCard = document.getElementById('phraseCard');
    const quickPhrasesEl = document.getElementById('quickPhrases');
    const progressFill = document.getElementById('progressFill');
    const searchInput = document.getElementById('searchInput');
    const searchResults = document.getElementById('searchResults');
    const learnMode = document.getElementById('learnMode');
    const quizMode = document.getElementById('quizMode');

    function renderPhrase() {
      const categoryPhrases = phrases[currentCategory];
      const phrase = categoryPhrases[currentIndex];

      const progress = ((currentIndex + 1) / categoryPhrases.length) * 100;
      progressFill.style.width = progress + '%';

      phraseCard.innerHTML = `
        <div class="phrase-header">
          <span class="phrase-category">${currentCategory}</span>
          <span class="phrase-number">${currentIndex + 1} / ${categoryPhrases.length}</span>
        </div>
        <div class="japanese">${phrase.japanese}</div>
        <div class="romaji">${phrase.romaji}</div>
        <div class="english">${phrase.english}</div>
        <div class="pronunciation-tip">
          <div class="tip-label">üí° Pronunciation Tip</div>
          <div class="tip-text">${phrase.tip}</div>
        </div>
        <div class="context">
          <div class="context-label">üìç When to Use</div>
          <div class="context-text">${phrase.context}</div>
        </div>
      `;
    }

    function renderQuickPhrases() {
      const essentials = [
        { jp: '„ÅÇ„Çä„Åå„Å®„ÅÜ', en: 'Thank you' },
        { jp: '„Åô„Åø„Åæ„Åõ„Çì', en: 'Excuse me' },
        { jp: '„ÅØ„ÅÑ / „ÅÑ„ÅÑ„Åà', en: 'Yes / No' },
        { jp: '„Çè„Åã„Çä„Åæ„Åó„Åü', en: 'I understand' }
      ];

      quickPhrasesEl.innerHTML = essentials.map(p => `
        <div class="quick-phrase" data-text="${p.jp}">
          <div class="quick-jp">${p.jp}</div>
          <div class="quick-en">${p.en}</div>
        </div>
      `).join('');

      quickPhrasesEl.querySelectorAll('.quick-phrase').forEach(el => {
        el.addEventListener('click', () => {
          speak(el.dataset.text);
        });
      });
    }

    function speak(text) {
      if ('speechSynthesis' in window) {
        speechSynthesis.cancel(); // Stop any ongoing speech
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'ja-JP';
        utterance.rate = 0.8;

        // Try to find a Japanese voice matching the gender preference
        if (japaneseVoices.length > 0) {
          const preferredVoice = japaneseVoices.find(v => {
            const name = v.name.toLowerCase();
            if (voiceGender === 'female') {
              return name.includes('female') || name.includes('kyoko') ||
                     name.includes('haruka') || name.includes('o-ren') ||
                     name.includes('nanami') || (!name.includes('male') && !name.includes('otoya'));
            } else {
              return name.includes('male') || name.includes('otoya') ||
                     name.includes('ichiro') || name.includes('takumi');
            }
          });
          if (preferredVoice) {
            utterance.voice = preferredVoice;
          } else {
            // Fallback: use first available Japanese voice
            utterance.voice = japaneseVoices[0];
          }
        }

        speechSynthesis.speak(utterance);
      }
    }

    // Load available voices
    function loadVoices() {
      const voices = speechSynthesis.getVoices();
      japaneseVoices = voices.filter(v => v.lang.startsWith('ja'));
    }

    // Voices may load async
    if (speechSynthesis.onvoiceschanged !== undefined) {
      speechSynthesis.onvoiceschanged = loadVoices;
    }
    loadVoices();

    // Category buttons
    document.querySelectorAll('.category-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentCategory = btn.dataset.category;
        currentIndex = 0;
        renderPhrase();
      });
    });

    // Navigation
    document.getElementById('prevBtn').addEventListener('click', () => {
      const categoryPhrases = phrases[currentCategory];
      currentIndex = (currentIndex - 1 + categoryPhrases.length) % categoryPhrases.length;
      renderPhrase();
    });

    document.getElementById('nextBtn').addEventListener('click', () => {
      const categoryPhrases = phrases[currentCategory];
      currentIndex = (currentIndex + 1) % categoryPhrases.length;
      renderPhrase();
    });

    // Speak button
    document.getElementById('speakBtn').addEventListener('click', () => {
      const phrase = phrases[currentCategory][currentIndex];
      speak(phrase.japanese);
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') {
        document.getElementById('prevBtn').click();
      } else if (e.key === 'ArrowRight') {
        document.getElementById('nextBtn').click();
      } else if (e.key === ' ') {
        e.preventDefault();
        document.getElementById('speakBtn').click();
      }
    });

    // Get all phrases as flat array
    function getAllPhrases() {
      const all = [];
      for (const [cat, list] of Object.entries(phrases)) {
        list.forEach((p, idx) => {
          all.push({ ...p, category: cat, index: idx });
        });
      }
      return all;
    }

    // Search functionality
    searchInput.addEventListener('input', (e) => {
      const query = e.target.value.toLowerCase().trim();
      if (!query) {
        searchResults.classList.remove('show');
        return;
      }

      const allPhrases = getAllPhrases();
      const matches = allPhrases.filter(p =>
        p.japanese.includes(query) ||
        p.romaji.toLowerCase().includes(query) ||
        p.english.toLowerCase().includes(query)
      ).slice(0, 8);

      if (matches.length === 0) {
        searchResults.innerHTML = '<div class="search-result-item"><span style="color:#666">No matches found</span></div>';
      } else {
        searchResults.innerHTML = matches.map(p => `
          <div class="search-result-item" data-category="${p.category}" data-index="${p.index}">
            <div class="search-result-jp">${p.japanese}</div>
            <div class="search-result-en">${p.english}</div>
            <div class="search-result-cat">${p.category}</div>
          </div>
        `).join('');
      }
      searchResults.classList.add('show');

      // Click handlers for results
      searchResults.querySelectorAll('.search-result-item[data-category]').forEach(item => {
        item.addEventListener('click', () => {
          currentCategory = item.dataset.category;
          currentIndex = parseInt(item.dataset.index);

          // Update category buttons
          document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
          document.querySelector(`[data-category="${currentCategory}"]`).classList.add('active');

          // Switch to learn mode if in quiz
          if (currentMode === 'quiz') {
            switchMode('learn');
          }

          renderPhrase();
          searchInput.value = '';
          searchResults.classList.remove('show');
        });
      });
    });

    // Hide search results on outside click
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.search-container')) {
        searchResults.classList.remove('show');
      }
    });

    // Mode toggle
    function switchMode(mode) {
      currentMode = mode;
      document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
      document.querySelector(`[data-mode="${mode}"]`).classList.add('active');

      if (mode === 'learn') {
        learnMode.style.display = 'block';
        quizMode.style.display = 'none';
      } else {
        learnMode.style.display = 'none';
        quizMode.style.display = 'block';
        generateQuizQuestion();
      }
    }

    document.getElementById('learnModeBtn').addEventListener('click', () => switchMode('learn'));
    document.getElementById('quizModeBtn').addEventListener('click', () => switchMode('quiz'));

    // Voice gender toggle
    const voiceSwitch = document.getElementById('voiceSwitch');
    const voiceGenderText = document.getElementById('voiceGenderText');

    voiceSwitch.addEventListener('click', () => {
      voiceGender = voiceGender === 'female' ? 'male' : 'female';
      voiceSwitch.classList.toggle('male', voiceGender === 'male');
      voiceGenderText.textContent = voiceGender === 'female' ? 'Female' : 'Male';
      voiceGenderText.style.color = voiceGender === 'female' ? '#ff6b9d' : '#6b9dff';
    });

    // Quiz functions
    function shuffleArray(arr) {
      const shuffled = [...arr];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    function generateQuizQuestion() {
      const allPhrases = getAllPhrases();
      currentQuizPhrase = allPhrases[Math.floor(Math.random() * allPhrases.length)];

      // Get 3 wrong answers
      const wrongAnswers = shuffleArray(
        allPhrases.filter(p => p.english !== currentQuizPhrase.english)
      ).slice(0, 3).map(p => p.english);

      // Combine and shuffle all options
      const options = shuffleArray([currentQuizPhrase.english, ...wrongAnswers]);

      document.getElementById('quizQuestion').textContent = currentQuizPhrase.japanese;
      document.getElementById('quizFeedback').classList.remove('show', 'correct', 'wrong');
      document.getElementById('nextQuestionBtn').classList.remove('show');

      const optionsEl = document.getElementById('quizOptions');
      optionsEl.innerHTML = options.map(opt => `
        <button class="quiz-option" data-answer="${opt}">${opt}</button>
      `).join('');

      optionsEl.querySelectorAll('.quiz-option').forEach(btn => {
        btn.addEventListener('click', () => checkAnswer(btn.dataset.answer));
      });
    }

    function checkAnswer(answer) {
      const isCorrect = answer === currentQuizPhrase.english;
      const feedback = document.getElementById('quizFeedback');
      const options = document.querySelectorAll('.quiz-option');

      options.forEach(opt => {
        opt.classList.add('disabled');
        if (opt.dataset.answer === currentQuizPhrase.english) {
          opt.classList.add('correct');
        } else if (opt.dataset.answer === answer && !isCorrect) {
          opt.classList.add('wrong');
        }
      });

      if (isCorrect) {
        quizCorrect++;
        quizStreak++;
        feedback.textContent = `‚úì Correct! "${currentQuizPhrase.romaji}"`;
        feedback.classList.add('correct');
      } else {
        quizWrong++;
        quizStreak = 0;
        feedback.textContent = `‚úó The answer was: "${currentQuizPhrase.english}"`;
        feedback.classList.add('wrong');
      }

      feedback.classList.add('show');
      document.getElementById('nextQuestionBtn').classList.add('show');

      // Update stats
      document.getElementById('quizCorrect').textContent = quizCorrect;
      document.getElementById('quizWrong').textContent = quizWrong;
      document.getElementById('quizStreak').textContent = quizStreak;
    }

    document.getElementById('nextQuestionBtn').addEventListener('click', generateQuizQuestion);
    document.getElementById('quizSpeakBtn').addEventListener('click', () => {
      if (currentQuizPhrase) {
        speak(currentQuizPhrase.japanese);
      }
    });

    // Kana Reference Data
    const kanaData = {
      hiragana: [
        { label: 'Vowels', chars: [['„ÅÇ','a'],['„ÅÑ','i'],['„ÅÜ','u'],['„Åà','e'],['„Åä','o']] },
        { label: 'K', chars: [['„Åã','ka'],['„Åç','ki'],['„Åè','ku'],['„Åë','ke'],['„Åì','ko']] },
        { label: 'S', chars: [['„Åï','sa'],['„Åó','shi'],['„Åô','su'],['„Åõ','se'],['„Åù','so']] },
        { label: 'T', chars: [['„Åü','ta'],['„Å°','chi'],['„Å§','tsu'],['„Å¶','te'],['„Å®','to']] },
        { label: 'N', chars: [['„Å™','na'],['„Å´','ni'],['„Å¨','nu'],['„Å≠','ne'],['„ÅÆ','no']] },
        { label: 'H', chars: [['„ÅØ','ha'],['„Å≤','hi'],['„Åµ','fu'],['„Å∏','he'],['„Åª','ho']] },
        { label: 'M', chars: [['„Åæ','ma'],['„Åø','mi'],['„ÇÄ','mu'],['„ÇÅ','me'],['„ÇÇ','mo']] },
        { label: 'Y', chars: [['„ÇÑ','ya'],['',''],['„ÇÜ','yu'],['',''],['„Çà','yo']] },
        { label: 'R', chars: [['„Çâ','ra'],['„Çä','ri'],['„Çã','ru'],['„Çå','re'],['„Çç','ro']] },
        { label: 'W', chars: [['„Çè','wa'],['',''],['',''],['',''],['„Çí','wo']] },
        { label: 'N', chars: [['„Çì','n'],['',''],['',''],['',''],['','']] },
        { label: 'G (voiced)', chars: [['„Åå','ga'],['„Åé','gi'],['„Åê','gu'],['„Åí','ge'],['„Åî','go']] },
        { label: 'Z (voiced)', chars: [['„Åñ','za'],['„Åò','ji'],['„Åö','zu'],['„Åú','ze'],['„Åû','zo']] },
        { label: 'D (voiced)', chars: [['„Å†','da'],['„Å¢','ji'],['„Å•','zu'],['„Åß','de'],['„Å©','do']] },
        { label: 'B (voiced)', chars: [['„Å∞','ba'],['„Å≥','bi'],['„Å∂','bu'],['„Åπ','be'],['„Åº','bo']] },
        { label: 'P (half-voiced)', chars: [['„Å±','pa'],['„Å¥','pi'],['„Å∑','pu'],['„Å∫','pe'],['„ÅΩ','po']] }
      ],
      katakana: [
        { label: 'Vowels', chars: [['„Ç¢','a'],['„Ç§','i'],['„Ç¶','u'],['„Ç®','e'],['„Ç™','o']] },
        { label: 'K', chars: [['„Ç´','ka'],['„Ç≠','ki'],['„ÇØ','ku'],['„Ç±','ke'],['„Ç≥','ko']] },
        { label: 'S', chars: [['„Çµ','sa'],['„Ç∑','shi'],['„Çπ','su'],['„Çª','se'],['„ÇΩ','so']] },
        { label: 'T', chars: [['„Çø','ta'],['„ÉÅ','chi'],['„ÉÑ','tsu'],['„ÉÜ','te'],['„Éà','to']] },
        { label: 'N', chars: [['„Éä','na'],['„Éã','ni'],['„Éå','nu'],['„Éç','ne'],['„Éé','no']] },
        { label: 'H', chars: [['„Éè','ha'],['„Éí','hi'],['„Éï','fu'],['„Éò','he'],['„Éõ','ho']] },
        { label: 'M', chars: [['„Éû','ma'],['„Éü','mi'],['„É†','mu'],['„É°','me'],['„É¢','mo']] },
        { label: 'Y', chars: [['„É§','ya'],['',''],['„É¶','yu'],['',''],['„É®','yo']] },
        { label: 'R', chars: [['„É©','ra'],['„É™','ri'],['„É´','ru'],['„É¨','re'],['„É≠','ro']] },
        { label: 'W', chars: [['„ÉØ','wa'],['',''],['',''],['',''],['„É≤','wo']] },
        { label: 'N', chars: [['„É≥','n'],['',''],['',''],['',''],['','']] },
        { label: 'G (voiced)', chars: [['„Ç¨','ga'],['„ÇÆ','gi'],['„Ç∞','gu'],['„Ç≤','ge'],['„Ç¥','go']] },
        { label: 'Z (voiced)', chars: [['„Ç∂','za'],['„Ç∏','ji'],['„Ç∫','zu'],['„Çº','ze'],['„Çæ','zo']] },
        { label: 'D (voiced)', chars: [['„ÉÄ','da'],['„ÉÇ','ji'],['„ÉÖ','zu'],['„Éá','de'],['„Éâ','do']] },
        { label: 'B (voiced)', chars: [['„Éê','ba'],['„Éì','bi'],['„Éñ','bu'],['„Éô','be'],['„Éú','bo']] },
        { label: 'P (half-voiced)', chars: [['„Éë','pa'],['„Éî','pi'],['„Éó','pu'],['„Éö','pe'],['„Éù','po']] }
      ]
    };

    function renderKanaGrid(type) {
      const grid = document.getElementById(type + 'Grid');
      const data = kanaData[type];
      let html = '';

      data.forEach(row => {
        html += `<div class="kana-row-label">${row.label}</div>`;
        row.chars.forEach(([char, rom]) => {
          if (char) {
            html += `<div class="kana-cell" data-char="${char}">
              <div class="kana-char">${char}</div>
              <div class="kana-romaji">${rom}</div>
            </div>`;
          } else {
            html += `<div class="kana-cell" style="opacity:0.2;pointer-events:none;">
              <div class="kana-char">-</div>
              <div class="kana-romaji"></div>
            </div>`;
          }
        });
      });

      grid.innerHTML = html;

      // Click to speak
      grid.querySelectorAll('.kana-cell[data-char]').forEach(cell => {
        cell.addEventListener('click', () => speak(cell.dataset.char));
      });
    }

    // Kana panel toggle
    const kanaToggle = document.getElementById('kanaToggle');
    const kanaPanel = document.getElementById('kanaPanel');

    kanaToggle.addEventListener('click', () => {
      kanaToggle.classList.toggle('open');
      kanaPanel.classList.toggle('open');
    });

    // Kana tab switching
    document.querySelectorAll('.kana-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.kana-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');

        const type = tab.dataset.kana;
        document.querySelectorAll('.kana-section').forEach(s => s.classList.remove('active'));
        document.getElementById(type + 'Section').classList.add('active');
      });
    });

    // Initialize
    renderPhrase();
    renderQuickPhrases();
    renderKanaGrid('hiragana');
    renderKanaGrid('katakana');
  </script>
</body>
</html>
