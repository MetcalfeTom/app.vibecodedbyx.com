<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Roikku - Japanese Phrases</title>
  <link rel="icon" href="https://emojicdn.elk.sh/ğŸ—¾">
  <meta property="og:title" content="Roikku - Japanese Phrases">
  <meta property="og:description" content="Learn everyday Japanese phrases naturally!">
  <meta property="og:url" content="https://sloppy.live/roikku">
  <meta property="og:image" content="https://emojicdn.elk.sh/ğŸ—¾?style=apple&size=512">
  <link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Zen Maru Gothic', 'Noto Sans JP', sans-serif;
      background: linear-gradient(180deg, #0a0a1a 0%, #1a0a20 50%, #0a1520 100%);
      color: #fff;
      min-height: 100vh;
    }

    .app-container {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }

    .header {
      text-align: center;
      margin-bottom: 25px;
    }

    .logo {
      font-size: 2.5rem;
      font-weight: 700;
      background: linear-gradient(90deg, #ff6b9d, #ffa07a, #ffcc00);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: drop-shadow(0 0 20px rgba(255, 107, 157, 0.5));
      margin-bottom: 5px;
    }

    .tagline {
      font-size: 0.9rem;
      color: #888;
    }

    /* Difficulty Tabs */
    .difficulty-tabs {
      display: flex;
      justify-content: center;
      gap: 0;
      margin-bottom: 20px;
      border-radius: 25px;
      overflow: hidden;
      border: 1px solid rgba(255, 255, 255, 0.2);
      background: rgba(0, 0, 0, 0.3);
    }

    .difficulty-tab {
      padding: 12px 24px;
      background: transparent;
      border: none;
      color: #888;
      font-family: inherit;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      flex: 1;
      text-align: center;
    }

    .difficulty-tab:hover {
      background: rgba(255, 255, 255, 0.05);
      color: #aaa;
    }

    .difficulty-tab.active {
      color: #000;
      font-weight: 600;
    }

    .difficulty-tab[data-difficulty="beginner"].active {
      background: linear-gradient(135deg, #00ff88, #00cc66);
      text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
    }

    .difficulty-tab[data-difficulty="intermediate"].active {
      background: linear-gradient(135deg, #ffcc00, #ff9900);
      text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
    }

    .difficulty-tab[data-difficulty="expert"].active {
      background: linear-gradient(135deg, #ff6666, #ff3333);
      text-shadow: 0 0 10px rgba(255, 102, 102, 0.5);
    }

    .difficulty-label {
      font-size: 0.65rem;
      display: block;
      margin-top: 2px;
      opacity: 0.7;
    }

    .categories {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 20px;
      justify-content: center;
    }

    .category-btn {
      padding: 10px 18px;
      background: rgba(255, 107, 157, 0.1);
      border: 1px solid rgba(255, 107, 157, 0.3);
      border-radius: 20px;
      color: #ff6b9d;
      font-family: inherit;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .category-btn:hover {
      background: rgba(255, 107, 157, 0.2);
    }

    .category-btn.active {
      background: #ff6b9d;
      color: #000;
      border-color: #ff6b9d;
    }

    .phrase-card {
      background: rgba(20, 20, 35, 0.8);
      border: 1px solid rgba(255, 107, 157, 0.2);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 0 40px rgba(255, 107, 157, 0.1);
    }

    .phrase-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .phrase-category {
      font-size: 0.75rem;
      color: #ffa07a;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .phrase-number {
      font-size: 0.8rem;
      color: #666;
    }

    .japanese {
      font-size: 2.2rem;
      font-weight: 700;
      color: #fff;
      margin-bottom: 10px;
      line-height: 1.4;
      text-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
    }

    .romaji {
      font-size: 1.1rem;
      color: #ff6b9d;
      margin-bottom: 15px;
      font-style: italic;
    }

    .english {
      font-size: 1.2rem;
      color: #aaa;
      margin-bottom: 20px;
      padding-bottom: 20px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .pronunciation-tip {
      background: rgba(255, 204, 0, 0.1);
      border-left: 3px solid #ffcc00;
      padding: 15px;
      border-radius: 0 10px 10px 0;
      margin-bottom: 20px;
    }

    .tip-label {
      font-size: 0.7rem;
      color: #ffcc00;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .tip-text {
      font-size: 0.9rem;
      color: #ccc;
      line-height: 1.5;
    }

    .context {
      background: rgba(0, 255, 200, 0.05);
      border-left: 3px solid #00ffc8;
      padding: 15px;
      border-radius: 0 10px 10px 0;
      margin-bottom: 20px;
    }

    .context-label {
      font-size: 0.7rem;
      color: #00ffc8;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    .context-text {
      font-size: 0.9rem;
      color: #aaa;
      line-height: 1.5;
    }

    .phrase-actions {
      display: flex;
      gap: 10px;
      justify-content: center;
    }

    .btn {
      padding: 12px 25px;
      border: none;
      border-radius: 25px;
      font-family: inherit;
      font-size: 0.9rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .btn-speak {
      background: linear-gradient(135deg, #ff6b9d, #ffa07a);
      color: #000;
    }

    .btn-speak:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(255, 107, 157, 0.4);
    }

    .btn-nav {
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .btn-nav:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .navigation {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
    }

    .nav-btn {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: rgba(255, 107, 157, 0.1);
      border: 1px solid rgba(255, 107, 157, 0.3);
      color: #ff6b9d;
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .nav-btn:hover {
      background: rgba(255, 107, 157, 0.2);
      transform: scale(1.1);
    }

    .progress-bar {
      height: 4px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 2px;
      overflow: hidden;
      margin-bottom: 20px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #ff6b9d, #ffcc00);
      border-radius: 2px;
      transition: width 0.3s ease;
    }

    .quick-phrases {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }

    .quick-phrase {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 15px;
      cursor: pointer;
      transition: all 0.2s;
      text-align: center;
    }

    .quick-phrase:hover {
      background: rgba(255, 107, 157, 0.1);
      border-color: rgba(255, 107, 157, 0.3);
    }

    .quick-jp {
      font-size: 1.3rem;
      margin-bottom: 5px;
    }

    .quick-en {
      font-size: 0.75rem;
      color: #888;
    }

    .section-title {
      font-size: 0.8rem;
      color: #666;
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 15px;
      text-align: center;
    }

    .back-link {
      position: fixed;
      bottom: 15px;
      right: 15px;
      color: #444;
      text-decoration: none;
      font-size: 0.75rem;
      z-index: 100;
    }

    .back-link:hover { color: #ff6b9d; }

    /* Search bar */
    .search-container {
      margin-bottom: 20px;
      position: relative;
    }

    .search-input {
      width: 100%;
      padding: 14px 20px 14px 45px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 107, 157, 0.3);
      border-radius: 25px;
      color: #fff;
      font-family: inherit;
      font-size: 1rem;
      transition: all 0.2s;
    }

    .search-input:focus {
      outline: none;
      border-color: #ff6b9d;
      background: rgba(255, 107, 157, 0.1);
    }

    .search-input::placeholder {
      color: #666;
    }

    .search-icon {
      position: absolute;
      left: 18px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1rem;
      color: #666;
    }

    .search-results {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: rgba(20, 20, 35, 0.98);
      border: 1px solid rgba(255, 107, 157, 0.3);
      border-radius: 15px;
      margin-top: 5px;
      max-height: 300px;
      overflow-y: auto;
      z-index: 200;
      display: none;
    }

    .search-results.show {
      display: block;
    }

    .search-result-item {
      padding: 12px 18px;
      cursor: pointer;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      transition: all 0.2s;
    }

    .search-result-item:hover {
      background: rgba(255, 107, 157, 0.1);
    }

    .search-result-item:last-child {
      border-bottom: none;
    }

    .search-result-jp {
      font-size: 1.1rem;
      margin-bottom: 3px;
    }

    .search-result-en {
      font-size: 0.8rem;
      color: #888;
    }

    .search-result-cat {
      font-size: 0.65rem;
      color: #ff6b9d;
      text-transform: uppercase;
    }

    /* Mode toggle */
    .mode-toggle {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    .mode-btn {
      padding: 10px 25px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 20px;
      color: #888;
      font-family: inherit;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .mode-btn:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .mode-btn.active {
      background: #ff6b9d;
      color: #000;
      border-color: #ff6b9d;
    }

    /* Quiz mode */
    .quiz-card {
      background: rgba(20, 20, 35, 0.8);
      border: 1px solid rgba(255, 204, 0, 0.3);
      border-radius: 20px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 0 40px rgba(255, 204, 0, 0.1);
      text-align: center;
    }

    .quiz-question {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .quiz-romaji {
      font-size: 1.1rem;
      color: #ff6b9d;
      font-style: italic;
      margin-bottom: 15px;
    }

    .quiz-prompt {
      font-size: 0.9rem;
      color: #888;
      margin-bottom: 25px;
    }

    .quiz-options {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .quiz-option {
      padding: 15px 20px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      color: #fff;
      font-family: inherit;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.2s;
      text-align: left;
    }

    .quiz-option:hover {
      background: rgba(255, 107, 157, 0.1);
      border-color: rgba(255, 107, 157, 0.3);
    }

    .quiz-option.correct {
      background: rgba(0, 255, 136, 0.2);
      border-color: #00ff88;
      color: #00ff88;
    }

    .quiz-option.wrong {
      background: rgba(255, 51, 102, 0.2);
      border-color: #ff3366;
      color: #ff3366;
    }

    .quiz-option.disabled {
      pointer-events: none;
      opacity: 0.6;
    }

    .quiz-stats {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin-bottom: 20px;
    }

    .quiz-stat {
      text-align: center;
    }

    .quiz-stat-value {
      font-size: 1.8rem;
      font-weight: 700;
    }

    .quiz-stat-value.correct-color {
      color: #00ff88;
      text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
    }

    .quiz-stat-value.wrong-color {
      color: #ff3366;
      text-shadow: 0 0 10px rgba(255, 51, 102, 0.5);
    }

    .quiz-stat-value.streak-color {
      color: #ffcc00;
      text-shadow: 0 0 10px rgba(255, 204, 0, 0.5);
    }

    .quiz-stat-label {
      font-size: 0.7rem;
      color: #666;
      text-transform: uppercase;
    }

    .quiz-feedback {
      padding: 15px;
      border-radius: 12px;
      margin-top: 20px;
      display: none;
    }

    .quiz-feedback.show {
      display: block;
    }

    .quiz-feedback.correct {
      background: rgba(0, 255, 136, 0.1);
      border: 1px solid rgba(0, 255, 136, 0.3);
      color: #00ff88;
    }

    .quiz-feedback.wrong {
      background: rgba(255, 51, 102, 0.1);
      border: 1px solid rgba(255, 51, 102, 0.3);
      color: #ff3366;
    }

    .next-question-btn {
      margin-top: 20px;
      padding: 12px 30px;
      background: linear-gradient(135deg, #ffcc00, #ffa07a);
      border: none;
      border-radius: 25px;
      color: #000;
      font-family: inherit;
      font-size: 0.9rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: none;
    }

    .next-question-btn.show {
      display: inline-block;
    }

    .next-question-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(255, 204, 0, 0.4);
    }

    /* Voice Controls (Pitch & Volume) */
    .voice-controls {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px;
    }

    .slider-control {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      font-size: 0.85rem;
      color: #888;
    }

    .slider-label {
      min-width: 70px;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .voice-slider {
      -webkit-appearance: none;
      appearance: none;
      width: 120px;
      height: 6px;
      border-radius: 3px;
      outline: none;
      cursor: pointer;
    }

    .voice-slider.pitch-slider {
      background: linear-gradient(90deg, #6b9dff, #ff6b9d);
    }

    .voice-slider.volume-slider {
      background: linear-gradient(90deg, #444, #00ffc8);
    }

    .voice-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      background: #fff;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      transition: transform 0.15s;
    }

    .voice-slider::-webkit-slider-thumb:hover {
      transform: scale(1.15);
    }

    .voice-slider::-moz-range-thumb {
      width: 18px;
      height: 18px;
      background: #fff;
      border-radius: 50%;
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
    }

    .slider-value {
      min-width: 35px;
      text-align: center;
      font-weight: 500;
    }

    .slider-value.pitch-value {
      color: #ff6b9d;
    }

    .slider-value.volume-value {
      color: #00ffc8;
    }

    .gender-toggle {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-top: 5px;
    }

    .gender-btn {
      padding: 8px 16px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      color: #888;
      font-family: inherit;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .gender-btn:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .gender-btn.active {
      background: linear-gradient(135deg, #ff6b9d, #ffa07a);
      color: #000;
      border-color: #ff6b9d;
    }

    /* Kana Reference Panel */
    .kana-toggle {
      position: fixed;
      top: 50%;
      right: 0;
      transform: translateY(-50%);
      background: linear-gradient(135deg, #ff6b9d, #ffa07a);
      color: #000;
      border: none;
      padding: 15px 8px;
      border-radius: 12px 0 0 12px;
      cursor: pointer;
      font-family: inherit;
      font-size: 0.8rem;
      font-weight: 600;
      writing-mode: vertical-rl;
      z-index: 300;
      transition: all 0.2s;
    }

    .kana-toggle:hover {
      padding-right: 12px;
      box-shadow: -5px 0 20px rgba(255, 107, 157, 0.4);
    }

    .kana-toggle.open {
      right: 320px;
    }

    .kana-panel {
      position: fixed;
      top: 0;
      right: -320px;
      width: 320px;
      height: 100vh;
      background: rgba(15, 15, 25, 0.98);
      border-left: 1px solid rgba(255, 107, 157, 0.3);
      overflow-y: auto;
      z-index: 290;
      transition: right 0.3s ease;
      padding: 20px;
    }

    .kana-panel.open {
      right: 0;
    }

    .kana-panel-header {
      text-align: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .kana-panel-title {
      font-size: 1.2rem;
      color: #ff6b9d;
      margin-bottom: 5px;
    }

    .kana-tabs {
      display: flex;
      gap: 8px;
      justify-content: center;
      margin-bottom: 15px;
    }

    .kana-tab {
      padding: 8px 20px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-radius: 15px;
      color: #888;
      font-family: inherit;
      font-size: 0.85rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .kana-tab:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .kana-tab.active {
      background: #ff6b9d;
      color: #000;
      border-color: #ff6b9d;
    }

    .kana-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 4px;
    }

    .kana-cell {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 8px;
      padding: 8px 4px;
      text-align: center;
      cursor: pointer;
      transition: all 0.2s;
    }

    .kana-cell:hover {
      background: rgba(255, 107, 157, 0.15);
      border-color: rgba(255, 107, 157, 0.4);
    }

    .kana-char {
      font-size: 1.3rem;
      margin-bottom: 2px;
    }

    .kana-romaji {
      font-size: 0.6rem;
      color: #666;
    }

    .kana-section {
      display: none;
    }

    .kana-section.active {
      display: block;
    }

    .kana-row-label {
      grid-column: 1 / -1;
      font-size: 0.7rem;
      color: #ffcc00;
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 10px 0 5px;
      text-align: left;
    }

    @media (max-width: 500px) {
      .logo { font-size: 2rem; }
      .japanese { font-size: 1.8rem; }
      .quick-phrases { grid-template-columns: 1fr; }
      .kana-panel { width: 280px; right: -280px; }
      .kana-toggle.open { right: 280px; }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="header">
      <h1 class="logo">ğŸ—¾ Roikku</h1>
      <p class="tagline">Learn Japanese phrases for everyday life</p>
    </div>

    <!-- Search Bar -->
    <div class="search-container">
      <span class="search-icon">ğŸ”</span>
      <input type="text" class="search-input" id="searchInput" placeholder="Search phrases...">
      <div class="search-results" id="searchResults"></div>
    </div>

    <!-- Mode Toggle -->
    <div class="mode-toggle">
      <button class="mode-btn active" data-mode="learn" id="learnModeBtn">ğŸ“š Learn</button>
      <button class="mode-btn" data-mode="quiz" id="quizModeBtn">ğŸ¯ Quiz</button>
    </div>

    <!-- Voice Controls -->
    <div class="voice-controls">
      <div class="slider-control">
        <span class="slider-label">ğŸµ Pitch:</span>
        <input type="range" class="voice-slider pitch-slider" id="pitchSlider" min="0.5" max="1.5" step="0.1" value="1.0">
        <span class="slider-value pitch-value" id="pitchValue">1.0</span>
      </div>
      <div class="slider-control">
        <span class="slider-label">ğŸ”Š Volume:</span>
        <input type="range" class="voice-slider volume-slider" id="volumeSlider" min="0" max="1" step="0.1" value="0.1">
        <span class="slider-value volume-value" id="volumeValue">0.1</span>
      </div>
      <div style="text-align: center; font-size: 0.65rem; color: #555; margin-top: 8px;">
        Voice features may vary by browser
      </div>
    </div>

    <!-- Difficulty Tabs -->
    <div class="difficulty-tabs">
      <button class="difficulty-tab active" data-difficulty="beginner">
        ğŸŒ± Beginner
        <span class="difficulty-label">Basic phrases</span>
      </button>
      <button class="difficulty-tab" data-difficulty="intermediate">
        ğŸŒ¿ Intermediate
        <span class="difficulty-label">Daily life</span>
      </button>
      <button class="difficulty-tab" data-difficulty="expert">
        ğŸŒ³ Expert
        <span class="difficulty-label">Advanced</span>
      </button>
    </div>

    <!-- Learn Mode Content -->
    <div id="learnMode">
      <div class="categories" id="categories">
      <!-- Categories loaded dynamically based on difficulty -->
    </div>

    <div class="progress-bar">
      <div class="progress-fill" id="progressFill" style="width: 0%"></div>
    </div>

    <div class="phrase-card" id="phraseCard">
      <!-- Phrase content loaded dynamically -->
    </div>

    <div class="navigation">
      <button class="nav-btn" id="prevBtn">â†</button>
      <button class="btn btn-speak" id="speakBtn">ğŸ”Š Listen</button>
      <button class="nav-btn" id="nextBtn">â†’</button>
    </div>

    <div class="section-title">Quick Phrases</div>
    <div class="quick-phrases" id="quickPhrases">
      <!-- Quick phrases loaded dynamically -->
    </div>
    </div><!-- End Learn Mode -->

    <!-- Quiz Mode Content -->
    <div id="quizMode" style="display: none;">
      <div class="quiz-stats">
        <div class="quiz-stat">
          <div class="quiz-stat-value correct-color" id="quizCorrect">0</div>
          <div class="quiz-stat-label">Correct</div>
        </div>
        <div class="quiz-stat">
          <div class="quiz-stat-value wrong-color" id="quizWrong">0</div>
          <div class="quiz-stat-label">Wrong</div>
        </div>
        <div class="quiz-stat">
          <div class="quiz-stat-value streak-color" id="quizStreak">0</div>
          <div class="quiz-stat-label">Streak</div>
        </div>
      </div>

      <div class="quiz-card" id="quizCard">
        <div class="quiz-question" id="quizQuestion">ã“ã‚“ã«ã¡ã¯</div>
        <div class="quiz-romaji" id="quizRomaji">Konnichiwa</div>
        <div class="quiz-prompt">What does this mean?</div>
        <div class="quiz-options" id="quizOptions">
          <!-- Options loaded dynamically -->
        </div>
        <div class="quiz-feedback" id="quizFeedback"></div>
        <button class="next-question-btn" id="nextQuestionBtn">Next Question â†’</button>
      </div>

      <button class="btn btn-speak" id="quizSpeakBtn" style="margin: 0 auto; display: flex;">ğŸ”Š Listen</button>
    </div>
  </div>

  <!-- Kana Reference Toggle -->
  <button class="kana-toggle" id="kanaToggle">ã‚ã‚¢ Kana</button>

  <!-- Kana Reference Panel -->
  <div class="kana-panel" id="kanaPanel">
    <div class="kana-panel-header">
      <div class="kana-panel-title">Japanese Characters</div>
    </div>

    <div class="kana-tabs">
      <button class="kana-tab active" data-kana="hiragana">ã²ã‚‰ãŒãª</button>
      <button class="kana-tab" data-kana="katakana">ã‚«ã‚¿ã‚«ãƒŠ</button>
    </div>

    <div class="kana-section active" id="hiraganaSection">
      <div class="kana-grid" id="hiraganaGrid"></div>
    </div>

    <div class="kana-section" id="katakanaSection">
      <div class="kana-grid" id="katakanaGrid"></div>
    </div>
  </div>

  <a href="https://sloppy.live" class="back-link">â† sloppy.live</a>

  <script>
    // Difficulty-based phrase organization
    const phrasesByDifficulty = {
      beginner: {
        greetings: [
        {
          japanese: 'ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™',
          romaji: 'Ohayou gozaimasu',
          english: 'Good morning (polite)',
          tip: 'Pronounce "ou" as a long "o" sound. The "u" at the end is almost silent.',
          context: 'Use this until about 10-11 AM. With close friends, you can shorten it to just "ãŠã¯ã‚ˆã†" (Ohayou).'
        },
        {
          japanese: 'ã“ã‚“ã«ã¡ã¯',
          romaji: 'Konnichiwa',
          english: 'Hello / Good afternoon',
          tip: 'The "n" before "ni" is held slightly longer. Say "kon-ni-chi-wa" with equal beats.',
          context: 'The most versatile greeting! Use from late morning until early evening.'
        },
        {
          japanese: 'ã“ã‚“ã°ã‚“ã¯',
          romaji: 'Konbanwa',
          english: 'Good evening',
          tip: 'Similar rhythm to ã“ã‚“ã«ã¡ã¯. The "n" before "ba" is a full beat.',
          context: 'Use after sunset. Great for evening social situations.'
        },
        {
          japanese: 'ãŠå…ƒæ°—ã§ã™ã‹ï¼Ÿ',
          romaji: 'O-genki desu ka?',
          english: 'How are you?',
          tip: 'The "ge" sounds like "geh". Rise your pitch slightly at the end for the question.',
          context: 'More formal than in English - often used when you haven\'t seen someone in a while.'
        },
        {
          japanese: 'ã¯ã˜ã‚ã¾ã—ã¦',
          romaji: 'Hajimemashite',
          english: 'Nice to meet you',
          tip: 'Break it down: Ha-ji-me-ma-shi-te. The "shi" is soft, not "shee".',
          context: 'Used when meeting someone for the first time. Often followed by your name.'
        },
        {
          japanese: 'ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™',
          romaji: 'Yoroshiku onegaishimasu',
          english: 'Please take care of me / Nice to meet you',
          tip: 'This phrase has many uses! "Yo-ro-shi-ku o-ne-gai-shi-ma-su" - keep it flowing.',
          context: 'Essential phrase! Use after introductions, when asking favors, or starting work together.'
        },
        {
          japanese: 'ã•ã‚ˆã†ãªã‚‰',
          romaji: 'Sayounara',
          english: 'Goodbye',
          tip: 'The "you" is a long "o" sound. "Sa-yÅ-na-ra" with the Å held longer.',
          context: 'Formal goodbye. For casual farewells, use ã˜ã‚ƒã‚ã­ (Jaa ne) or ã¾ãŸã­ (Mata ne).'
        },
        {
          japanese: 'ãŠã‚„ã™ã¿ãªã•ã„',
          romaji: 'Oyasuminasai',
          english: 'Good night',
          tip: 'O-ya-su-mi-na-sai - the "su" is very soft, almost whispered.',
          context: 'Use when parting for the night or going to bed. Casual: ãŠã‚„ã™ã¿ (Oyasumi).'
        }
      ],
      shopping: [
        {
          japanese: 'ã„ãã‚‰ã§ã™ã‹ï¼Ÿ',
          romaji: 'Ikura desu ka?',
          english: 'How much is it?',
          tip: 'I-ku-ra de-su ka? The "ra" is a light flap, between "r" and "l".',
          context: 'Essential for any shopping! Point at the item when asking.'
        },
        {
          japanese: 'ã“ã‚Œã‚’ãã ã•ã„',
          romaji: 'Kore o kudasai',
          english: 'I\'ll take this, please',
          tip: 'Ko-re o ku-da-sai. "Kudasai" is the polite "please give me".',
          context: 'Point at what you want. Great for restaurants and shops.'
        },
        {
          japanese: 'ã‚«ãƒ¼ãƒ‰ã§æ‰•ãˆã¾ã™ã‹ï¼Ÿ',
          romaji: 'Kaado de haraemasu ka?',
          english: 'Can I pay by card?',
          tip: '"Kaado" is the borrowed English word "card". Ha-ra-e-ma-su.',
          context: 'Japan is still quite cash-based, so always good to ask first!'
        },
        {
          japanese: 'è©¦ç€ã—ã¦ã‚‚ã„ã„ã§ã™ã‹ï¼Ÿ',
          romaji: 'Shichaku shite mo ii desu ka?',
          english: 'May I try this on?',
          tip: 'Shi-cha-ku shi-te mo ii de-su ka? "Shichaku" = trying on clothes.',
          context: 'Useful in clothing stores. Staff will show you to the fitting room.'
        },
        {
          japanese: 'è¢‹ã‚’ãŠé¡˜ã„ã—ã¾ã™',
          romaji: 'Fukuro o onegaishimasu',
          english: 'A bag, please',
          tip: 'Fu-ku-ro. Note: many stores now charge for bags!',
          context: 'Since 2020, plastic bags cost extra in Japan. Bring your own or ask politely.'
        },
        {
          japanese: 'ãƒ¬ã‚·ãƒ¼ãƒˆã‚’ãã ã•ã„',
          romaji: 'Reshiito o kudasai',
          english: 'Receipt, please',
          tip: '"Reshiito" comes from English "receipt". Re-shii-to.',
          context: 'Useful for business expenses or returns. Keep your receipts!'
        }
      ],
      restaurant: [
        {
          japanese: 'ã„ãŸã ãã¾ã™',
          romaji: 'Itadakimasu',
          english: 'Thanks for the food (before eating)',
          tip: 'I-ta-da-ki-ma-su. Said with gratitude before every meal!',
          context: 'Essential! Said before eating. Shows appreciation for the food and those who prepared it.'
        },
        {
          japanese: 'ã”ã¡ãã†ã•ã¾ã§ã—ãŸ',
          romaji: 'Gochisousama deshita',
          english: 'Thanks for the meal (after eating)',
          tip: 'Go-chi-sou-sa-ma de-shi-ta. Longer phrase, but very important!',
          context: 'Said after finishing a meal. Very polite to say to restaurant staff when leaving.'
        },
        {
          japanese: 'ã™ã¿ã¾ã›ã‚“',
          romaji: 'Sumimasen',
          english: 'Excuse me',
          tip: 'Su-mi-ma-sen. Versatile! Also means "sorry" and "thank you".',
          context: 'Use to call a waiter, apologize for small things, or express gratitude.'
        },
        {
          japanese: 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ãã ã•ã„',
          romaji: 'Menyuu o kudasai',
          english: 'Menu, please',
          tip: '"Menyuu" is from English "menu". Me-nyuu o ku-da-sai.',
          context: 'Use when seated. Many restaurants also have picture menus!'
        },
        {
          japanese: 'ãŠã™ã™ã‚ã¯ä½•ã§ã™ã‹ï¼Ÿ',
          romaji: 'Osusume wa nan desu ka?',
          english: 'What do you recommend?',
          tip: 'O-su-su-me wa nan de-su ka? "Osusume" = recommendation.',
          context: 'Great way to discover local favorites! Staff love sharing their recommendations.'
        },
        {
          japanese: 'ãŠä¼šè¨ˆãŠé¡˜ã„ã—ã¾ã™',
          romaji: 'O-kaikei onegaishimasu',
          english: 'Check, please',
          tip: 'O-kai-kei o-ne-gai-shi-ma-su. Or just gesture writing on your palm!',
          context: 'In Japan, you often pay at the register near the exit, not at your table.'
        },
        {
          japanese: 'ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãŒã‚ã‚Šã¾ã™',
          romaji: 'Arerugii ga arimasu',
          english: 'I have an allergy',
          tip: '"Arerugii" is from English "allergy". A-re-ru-gii.',
          context: 'Important for food safety! Follow with the specific allergy.'
        },
        {
          japanese: 'ç¾å‘³ã—ã„ï¼',
          romaji: 'Oishii!',
          english: 'Delicious!',
          tip: 'O-i-shii! Let your enjoyment show in your voice!',
          context: 'Chefs love hearing this! A simple way to show appreciation.'
        }
      ],
      directions: [
        {
          japanese: 'ã™ã¿ã¾ã›ã‚“ã€é“ã«è¿·ã„ã¾ã—ãŸ',
          romaji: 'Sumimasen, michi ni mayoimashita',
          english: 'Excuse me, I\'m lost',
          tip: 'Mi-chi ni ma-yo-i-ma-shi-ta. "Michi" = road/way, "mayou" = to be lost.',
          context: 'Japanese people are very helpful! Don\'t be shy to ask.'
        },
        {
          japanese: 'é§…ã¯ã©ã“ã§ã™ã‹ï¼Ÿ',
          romaji: 'Eki wa doko desu ka?',
          english: 'Where is the station?',
          tip: 'E-ki wa do-ko de-su ka? "Eki" = train station.',
          context: 'Train stations are central landmarks. Replace é§… with other places as needed.'
        },
        {
          japanese: 'ã¾ã£ã™ãè¡Œã£ã¦ãã ã•ã„',
          romaji: 'Massugu itte kudasai',
          english: 'Please go straight',
          tip: 'Mas-su-gu it-te ku-da-sai. Double consonants are held slightly longer.',
          context: 'You might hear this in directions. "Massugu" = straight ahead.'
        },
        {
          japanese: 'å³ã«æ›²ãŒã£ã¦ãã ã•ã„',
          romaji: 'Migi ni magatte kudasai',
          english: 'Please turn right',
          tip: 'Mi-gi ni ma-gat-te. "Migi" = right, "Hidari" = left.',
          context: 'Essential direction vocabulary! Combine with other phrases.'
        },
        {
          japanese: 'å·¦ã«æ›²ãŒã£ã¦ãã ã•ã„',
          romaji: 'Hidari ni magatte kudasai',
          english: 'Please turn left',
          tip: 'Hi-da-ri ni ma-gat-te. Remember: Hidari = left, Migi = right.',
          context: 'Practice both right and left until they become automatic!'
        },
        {
          japanese: 'ã“ã“ã‹ã‚‰è¿‘ã„ã§ã™ã‹ï¼Ÿ',
          romaji: 'Koko kara chikai desu ka?',
          english: 'Is it close from here?',
          tip: 'Ko-ko ka-ra chi-kai de-su ka? "Chikai" = close/near.',
          context: 'Good follow-up question after getting directions.'
        },
        {
          japanese: 'æ­©ã„ã¦ä½•åˆ†ã§ã™ã‹ï¼Ÿ',
          romaji: 'Aruite nanpun desu ka?',
          english: 'How many minutes by walking?',
          tip: 'A-ru-i-te nan-pun de-su ka? "Aruite" = by walking.',
          context: 'Japanese often give time estimates rather than distance.'
        }
      ],
      social: [
        {
          japanese: 'ãŠåå‰ã¯ä½•ã§ã™ã‹ï¼Ÿ',
          romaji: 'O-namae wa nan desu ka?',
          english: 'What is your name?',
          tip: 'O-na-ma-e wa nan de-su ka? The "O" is honorific.',
          context: 'Polite way to ask someone\'s name. Introduce yourself first!'
        },
        {
          japanese: 'ç§ã¯ã€‡ã€‡ã§ã™',
          romaji: 'Watashi wa __ desu',
          english: 'I am __',
          tip: 'Wa-ta-shi wa [name] de-su. Simple self-introduction!',
          context: 'Fill in your name. Often followed by ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™.'
        },
        {
          japanese: 'æ—¥æœ¬èªãŒå°‘ã—è©±ã›ã¾ã™',
          romaji: 'Nihongo ga sukoshi hanasemasu',
          english: 'I can speak a little Japanese',
          tip: 'Ni-hon-go ga su-ko-shi ha-na-se-ma-su. Be humble!',
          context: 'Japanese appreciate any effort to speak their language!'
        },
        {
          japanese: 'ã‚‚ã†ä¸€åº¦ãŠé¡˜ã„ã—ã¾ã™',
          romaji: 'Mou ichido onegaishimasu',
          english: 'Once more, please',
          tip: 'Mou i-chi-do o-ne-gai-shi-ma-su. Very useful for learning!',
          context: 'Use when you didn\'t catch what someone said. People will happily repeat.'
        },
        {
          japanese: 'ã‚†ã£ãã‚Šè©±ã—ã¦ãã ã•ã„',
          romaji: 'Yukkuri hanashite kudasai',
          english: 'Please speak slowly',
          tip: 'Yuk-ku-ri ha-na-shi-te ku-da-sai. "Yukkuri" = slowly.',
          context: 'Don\'t be shy to ask! People will adjust their speed.'
        },
        {
          japanese: 'è¶£å‘³ã¯ä½•ã§ã™ã‹ï¼Ÿ',
          romaji: 'Shumi wa nan desu ka?',
          english: 'What are your hobbies?',
          tip: 'Shu-mi wa nan de-su ka? Great conversation starter!',
          context: 'Japanese love discussing hobbies. Share yours too!'
        },
        {
          japanese: 'ãŠä»•äº‹ã¯ä½•ã§ã™ã‹ï¼Ÿ',
          romaji: 'O-shigoto wa nan desu ka?',
          english: 'What is your job?',
          tip: 'O-shi-go-to wa nan de-su ka? "Shigoto" = work/job.',
          context: 'Common question when getting to know someone.'
        },
        {
          japanese: 'æ¥½ã—ã‹ã£ãŸã§ã™',
          romaji: 'Tanoshikatta desu',
          english: 'It was fun',
          tip: 'Ta-no-shi-kat-ta de-su. Past tense of "tanoshii" (fun).',
          context: 'Great way to end a gathering or activity. Shows gratitude!'
        }
      ],
      basics: [
        {
          japanese: 'ã¯ã„',
          romaji: 'Hai',
          english: 'Yes',
          tip: 'Ha-i. Simple and essential!',
          context: 'The most basic affirmative. Also used to show you\'re listening.'
        },
        {
          japanese: 'ã„ã„ãˆ',
          romaji: 'Iie',
          english: 'No',
          tip: 'I-i-e. Three syllables, soft tone.',
          context: 'Polite negative. For casual situations, use "ã†ã†ã‚“" (uun).'
        },
        {
          japanese: 'ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™',
          romaji: 'Arigatou gozaimasu',
          english: 'Thank you (polite)',
          tip: 'A-ri-ga-tou go-zai-ma-su. The "u" at the end is soft.',
          context: 'Formal thanks. For casual: just "ã‚ã‚ŠãŒã¨ã†" (Arigatou).'
        },
        {
          japanese: 'ã™ã¿ã¾ã›ã‚“',
          romaji: 'Sumimasen',
          english: 'Excuse me / Sorry',
          tip: 'Su-mi-ma-sen. Very versatile phrase!',
          context: 'Use to get attention, apologize, or even thank someone.'
        },
        {
          japanese: 'ãŠé¡˜ã„ã—ã¾ã™',
          romaji: 'Onegaishimasu',
          english: 'Please',
          tip: 'O-ne-gai-shi-ma-su. Essential polite request.',
          context: 'Add after any request to make it polite.'
        },
        {
          japanese: 'ã‚ã‹ã‚Šã¾ã—ãŸ',
          romaji: 'Wakarimashita',
          english: 'I understand',
          tip: 'Wa-ka-ri-ma-shi-ta. Past tense shows certainty.',
          context: 'Shows you understood. Present: ã‚ã‹ã‚Šã¾ã™ (I understand).'
        }
      ]
      },
      intermediate: {
        shopping: [
        {
          japanese: 'ã„ãã‚‰ã§ã™ã‹ï¼Ÿ',
          romaji: 'Ikura desu ka?',
          english: 'How much is it?',
          tip: 'I-ku-ra de-su ka? The "ra" is a light flap, between "r" and "l".',
          context: 'Essential for any shopping! Point at the item when asking.'
        },
        {
          japanese: 'ã“ã‚Œã‚’ãã ã•ã„',
          romaji: 'Kore o kudasai',
          english: 'I\'ll take this, please',
          tip: 'Ko-re o ku-da-sai. "Kudasai" is the polite "please give me".',
          context: 'Point at what you want. Great for restaurants and shops.'
        },
        {
          japanese: 'ã‚«ãƒ¼ãƒ‰ã§æ‰•ãˆã¾ã™ã‹ï¼Ÿ',
          romaji: 'Kaado de haraemasu ka?',
          english: 'Can I pay by card?',
          tip: '"Kaado" is the borrowed English word "card". Ha-ra-e-ma-su.',
          context: 'Japan is still quite cash-based, so always good to ask first!'
        },
        {
          japanese: 'è©¦ç€ã—ã¦ã‚‚ã„ã„ã§ã™ã‹ï¼Ÿ',
          romaji: 'Shichaku shite mo ii desu ka?',
          english: 'May I try this on?',
          tip: 'Shi-cha-ku shi-te mo ii de-su ka? "Shichaku" = trying on clothes.',
          context: 'Useful in clothing stores. Staff will show you to the fitting room.'
        },
        {
          japanese: 'è¢‹ã‚’ãŠé¡˜ã„ã—ã¾ã™',
          romaji: 'Fukuro o onegaishimasu',
          english: 'A bag, please',
          tip: 'Fu-ku-ro. Note: many stores now charge for bags!',
          context: 'Since 2020, plastic bags cost extra in Japan. Bring your own or ask politely.'
        },
        {
          japanese: 'ãƒ¬ã‚·ãƒ¼ãƒˆã‚’ãã ã•ã„',
          romaji: 'Reshiito o kudasai',
          english: 'Receipt, please',
          tip: '"Reshiito" comes from English "receipt". Re-shii-to.',
          context: 'Useful for business expenses or returns. Keep your receipts!'
        }
      ],
      restaurant: [
        {
          japanese: 'ã„ãŸã ãã¾ã™',
          romaji: 'Itadakimasu',
          english: 'Thanks for the food (before eating)',
          tip: 'I-ta-da-ki-ma-su. Said with gratitude before every meal!',
          context: 'Essential! Said before eating. Shows appreciation for the food and those who prepared it.'
        },
        {
          japanese: 'ã”ã¡ãã†ã•ã¾ã§ã—ãŸ',
          romaji: 'Gochisousama deshita',
          english: 'Thanks for the meal (after eating)',
          tip: 'Go-chi-sou-sa-ma de-shi-ta. Longer phrase, but very important!',
          context: 'Said after finishing a meal. Very polite to say to restaurant staff when leaving.'
        },
        {
          japanese: 'ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ãã ã•ã„',
          romaji: 'Menyuu o kudasai',
          english: 'Menu, please',
          tip: '"Menyuu" is from English "menu". Me-nyuu o ku-da-sai.',
          context: 'Use when seated. Many restaurants also have picture menus!'
        },
        {
          japanese: 'ãŠã™ã™ã‚ã¯ä½•ã§ã™ã‹ï¼Ÿ',
          romaji: 'Osusume wa nan desu ka?',
          english: 'What do you recommend?',
          tip: 'O-su-su-me wa nan de-su ka? "Osusume" = recommendation.',
          context: 'Great way to discover local favorites! Staff love sharing their recommendations.'
        },
        {
          japanese: 'ãŠä¼šè¨ˆãŠé¡˜ã„ã—ã¾ã™',
          romaji: 'O-kaikei onegaishimasu',
          english: 'Check, please',
          tip: 'O-kai-kei o-ne-gai-shi-ma-su. Or just gesture writing on your palm!',
          context: 'In Japan, you often pay at the register near the exit, not at your table.'
        },
        {
          japanese: 'ã‚¢ãƒ¬ãƒ«ã‚®ãƒ¼ãŒã‚ã‚Šã¾ã™',
          romaji: 'Arerugii ga arimasu',
          english: 'I have an allergy',
          tip: '"Arerugii" is from English "allergy". A-re-ru-gii.',
          context: 'Important for food safety! Follow with the specific allergy.'
        },
        {
          japanese: 'ç¾å‘³ã—ã„ï¼',
          romaji: 'Oishii!',
          english: 'Delicious!',
          tip: 'O-i-shii! Let your enjoyment show in your voice!',
          context: 'Chefs love hearing this! A simple way to show appreciation.'
        }
      ],
      directions: [
        {
          japanese: 'ã™ã¿ã¾ã›ã‚“ã€é“ã«è¿·ã„ã¾ã—ãŸ',
          romaji: 'Sumimasen, michi ni mayoimashita',
          english: 'Excuse me, I\'m lost',
          tip: 'Mi-chi ni ma-yo-i-ma-shi-ta. "Michi" = road/way, "mayou" = to be lost.',
          context: 'Japanese people are very helpful! Don\'t be shy to ask.'
        },
        {
          japanese: 'é§…ã¯ã©ã“ã§ã™ã‹ï¼Ÿ',
          romaji: 'Eki wa doko desu ka?',
          english: 'Where is the station?',
          tip: 'E-ki wa do-ko de-su ka? "Eki" = train station.',
          context: 'Train stations are central landmarks. Replace é§… with other places as needed.'
        },
        {
          japanese: 'ã¾ã£ã™ãè¡Œã£ã¦ãã ã•ã„',
          romaji: 'Massugu itte kudasai',
          english: 'Please go straight',
          tip: 'Mas-su-gu it-te ku-da-sai. Double consonants are held slightly longer.',
          context: 'You might hear this in directions. "Massugu" = straight ahead.'
        },
        {
          japanese: 'å³ã«æ›²ãŒã£ã¦ãã ã•ã„',
          romaji: 'Migi ni magatte kudasai',
          english: 'Please turn right',
          tip: 'Mi-gi ni ma-gat-te. "Migi" = right, "Hidari" = left.',
          context: 'Essential direction vocabulary! Combine with other phrases.'
        },
        {
          japanese: 'å·¦ã«æ›²ãŒã£ã¦ãã ã•ã„',
          romaji: 'Hidari ni magatte kudasai',
          english: 'Please turn left',
          tip: 'Hi-da-ri ni ma-gat-te. Remember: Hidari = left, Migi = right.',
          context: 'Practice both right and left until they become automatic!'
        },
        {
          japanese: 'ã“ã“ã‹ã‚‰è¿‘ã„ã§ã™ã‹ï¼Ÿ',
          romaji: 'Koko kara chikai desu ka?',
          english: 'Is it close from here?',
          tip: 'Ko-ko ka-ra chi-kai de-su ka? "Chikai" = close/near.',
          context: 'Good follow-up question after getting directions.'
        },
        {
          japanese: 'æ­©ã„ã¦ä½•åˆ†ã§ã™ã‹ï¼Ÿ',
          romaji: 'Aruite nanpun desu ka?',
          english: 'How many minutes by walking?',
          tip: 'A-ru-i-te nan-pun de-su ka? "Aruite" = by walking.',
          context: 'Japanese often give time estimates rather than distance.'
        }
      ]
      },
      expert: {
        social: [
        {
          japanese: 'ãŠåå‰ã¯ä½•ã§ã™ã‹ï¼Ÿ',
          romaji: 'O-namae wa nan desu ka?',
          english: 'What is your name?',
          tip: 'O-na-ma-e wa nan de-su ka? The "O" is honorific.',
          context: 'Polite way to ask someone\'s name. Introduce yourself first!'
        },
        {
          japanese: 'ç§ã¯ã€‡ã€‡ã§ã™',
          romaji: 'Watashi wa __ desu',
          english: 'I am __',
          tip: 'Wa-ta-shi wa [name] de-su. Simple self-introduction!',
          context: 'Fill in your name. Often followed by ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™.'
        },
        {
          japanese: 'æ—¥æœ¬èªãŒå°‘ã—è©±ã›ã¾ã™',
          romaji: 'Nihongo ga sukoshi hanasemasu',
          english: 'I can speak a little Japanese',
          tip: 'Ni-hon-go ga su-ko-shi ha-na-se-ma-su. Be humble!',
          context: 'Japanese appreciate any effort to speak their language!'
        },
        {
          japanese: 'ã‚‚ã†ä¸€åº¦ãŠé¡˜ã„ã—ã¾ã™',
          romaji: 'Mou ichido onegaishimasu',
          english: 'Once more, please',
          tip: 'Mou i-chi-do o-ne-gai-shi-ma-su. Very useful for learning!',
          context: 'Use when you didn\'t catch what someone said. People will happily repeat.'
        },
        {
          japanese: 'ã‚†ã£ãã‚Šè©±ã—ã¦ãã ã•ã„',
          romaji: 'Yukkuri hanashite kudasai',
          english: 'Please speak slowly',
          tip: 'Yuk-ku-ri ha-na-shi-te ku-da-sai. "Yukkuri" = slowly.',
          context: 'Don\'t be shy to ask! People will adjust their speed.'
        },
        {
          japanese: 'è¶£å‘³ã¯ä½•ã§ã™ã‹ï¼Ÿ',
          romaji: 'Shumi wa nan desu ka?',
          english: 'What are your hobbies?',
          tip: 'Shu-mi wa nan de-su ka? Great conversation starter!',
          context: 'Japanese love discussing hobbies. Share yours too!'
        },
        {
          japanese: 'ãŠä»•äº‹ã¯ä½•ã§ã™ã‹ï¼Ÿ',
          romaji: 'O-shigoto wa nan desu ka?',
          english: 'What is your job?',
          tip: 'O-shi-go-to wa nan de-su ka? "Shigoto" = work/job.',
          context: 'Common question when getting to know someone.'
        },
        {
          japanese: 'æ¥½ã—ã‹ã£ãŸã§ã™',
          romaji: 'Tanoshikatta desu',
          english: 'It was fun',
          tip: 'Ta-no-shi-kat-ta de-su. Past tense of "tanoshii" (fun).',
          context: 'Great way to end a gathering or activity. Shows gratitude!'
        }
      ],
      emergency: [
        {
          japanese: 'åŠ©ã‘ã¦ãã ã•ã„ï¼',
          romaji: 'Tasukete kudasai!',
          english: 'Help me, please!',
          tip: 'Ta-su-ke-te ku-da-sai! Say it loudly and clearly.',
          context: 'Emergency phrase. Japan is very safe, but good to know.'
        },
        {
          japanese: 'è­¦å¯Ÿã‚’å‘¼ã‚“ã§ãã ã•ã„',
          romaji: 'Keisatsu o yonde kudasai',
          english: 'Please call the police',
          tip: 'Kei-sa-tsu o yon-de ku-da-sai. Emergency number: 110.',
          context: 'Police in Japan are helpful and approachable.'
        },
        {
          japanese: 'æ•‘æ€¥è»Šã‚’å‘¼ã‚“ã§ãã ã•ã„',
          romaji: 'Kyuukyuusha o yonde kudasai',
          english: 'Please call an ambulance',
          tip: 'Kyuu-kyuu-sha. Emergency number: 119 (fire/ambulance).',
          context: 'For medical emergencies. Ambulances are free in Japan.'
        },
        {
          japanese: 'ç—…é™¢ã¯ã©ã“ã§ã™ã‹ï¼Ÿ',
          romaji: 'Byouin wa doko desu ka?',
          english: 'Where is the hospital?',
          tip: 'Byou-in wa do-ko de-su ka? "Byouin" = hospital.',
          context: 'Many hospitals have English-speaking staff in major cities.'
        },
        {
          japanese: 'æ°—åˆ†ãŒæ‚ªã„ã§ã™',
          romaji: 'Kibun ga warui desu',
          english: 'I don\'t feel well',
          tip: 'Ki-bun ga wa-ru-i de-su. "Kibun" = feeling.',
          context: 'Use to explain you\'re unwell. People will want to help.'
        },
        {
          japanese: 'è–¬å±€ã¯ã©ã“ã§ã™ã‹ï¼Ÿ',
          romaji: 'Yakkyoku wa doko desu ka?',
          english: 'Where is a pharmacy?',
          tip: 'Yak-kyo-ku wa do-ko de-su ka? Look for ãƒ‰ãƒ©ãƒƒã‚°ã‚¹ãƒˆã‚¢ too.',
          context: 'Pharmacies are common. Drugstores often have basic medicine.'
        }
      ],
      business: [
        {
          japanese: 'ãŠä¸–è©±ã«ãªã£ã¦ãŠã‚Šã¾ã™',
          romaji: 'Osewa ni natte orimasu',
          english: 'Thank you for your ongoing support',
          tip: 'O-se-wa ni nat-te o-ri-ma-su. Very formal business greeting.',
          context: 'Used in business emails and meetings. Shows appreciation for the relationship.'
        },
        {
          japanese: 'å¤±ç¤¼ã„ãŸã—ã¾ã™',
          romaji: 'Shitsurei itashimasu',
          english: 'Excuse me (formal)',
          tip: 'Shi-tsu-rei i-ta-shi-ma-su. Ultra-polite form.',
          context: 'When entering/leaving rooms, interrupting, or ending calls.'
        },
        {
          japanese: 'ã”ç¢ºèªãã ã•ã„',
          romaji: 'Go-kakunin kudasai',
          english: 'Please confirm/check',
          tip: 'Go-ka-ku-nin ku-da-sai. "Go" adds formality.',
          context: 'Common in business emails when asking someone to review something.'
        },
        {
          japanese: 'ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“',
          romaji: 'Moushiwake gozaimasen',
          english: 'I\'m very sorry (formal)',
          tip: 'Mou-shi-wa-ke go-zai-ma-sen. Very formal apology.',
          context: 'Used in business settings for sincere apologies.'
        },
        {
          japanese: 'ãŠæ‰‹æ•°ãŠã‹ã‘ã—ã¾ã™',
          romaji: 'O-tesuu okake shimasu',
          english: 'Sorry for the trouble',
          tip: 'O-te-suu o-ka-ke shi-ma-su. Acknowledge the effort.',
          context: 'When asking someone to do something that takes effort.'
        },
        {
          japanese: 'ã”æ¤œè¨ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™',
          romaji: 'Go-kentou yoroshiku onegaishimasu',
          english: 'Please consider this carefully',
          tip: 'Go-ken-tou yo-ro-shi-ku o-ne-gai-shi-ma-su.',
          context: 'Business closing phrase when proposing something.'
        }
      ]
    }
    };

    // Current difficulty level
    let currentDifficulty = 'beginner';

    // Get phrases for current difficulty
    function getCurrentPhrases() {
      return phrasesByDifficulty[currentDifficulty];
    }

    let currentCategory = 'greetings';
    let currentIndex = 0;
    let currentMode = 'learn';
    let voicePitch = 1.0; // default pitch (natural)
    let voiceVolume = 0.1; // default volume (comfortable starting level)
    let voiceGender = 'female'; // default voice gender

    // Quiz state
    let quizCorrect = 0;
    let quizWrong = 0;
    let quizStreak = 0;
    let currentQuizPhrase = null;

    const phraseCard = document.getElementById('phraseCard');
    const quickPhrasesEl = document.getElementById('quickPhrases');
    const progressFill = document.getElementById('progressFill');
    const searchInput = document.getElementById('searchInput');
    const searchResults = document.getElementById('searchResults');
    const learnMode = document.getElementById('learnMode');
    const quizMode = document.getElementById('quizMode');
    const categoriesEl = document.getElementById('categories');

    // Category display names
    const categoryNames = {
      greetings: 'ğŸ‘‹ Greetings',
      basics: 'ğŸ“ Basics',
      shopping: 'ğŸ›ï¸ Shopping',
      restaurant: 'ğŸœ Restaurant',
      directions: 'ğŸ—ºï¸ Directions',
      social: 'ğŸ’¬ Social',
      emergency: 'ğŸš¨ Emergency',
      business: 'ğŸ’¼ Business'
    };

    // Render categories for current difficulty
    function renderCategories() {
      const phrases = getCurrentPhrases();
      const cats = Object.keys(phrases);

      // Reset to first category of new difficulty
      if (!phrases[currentCategory]) {
        currentCategory = cats[0];
        currentIndex = 0;
      }

      categoriesEl.innerHTML = cats.map(cat => `
        <button class="category-btn ${cat === currentCategory ? 'active' : ''}" data-category="${cat}">
          ${categoryNames[cat] || cat}
        </button>
      `).join('');

      // Add click handlers
      categoriesEl.querySelectorAll('.category-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          categoriesEl.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          currentCategory = btn.dataset.category;
          currentIndex = 0;
          renderPhrase();
        });
      });
    }

    // Difficulty tab handlers
    document.querySelectorAll('.difficulty-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.difficulty-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        currentDifficulty = tab.dataset.difficulty;
        currentIndex = 0;
        renderCategories();
        renderPhrase();
      });
    });

    function renderPhrase() {
      const phrases = getCurrentPhrases();
      const categoryPhrases = phrases[currentCategory];
      const phrase = categoryPhrases[currentIndex];

      const progress = ((currentIndex + 1) / categoryPhrases.length) * 100;
      progressFill.style.width = progress + '%';

      phraseCard.innerHTML = `
        <div class="phrase-header">
          <span class="phrase-category">${currentCategory}</span>
          <span class="phrase-number">${currentIndex + 1} / ${categoryPhrases.length}</span>
        </div>
        <div class="japanese">${phrase.japanese}</div>
        <div class="romaji">${phrase.romaji}</div>
        <div class="english">${phrase.english}</div>
        <div class="pronunciation-tip">
          <div class="tip-label">ğŸ’¡ Pronunciation Tip</div>
          <div class="tip-text">${phrase.tip}</div>
        </div>
        <div class="context">
          <div class="context-label">ğŸ“ When to Use</div>
          <div class="context-text">${phrase.context}</div>
        </div>
      `;
    }

    function renderQuickPhrases() {
      const essentials = [
        { jp: 'ã‚ã‚ŠãŒã¨ã†', romaji: 'Arigatou', en: 'Thank you' },
        { jp: 'ã™ã¿ã¾ã›ã‚“', romaji: 'Sumimasen', en: 'Excuse me' },
        { jp: 'ã¯ã„', romaji: 'Hai', en: 'Yes' },
        { jp: 'ã„ã„ãˆ', romaji: 'Iie', en: 'No' },
        { jp: 'ã‚ã‹ã‚Šã¾ã—ãŸ', romaji: 'Wakarimashita', en: 'I understand' },
        { jp: 'ãŠé¡˜ã„ã—ã¾ã™', romaji: 'Onegaishimasu', en: 'Please' }
      ];

      quickPhrasesEl.innerHTML = essentials.map(p => `
        <div class="quick-phrase" data-text="${p.jp}" data-romaji="${p.romaji}">
          <div class="quick-jp">${p.jp}</div>
          <div class="quick-en">${p.en}</div>
        </div>
      `).join('');

      quickPhrasesEl.querySelectorAll('.quick-phrase').forEach(el => {
        el.addEventListener('click', () => {
          speak(el.dataset.text, el.dataset.romaji);
        });
      });
    }

    // Cache Japanese voices by gender
    let japaneseVoices = { female: [], male: [], all: [] };

    function loadVoices() {
      const voices = speechSynthesis.getVoices();
      const jaVoices = voices.filter(v => v.lang.startsWith('ja'));
      japaneseVoices.all = jaVoices;

      // Try to categorize by name patterns (common patterns for female/male voices)
      japaneseVoices.female = jaVoices.filter(v => {
        const name = v.name.toLowerCase();
        return name.includes('female') || name.includes('woman') ||
               name.includes('kyoko') || name.includes('o-ren') ||
               name.includes('haruka') || name.includes('sayaka') ||
               name.includes('mizuki') || name.includes('nanami');
      });

      japaneseVoices.male = jaVoices.filter(v => {
        const name = v.name.toLowerCase();
        return name.includes('male') || name.includes('man') ||
               name.includes('otoya') || name.includes('ichiro') ||
               name.includes('takumi') || name.includes('kenji');
      });

      // If categorization didn't work well, use all voices as fallback
      if (japaneseVoices.female.length === 0 && japaneseVoices.male.length === 0) {
        // Default: first half female, second half male (rough heuristic)
        const mid = Math.ceil(jaVoices.length / 2);
        japaneseVoices.female = jaVoices.slice(0, mid);
        japaneseVoices.male = jaVoices.slice(mid);
      }
    }

    // Load voices (may be async)
    if ('speechSynthesis' in window) {
      loadVoices();
      if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = loadVoices;
      }
    }

    function speak(text, fallbackRomaji = null) {
      if ('speechSynthesis' in window) {
        speechSynthesis.cancel(); // Stop any ongoing speech
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'ja-JP';
        utterance.rate = 0.8;

        // Select voice based on gender preference
        const genderVoices = japaneseVoices[voiceGender];
        if (genderVoices && genderVoices.length > 0) {
          utterance.voice = genderVoices[0];
        } else if (japaneseVoices.all.length > 0) {
          utterance.voice = japaneseVoices.all[0];
        }

        // Set pitch and volume AFTER voice selection (some browsers reset on voice change)
        utterance.pitch = voicePitch;
        utterance.volume = voiceVolume;

        if (japaneseVoices.all.length > 0 || !fallbackRomaji) {
          speechSynthesis.speak(utterance);
        } else {
          // No Japanese voice - speak the romaji in English instead
          const romajiUtterance = new SpeechSynthesisUtterance(fallbackRomaji);
          romajiUtterance.lang = 'en-US';
          romajiUtterance.rate = 0.85;
          romajiUtterance.pitch = voicePitch;
          romajiUtterance.volume = voiceVolume;
          speechSynthesis.speak(romajiUtterance);
        }
      }
    }

    // Navigation
    document.getElementById('prevBtn').addEventListener('click', () => {
      const phrases = getCurrentPhrases();
      const categoryPhrases = phrases[currentCategory];
      currentIndex = (currentIndex - 1 + categoryPhrases.length) % categoryPhrases.length;
      renderPhrase();
    });

    document.getElementById('nextBtn').addEventListener('click', () => {
      const phrases = getCurrentPhrases();
      const categoryPhrases = phrases[currentCategory];
      currentIndex = (currentIndex + 1) % categoryPhrases.length;
      renderPhrase();
    });

    // Speak button
    document.getElementById('speakBtn').addEventListener('click', () => {
      const phrases = getCurrentPhrases();
      const phrase = phrases[currentCategory][currentIndex];
      speak(phrase.japanese, phrase.romaji);
    });

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') {
        document.getElementById('prevBtn').click();
      } else if (e.key === 'ArrowRight') {
        document.getElementById('nextBtn').click();
      } else if (e.key === ' ') {
        e.preventDefault();
        document.getElementById('speakBtn').click();
      }
    });

    // Get all phrases as flat array (for current difficulty)
    function getAllPhrases() {
      const phrases = getCurrentPhrases();
      const all = [];
      for (const [cat, list] of Object.entries(phrases)) {
        list.forEach((p, idx) => {
          all.push({ ...p, category: cat, index: idx });
        });
      }
      return all;
    }

    // Search functionality
    searchInput.addEventListener('input', (e) => {
      const query = e.target.value.toLowerCase().trim();
      if (!query) {
        searchResults.classList.remove('show');
        return;
      }

      const allPhrases = getAllPhrases();
      const matches = allPhrases.filter(p =>
        p.japanese.includes(query) ||
        p.romaji.toLowerCase().includes(query) ||
        p.english.toLowerCase().includes(query)
      ).slice(0, 8);

      if (matches.length === 0) {
        searchResults.innerHTML = '<div class="search-result-item"><span style="color:#666">No matches found</span></div>';
      } else {
        searchResults.innerHTML = matches.map(p => `
          <div class="search-result-item" data-category="${p.category}" data-index="${p.index}">
            <div class="search-result-jp">${p.japanese}</div>
            <div class="search-result-en">${p.english}</div>
            <div class="search-result-cat">${p.category}</div>
          </div>
        `).join('');
      }
      searchResults.classList.add('show');

      // Click handlers for results
      searchResults.querySelectorAll('.search-result-item[data-category]').forEach(item => {
        item.addEventListener('click', () => {
          currentCategory = item.dataset.category;
          currentIndex = parseInt(item.dataset.index);

          // Update category buttons
          document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
          document.querySelector(`[data-category="${currentCategory}"]`).classList.add('active');

          // Switch to learn mode if in quiz
          if (currentMode === 'quiz') {
            switchMode('learn');
          }

          renderPhrase();
          searchInput.value = '';
          searchResults.classList.remove('show');
        });
      });
    });

    // Hide search results on outside click
    document.addEventListener('click', (e) => {
      if (!e.target.closest('.search-container')) {
        searchResults.classList.remove('show');
      }
    });

    // Mode toggle
    function switchMode(mode) {
      currentMode = mode;
      document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
      document.querySelector(`[data-mode="${mode}"]`).classList.add('active');

      if (mode === 'learn') {
        learnMode.style.display = 'block';
        quizMode.style.display = 'none';
      } else {
        learnMode.style.display = 'none';
        quizMode.style.display = 'block';
        generateQuizQuestion();
      }
    }

    document.getElementById('learnModeBtn').addEventListener('click', () => switchMode('learn'));
    document.getElementById('quizModeBtn').addEventListener('click', () => switchMode('quiz'));

    // Pitch slider
    const pitchSlider = document.getElementById('pitchSlider');
    const pitchValue = document.getElementById('pitchValue');

    pitchSlider.addEventListener('input', () => {
      voicePitch = parseFloat(pitchSlider.value);
      pitchValue.textContent = voicePitch.toFixed(1);
    });

    // Volume slider
    const volumeSlider = document.getElementById('volumeSlider');
    const volumeValue = document.getElementById('volumeValue');

    // Initialize volume from slider's actual value (handle 0 correctly - don't use || which treats 0 as falsy)
    function parseVolume(val) {
      const parsed = parseFloat(val);
      return isNaN(parsed) ? 1 : Math.max(0, Math.min(1, parsed));
    }

    voiceVolume = parseVolume(volumeSlider.value);
    volumeValue.textContent = voiceVolume.toFixed(1);

    volumeSlider.addEventListener('input', () => {
      voiceVolume = parseVolume(volumeSlider.value);
      volumeValue.textContent = voiceVolume.toFixed(1);
    });

    // Quiz functions
    function shuffleArray(arr) {
      const shuffled = [...arr];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    function generateQuizQuestion() {
      const allPhrases = getAllPhrases();
      currentQuizPhrase = allPhrases[Math.floor(Math.random() * allPhrases.length)];

      // Get 3 wrong answers
      const wrongAnswers = shuffleArray(
        allPhrases.filter(p => p.english !== currentQuizPhrase.english)
      ).slice(0, 3).map(p => p.english);

      // Combine and shuffle all options
      const options = shuffleArray([currentQuizPhrase.english, ...wrongAnswers]);

      document.getElementById('quizQuestion').textContent = currentQuizPhrase.japanese;
      document.getElementById('quizRomaji').textContent = currentQuizPhrase.romaji;
      document.getElementById('quizFeedback').classList.remove('show', 'correct', 'wrong');
      document.getElementById('nextQuestionBtn').classList.remove('show');

      const optionsEl = document.getElementById('quizOptions');
      optionsEl.innerHTML = options.map(opt => `
        <button class="quiz-option" data-answer="${opt}">${opt}</button>
      `).join('');

      optionsEl.querySelectorAll('.quiz-option').forEach(btn => {
        btn.addEventListener('click', () => checkAnswer(btn.dataset.answer));
      });
    }

    function checkAnswer(answer) {
      const isCorrect = answer === currentQuizPhrase.english;
      const feedback = document.getElementById('quizFeedback');
      const options = document.querySelectorAll('.quiz-option');

      options.forEach(opt => {
        opt.classList.add('disabled');
        if (opt.dataset.answer === currentQuizPhrase.english) {
          opt.classList.add('correct');
        } else if (opt.dataset.answer === answer && !isCorrect) {
          opt.classList.add('wrong');
        }
      });

      if (isCorrect) {
        quizCorrect++;
        quizStreak++;
        feedback.textContent = `âœ“ Correct! "${currentQuizPhrase.romaji}"`;
        feedback.classList.add('correct');
      } else {
        quizWrong++;
        quizStreak = 0;
        feedback.textContent = `âœ— The answer was: "${currentQuizPhrase.english}"`;
        feedback.classList.add('wrong');
      }

      feedback.classList.add('show');
      document.getElementById('nextQuestionBtn').classList.add('show');

      // Update stats
      document.getElementById('quizCorrect').textContent = quizCorrect;
      document.getElementById('quizWrong').textContent = quizWrong;
      document.getElementById('quizStreak').textContent = quizStreak;
    }

    document.getElementById('nextQuestionBtn').addEventListener('click', generateQuizQuestion);
    document.getElementById('quizSpeakBtn').addEventListener('click', () => {
      if (currentQuizPhrase) {
        speak(currentQuizPhrase.japanese, currentQuizPhrase.romaji);
      }
    });

    // Kana Reference Data
    const kanaData = {
      hiragana: [
        { label: 'Vowels', chars: [['ã‚','a'],['ã„','i'],['ã†','u'],['ãˆ','e'],['ãŠ','o']] },
        { label: 'K', chars: [['ã‹','ka'],['ã','ki'],['ã','ku'],['ã‘','ke'],['ã“','ko']] },
        { label: 'S', chars: [['ã•','sa'],['ã—','shi'],['ã™','su'],['ã›','se'],['ã','so']] },
        { label: 'T', chars: [['ãŸ','ta'],['ã¡','chi'],['ã¤','tsu'],['ã¦','te'],['ã¨','to']] },
        { label: 'N', chars: [['ãª','na'],['ã«','ni'],['ã¬','nu'],['ã­','ne'],['ã®','no']] },
        { label: 'H', chars: [['ã¯','ha'],['ã²','hi'],['ãµ','fu'],['ã¸','he'],['ã»','ho']] },
        { label: 'M', chars: [['ã¾','ma'],['ã¿','mi'],['ã‚€','mu'],['ã‚','me'],['ã‚‚','mo']] },
        { label: 'Y', chars: [['ã‚„','ya'],['',''],['ã‚†','yu'],['',''],['ã‚ˆ','yo']] },
        { label: 'R', chars: [['ã‚‰','ra'],['ã‚Š','ri'],['ã‚‹','ru'],['ã‚Œ','re'],['ã‚','ro']] },
        { label: 'W', chars: [['ã‚','wa'],['',''],['',''],['',''],['ã‚’','wo']] },
        { label: 'N', chars: [['ã‚“','n'],['',''],['',''],['',''],['','']] },
        { label: 'G (voiced)', chars: [['ãŒ','ga'],['ã','gi'],['ã','gu'],['ã’','ge'],['ã”','go']] },
        { label: 'Z (voiced)', chars: [['ã–','za'],['ã˜','ji'],['ãš','zu'],['ãœ','ze'],['ã','zo']] },
        { label: 'D (voiced)', chars: [['ã ','da'],['ã¢','ji'],['ã¥','zu'],['ã§','de'],['ã©','do']] },
        { label: 'B (voiced)', chars: [['ã°','ba'],['ã³','bi'],['ã¶','bu'],['ã¹','be'],['ã¼','bo']] },
        { label: 'P (half-voiced)', chars: [['ã±','pa'],['ã´','pi'],['ã·','pu'],['ãº','pe'],['ã½','po']] }
      ],
      katakana: [
        { label: 'Vowels', chars: [['ã‚¢','a'],['ã‚¤','i'],['ã‚¦','u'],['ã‚¨','e'],['ã‚ª','o']] },
        { label: 'K', chars: [['ã‚«','ka'],['ã‚­','ki'],['ã‚¯','ku'],['ã‚±','ke'],['ã‚³','ko']] },
        { label: 'S', chars: [['ã‚µ','sa'],['ã‚·','shi'],['ã‚¹','su'],['ã‚»','se'],['ã‚½','so']] },
        { label: 'T', chars: [['ã‚¿','ta'],['ãƒ','chi'],['ãƒ„','tsu'],['ãƒ†','te'],['ãƒˆ','to']] },
        { label: 'N', chars: [['ãƒŠ','na'],['ãƒ‹','ni'],['ãƒŒ','nu'],['ãƒ','ne'],['ãƒ','no']] },
        { label: 'H', chars: [['ãƒ','ha'],['ãƒ’','hi'],['ãƒ•','fu'],['ãƒ˜','he'],['ãƒ›','ho']] },
        { label: 'M', chars: [['ãƒ','ma'],['ãƒŸ','mi'],['ãƒ ','mu'],['ãƒ¡','me'],['ãƒ¢','mo']] },
        { label: 'Y', chars: [['ãƒ¤','ya'],['',''],['ãƒ¦','yu'],['',''],['ãƒ¨','yo']] },
        { label: 'R', chars: [['ãƒ©','ra'],['ãƒª','ri'],['ãƒ«','ru'],['ãƒ¬','re'],['ãƒ­','ro']] },
        { label: 'W', chars: [['ãƒ¯','wa'],['',''],['',''],['',''],['ãƒ²','wo']] },
        { label: 'N', chars: [['ãƒ³','n'],['',''],['',''],['',''],['','']] },
        { label: 'G (voiced)', chars: [['ã‚¬','ga'],['ã‚®','gi'],['ã‚°','gu'],['ã‚²','ge'],['ã‚´','go']] },
        { label: 'Z (voiced)', chars: [['ã‚¶','za'],['ã‚¸','ji'],['ã‚º','zu'],['ã‚¼','ze'],['ã‚¾','zo']] },
        { label: 'D (voiced)', chars: [['ãƒ€','da'],['ãƒ‚','ji'],['ãƒ…','zu'],['ãƒ‡','de'],['ãƒ‰','do']] },
        { label: 'B (voiced)', chars: [['ãƒ','ba'],['ãƒ“','bi'],['ãƒ–','bu'],['ãƒ™','be'],['ãƒœ','bo']] },
        { label: 'P (half-voiced)', chars: [['ãƒ‘','pa'],['ãƒ”','pi'],['ãƒ—','pu'],['ãƒš','pe'],['ãƒ','po']] }
      ]
    };

    function renderKanaGrid(type) {
      const grid = document.getElementById(type + 'Grid');
      const data = kanaData[type];
      let html = '';

      data.forEach(row => {
        html += `<div class="kana-row-label">${row.label}</div>`;
        row.chars.forEach(([char, rom]) => {
          if (char) {
            html += `<div class="kana-cell" data-char="${char}" data-romaji="${rom}">
              <div class="kana-char">${char}</div>
              <div class="kana-romaji">${rom}</div>
            </div>`;
          } else {
            html += `<div class="kana-cell" style="opacity:0.2;pointer-events:none;">
              <div class="kana-char">-</div>
              <div class="kana-romaji"></div>
            </div>`;
          }
        });
      });

      grid.innerHTML = html;

      // Click to speak
      grid.querySelectorAll('.kana-cell[data-char]').forEach(cell => {
        cell.addEventListener('click', () => speak(cell.dataset.char, cell.dataset.romaji));
      });
    }

    // Kana panel toggle
    const kanaToggle = document.getElementById('kanaToggle');
    const kanaPanel = document.getElementById('kanaPanel');

    kanaToggle.addEventListener('click', () => {
      kanaToggle.classList.toggle('open');
      kanaPanel.classList.toggle('open');
    });

    // Kana tab switching
    document.querySelectorAll('.kana-tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.kana-tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');

        const type = tab.dataset.kana;
        document.querySelectorAll('.kana-section').forEach(s => s.classList.remove('active'));
        document.getElementById(type + 'Section').classList.add('active');
      });
    });

    // Initialize
    renderCategories();
    renderPhrase();
    renderQuickPhrases();
    renderKanaGrid('hiragana');
    renderKanaGrid('katakana');
  </script>
</body>
</html>
