<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ship Hull Defense</title>
  <link rel="icon" href="https://emojicdn.elk.sh/âš“">
  <meta property="og:title" content="Ship Hull Defense">
  <meta property="og:description" content="Reinforce yer hull and deflect those cannonballs!">
  <meta property="og:url" content="https://sloppy.live/mech-suit">
  <meta property="og:image" content="https://emojicdn.elk.sh/ðŸš¢?style=apple&size=512">
  <link href="https://fonts.googleapis.com/css2?family=Pirata+One&family=IM+Fell+English+SC&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      min-height: 100vh;
      background: linear-gradient(180deg, #0d1a2a 0%, #1a2d4a 50%, #0d1a2a 100%);
      font-family: 'IM Fell English SC', serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    .game-container {
      position: relative;
      width: 100vw;
      height: 100vh;
    }
    canvas { display: block; width: 100%; height: 100%; }
    .hud {
      position: absolute;
      top: 15px;
      left: 20px;
      right: 20px;
      display: flex;
      justify-content: space-between;
      pointer-events: none;
      z-index: 10;
    }
    .title {
      font-family: 'Pirata One', cursive;
      font-size: 1.4rem;
      color: #d4a84b;
      text-shadow: 0 0 20px rgba(212,168,75,0.5), 2px 2px 4px #1a0f0a;
      letter-spacing: 0.05em;
    }
    .stats {
      font-family: 'Pirata One', cursive;
      font-size: 1rem;
      color: #ffd700;
      text-shadow: 0 0 10px rgba(255,215,0,0.5);
    }
    .armor-bar {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 300px;
      height: 30px;
      background: rgba(0,0,0,0.5);
      border: 3px solid #5c3a1e;
      border-radius: 5px;
      overflow: hidden;
    }
    .armor-fill {
      height: 100%;
      background: linear-gradient(90deg, #5c3a1e, #8b6914);
      transition: width 0.3s;
      box-shadow: 0 0 20px rgba(139,105,20,0.5);
    }
    .armor-label {
      position: absolute;
      bottom: 55px;
      left: 50%;
      transform: translateX(-50%);
      font-family: 'Pirata One', cursive;
      font-size: 0.9rem;
      color: #d4a84b;
      letter-spacing: 0.1em;
    }
    .instructions {
      position: absolute;
      top: 50px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.75rem;
      color: rgba(212,168,75,0.4);
      text-align: center;
    }
    .back-link {
      position: fixed;
      bottom: 5px;
      right: 10px;
      color: #d4a84b;
      text-decoration: none;
      font-size: 0.7rem;
      opacity: 0.5;
    }
  </style>
</head>
<body>
  <div class="game-container">
    <canvas id="canvas"></canvas>
    <div class="hud">
      <div class="title">âš“ Ship Hull Defense</div>
      <div class="stats">DEFLECTED: <span id="blocked">0</span></div>
    </div>
    <div class="instructions">Click to add hull planks â€¢ Deflect the cannonballs!</div>
    <div class="armor-label">HULL INTEGRITY</div>
    <div class="armor-bar">
      <div class="armor-fill" id="armorFill" style="width: 0%"></div>
    </div>
  </div>
  <a href="https://sloppy.live" class="back-link">sloppy.live</a>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let frameCount = 0;
let hullLevel = 0;
let cannonballsDeflected = 0;
let shakeIntensity = 0;
let hullPlanks = [];
let cannonballs = [];
let sparks = [];
let splashTexts = [];
let waveOffset = 0;

const ship = {
  x: 0, y: 0,
  bodyWidth: 140,
  bodyHeight: 100
};

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  ship.x = canvas.width / 2;
  ship.y = canvas.height / 2;
}

function addHullPlank(x, y) {
  const angle = Math.atan2(y - ship.y, x - ship.x);
  const distance = 90 + Math.random() * 30;

  hullPlanks.push({
    angle,
    distance,
    width: 50 + Math.random() * 30,
    height: 25 + Math.random() * 15,
    thickness: 0,
    targetThickness: 6 + Math.random() * 6,
    glow: 1,
    nails: Math.floor(Math.random() * 3) + 2
  });

  hullLevel = Math.min(100, hullLevel + 5);
  updateHullBar();

  // Spawn wood splinters
  for (let i = 0; i < 8; i++) {
    sparks.push({
      x: ship.x + Math.cos(angle) * distance,
      y: ship.y + Math.sin(angle) * distance,
      vx: (Math.random() - 0.5) * 8,
      vy: (Math.random() - 0.5) * 8,
      life: 1,
      color: Math.random() > 0.5 ? '#d4a84b' : '#8b6914'
    });
  }

  shakeIntensity = 5;
}

function spawnCannonball() {
  const side = Math.floor(Math.random() * 4);
  let x, y, vx, vy;

  switch(side) {
    case 0: x = Math.random() * canvas.width; y = -50; vx = (Math.random()-0.5)*2; vy = 4 + Math.random()*3; break;
    case 1: x = canvas.width + 50; y = Math.random() * canvas.height; vx = -4 - Math.random()*3; vy = (Math.random()-0.5)*2; break;
    case 2: x = Math.random() * canvas.width; y = canvas.height + 50; vx = (Math.random()-0.5)*2; vy = -4 - Math.random()*3; break;
    case 3: x = -50; y = Math.random() * canvas.height; vx = 4 + Math.random()*3; vy = (Math.random()-0.5)*2; break;
  }

  cannonballs.push({ x, y, vx, vy, rotation: Math.random() * Math.PI * 2, size: 18 + Math.random() * 12, smoke: [] });
}

function checkCannonballCollision(ball) {
  const dx = ball.x - ship.x;
  const dy = ball.y - ship.y;
  const dist = Math.sqrt(dx*dx + dy*dy);

  // Check hull plank collision
  for (const plank of hullPlanks) {
    const px = ship.x + Math.cos(plank.angle) * plank.distance;
    const py = ship.y + Math.sin(plank.angle) * plank.distance;
    const pDist = Math.sqrt((ball.x-px)**2 + (ball.y-py)**2);

    if (pDist < plank.width/2 + ball.size/2) {
      return 'blocked';
    }
  }

  // Check ship body collision
  if (dist < 70) {
    return 'hit';
  }

  return null;
}

function spawnDeflectEffect(x, y) {
  shakeIntensity = 15;
  cannonballsDeflected++;
  document.getElementById('blocked').textContent = cannonballsDeflected;

  // Wood and water splashes
  for (let i = 0; i < 20; i++) {
    sparks.push({
      x, y,
      vx: (Math.random() - 0.5) * 15,
      vy: (Math.random() - 0.5) * 15,
      life: 1,
      color: ['#d4a84b', '#8b6914', '#5c3a1e', '#4a9'][Math.floor(Math.random()*4)]
    });
  }

  // Splash text
  splashTexts.push({
    x, y,
    text: ['SPLASH!', 'DEFLECTED!', 'ARRR!', 'MISSED!'][Math.floor(Math.random()*4)],
    alpha: 1,
    scale: 1,
    vy: -2
  });
}

function update() {
  frameCount++;
  waveOffset += 0.02;

  // Spawn cannonballs
  const spawnRate = Math.max(30, 80 - Math.floor(cannonballsDeflected / 5));
  if (frameCount % spawnRate === 0) {
    spawnCannonball();
  }

  // Update cannonballs
  for (let i = cannonballs.length - 1; i >= 0; i--) {
    const ball = cannonballs[i];
    ball.x += ball.vx;
    ball.y += ball.vy;
    ball.rotation += 0.15;

    // Add smoke trail
    if (frameCount % 3 === 0) {
      ball.smoke.push({ x: ball.x, y: ball.y, alpha: 0.6, size: ball.size * 0.4 });
    }

    // Update smoke
    for (let j = ball.smoke.length - 1; j >= 0; j--) {
      ball.smoke[j].alpha -= 0.02;
      ball.smoke[j].size *= 1.02;
      if (ball.smoke[j].alpha <= 0) ball.smoke.splice(j, 1);
    }

    const collision = checkCannonballCollision(ball);
    if (collision === 'blocked') {
      spawnDeflectEffect(ball.x, ball.y);
      cannonballs.splice(i, 1);
    } else if (collision === 'hit') {
      hullLevel = Math.max(0, hullLevel - 10);
      updateHullBar();
      shakeIntensity = 20;
      cannonballs.splice(i, 1);
    } else if (ball.x < -100 || ball.x > canvas.width+100 || ball.y < -100 || ball.y > canvas.height+100) {
      cannonballs.splice(i, 1);
    }
  }

  // Update hull planks
  for (const plank of hullPlanks) {
    plank.thickness += (plank.targetThickness - plank.thickness) * 0.1;
    plank.glow *= 0.95;
  }

  // Update sparks
  for (let i = sparks.length - 1; i >= 0; i--) {
    const s = sparks[i];
    s.x += s.vx;
    s.y += s.vy;
    s.vy += 0.3;
    s.vx *= 0.98;
    s.life -= 0.03;
    if (s.life <= 0) sparks.splice(i, 1);
  }

  // Update splash texts
  for (let i = splashTexts.length - 1; i >= 0; i--) {
    const t = splashTexts[i];
    t.y += t.vy;
    t.alpha -= 0.02;
    t.scale += 0.02;
    if (t.alpha <= 0) splashTexts.splice(i, 1);
  }

  shakeIntensity *= 0.9;
}

function drawShip() {
  ctx.save();
  ctx.translate(ship.x, ship.y);

  // Ship glow
  const glow = ctx.createRadialGradient(0, 0, 30, 0, 0, 120);
  glow.addColorStop(0, 'rgba(212, 168, 75, 0.2)');
  glow.addColorStop(1, 'transparent');
  ctx.fillStyle = glow;
  ctx.beginPath();
  ctx.arc(0, 0, 120, 0, Math.PI * 2);
  ctx.fill();

  // Ship hull
  ctx.fillStyle = '#5c3a1e';
  ctx.beginPath();
  ctx.moveTo(-70, -20);
  ctx.quadraticCurveTo(-80, 30, -50, 50);
  ctx.lineTo(50, 50);
  ctx.quadraticCurveTo(80, 30, 70, -20);
  ctx.quadraticCurveTo(50, -35, 0, -40);
  ctx.quadraticCurveTo(-50, -35, -70, -20);
  ctx.closePath();
  ctx.fill();

  // Hull planks
  ctx.strokeStyle = '#3a2a1a';
  ctx.lineWidth = 2;
  for (let y = -15; y < 45; y += 15) {
    ctx.beginPath();
    ctx.moveTo(-65 + Math.abs(y) * 0.3, y);
    ctx.lineTo(65 - Math.abs(y) * 0.3, y);
    ctx.stroke();
  }

  // Deck
  ctx.fillStyle = '#8b6914';
  ctx.beginPath();
  ctx.ellipse(0, -25, 55, 20, 0, 0, Math.PI * 2);
  ctx.fill();

  // Mast
  ctx.fillStyle = '#4a2c0f';
  ctx.fillRect(-5, -90, 10, 70);

  // Sail
  ctx.fillStyle = '#f5f5dc';
  ctx.beginPath();
  ctx.moveTo(0, -85);
  ctx.quadraticCurveTo(45, -55, 40, -25);
  ctx.lineTo(0, -25);
  ctx.closePath();
  ctx.fill();

  // Jolly Roger on sail
  ctx.fillStyle = '#1a1a1a';
  ctx.font = '20px serif';
  ctx.textAlign = 'center';
  ctx.fillText('â˜ ', 18, -50);

  // Crow's nest
  ctx.fillStyle = '#3a2a1a';
  ctx.fillRect(-12, -95, 24, 8);

  // Flag
  ctx.fillStyle = '#1a1a1a';
  ctx.beginPath();
  ctx.moveTo(5, -90);
  ctx.lineTo(30, -85);
  ctx.lineTo(30, -70);
  ctx.lineTo(5, -75);
  ctx.closePath();
  ctx.fill();

  // Skull on flag
  ctx.fillStyle = '#f5f5dc';
  ctx.font = '10px serif';
  ctx.fillText('â˜ ', 18, -78);

  // Expression based on hull level
  ctx.fillStyle = '#ffd700';
  ctx.font = '24px serif';
  if (hullLevel < 30) {
    ctx.fillText('ðŸ˜°', -5, 10);
  } else {
    ctx.fillText('âš“', -5, 10);
  }

  ctx.restore();
}

function drawHullPlank(plank) {
  const x = ship.x + Math.cos(plank.angle) * plank.distance;
  const y = ship.y + Math.sin(plank.angle) * plank.distance;

  ctx.save();
  ctx.translate(x, y);
  ctx.rotate(plank.angle + Math.PI/2);

  // Plank shadow
  ctx.fillStyle = 'rgba(0,0,0,0.3)';
  ctx.fillRect(-plank.width/2 + 3, -plank.height/2 + 3, plank.width, plank.height);

  // Main wooden plank
  const plankGrad = ctx.createLinearGradient(-plank.width/2, 0, plank.width/2, 0);
  plankGrad.addColorStop(0, '#5c3a1e');
  plankGrad.addColorStop(0.3, '#8b6914');
  plankGrad.addColorStop(0.5, '#a07828');
  plankGrad.addColorStop(0.7, '#8b6914');
  plankGrad.addColorStop(1, '#5c3a1e');
  ctx.fillStyle = plankGrad;
  ctx.fillRect(-plank.width/2, -plank.height/2, plank.width, plank.height);

  // Wood grain
  ctx.strokeStyle = '#4a2c0f';
  ctx.lineWidth = 1;
  for (let i = 0; i < 3; i++) {
    ctx.beginPath();
    ctx.moveTo(-plank.width/2 + 5, -plank.height/2 + 5 + i * 8);
    ctx.lineTo(plank.width/2 - 5, -plank.height/2 + 5 + i * 8);
    ctx.stroke();
  }

  // Plank border (iron band)
  ctx.strokeStyle = '#3a3a3a';
  ctx.lineWidth = plank.thickness / 2;
  ctx.strokeRect(-plank.width/2, -plank.height/2, plank.width, plank.height);

  // Iron band highlight
  ctx.strokeStyle = 'rgba(100, 100, 100, 0.3)';
  ctx.lineWidth = 2;
  ctx.strokeRect(-plank.width/2 + 3, -plank.height/2 + 3, plank.width - 6, plank.height - 6);

  // Nails
  ctx.fillStyle = '#2a2a2a';
  for (let i = 0; i < plank.nails; i++) {
    const nx = -plank.width/2 + 8 + (i * (plank.width-16) / (plank.nails-1 || 1));
    ctx.beginPath();
    ctx.arc(nx, -plank.height/2 + 6, 3, 0, Math.PI * 2);
    ctx.arc(nx, plank.height/2 - 6, 3, 0, Math.PI * 2);
    ctx.fill();
  }

  // Glow effect when newly placed
  if (plank.glow > 0.1) {
    ctx.strokeStyle = `rgba(212, 168, 75, ${plank.glow})`;
    ctx.lineWidth = 3;
    ctx.strokeRect(-plank.width/2 - 2, -plank.height/2 - 2, plank.width + 4, plank.height + 4);
  }

  ctx.restore();
}

function drawCannonball(ball) {
  // Draw smoke trail
  for (const smoke of ball.smoke) {
    ctx.globalAlpha = smoke.alpha;
    ctx.fillStyle = '#555';
    ctx.beginPath();
    ctx.arc(smoke.x, smoke.y, smoke.size, 0, Math.PI * 2);
    ctx.fill();
  }
  ctx.globalAlpha = 1;

  ctx.save();
  ctx.translate(ball.x, ball.y);
  ctx.rotate(ball.rotation);

  // Cannonball body
  const ballGrad = ctx.createRadialGradient(-ball.size * 0.3, -ball.size * 0.3, 0, 0, 0, ball.size);
  ballGrad.addColorStop(0, '#4a4a4a');
  ballGrad.addColorStop(0.5, '#2a2a2a');
  ballGrad.addColorStop(1, '#1a1a1a');
  ctx.fillStyle = ballGrad;
  ctx.beginPath();
  ctx.arc(0, 0, ball.size, 0, Math.PI * 2);
  ctx.fill();

  // Highlight
  ctx.fillStyle = 'rgba(255,255,255,0.2)';
  ctx.beginPath();
  ctx.arc(-ball.size * 0.3, -ball.size * 0.3, ball.size * 0.3, 0, Math.PI * 2);
  ctx.fill();

  ctx.restore();
}

function render() {
  ctx.save();

  // Screen shake
  if (shakeIntensity > 0.5) {
    ctx.translate(
      (Math.random() - 0.5) * shakeIntensity,
      (Math.random() - 0.5) * shakeIntensity
    );
  }

  // Ocean background
  const bgGrad = ctx.createLinearGradient(0, 0, 0, canvas.height);
  bgGrad.addColorStop(0, '#0d1a2a');
  bgGrad.addColorStop(0.5, '#1a2d4a');
  bgGrad.addColorStop(1, '#0d2a3a');
  ctx.fillStyle = bgGrad;
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // Ocean waves
  ctx.fillStyle = 'rgba(10, 58, 74, 0.3)';
  for (let w = 0; w < 5; w++) {
    ctx.beginPath();
    ctx.moveTo(0, canvas.height * 0.3 + w * 80);
    for (let x = 0; x <= canvas.width; x += 30) {
      const y = canvas.height * 0.3 + w * 80 + Math.sin((x + frameCount * 2 + w * 50) * 0.02 + waveOffset) * 15;
      ctx.lineTo(x, y);
    }
    ctx.lineTo(canvas.width, canvas.height);
    ctx.lineTo(0, canvas.height);
    ctx.fill();
  }

  // Draw cannonballs (behind ship)
  for (const ball of cannonballs) {
    drawCannonball(ball);
  }

  // Draw ship
  drawShip();

  // Draw hull planks
  for (const plank of hullPlanks) {
    drawHullPlank(plank);
  }

  // Draw sparks
  for (const s of sparks) {
    ctx.globalAlpha = s.life;
    ctx.fillStyle = s.color;
    ctx.beginPath();
    ctx.arc(s.x, s.y, 3 * s.life, 0, Math.PI * 2);
    ctx.fill();
  }
  ctx.globalAlpha = 1;

  // Draw splash texts
  ctx.font = 'bold 24px "Pirata One"';
  ctx.textAlign = 'center';
  for (const t of splashTexts) {
    ctx.globalAlpha = t.alpha;
    ctx.fillStyle = '#d4a84b';
    ctx.save();
    ctx.translate(t.x, t.y);
    ctx.scale(t.scale, t.scale);
    ctx.fillText(t.text, 0, 0);
    ctx.restore();
  }
  ctx.globalAlpha = 1;

  // Vignette
  const vignette = ctx.createRadialGradient(
    canvas.width / 2, canvas.height / 2, canvas.height * 0.4,
    canvas.width / 2, canvas.height / 2, canvas.height
  );
  vignette.addColorStop(0, 'transparent');
  vignette.addColorStop(1, 'rgba(0, 0, 0, 0.5)');
  ctx.fillStyle = vignette;
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.restore();
}

function updateHullBar() {
  document.getElementById('armorFill').style.width = hullLevel + '%';
}

function gameLoop() {
  update();
  render();
  requestAnimationFrame(gameLoop);
}

canvas.addEventListener('click', e => {
  const rect = canvas.getBoundingClientRect();
  addHullPlank(e.clientX - rect.left, e.clientY - rect.top);
});

canvas.addEventListener('touchstart', e => {
  e.preventDefault();
  const touch = e.touches[0];
  const rect = canvas.getBoundingClientRect();
  addHullPlank(touch.clientX - rect.left, touch.clientY - rect.top);
});

window.addEventListener('resize', resize);

resize();
gameLoop();
</script>
<script src="/sloppy-header/sloppy-bar.js"></script>
</body>
</html>
