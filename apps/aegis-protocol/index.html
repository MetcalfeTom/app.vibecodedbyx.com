<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Aegis Protocol</title>
  <link rel="icon" href="https://emojicdn.elk.sh/üõ°Ô∏è">

  <meta property="og:title" content="Aegis Protocol">
  <meta property="og:description" content="Defend the mainframe from bot waves using terminal commands">
  <meta property="og:url" content="https://app.sloppy.live/aegis-protocol">
  <meta property="og:image" content="https://app.sloppy.live/aegis-protocol/og-image.png">
  <meta property="og:type" content="website">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=VT323&family=Fira+Code:wght@400;700&display=swap" rel="stylesheet">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #0a0a0a;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'VT323', monospace;
      overflow: hidden;
    }

    #crt {
      position: relative;
      width: 100%;
      max-width: 900px;
      height: 100vh;
      max-height: 700px;
      background: #050505;
      border-radius: 20px;
      padding: 20px;
      box-shadow:
        0 0 20px rgba(0, 255, 65, 0.3),
        inset 0 0 60px rgba(0, 0, 0, 0.8);
    }

    #crt::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(
        rgba(0, 255, 65, 0.03) 50%,
        rgba(0, 0, 0, 0.1) 50%
      );
      background-size: 100% 4px;
      pointer-events: none;
      z-index: 10;
      border-radius: 20px;
    }

    #crt::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(ellipse at center, transparent 0%, rgba(0,0,0,0.4) 100%);
      pointer-events: none;
      z-index: 11;
      border-radius: 20px;
    }

    #screen {
      width: 100%;
      height: 100%;
      background: #0d1a0d;
      border: 3px solid #1a3a1a;
      border-radius: 10px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
    }

    #header {
      background: #0a150a;
      padding: 8px 12px;
      border-bottom: 2px solid #00ff41;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
    }

    .header-title {
      color: #00ff41;
      font-size: 18px;
      text-shadow: 0 0 10px #00ff41;
      letter-spacing: 2px;
    }

    .header-stats {
      display: flex;
      gap: 20px;
      font-size: 14px;
    }

    .stat {
      color: #00ff41;
      text-shadow: 0 0 5px #00ff41;
    }

    .stat-label {
      color: #006618;
    }

    .stat-critical {
      color: #ff4141;
      text-shadow: 0 0 10px #ff4141;
      animation: pulse 0.5s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    #main-area {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    #output-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    #output {
      flex: 1;
      padding: 12px;
      overflow-y: auto;
      font-size: 16px;
      line-height: 1.4;
      color: #00ff41;
      text-shadow: 0 0 5px rgba(0, 255, 65, 0.5);
    }

    #output::-webkit-scrollbar {
      width: 8px;
    }

    #output::-webkit-scrollbar-track {
      background: #0a150a;
    }

    #output::-webkit-scrollbar-thumb {
      background: #00ff41;
      border-radius: 4px;
    }

    .line {
      margin-bottom: 4px;
      animation: fadeIn 0.1s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .system { color: #00aa30; }
    .warning { color: #ffaa00; text-shadow: 0 0 5px #ffaa00; }
    .error { color: #ff4141; text-shadow: 0 0 5px #ff4141; }
    .success { color: #00ff41; text-shadow: 0 0 10px #00ff41; }
    .info { color: #41ffff; text-shadow: 0 0 5px #41ffff; }
    .dim { color: #006618; }
    .highlight { color: #ffffff; text-shadow: 0 0 10px #00ff41; }

    #status-panel {
      width: 220px;
      background: #0a150a;
      border-left: 2px solid #00ff41;
      padding: 12px;
      font-size: 13px;
      overflow-y: auto;
      flex-shrink: 0;
    }

    .panel-section {
      margin-bottom: 16px;
    }

    .panel-title {
      color: #00ff41;
      font-size: 14px;
      border-bottom: 1px solid #006618;
      padding-bottom: 4px;
      margin-bottom: 8px;
      text-shadow: 0 0 5px #00ff41;
    }

    .node {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
      color: #00aa30;
    }

    .node-name {
      color: #006618;
    }

    .node-ok { color: #00ff41; }
    .node-warn { color: #ffaa00; }
    .node-crit { color: #ff4141; animation: pulse 0.5s infinite; }
    .node-shield { color: #41ffff; }

    .bar-container {
      height: 12px;
      background: #0a150a;
      border: 1px solid #006618;
      margin-top: 4px;
    }

    .bar {
      height: 100%;
      transition: width 0.3s;
    }

    .bar-integrity { background: linear-gradient(90deg, #ff4141, #ffaa00, #00ff41); }
    .bar-energy { background: #41ffff; }

    #input-area {
      display: flex;
      border-top: 2px solid #00ff41;
      background: #0a150a;
      flex-shrink: 0;
    }

    #prompt {
      color: #00ff41;
      padding: 10px;
      font-size: 16px;
      text-shadow: 0 0 5px #00ff41;
      white-space: nowrap;
    }

    #input {
      flex: 1;
      background: transparent;
      border: none;
      color: #00ff41;
      font-family: 'VT323', monospace;
      font-size: 16px;
      padding: 10px 10px 10px 0;
      outline: none;
      text-shadow: 0 0 5px rgba(0, 255, 65, 0.5);
    }

    #input::placeholder {
      color: #006618;
    }

    #cursor {
      display: inline-block;
      width: 10px;
      height: 18px;
      background: #00ff41;
      animation: blink 1s infinite;
      vertical-align: middle;
      margin-left: 2px;
    }

    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }

    #game-over, #start-screen {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(10, 21, 10, 0.95);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 5;
      text-align: center;
      padding: 20px;
    }

    #game-over { display: none; }

    .go-title {
      font-size: 32px;
      color: #ff4141;
      text-shadow: 0 0 20px #ff4141;
      margin-bottom: 20px;
    }

    .go-win {
      color: #00ff41;
      text-shadow: 0 0 20px #00ff41;
    }

    .go-stats {
      color: #00aa30;
      font-size: 18px;
      margin-bottom: 30px;
    }

    .start-title {
      font-size: 36px;
      color: #00ff41;
      text-shadow: 0 0 20px #00ff41;
      margin-bottom: 10px;
      letter-spacing: 4px;
    }

    .start-subtitle {
      font-size: 16px;
      color: #006618;
      margin-bottom: 30px;
    }

    .start-art {
      color: #00ff41;
      font-size: 12px;
      line-height: 1.2;
      margin-bottom: 30px;
      text-shadow: 0 0 10px #00ff41;
      white-space: pre;
      font-family: 'Fira Code', monospace;
    }

    .start-btn, .restart-btn {
      background: transparent;
      border: 2px solid #00ff41;
      color: #00ff41;
      font-family: 'VT323', monospace;
      font-size: 20px;
      padding: 12px 30px;
      cursor: pointer;
      text-shadow: 0 0 5px #00ff41;
      box-shadow: 0 0 10px rgba(0, 255, 65, 0.3);
      transition: all 0.2s;
    }

    .start-btn:hover, .restart-btn:hover {
      background: #00ff41;
      color: #0a150a;
      box-shadow: 0 0 20px rgba(0, 255, 65, 0.6);
    }

    .restart-btn {
      border-color: #ff4141;
      color: #ff4141;
      text-shadow: 0 0 5px #ff4141;
      box-shadow: 0 0 10px rgba(255, 65, 65, 0.3);
    }

    .restart-btn:hover {
      background: #ff4141;
      color: #0a150a;
    }

    .cmd-help {
      color: #006618;
      font-size: 14px;
      margin-top: 20px;
      max-width: 400px;
    }

    .back-link {
      position: fixed;
      bottom: 10px;
      left: 10px;
      color: #006618;
      font-size: 14px;
      text-decoration: none;
      z-index: 20;
    }

    .back-link:hover {
      color: #00ff41;
    }

    @media (max-width: 700px) {
      #status-panel {
        display: none;
      }

      .header-stats {
        gap: 10px;
        font-size: 12px;
      }

      #output {
        font-size: 14px;
      }

      .start-art {
        font-size: 8px;
      }
    }

    .flicker {
      animation: flicker 0.1s;
    }

    @keyframes flicker {
      0% { opacity: 0.8; }
      50% { opacity: 1; }
      100% { opacity: 0.9; }
    }
  </style>
</head>
<body>
  <div id="crt">
    <div id="screen">
      <div id="header">
        <div class="header-title">‚óà AEGIS PROTOCOL v2.7 ‚óà</div>
        <div class="header-stats">
          <span class="stat"><span class="stat-label">WAVE:</span> <span id="wave-num">1</span></span>
          <span class="stat"><span class="stat-label">SCORE:</span> <span id="score">0</span></span>
          <span class="stat"><span class="stat-label">ENERGY:</span> <span id="energy">100</span></span>
        </div>
      </div>

      <div id="main-area">
        <div id="output-panel">
          <div id="output"></div>
        </div>

        <div id="status-panel">
          <div class="panel-section">
            <div class="panel-title">‚ñ∏ MAINFRAME INTEGRITY</div>
            <div class="bar-container">
              <div class="bar bar-integrity" id="integrity-bar" style="width: 100%"></div>
            </div>
            <div class="node" style="margin-top:6px">
              <span class="node-name">STATUS:</span>
              <span id="integrity-status" class="node-ok">SECURE</span>
            </div>
          </div>

          <div class="panel-section">
            <div class="panel-title">‚ñ∏ SYSTEM NODES</div>
            <div id="nodes-list"></div>
          </div>

          <div class="panel-section">
            <div class="panel-title">‚ñ∏ ACTIVE THREATS</div>
            <div id="threats-list">
              <div class="dim">No active threats</div>
            </div>
          </div>

          <div class="panel-section">
            <div class="panel-title">‚ñ∏ COMMANDS</div>
            <div class="dim" style="font-size:11px; line-height:1.5">
              SCAN - detect threats<br>
              PATCH [node] - repair<br>
              TRACE [bot] - eliminate<br>
              SHIELD [node] - protect<br>
              STATUS - system info<br>
              HELP - full manual
            </div>
          </div>
        </div>
      </div>

      <div id="input-area">
        <div id="prompt">root@aegis:~$</div>
        <input type="text" id="input" placeholder="Enter command..." autocomplete="off" autocapitalize="off" spellcheck="false">
      </div>

      <div id="start-screen">
        <div class="start-title">AEGIS PROTOCOL</div>
        <div class="start-subtitle">MAINFRAME DEFENSE SYSTEM</div>
        <div class="start-art">
    ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
    ‚ïë  ‚ñÑ‚ñÑ‚ñÑ      ‚ñì‚ñà‚ñà‚ñà‚ñà‚ñà   ‚ñÑ‚ñà‚ñà‚ñà‚ñà   ‚ñà‚ñà‚ñì   ‚ïë
    ‚ïë ‚ñí‚ñà‚ñà‚ñà‚ñà‚ñÑ    ‚ñì‚ñà   ‚ñÄ  ‚ñà‚ñà‚ñí ‚ñÄ‚ñà‚ñí ‚ñì‚ñà‚ñà‚ñí   ‚ïë
    ‚ïë ‚ñí‚ñà‚ñà  ‚ñÄ‚ñà‚ñÑ  ‚ñí‚ñà‚ñà‚ñà   ‚ñí‚ñà‚ñà‚ñë‚ñÑ‚ñÑ‚ñÑ‚ñë ‚ñí‚ñà‚ñà‚ñí   ‚ïë
    ‚ïë ‚ñë‚ñà‚ñà‚ñÑ‚ñÑ‚ñÑ‚ñÑ‚ñà‚ñà ‚ñí‚ñì‚ñà  ‚ñÑ ‚ñë‚ñì‚ñà  ‚ñà‚ñà‚ñì ‚ñë‚ñà‚ñà‚ñë   ‚ïë
    ‚ïë  ‚ñì‚ñà   ‚ñì‚ñà‚ñà‚ñí‚ñë‚ñí‚ñà‚ñà‚ñà‚ñà‚ñí‚ñë‚ñí‚ñì‚ñà‚ñà‚ñà‚ñÄ‚ñí ‚ñë‚ñà‚ñà‚ñë   ‚ïë
    ‚ïë  ‚ñí‚ñí   ‚ñì‚ñí‚ñà‚ñë‚ñë‚ñë ‚ñí‚ñë ‚ñë ‚ñë‚ñí   ‚ñí  ‚ñë‚ñì     ‚ïë
    ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
        </div>
        <button class="start-btn" id="start-btn">INITIALIZE DEFENSE</button>
        <div class="cmd-help">
          Defend the mainframe from incoming bot waves.<br>
          Use terminal commands to patch, trace, and shield.
        </div>
      </div>

      <div id="game-over">
        <div class="go-title" id="go-title">SYSTEM COMPROMISED</div>
        <div class="go-stats" id="go-stats"></div>
        <button class="restart-btn" id="restart-btn">REBOOT SYSTEM</button>
      </div>
    </div>
  </div>

  <a href="https://sloppy.live" class="back-link">‚Üê sloppy.live</a>

  <script>
    // Game state
    const game = {
      running: false,
      wave: 1,
      score: 0,
      energy: 100,
      maxEnergy: 100,
      integrity: 100,
      nodes: {},
      bots: [],
      botIdCounter: 0,
      waveTimer: null,
      attackTimer: null,
      energyTimer: null
    };

    const NODES = ['FIREWALL', 'DATABASE', 'AUTH', 'NETWORK', 'CORE'];
    const BOT_TYPES = {
      PROBE: { hp: 1, damage: 5, speed: 3000, points: 10, symbol: '‚óá' },
      WORM: { hp: 2, damage: 10, speed: 4000, points: 25, symbol: '‚óà' },
      TROJAN: { hp: 3, damage: 15, speed: 5000, points: 50, symbol: '‚óÜ' },
      DDOS: { hp: 5, damage: 25, speed: 6000, points: 100, symbol: '‚ñ£' }
    };

    const COMMANDS = {
      SCAN: { energy: 5, desc: 'Reveal all active threats and their targets' },
      PATCH: { energy: 15, desc: 'Repair a damaged node (+30 integrity)' },
      TRACE: { energy: 20, desc: 'Trace and eliminate a bot (1 damage)' },
      SHIELD: { energy: 25, desc: 'Shield a node for 10 seconds (immune)' },
      STATUS: { energy: 0, desc: 'Display full system status' },
      HELP: { energy: 0, desc: 'Show command manual' },
      NUKE: { energy: 80, desc: 'Emergency: damage all bots (unlocks wave 5)' }
    };

    const output = document.getElementById('output');
    const input = document.getElementById('input');

    function log(text, className = '') {
      const line = document.createElement('div');
      line.className = 'line ' + className;
      line.innerHTML = text;
      output.appendChild(line);
      output.scrollTop = output.scrollHeight;
    }

    function clearOutput() {
      output.innerHTML = '';
    }

    function updateUI() {
      document.getElementById('wave-num').textContent = game.wave;
      document.getElementById('score').textContent = game.score;
      document.getElementById('energy').textContent = Math.floor(game.energy);

      const intBar = document.getElementById('integrity-bar');
      intBar.style.width = game.integrity + '%';

      const intStatus = document.getElementById('integrity-status');
      if (game.integrity > 60) {
        intStatus.textContent = 'SECURE';
        intStatus.className = 'node-ok';
      } else if (game.integrity > 30) {
        intStatus.textContent = 'WARNING';
        intStatus.className = 'node-warn';
      } else {
        intStatus.textContent = 'CRITICAL';
        intStatus.className = 'node-crit';
      }

      // Update nodes list
      const nodesList = document.getElementById('nodes-list');
      nodesList.innerHTML = NODES.map(n => {
        const node = game.nodes[n];
        let statusClass = 'node-ok';
        let status = node.hp + '%';
        if (node.shield > 0) {
          statusClass = 'node-shield';
          status = 'SHIELDED';
        } else if (node.hp <= 0) {
          statusClass = 'node-crit';
          status = 'DOWN';
        } else if (node.hp < 50) {
          statusClass = 'node-warn';
        }
        return `<div class="node"><span class="node-name">${n}</span><span class="${statusClass}">${status}</span></div>`;
      }).join('');

      // Update threats list
      const threatsList = document.getElementById('threats-list');
      if (game.bots.length === 0) {
        threatsList.innerHTML = '<div class="dim">No active threats</div>';
      } else {
        threatsList.innerHTML = game.bots.slice(0, 5).map(b => {
          const type = BOT_TYPES[b.type];
          return `<div class="node"><span class="node-warn">${type.symbol} ${b.type}#${b.id}</span><span class="dim">‚Üí${b.target}</span></div>`;
        }).join('');
        if (game.bots.length > 5) {
          threatsList.innerHTML += `<div class="dim">+${game.bots.length - 5} more...</div>`;
        }
      }
    }

    function initGame() {
      game.wave = 1;
      game.score = 0;
      game.energy = 100;
      game.integrity = 100;
      game.bots = [];
      game.botIdCounter = 0;

      NODES.forEach(n => {
        game.nodes[n] = { hp: 100, shield: 0 };
      });

      clearOutput();
      log('‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó', 'success');
      log('‚ïë     AEGIS PROTOCOL INITIALIZED - DEFENSE ACTIVE    ‚ïë', 'success');
      log('‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù', 'success');
      log('');
      log('Mainframe defense systems online.', 'system');
      log('Type HELP for command reference.', 'dim');
      log('');
      log('‚ö† WARNING: Incoming hostile traffic detected...', 'warning');
      log('');

      updateUI();
      game.running = true;

      // Start wave
      setTimeout(() => startWave(), 2000);

      // Energy regeneration
      game.energyTimer = setInterval(() => {
        if (game.running && game.energy < game.maxEnergy) {
          game.energy = Math.min(game.maxEnergy, game.energy + 2);
          updateUI();
        }
      }, 1000);

      // Reduce shields
      setInterval(() => {
        if (game.running) {
          NODES.forEach(n => {
            if (game.nodes[n].shield > 0) {
              game.nodes[n].shield--;
              if (game.nodes[n].shield === 0) {
                log(`Shield on ${n} has expired.`, 'warning');
              }
            }
          });
          updateUI();
        }
      }, 1000);
    }

    function startWave() {
      if (!game.running) return;

      log(`‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê WAVE ${game.wave} INCOMING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê`, 'error');

      const botCount = 2 + game.wave * 2;
      const types = Object.keys(BOT_TYPES);
      const availableTypes = types.slice(0, Math.min(game.wave, types.length));

      for (let i = 0; i < botCount; i++) {
        setTimeout(() => {
          if (!game.running) return;
          const type = availableTypes[Math.floor(Math.random() * availableTypes.length)];
          spawnBot(type);
        }, i * 800);
      }

      // Check wave completion
      game.waveTimer = setInterval(() => {
        if (game.bots.length === 0 && game.running) {
          clearInterval(game.waveTimer);
          waveComplete();
        }
      }, 500);
    }

    function spawnBot(type) {
      const bot = {
        id: ++game.botIdCounter,
        type: type,
        hp: BOT_TYPES[type].hp,
        target: NODES[Math.floor(Math.random() * NODES.length)],
        attackTimer: null
      };

      game.bots.push(bot);
      log(`‚ñ∏ ${BOT_TYPES[type].symbol} ${type}#${bot.id} detected targeting ${bot.target}`, 'warning');

      // Start attacking
      bot.attackTimer = setInterval(() => {
        if (!game.running) {
          clearInterval(bot.attackTimer);
          return;
        }
        botAttack(bot);
      }, BOT_TYPES[type].speed);

      updateUI();
    }

    function botAttack(bot) {
      const node = game.nodes[bot.target];
      if (!node) return;

      if (node.shield > 0) {
        log(`${BOT_TYPES[bot.type].symbol} ${bot.type}#${bot.id} attack blocked by shield!`, 'info');
        return;
      }

      const damage = BOT_TYPES[bot.type].damage;
      node.hp = Math.max(0, node.hp - damage);

      log(`‚úñ ${bot.type}#${bot.id} attacked ${bot.target} (-${damage}%)`, 'error');

      if (node.hp <= 0) {
        log(`‚óâ NODE ${bot.target} IS DOWN!`, 'error');
        game.integrity -= 20;
      }

      game.integrity = Math.max(0, game.integrity - damage / 5);
      updateUI();

      if (game.integrity <= 0) {
        gameOver(false);
      }
    }

    function destroyBot(bot) {
      clearInterval(bot.attackTimer);
      game.bots = game.bots.filter(b => b.id !== bot.id);
      game.score += BOT_TYPES[bot.type].points;
      updateUI();
    }

    function waveComplete() {
      if (!game.running) return;

      log('');
      log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê WAVE CLEARED ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'success');
      log(`Score: ${game.score} | Integrity: ${Math.floor(game.integrity)}%`, 'info');

      game.wave++;

      if (game.wave > 10) {
        gameOver(true);
        return;
      }

      // Bonus energy
      game.energy = Math.min(game.maxEnergy, game.energy + 30);
      log('Energy recharged +30', 'success');
      log('');

      setTimeout(() => {
        if (game.running) {
          log(`Preparing for wave ${game.wave}...`, 'system');
          setTimeout(() => startWave(), 3000);
        }
      }, 2000);
    }

    function gameOver(won) {
      game.running = false;
      clearInterval(game.waveTimer);
      clearInterval(game.energyTimer);
      game.bots.forEach(b => clearInterval(b.attackTimer));

      const goScreen = document.getElementById('game-over');
      const goTitle = document.getElementById('go-title');
      const goStats = document.getElementById('go-stats');

      if (won) {
        goTitle.textContent = 'MAINFRAME SECURED';
        goTitle.className = 'go-title go-win';
        document.querySelector('.restart-btn').style.borderColor = '#00ff41';
        document.querySelector('.restart-btn').style.color = '#00ff41';
      } else {
        goTitle.textContent = 'SYSTEM COMPROMISED';
        goTitle.className = 'go-title';
        document.querySelector('.restart-btn').style.borderColor = '#ff4141';
        document.querySelector('.restart-btn').style.color = '#ff4141';
      }

      goStats.innerHTML = `Waves Survived: ${game.wave - 1}<br>Final Score: ${game.score}`;
      goScreen.style.display = 'flex';
    }

    function executeCommand(cmd) {
      const parts = cmd.toUpperCase().trim().split(/\s+/);
      const command = parts[0];
      const arg = parts[1];

      log(`<span class="dim">root@aegis:~$</span> ${cmd}`, '');

      if (!COMMANDS[command] && command !== 'CLEAR') {
        log(`Command not found: ${command}. Type HELP for commands.`, 'error');
        return;
      }

      if (command === 'CLEAR') {
        clearOutput();
        return;
      }

      const cmdInfo = COMMANDS[command];
      if (game.energy < cmdInfo.energy) {
        log(`Insufficient energy! Need ${cmdInfo.energy}, have ${Math.floor(game.energy)}`, 'error');
        return;
      }

      game.energy -= cmdInfo.energy;

      switch (command) {
        case 'HELP':
          log('');
          log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê AEGIS COMMAND MANUAL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
          Object.entries(COMMANDS).forEach(([cmd, info]) => {
            if (cmd === 'NUKE' && game.wave < 5) return;
            log(`<span class="success">${cmd}</span> <span class="dim">[${info.energy} energy]</span>`, '');
            log(`  ${info.desc}`, 'dim');
          });
          log('');
          log('<span class="success">CLEAR</span> - Clear terminal output', '');
          log('');
          break;

        case 'SCAN':
          log('');
          log('‚ñ∏ SCANNING FOR THREATS...', 'info');
          if (game.bots.length === 0) {
            log('  No active threats detected.', 'success');
          } else {
            game.bots.forEach(b => {
              const type = BOT_TYPES[b.type];
              log(`  ${type.symbol} ${b.type}#${b.id} | HP:${b.hp}/${type.hp} | Target:${b.target}`, 'warning');
            });
          }
          log('');
          break;

        case 'PATCH':
          if (!arg) {
            log('Usage: PATCH <NODE>', 'error');
            log('Nodes: ' + NODES.join(', '), 'dim');
            game.energy += cmdInfo.energy;
            break;
          }
          if (!NODES.includes(arg)) {
            log(`Unknown node: ${arg}`, 'error');
            game.energy += cmdInfo.energy;
            break;
          }
          const patchNode = game.nodes[arg];
          if (patchNode.hp >= 100) {
            log(`${arg} is already at full integrity.`, 'warning');
            game.energy += cmdInfo.energy;
            break;
          }
          patchNode.hp = Math.min(100, patchNode.hp + 30);
          log(`‚óà Patching ${arg}... +30% integrity`, 'success');
          if (patchNode.hp > 0) {
            game.integrity = Math.min(100, game.integrity + 5);
          }
          break;

        case 'TRACE':
          if (!arg) {
            log('Usage: TRACE <BOT_ID>', 'error');
            log('Use SCAN to see bot IDs', 'dim');
            game.energy += cmdInfo.energy;
            break;
          }
          const botId = parseInt(arg.replace(/[^0-9]/g, ''));
          const bot = game.bots.find(b => b.id === botId);
          if (!bot) {
            log(`Bot #${botId} not found. Use SCAN.`, 'error');
            game.energy += cmdInfo.energy;
            break;
          }
          bot.hp--;
          log(`‚óà Tracing ${bot.type}#${bot.id}... HIT!`, 'success');
          if (bot.hp <= 0) {
            log(`‚úì ${bot.type}#${bot.id} ELIMINATED (+${BOT_TYPES[bot.type].points} pts)`, 'success');
            destroyBot(bot);
          } else {
            log(`  ${bot.type}#${bot.id} HP: ${bot.hp}/${BOT_TYPES[bot.type].hp}`, 'warning');
          }
          break;

        case 'SHIELD':
          if (!arg) {
            log('Usage: SHIELD <NODE>', 'error');
            log('Nodes: ' + NODES.join(', '), 'dim');
            game.energy += cmdInfo.energy;
            break;
          }
          if (!NODES.includes(arg)) {
            log(`Unknown node: ${arg}`, 'error');
            game.energy += cmdInfo.energy;
            break;
          }
          const shieldNode = game.nodes[arg];
          if (shieldNode.shield > 0) {
            log(`${arg} already has an active shield.`, 'warning');
            game.energy += cmdInfo.energy;
            break;
          }
          shieldNode.shield = 10;
          log(`‚óà Shield deployed on ${arg} (10s)`, 'info');
          break;

        case 'STATUS':
          log('');
          log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SYSTEM STATUS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
          log(`Mainframe Integrity: ${Math.floor(game.integrity)}%`, game.integrity > 50 ? 'success' : 'error');
          log(`Wave: ${game.wave} | Score: ${game.score}`, 'system');
          log(`Energy: ${Math.floor(game.energy)}/${game.maxEnergy}`, 'info');
          log('');
          log('Node Status:', 'system');
          NODES.forEach(n => {
            const node = game.nodes[n];
            const shield = node.shield > 0 ? ` [SHIELD:${node.shield}s]` : '';
            const cls = node.hp > 50 ? 'success' : node.hp > 0 ? 'warning' : 'error';
            log(`  ${n}: ${node.hp}%${shield}`, cls);
          });
          log('');
          break;

        case 'NUKE':
          if (game.wave < 5) {
            log('NUKE command unlocks at wave 5.', 'error');
            game.energy += cmdInfo.energy;
            break;
          }
          log('');
          log('‚óâ EXECUTING EMERGENCY PROTOCOL...', 'error');
          log('‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì NUKE DEPLOYED ‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì‚ñì', 'error');
          game.bots.forEach(b => {
            b.hp -= 2;
            if (b.hp <= 0) {
              log(`‚úì ${b.type}#${b.id} DESTROYED`, 'success');
              destroyBot(b);
            } else {
              log(`  ${b.type}#${b.id} damaged (HP:${b.hp})`, 'warning');
            }
          });
          log('');
          break;
      }

      updateUI();
    }

    // Event listeners
    input.addEventListener('keydown', e => {
      if (e.key === 'Enter' && input.value.trim() && game.running) {
        executeCommand(input.value);
        input.value = '';
      }
    });

    document.getElementById('start-btn').addEventListener('click', () => {
      document.getElementById('start-screen').style.display = 'none';
      initGame();
      input.focus();
    });

    document.getElementById('restart-btn').addEventListener('click', () => {
      document.getElementById('game-over').style.display = 'none';
      initGame();
      input.focus();
    });

    // Focus input on click
    document.getElementById('screen').addEventListener('click', () => {
      if (game.running) input.focus();
    });

    // CRT flicker effect
    setInterval(() => {
      if (Math.random() < 0.02) {
        document.getElementById('crt').classList.add('flicker');
        setTimeout(() => document.getElementById('crt').classList.remove('flicker'), 100);
      }
    }, 500);
  </script>
<script src="/sloppy-header/sloppy-bar.js"></script>
</body>
</html>
