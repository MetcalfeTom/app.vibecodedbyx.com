<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Neon Zen Garden</title>
  <link rel="icon" href="https://emojicdn.elk.sh/üå∏">
  <meta name="description" content="Rake sand patterns and grow fractal trees in this meditative garden">
  <meta property="og:title" content="Neon Zen Garden">
  <meta property="og:description" content="Rake sand patterns and grow fractal trees in this meditative garden">
  <meta property="og:image" content="https://emojicdn.elk.sh/üå∏?style=google">
  <meta property="og:url" content="https://app.sloppy.live/zen-garden">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@300;500&display=swap');

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      min-height: 100vh;
      background: #0a0a12;
      font-family: 'Noto Serif JP', serif;
      color: #fff;
      overflow: hidden;
    }

    .back-link {
      position: fixed;
      top: 10px;
      left: 10px;
      color: rgba(255,255,255,0.3);
      text-decoration: none;
      font-size: 0.8rem;
      z-index: 100;
    }

    .header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      padding: 15px;
      text-align: center;
      background: linear-gradient(180deg, rgba(10,10,18,0.9) 0%, transparent 100%);
      z-index: 50;
      pointer-events: none;
    }

    .title {
      font-size: 1.3rem;
      font-weight: 300;
      letter-spacing: 12px;
      color: #f0f;
      text-shadow: 0 0 30px #f0f;
    }

    .title-jp {
      font-size: 0.65rem;
      color: #666;
      letter-spacing: 8px;
      margin-top: 5px;
    }

    .garden {
      width: 100vw;
      height: 100vh;
      position: relative;
    }

    #sandCanvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    #treeCanvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }

    /* Stones */
    .stone {
      position: absolute;
      border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
      background: linear-gradient(145deg, #2a2a35 0%, #15151a 100%);
      box-shadow:
        inset -5px -5px 15px rgba(0,0,0,0.8),
        inset 5px 5px 15px rgba(255,255,255,0.05),
        0 10px 30px rgba(0,0,0,0.5);
      cursor: pointer;
      transition: box-shadow 0.5s;
      z-index: 10;
    }

    .stone.glowing {
      box-shadow:
        inset -5px -5px 15px rgba(0,0,0,0.8),
        0 0 40px rgba(0,255,255,0.6),
        0 0 80px rgba(255,0,255,0.3);
    }

    /* Toolbar */
    .toolbar {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 8px;
      padding: 12px 18px;
      background: rgba(10,10,18,0.95);
      border: 1px solid rgba(255,0,255,0.3);
      border-radius: 30px;
      box-shadow: 0 0 30px rgba(255,0,255,0.2);
      z-index: 100;
    }

    .tool-btn {
      width: 42px;
      height: 42px;
      background: rgba(255,255,255,0.05);
      border: 1px solid #333;
      border-radius: 50%;
      color: #888;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .tool-btn:hover {
      border-color: #0ff;
      color: #0ff;
    }

    .tool-btn.active {
      background: rgba(0,255,255,0.2);
      border-color: #0ff;
      color: #0ff;
      box-shadow: 0 0 15px rgba(0,255,255,0.4);
    }

    .tool-divider {
      width: 1px;
      background: #333;
      margin: 5px 5px;
    }

    .color-picker {
      display: flex;
      gap: 5px;
      align-items: center;
    }

    .color-btn {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      border: 2px solid transparent;
      cursor: pointer;
      transition: all 0.2s;
    }

    .color-btn:hover { transform: scale(1.15); }
    .color-btn.active {
      border-color: #fff;
      box-shadow: 0 0 10px currentColor;
    }

    .color-btn.cyan { background: #0ff; }
    .color-btn.magenta { background: #f0f; }
    .color-btn.gold { background: #fc0; }
    .color-btn.green { background: #0f0; }

    .instructions {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.55rem;
      color: #444;
      letter-spacing: 2px;
      text-align: center;
    }

    /* Petals */
    .petal {
      position: absolute;
      width: 8px;
      height: 8px;
      background: radial-gradient(ellipse, #f9c, #f6a);
      border-radius: 50% 0 50% 50%;
      pointer-events: none;
      opacity: 0.6;
      animation: petalFall linear forwards;
      filter: drop-shadow(0 0 3px #f0f);
    }

    @keyframes petalFall {
      0% { transform: translateY(-20px) rotate(0deg); opacity: 0; }
      10% { opacity: 0.6; }
      90% { opacity: 0.6; }
      100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
    }
  </style>
</head>
<body>
  <a href="https://sloppy.live" class="back-link">‚Üê exit</a>

  <div class="header">
    <div class="title">ZEN GARDEN</div>
    <div class="title-jp">ÊûØÂ±±Ê∞¥</div>
  </div>

  <div class="garden" id="garden">
    <canvas id="sandCanvas"></canvas>
    <canvas id="treeCanvas"></canvas>
  </div>

  <div class="instructions">DRAG TO RAKE SAND ‚Ä¢ CLICK WITH TREE TOOL TO PLANT</div>

  <div class="toolbar">
    <button class="tool-btn active" data-tool="rake" title="Rake">„Ä∞Ô∏è</button>
    <button class="tool-btn" data-tool="circle" title="Circle Pattern">‚≠ï</button>
    <button class="tool-btn" data-tool="smooth" title="Smooth">üåä</button>
    <button class="tool-btn" data-tool="tree" title="Plant Tree">üå≥</button>

    <div class="tool-divider"></div>

    <div class="color-picker">
      <div class="color-btn cyan active" data-color="#0ff"></div>
      <div class="color-btn magenta" data-color="#f0f"></div>
      <div class="color-btn gold" data-color="#fc0"></div>
      <div class="color-btn green" data-color="#0f0"></div>
    </div>

    <div class="tool-divider"></div>

    <button class="tool-btn" onclick="clearGarden()" title="Clear All">üóëÔ∏è</button>
  </div>

  <script>
    const sandCanvas = document.getElementById('sandCanvas');
    const sandCtx = sandCanvas.getContext('2d');
    const treeCanvas = document.getElementById('treeCanvas');
    const treeCtx = treeCanvas.getContext('2d');

    let currentTool = 'rake';
    let currentColor = '#0ff';
    let isDrawing = false;
    let lastX = 0, lastY = 0;
    let trees = [];

    // Resize
    function resize() {
      sandCanvas.width = window.innerWidth;
      sandCanvas.height = window.innerHeight;
      treeCanvas.width = window.innerWidth;
      treeCanvas.height = window.innerHeight;
      drawSandBase();
      redrawTrees();
    }
    window.addEventListener('resize', resize);

    // Sand base
    function drawSandBase() {
      const gradient = sandCtx.createRadialGradient(
        sandCanvas.width/2, sandCanvas.height/2, 0,
        sandCanvas.width/2, sandCanvas.height/2, sandCanvas.width * 0.7
      );
      gradient.addColorStop(0, '#18181f');
      gradient.addColorStop(1, '#0e0e14');
      sandCtx.fillStyle = gradient;
      sandCtx.fillRect(0, 0, sandCanvas.width, sandCanvas.height);

      // Texture noise
      for (let i = 0; i < 8000; i++) {
        sandCtx.fillStyle = `rgba(255,255,255,${Math.random() * 0.025})`;
        sandCtx.fillRect(Math.random() * sandCanvas.width, Math.random() * sandCanvas.height, 1, 1);
      }
    }

    // Stones
    function createStones() {
      const stoneData = [
        { x: '12%', y: '25%', w: 70, h: 55 },
        { x: '80%', y: '20%', w: 55, h: 42 },
        { x: '85%', y: '65%', w: 65, h: 50 },
        { x: '20%', y: '72%', w: 48, h: 38 },
        { x: '55%', y: '78%', w: 60, h: 48 }
      ];

      stoneData.forEach(data => {
        const stone = document.createElement('div');
        stone.className = 'stone';
        stone.style.left = data.x;
        stone.style.top = data.y;
        stone.style.width = data.w + 'px';
        stone.style.height = data.h + 'px';
        stone.style.transform = `rotate(${Math.random() * 30 - 15}deg)`;
        stone.onclick = (e) => { e.stopPropagation(); stone.classList.toggle('glowing'); };
        document.getElementById('garden').appendChild(stone);
      });
    }

    // Rake tool
    function rake(x, y, px, py) {
      const dx = x - px, dy = y - py;
      const dist = Math.sqrt(dx*dx + dy*dy);
      if (dist < 3) return;

      const angle = Math.atan2(dy, dx);
      const perp = angle + Math.PI / 2;

      sandCtx.strokeStyle = currentColor;
      sandCtx.lineWidth = 2;
      sandCtx.lineCap = 'round';
      sandCtx.shadowBlur = 12;
      sandCtx.shadowColor = currentColor;

      for (let i = -4; i <= 4; i++) {
        const off = i * 5;
        sandCtx.globalAlpha = 0.25 + (1 - Math.abs(i)/4) * 0.35;
        sandCtx.beginPath();
        sandCtx.moveTo(px + Math.cos(perp)*off, py + Math.sin(perp)*off);
        sandCtx.lineTo(x + Math.cos(perp)*off, y + Math.sin(perp)*off);
        sandCtx.stroke();
      }
      sandCtx.globalAlpha = 1;
      sandCtx.shadowBlur = 0;
    }

    // Circle tool
    function drawCircle(x, y) {
      sandCtx.strokeStyle = currentColor;
      sandCtx.lineWidth = 2;
      sandCtx.shadowBlur = 15;
      sandCtx.shadowColor = currentColor;

      for (let r = 15; r < 90; r += 12) {
        sandCtx.globalAlpha = 0.5 - r/180;
        sandCtx.beginPath();
        sandCtx.arc(x, y, r, 0, Math.PI * 2);
        sandCtx.stroke();
      }
      sandCtx.globalAlpha = 1;
      sandCtx.shadowBlur = 0;
    }

    // Smooth tool
    function smooth(x, y) {
      sandCtx.shadowBlur = 25;
      sandCtx.shadowColor = currentColor;
      const grad = sandCtx.createRadialGradient(x, y, 0, x, y, 35);
      grad.addColorStop(0, currentColor);
      grad.addColorStop(1, 'transparent');
      sandCtx.fillStyle = grad;
      sandCtx.globalAlpha = 0.3;
      sandCtx.beginPath();
      sandCtx.arc(x, y, 35, 0, Math.PI * 2);
      sandCtx.fill();
      sandCtx.globalAlpha = 1;
      sandCtx.shadowBlur = 0;
    }

    // Fractal tree
    function plantTree(x, y) {
      trees.push({ x, y, color: currentColor, progress: 0 });
      animateTrees();
    }

    function animateTrees() {
      let growing = false;
      trees.forEach(t => {
        if (t.progress < 1) {
          t.progress += 0.015;
          growing = true;
        }
      });
      redrawTrees();
      if (growing) requestAnimationFrame(animateTrees);
    }

    function redrawTrees() {
      treeCtx.clearRect(0, 0, treeCanvas.width, treeCanvas.height);
      trees.forEach(t => drawBranch(treeCtx, t.x, t.y, -Math.PI/2, 70, 0, 7, t.color, t.progress));
    }

    function drawBranch(ctx, x, y, angle, len, depth, maxD, color, prog) {
      if (depth > maxD || len < 3) return;
      const dp = Math.min(1, prog * (maxD + 1) - depth);
      if (dp <= 0) return;

      const ex = x + Math.cos(angle) * len * dp;
      const ey = y + Math.sin(angle) * len * dp;

      ctx.strokeStyle = color;
      ctx.lineWidth = Math.max(1, (maxD - depth) * 1.2);
      ctx.lineCap = 'round';
      ctx.shadowBlur = 8;
      ctx.shadowColor = color;
      ctx.globalAlpha = 0.85;

      ctx.beginPath();
      ctx.moveTo(x, y);
      ctx.lineTo(ex, ey);
      ctx.stroke();

      if (dp >= 1) {
        const spread = 0.4 + Math.random() * 0.15;
        drawBranch(ctx, ex, ey, angle - spread, len * 0.72, depth + 1, maxD, color, prog);
        drawBranch(ctx, ex, ey, angle + spread, len * 0.72, depth + 1, maxD, color, prog);
        if (depth < 2 && Math.random() > 0.6) {
          drawBranch(ctx, ex, ey, angle + (Math.random()-0.5)*0.4, len * 0.5, depth + 2, maxD, color, prog);
        }
      }

      // Leaves at tips
      if (depth >= maxD - 1 && dp >= 0.9) {
        ctx.fillStyle = color;
        ctx.shadowBlur = 12;
        ctx.beginPath();
        ctx.arc(ex, ey, 4 - depth * 0.3, 0, Math.PI * 2);
        ctx.fill();
      }

      ctx.shadowBlur = 0;
      ctx.globalAlpha = 1;
    }

    // Event handlers
    sandCanvas.addEventListener('mousedown', e => {
      if (currentTool === 'tree') { plantTree(e.clientX, e.clientY); return; }
      if (currentTool === 'circle') { drawCircle(e.clientX, e.clientY); return; }
      isDrawing = true;
      lastX = e.clientX; lastY = e.clientY;
    });

    sandCanvas.addEventListener('mousemove', e => {
      if (!isDrawing) return;
      if (currentTool === 'rake') rake(e.clientX, e.clientY, lastX, lastY);
      if (currentTool === 'smooth') smooth(e.clientX, e.clientY);
      lastX = e.clientX; lastY = e.clientY;
    });

    sandCanvas.addEventListener('mouseup', () => isDrawing = false);
    sandCanvas.addEventListener('mouseleave', () => isDrawing = false);

    // Touch
    sandCanvas.addEventListener('touchstart', e => {
      e.preventDefault();
      const t = e.touches[0];
      if (currentTool === 'tree') { plantTree(t.clientX, t.clientY); return; }
      if (currentTool === 'circle') { drawCircle(t.clientX, t.clientY); return; }
      isDrawing = true;
      lastX = t.clientX; lastY = t.clientY;
    }, { passive: false });

    sandCanvas.addEventListener('touchmove', e => {
      e.preventDefault();
      if (!isDrawing) return;
      const t = e.touches[0];
      if (currentTool === 'rake') rake(t.clientX, t.clientY, lastX, lastY);
      if (currentTool === 'smooth') smooth(t.clientX, t.clientY);
      lastX = t.clientX; lastY = t.clientY;
    }, { passive: false });

    sandCanvas.addEventListener('touchend', () => isDrawing = false);

    // Tool buttons
    document.querySelectorAll('.tool-btn[data-tool]').forEach(btn => {
      btn.onclick = () => {
        document.querySelectorAll('.tool-btn[data-tool]').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentTool = btn.dataset.tool;
        sandCanvas.style.cursor = currentTool === 'tree' ? 'crosshair' : 'default';
      };
    });

    // Color buttons
    document.querySelectorAll('.color-btn').forEach(btn => {
      btn.onclick = () => {
        document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentColor = btn.dataset.color;
      };
    });

    // Clear
    function clearGarden() {
      drawSandBase();
      trees = [];
      redrawTrees();
    }

    // Cherry blossom petals
    function spawnPetal() {
      const petal = document.createElement('div');
      petal.className = 'petal';
      petal.style.left = Math.random() * 100 + '%';
      petal.style.animationDuration = (6 + Math.random() * 6) + 's';
      document.getElementById('garden').appendChild(petal);
      setTimeout(() => petal.remove(), 12000);
    }
    setInterval(spawnPetal, 2500);
    for (let i = 0; i < 4; i++) setTimeout(spawnPetal, i * 600);

    // Init
    resize();
    createStones();
  </script>
<script src="/sloppy-header/sloppy-bar.js"></script>
<script src="/vibelib-extended.js"></script>
<script>
  // Compatibility Patch for Legacy Apps
  window.addEventListener("load", () => {
    if (window.SloppyKarma && window.VibeLib.Economy) {
      // Redirect old calls to new engine
      window.SloppyKarma.track = window.VibeLib.Economy.track;
    }
  });
</script>
</body>
</html>
