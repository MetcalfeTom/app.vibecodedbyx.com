<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Orbital Strike - Neon Space Shooter</title>
  <link rel="icon" href="https://emojicdn.elk.sh/üöÄ">
  <meta property="og:title" content="Orbital Strike">
  <meta property="og:description" content="Epic neon space shooter with powerups and boss fights">
  <meta property="og:url" content="https://sloppy.live/orbital-strike">
  <meta property="og:image" content="https://emojicdn.elk.sh/üöÄ?style=apple&size=512">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: #0a0a12;
      font-family: 'Orbitron', sans-serif;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    canvas {
      display: block;
      max-width: 100vw;
      max-height: 100vh;
    }
    .ui {
      position: fixed;
      top: 10px;
      left: 10px;
      color: #0ff;
      font-size: 14px;
      text-shadow: 0 0 10px #0ff;
      z-index: 100;
    }
    .score { font-size: 24px; font-weight: 900; }
    .wave { color: #f0f; text-shadow: 0 0 10px #f0f; margin-top: 5px; }
    .powerups {
      position: fixed;
      top: 10px;
      right: 10px;
      display: flex;
      gap: 8px;
      z-index: 100;
    }
    .powerup-icon {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
      opacity: 0.3;
      border: 2px solid;
      transition: opacity 0.3s;
    }
    .powerup-icon.active { opacity: 1; box-shadow: 0 0 15px; }
    .powerup-icon.shield { border-color: #0ff; color: #0ff; }
    .powerup-icon.rapid { border-color: #f0f; color: #f0f; }
    .powerup-icon.spread { border-color: #0f0; color: #0f0; }
    .powerup-icon.bomb { border-color: #f80; color: #f80; }
    .boss-health {
      position: fixed;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      width: 300px;
      height: 20px;
      background: rgba(255,0,0,0.2);
      border: 2px solid #f00;
      border-radius: 10px;
      overflow: hidden;
      display: none;
      z-index: 100;
    }
    .boss-health-bar {
      height: 100%;
      background: linear-gradient(90deg, #f00, #f80);
      box-shadow: 0 0 20px #f00;
      transition: width 0.2s;
    }
    .boss-name {
      position: fixed;
      top: 85px;
      left: 50%;
      transform: translateX(-50%);
      color: #f00;
      font-size: 12px;
      text-shadow: 0 0 10px #f00;
      display: none;
      z-index: 100;
    }
    .game-over, .start-screen {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      z-index: 200;
    }
    .game-over { display: none; }
    .game-over h1, .start-screen h1 {
      font-size: 48px;
      color: #f0f;
      text-shadow: 0 0 30px #f0f, 0 0 60px #f0f;
      margin-bottom: 20px;
    }
    .game-over p, .start-screen p {
      color: #0ff;
      font-size: 18px;
      text-shadow: 0 0 10px #0ff;
      margin-bottom: 30px;
    }
    .btn {
      background: transparent;
      border: 2px solid #0ff;
      color: #0ff;
      padding: 15px 40px;
      font-family: 'Orbitron', sans-serif;
      font-size: 18px;
      cursor: pointer;
      text-shadow: 0 0 10px #0ff;
      box-shadow: 0 0 20px rgba(0,255,255,0.3);
      transition: all 0.3s;
    }
    .btn:hover {
      background: rgba(0,255,255,0.2);
      box-shadow: 0 0 40px rgba(0,255,255,0.5);
    }
    .controls-hint {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      color: rgba(255,255,255,0.4);
      font-size: 11px;
      z-index: 100;
    }
    .mobile-controls {
      position: fixed;
      bottom: 20px;
      left: 0;
      right: 0;
      display: none;
      justify-content: space-between;
      padding: 0 20px;
      z-index: 100;
    }
    .mobile-btn {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      background: rgba(0,255,255,0.2);
      border: 2px solid #0ff;
      color: #0ff;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .mobile-dpad {
      display: flex;
      gap: 5px;
    }
    .mobile-dpad .mobile-btn { width: 55px; height: 55px; }
    @media (max-width: 768px) {
      .mobile-controls { display: flex; }
      .controls-hint { display: none; }
    }
    .backlink {
      position: fixed;
      bottom: 10px;
      left: 10px;
      color: rgba(255,255,255,0.3);
      font-size: 10px;
      text-decoration: none;
      z-index: 100;
    }
  </style>
</head>
<body>
  <div class="ui">
    <div class="score" id="score">0</div>
    <div class="wave" id="wave">WAVE 1</div>
    <div id="lives">‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
  </div>

  <div class="powerups">
    <div class="powerup-icon shield" id="pw-shield">üõ°Ô∏è</div>
    <div class="powerup-icon rapid" id="pw-rapid">‚ö°</div>
    <div class="powerup-icon spread" id="pw-spread">üî±</div>
    <div class="powerup-icon bomb" id="pw-bomb">üí£</div>
  </div>

  <div class="boss-health" id="boss-health">
    <div class="boss-health-bar" id="boss-health-bar"></div>
  </div>
  <div class="boss-name" id="boss-name">DESTROYER</div>

  <canvas id="game"></canvas>

  <div class="start-screen" id="start-screen">
    <h1>ORBITAL STRIKE</h1>
    <p>Survive the neon onslaught</p>
    <button class="btn" id="start-btn">LAUNCH</button>
  </div>

  <div class="game-over" id="game-over">
    <h1>GAME OVER</h1>
    <p>Final Score: <span id="final-score">0</span></p>
    <button class="btn" id="restart-btn">TRY AGAIN</button>
  </div>

  <div class="controls-hint">WASD/Arrows to move ‚Ä¢ Space to fire ‚Ä¢ B for bomb</div>

  <div class="mobile-controls" id="mobile-controls">
    <div class="mobile-dpad">
      <button class="mobile-btn" id="m-left">‚óÄ</button>
      <div style="display:flex;flex-direction:column;gap:5px;">
        <button class="mobile-btn" id="m-up">‚ñ≤</button>
        <button class="mobile-btn" id="m-down">‚ñº</button>
      </div>
      <button class="mobile-btn" id="m-right">‚ñ∂</button>
    </div>
    <div style="display:flex;gap:10px;">
      <button class="mobile-btn" id="m-bomb">üí£</button>
      <button class="mobile-btn" id="m-fire" style="width:80px;height:80px;font-size:28px;">üî•</button>
    </div>
  </div>

  <a href="https://sloppy.live" class="backlink">sloppy.live</a>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    function resize() {
      canvas.width = Math.min(window.innerWidth, 800);
      canvas.height = Math.min(window.innerHeight, 900);
    }
    resize();
    window.addEventListener('resize', resize);

    // Game state
    let gameRunning = false;
    let score = 0;
    let wave = 1;
    let lives = 3;
    let gameTime = 0;

    // Player
    const player = {
      x: 0, y: 0, width: 40, height: 50,
      vx: 0, vy: 0, speed: 300,
      fireRate: 150, lastFire: 0,
      shield: false, shieldTime: 0,
      rapid: false, rapidTime: 0,
      spread: false, spreadTime: 0,
      bombs: 1, invincible: 0
    };

    // Game objects
    let bullets = [];
    let enemies = [];
    let particles = [];
    let powerups = [];
    let enemyBullets = [];
    let stars = [];
    let boss = null;

    // Input
    const keys = { up: false, down: false, left: false, right: false, fire: false };

    // Colors
    const NEON = {
      cyan: '#0ff', magenta: '#f0f', green: '#0f0',
      orange: '#f80', red: '#f00', yellow: '#ff0', white: '#fff'
    };

    // Initialize stars
    function initStars() {
      stars = [];
      for (let i = 0; i < 100; i++) {
        stars.push({
          x: Math.random() * canvas.width,
          y: Math.random() * canvas.height,
          size: Math.random() * 2 + 0.5,
          speed: Math.random() * 100 + 50
        });
      }
    }

    // Enemy types
    const ENEMY_TYPES = {
      scout: { width: 30, height: 30, hp: 1, speed: 150, score: 100, color: NEON.cyan, pattern: 'straight' },
      fighter: { width: 35, height: 35, hp: 2, speed: 120, score: 200, color: NEON.magenta, pattern: 'zigzag' },
      bomber: { width: 45, height: 40, hp: 3, speed: 80, score: 300, color: NEON.orange, pattern: 'straight', shoots: true },
      elite: { width: 40, height: 40, hp: 5, speed: 100, score: 500, color: NEON.green, pattern: 'sine' }
    };

    const BOSS_TYPES = [
      { name: 'DESTROYER', width: 120, height: 80, hp: 50, color: NEON.red },
      { name: 'OVERLORD', width: 140, height: 90, hp: 80, color: NEON.magenta },
      { name: 'TITAN', width: 160, height: 100, hp: 120, color: NEON.orange }
    ];

    // Spawn functions
    function spawnEnemy(type) {
      const t = ENEMY_TYPES[type];
      enemies.push({
        x: Math.random() * (canvas.width - t.width),
        y: -t.height,
        width: t.width, height: t.height,
        hp: t.hp + Math.floor(wave / 3),
        maxHp: t.hp + Math.floor(wave / 3),
        speed: t.speed + wave * 5,
        score: t.score,
        color: t.color,
        pattern: t.pattern,
        shoots: t.shoots,
        time: Math.random() * 100,
        lastShot: 0
      });
    }

    function spawnBoss() {
      const bt = BOSS_TYPES[Math.min(Math.floor(wave / 5), BOSS_TYPES.length - 1)];
      boss = {
        x: canvas.width / 2 - bt.width / 2,
        y: -bt.height,
        width: bt.width, height: bt.height,
        hp: bt.hp + wave * 10,
        maxHp: bt.hp + wave * 10,
        color: bt.color,
        name: bt.name,
        phase: 0, time: 0, lastShot: 0,
        entering: true
      };
      document.getElementById('boss-health').style.display = 'block';
      document.getElementById('boss-name').style.display = 'block';
      document.getElementById('boss-name').textContent = bt.name;
    }

    function spawnPowerup(x, y) {
      const types = ['shield', 'rapid', 'spread', 'bomb', 'life'];
      const type = types[Math.floor(Math.random() * types.length)];
      const colors = { shield: NEON.cyan, rapid: NEON.magenta, spread: NEON.green, bomb: NEON.orange, life: NEON.red };
      powerups.push({ x, y, type, color: colors[type], width: 25, height: 25, time: 0 });
    }

    function spawnParticles(x, y, color, count = 10) {
      for (let i = 0; i < count; i++) {
        const angle = Math.random() * Math.PI * 2;
        const speed = Math.random() * 200 + 50;
        particles.push({
          x, y, vx: Math.cos(angle) * speed, vy: Math.sin(angle) * speed,
          color, size: Math.random() * 4 + 2, life: 1
        });
      }
    }

    function fireBullet() {
      const now = Date.now();
      const rate = player.rapid ? player.fireRate / 3 : player.fireRate;
      if (now - player.lastFire < rate) return;
      player.lastFire = now;

      const bx = player.x + player.width / 2;
      const by = player.y;

      if (player.spread) {
        [-20, 0, 20].forEach(angle => {
          const rad = angle * Math.PI / 180;
          bullets.push({ x: bx - 3, y: by, vx: Math.sin(rad) * 100, vy: -500, width: 6, height: 15, color: NEON.green });
        });
      } else {
        bullets.push({ x: bx - 3, y: by, vx: 0, vy: -600, width: 6, height: 15, color: NEON.cyan });
      }
    }

    function useBomb() {
      if (player.bombs <= 0) return;
      player.bombs--;
      
      // Screen flash
      spawnParticles(canvas.width / 2, canvas.height / 2, NEON.orange, 100);
      
      // Damage all enemies
      enemies.forEach(e => {
        e.hp -= 10;
        spawnParticles(e.x + e.width / 2, e.y + e.height / 2, e.color, 15);
      });
      enemies = enemies.filter(e => e.hp > 0);
      
      // Damage boss
      if (boss) {
        boss.hp -= 20;
        spawnParticles(boss.x + boss.width / 2, boss.y + boss.height / 2, boss.color, 30);
      }
      
      // Clear enemy bullets
      enemyBullets = [];
      
      updatePowerupUI();
    }

    function updatePowerupUI() {
      document.getElementById('pw-shield').classList.toggle('active', player.shield);
      document.getElementById('pw-rapid').classList.toggle('active', player.rapid);
      document.getElementById('pw-spread').classList.toggle('active', player.spread);
      document.getElementById('pw-bomb').classList.toggle('active', player.bombs > 0);
    }

    function collectPowerup(p) {
      switch (p.type) {
        case 'shield': player.shield = true; player.shieldTime = 8; break;
        case 'rapid': player.rapid = true; player.rapidTime = 10; break;
        case 'spread': player.spread = true; player.spreadTime = 8; break;
        case 'bomb': player.bombs = Math.min(player.bombs + 1, 3); break;
        case 'life': lives = Math.min(lives + 1, 5); updateLives(); break;
      }
      spawnParticles(p.x, p.y, p.color, 20);
      updatePowerupUI();
    }

    function updateLives() {
      document.getElementById('lives').textContent = '‚ù§Ô∏è'.repeat(lives);
    }

    function playerHit() {
      if (player.shield || player.invincible > 0) return;
      lives--;
      player.invincible = 2;
      spawnParticles(player.x + player.width / 2, player.y + player.height / 2, NEON.red, 30);
      updateLives();
      if (lives <= 0) gameOver();
    }

    function gameOver() {
      gameRunning = false;
      document.getElementById('final-score').textContent = score;
      document.getElementById('game-over').style.display = 'block';
    }

    function startGame() {
      gameRunning = true;
      score = 0;
      wave = 1;
      lives = 3;
      gameTime = 0;
      player.x = canvas.width / 2 - player.width / 2;
      player.y = canvas.height - 100;
      player.shield = false;
      player.rapid = false;
      player.spread = false;
      player.bombs = 1;
      player.invincible = 0;
      bullets = [];
      enemies = [];
      particles = [];
      powerups = [];
      enemyBullets = [];
      boss = null;
      initStars();
      updateLives();
      updatePowerupUI();
      document.getElementById('start-screen').style.display = 'none';
      document.getElementById('game-over').style.display = 'none';
      document.getElementById('boss-health').style.display = 'none';
      document.getElementById('boss-name').style.display = 'none';
    }

    // Collision detection
    function collides(a, b) {
      return a.x < b.x + b.width && a.x + a.width > b.x &&
             a.y < b.y + b.height && a.y + a.height > b.y;
    }

    // Update
    let waveTimer = 0;
    let enemiesThisWave = 0;
    let enemiesKilledThisWave = 0;

    function update(dt) {
      if (!gameRunning) return;
      gameTime += dt;
      waveTimer += dt;

      // Player movement
      player.vx = 0;
      player.vy = 0;
      if (keys.left) player.vx = -player.speed;
      if (keys.right) player.vx = player.speed;
      if (keys.up) player.vy = -player.speed;
      if (keys.down) player.vy = player.speed;

      player.x += player.vx * dt;
      player.y += player.vy * dt;
      player.x = Math.max(0, Math.min(canvas.width - player.width, player.x));
      player.y = Math.max(canvas.height / 2, Math.min(canvas.height - player.height - 10, player.y));

      // Powerup timers
      if (player.shield) { player.shieldTime -= dt; if (player.shieldTime <= 0) player.shield = false; }
      if (player.rapid) { player.rapidTime -= dt; if (player.rapidTime <= 0) player.rapid = false; }
      if (player.spread) { player.spreadTime -= dt; if (player.spreadTime <= 0) player.spread = false; }
      if (player.invincible > 0) player.invincible -= dt;
      updatePowerupUI();

      // Auto-fire
      if (keys.fire) fireBullet();

      // Wave spawning
      const enemiesPerWave = 10 + wave * 3;
      const bossWave = wave % 5 === 0;

      if (!boss && enemiesThisWave < enemiesPerWave && waveTimer > 1) {
        waveTimer = 0;
        const types = ['scout'];
        if (wave >= 2) types.push('fighter');
        if (wave >= 3) types.push('bomber');
        if (wave >= 5) types.push('elite');
        spawnEnemy(types[Math.floor(Math.random() * types.length)]);
        enemiesThisWave++;
      }

      // Boss wave
      if (bossWave && enemies.length === 0 && !boss && enemiesThisWave >= enemiesPerWave) {
        spawnBoss();
      }

      // Next wave
      if (!bossWave && enemies.length === 0 && enemiesThisWave >= enemiesPerWave) {
        wave++;
        enemiesThisWave = 0;
        document.getElementById('wave').textContent = `WAVE ${wave}`;
      }

      // Update bullets
      bullets.forEach(b => { b.x += b.vx * dt; b.y += b.vy * dt; });
      bullets = bullets.filter(b => b.y > -20 && b.y < canvas.height + 20 && b.x > -20 && b.x < canvas.width + 20);

      // Update enemies
      enemies.forEach(e => {
        e.time += dt;
        let moveX = 0;
        if (e.pattern === 'zigzag') moveX = Math.sin(e.time * 3) * 100;
        else if (e.pattern === 'sine') moveX = Math.sin(e.time * 2) * 150;
        e.y += e.speed * dt;
        e.x += moveX * dt;
        e.x = Math.max(0, Math.min(canvas.width - e.width, e.x));

        // Enemy shooting
        if (e.shoots && e.time - e.lastShot > 2) {
          e.lastShot = e.time;
          enemyBullets.push({
            x: e.x + e.width / 2 - 4, y: e.y + e.height,
            vx: 0, vy: 200, width: 8, height: 12, color: NEON.orange
          });
        }
      });
      enemies = enemies.filter(e => e.y < canvas.height + 50);

      // Update boss
      if (boss) {
        boss.time += dt;
        if (boss.entering) {
          boss.y += 50 * dt;
          if (boss.y >= 30) boss.entering = false;
        } else {
          boss.x += Math.sin(boss.time) * 100 * dt;
          boss.x = Math.max(0, Math.min(canvas.width - boss.width, boss.x));

          // Boss shooting patterns
          if (boss.time - boss.lastShot > 0.5) {
            boss.lastShot = boss.time;
            const cx = boss.x + boss.width / 2;
            const cy = boss.y + boss.height;
            
            // Different patterns based on HP
            if (boss.hp > boss.maxHp * 0.5) {
              // Spread shot
              for (let i = -2; i <= 2; i++) {
                enemyBullets.push({
                  x: cx - 4, y: cy, vx: i * 60, vy: 180,
                  width: 8, height: 12, color: boss.color
                });
              }
            } else {
              // Spiral shot
              for (let i = 0; i < 8; i++) {
                const angle = (boss.time * 2 + i * Math.PI / 4);
                enemyBullets.push({
                  x: cx - 4, y: cy,
                  vx: Math.sin(angle) * 120,
                  vy: Math.cos(angle) * 60 + 100,
                  width: 8, height: 12, color: boss.color
                });
              }
            }
          }
        }

        // Update boss health bar
        const pct = (boss.hp / boss.maxHp) * 100;
        document.getElementById('boss-health-bar').style.width = pct + '%';

        // Boss defeated
        if (boss.hp <= 0) {
          score += 5000 * wave;
          spawnParticles(boss.x + boss.width / 2, boss.y + boss.height / 2, boss.color, 100);
          for (let i = 0; i < 3; i++) spawnPowerup(boss.x + Math.random() * boss.width, boss.y + boss.height / 2);
          boss = null;
          wave++;
          enemiesThisWave = 0;
          document.getElementById('wave').textContent = `WAVE ${wave}`;
          document.getElementById('boss-health').style.display = 'none';
          document.getElementById('boss-name').style.display = 'none';
        }
      }

      // Update enemy bullets
      enemyBullets.forEach(b => { b.x += b.vx * dt; b.y += b.vy * dt; });
      enemyBullets = enemyBullets.filter(b => b.y > -20 && b.y < canvas.height + 20 && b.x > -20 && b.x < canvas.width + 20);

      // Bullet-enemy collision
      bullets.forEach(b => {
        enemies.forEach(e => {
          if (collides(b, e)) {
            b.dead = true;
            e.hp--;
            spawnParticles(b.x, b.y, e.color, 5);
            if (e.hp <= 0) {
              score += e.score;
              spawnParticles(e.x + e.width / 2, e.y + e.height / 2, e.color, 20);
              if (Math.random() < 0.15) spawnPowerup(e.x + e.width / 2, e.y + e.height / 2);
              e.dead = true;
            }
          }
        });
        // Boss collision
        if (boss && !boss.entering && collides(b, boss)) {
          b.dead = true;
          boss.hp--;
          spawnParticles(b.x, b.y, boss.color, 3);
        }
      });
      bullets = bullets.filter(b => !b.dead);
      enemies = enemies.filter(e => !e.dead);

      // Player-enemy collision
      enemies.forEach(e => {
        if (collides(player, e)) {
          playerHit();
          e.dead = true;
          spawnParticles(e.x + e.width / 2, e.y + e.height / 2, e.color, 15);
        }
      });
      enemies = enemies.filter(e => !e.dead);

      // Player-enemy bullet collision
      enemyBullets.forEach(b => {
        if (collides(player, b)) {
          playerHit();
          b.dead = true;
          spawnParticles(b.x, b.y, NEON.red, 10);
        }
      });
      enemyBullets = enemyBullets.filter(b => !b.dead);

      // Powerup collection
      powerups.forEach(p => {
        p.time += dt;
        p.y += 50 * dt;
        if (collides(player, p)) {
          collectPowerup(p);
          p.dead = true;
        }
      });
      powerups = powerups.filter(p => !p.dead && p.y < canvas.height + 50);

      // Update particles
      particles.forEach(p => {
        p.x += p.vx * dt;
        p.y += p.vy * dt;
        p.life -= dt * 2;
      });
      particles = particles.filter(p => p.life > 0);

      // Update stars
      stars.forEach(s => {
        s.y += s.speed * dt;
        if (s.y > canvas.height) { s.y = 0; s.x = Math.random() * canvas.width; }
      });

      // Update score display
      document.getElementById('score').textContent = score;
    }

    // Draw functions
    function drawGlow(x, y, w, h, color, blur = 15) {
      ctx.shadowColor = color;
      ctx.shadowBlur = blur;
    }

    function drawPlayer() {
      const cx = player.x + player.width / 2;
      const cy = player.y + player.height / 2;

      // Shield effect
      if (player.shield) {
        ctx.strokeStyle = NEON.cyan;
        ctx.lineWidth = 2;
        drawGlow(0, 0, 0, 0, NEON.cyan, 20);
        ctx.beginPath();
        ctx.arc(cx, cy, 35, 0, Math.PI * 2);
        ctx.stroke();
        ctx.shadowBlur = 0;
      }

      // Ship body
      drawGlow(0, 0, 0, 0, NEON.cyan, 15);
      ctx.fillStyle = NEON.cyan;
      ctx.beginPath();
      ctx.moveTo(cx, player.y);
      ctx.lineTo(player.x + player.width, player.y + player.height);
      ctx.lineTo(cx, player.y + player.height - 15);
      ctx.lineTo(player.x, player.y + player.height);
      ctx.closePath();
      ctx.fill();

      // Cockpit
      ctx.fillStyle = NEON.magenta;
      drawGlow(0, 0, 0, 0, NEON.magenta, 10);
      ctx.beginPath();
      ctx.arc(cx, cy + 5, 8, 0, Math.PI * 2);
      ctx.fill();

      // Engine glow
      ctx.fillStyle = NEON.orange;
      drawGlow(0, 0, 0, 0, NEON.orange, 20);
      ctx.beginPath();
      ctx.moveTo(cx - 8, player.y + player.height);
      ctx.lineTo(cx, player.y + player.height + 15 + Math.random() * 10);
      ctx.lineTo(cx + 8, player.y + player.height);
      ctx.fill();

      // Invincibility flash
      if (player.invincible > 0 && Math.floor(player.invincible * 10) % 2) {
        ctx.fillStyle = 'rgba(255,255,255,0.5)';
        ctx.fillRect(player.x, player.y, player.width, player.height);
      }

      ctx.shadowBlur = 0;
    }

    function drawEnemy(e) {
      drawGlow(0, 0, 0, 0, e.color, 15);
      ctx.fillStyle = e.color;

      const cx = e.x + e.width / 2;
      const cy = e.y + e.height / 2;

      // Enemy ship shape
      ctx.beginPath();
      ctx.moveTo(cx, e.y + e.height);
      ctx.lineTo(e.x, e.y);
      ctx.lineTo(cx, e.y + 10);
      ctx.lineTo(e.x + e.width, e.y);
      ctx.closePath();
      ctx.fill();

      // Health bar for tough enemies
      if (e.maxHp > 1) {
        const pct = e.hp / e.maxHp;
        ctx.fillStyle = 'rgba(255,0,0,0.5)';
        ctx.fillRect(e.x, e.y - 8, e.width, 4);
        ctx.fillStyle = NEON.green;
        ctx.fillRect(e.x, e.y - 8, e.width * pct, 4);
      }

      ctx.shadowBlur = 0;
    }

    function drawBoss() {
      if (!boss) return;
      
      drawGlow(0, 0, 0, 0, boss.color, 30);
      ctx.fillStyle = boss.color;

      // Boss body
      ctx.beginPath();
      ctx.moveTo(boss.x + boss.width / 2, boss.y + boss.height);
      ctx.lineTo(boss.x, boss.y + 20);
      ctx.lineTo(boss.x + 20, boss.y);
      ctx.lineTo(boss.x + boss.width - 20, boss.y);
      ctx.lineTo(boss.x + boss.width, boss.y + 20);
      ctx.closePath();
      ctx.fill();

      // Boss details
      ctx.fillStyle = NEON.yellow;
      drawGlow(0, 0, 0, 0, NEON.yellow, 15);
      ctx.beginPath();
      ctx.arc(boss.x + boss.width / 2, boss.y + boss.height / 2, 15, 0, Math.PI * 2);
      ctx.fill();

      ctx.shadowBlur = 0;
    }

    function drawBullet(b) {
      drawGlow(0, 0, 0, 0, b.color, 10);
      ctx.fillStyle = b.color;
      ctx.fillRect(b.x, b.y, b.width, b.height);
      ctx.shadowBlur = 0;
    }

    function drawPowerup(p) {
      drawGlow(0, 0, 0, 0, p.color, 15);
      ctx.strokeStyle = p.color;
      ctx.lineWidth = 2;
      const pulse = Math.sin(p.time * 5) * 3;
      ctx.beginPath();
      ctx.arc(p.x + p.width / 2, p.y + p.height / 2, p.width / 2 + pulse, 0, Math.PI * 2);
      ctx.stroke();

      ctx.fillStyle = p.color;
      ctx.font = '14px sans-serif';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      const icons = { shield: 'üõ°Ô∏è', rapid: '‚ö°', spread: 'üî±', bomb: 'üí£', life: '‚ù§Ô∏è' };
      ctx.fillText(icons[p.type], p.x + p.width / 2, p.y + p.height / 2);
      ctx.shadowBlur = 0;
    }

    function drawParticle(p) {
      ctx.globalAlpha = p.life;
      ctx.fillStyle = p.color;
      drawGlow(0, 0, 0, 0, p.color, 5);
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size * p.life, 0, Math.PI * 2);
      ctx.fill();
      ctx.shadowBlur = 0;
      ctx.globalAlpha = 1;
    }

    function draw() {
      // Clear
      ctx.fillStyle = '#0a0a12';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Stars
      ctx.fillStyle = 'rgba(255,255,255,0.6)';
      stars.forEach(s => {
        ctx.beginPath();
        ctx.arc(s.x, s.y, s.size, 0, Math.PI * 2);
        ctx.fill();
      });

      // Game objects
      particles.forEach(drawParticle);
      powerups.forEach(drawPowerup);
      bullets.forEach(drawBullet);
      enemyBullets.forEach(drawBullet);
      enemies.forEach(drawEnemy);
      drawBoss();
      if (gameRunning) drawPlayer();
    }

    // Game loop
    let lastTime = 0;
    function gameLoop(timestamp) {
      const dt = Math.min((timestamp - lastTime) / 1000, 0.05);
      lastTime = timestamp;

      update(dt);
      draw();
      requestAnimationFrame(gameLoop);
    }

    // Input handlers
    document.addEventListener('keydown', e => {
      if (e.key === 'ArrowUp' || e.key === 'w') keys.up = true;
      if (e.key === 'ArrowDown' || e.key === 's') keys.down = true;
      if (e.key === 'ArrowLeft' || e.key === 'a') keys.left = true;
      if (e.key === 'ArrowRight' || e.key === 'd') keys.right = true;
      if (e.key === ' ') { e.preventDefault(); keys.fire = true; }
      if (e.key === 'b' || e.key === 'B') useBomb();
    });

    document.addEventListener('keyup', e => {
      if (e.key === 'ArrowUp' || e.key === 'w') keys.up = false;
      if (e.key === 'ArrowDown' || e.key === 's') keys.down = false;
      if (e.key === 'ArrowLeft' || e.key === 'a') keys.left = false;
      if (e.key === 'ArrowRight' || e.key === 'd') keys.right = false;
      if (e.key === ' ') keys.fire = false;
    });

    // Mobile controls
    function setupMobileBtn(id, key) {
      const btn = document.getElementById(id);
      btn.addEventListener('touchstart', e => { e.preventDefault(); keys[key] = true; });
      btn.addEventListener('touchend', e => { e.preventDefault(); keys[key] = false; });
    }
    setupMobileBtn('m-up', 'up');
    setupMobileBtn('m-down', 'down');
    setupMobileBtn('m-left', 'left');
    setupMobileBtn('m-right', 'right');
    setupMobileBtn('m-fire', 'fire');
    document.getElementById('m-bomb').addEventListener('touchstart', e => { e.preventDefault(); useBomb(); });

    // Start/restart
    document.getElementById('start-btn').addEventListener('click', startGame);
    document.getElementById('restart-btn').addEventListener('click', startGame);

    // Init
    initStars();
    player.x = canvas.width / 2 - player.width / 2;
    player.y = canvas.height - 100;
    gameLoop(0);
  </script>
<script src="/sloppy-header/sloppy-bar.js"></script>
</body>
</html>
