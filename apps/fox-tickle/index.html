<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fox Tickle - Grape Chaos</title>
  <link rel="icon" href="https://emojicdn.elk.sh/ü¶ä">
  <meta property="og:title" content="Fox Tickle - Grape Chaos">
  <meta property="og:description" content="Tickle adorable foxes and catch falling grapes!">
  <meta property="og:url" content="https://sloppy.live/fox-tickle">
  <meta property="og:image" content="https://sloppy.live/fox-tickle/og-image.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@400;700&family=Grandstander:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Grandstander', cursive;
      background: linear-gradient(180deg, #ff9966 0%, #ff6b8a 50%, #c56cf0 100%);
      min-height: 100vh;
      overflow: hidden;
      cursor: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><text y="24" font-size="24">ü™∂</text></svg>') 16 16, auto;
    }

    #game-container {
      position: relative;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
    }

    #canvas {
      position: absolute;
      top: 0;
      left: 0;
    }

    #ui {
      position: absolute;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      z-index: 10;
      pointer-events: none;
    }

    h1 {
      font-family: 'Baloo 2', cursive;
      font-size: 2.5rem;
      color: #fff;
      text-shadow: 3px 3px 0 #ff6b35, 6px 6px 0 rgba(0,0,0,0.2);
      margin-bottom: 10px;
    }

    #score-display {
      font-size: 1.5rem;
      color: #fff;
      text-shadow: 2px 2px 0 rgba(0,0,0,0.3);
    }

    .grape-count {
      color: #9b59b6;
    }

    .tickle-count {
      color: #ff6b35;
    }

    #giggle-meter {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 300px;
      max-width: 80vw;
      z-index: 10;
    }

    #giggle-meter-label {
      color: #fff;
      font-size: 1rem;
      text-shadow: 1px 1px 0 rgba(0,0,0,0.3);
      margin-bottom: 5px;
    }

    #giggle-bar-container {
      background: rgba(0,0,0,0.3);
      border-radius: 20px;
      height: 25px;
      overflow: hidden;
      border: 3px solid #fff;
    }

    #giggle-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #ffeb3b, #ff9800, #ff5722);
      border-radius: 20px;
      transition: width 0.3s ease;
    }

    #instructions {
      position: absolute;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      color: #fff;
      font-size: 0.9rem;
      text-shadow: 1px 1px 0 rgba(0,0,0,0.3);
      opacity: 0.8;
      text-align: center;
      z-index: 10;
      transition: opacity 0.5s;
    }

    #back-link {
      position: absolute;
      bottom: 10px;
      right: 15px;
      color: rgba(255,255,255,0.7);
      font-size: 0.8rem;
      text-decoration: none;
      z-index: 20;
    }

    #back-link:hover {
      color: #fff;
    }

    .laugh-bubble {
      position: absolute;
      font-size: 1.5rem;
      pointer-events: none;
      animation: floatUp 1.5s ease-out forwards;
      z-index: 15;
    }

    @keyframes floatUp {
      0% { opacity: 1; transform: translateY(0) scale(1); }
      100% { opacity: 0; transform: translateY(-100px) scale(1.5); }
    }

    .grape-splash {
      position: absolute;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: radial-gradient(circle, #9b59b6 0%, transparent 70%);
      pointer-events: none;
      animation: splash 0.5s ease-out forwards;
      z-index: 5;
    }

    @keyframes splash {
      0% { transform: scale(0); opacity: 1; }
      100% { transform: scale(2); opacity: 0; }
    }

    @media (max-width: 600px) {
      h1 { font-size: 1.8rem; }
      #score-display { font-size: 1.2rem; }
      #instructions { font-size: 0.8rem; bottom: 90px; }
    }
  </style>
</head>
<body>
  <div id="game-container">
    <canvas id="canvas"></canvas>
    <div id="ui">
      <h1>ü¶ä Fox Tickle üçá</h1>
      <div id="score-display">
        <span class="grape-count">üçá <span id="grapes">0</span></span> |
        <span class="tickle-count">ü™∂ <span id="tickles">0</span></span>
      </div>
    </div>
    <div id="giggle-meter">
      <div id="giggle-meter-label">Giggle Meter</div>
      <div id="giggle-bar-container">
        <div id="giggle-bar"></div>
      </div>
    </div>
    <div id="instructions">Move mouse/finger over fox to tickle! Catch falling grapes!</div>
    <a id="back-link" href="https://sloppy.live">sloppy.live</a>
  </div>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    let width, height;
    let grapesCaught = 0;
    let tickleCount = 0;
    let giggleMeter = 0;
    let foxX, foxY;
    let mouseX = 0, mouseY = 0;
    let isTickling = false;
    let tailWag = 0;
    let tailWagSpeed = 0.05;
    let foxEmotion = 'happy';
    let emotionTimer = 0;
    let grapes = [];
    let particles = [];
    let tails = [];
    let instructionsVisible = true;

    const laughs = ['hehe', 'hihi', 'teehee', 'üòÜ', 'ü§≠', 'ahaha', 'üòÇ'];

    function resize() {
      width = canvas.width = window.innerWidth;
      height = canvas.height = window.innerHeight;
      foxX = width / 2;
      foxY = height / 2 + 50;
    }

    window.addEventListener('resize', resize);
    resize();

    // Audio context for sounds
    let audioCtx;
    function initAudio() {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
    }

    function playGiggle() {
      if (!audioCtx) return;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.connect(gain);
      gain.connect(audioCtx.destination);

      osc.frequency.setValueAtTime(800 + Math.random() * 400, audioCtx.currentTime);
      osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
      gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.15);

      osc.start();
      osc.stop(audioCtx.currentTime + 0.15);
    }

    function playPop() {
      if (!audioCtx) return;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.connect(gain);
      gain.connect(audioCtx.destination);

      osc.frequency.setValueAtTime(300, audioCtx.currentTime);
      osc.frequency.exponentialRampToValueAtTime(100, audioCtx.currentTime + 0.1);
      gain.gain.setValueAtTime(0.15, audioCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);

      osc.start();
      osc.stop(audioCtx.currentTime + 0.1);
    }

    // Spawn grape
    function spawnGrape() {
      grapes.push({
        x: Math.random() * (width - 100) + 50,
        y: -50,
        vy: 2 + Math.random() * 2,
        rotation: Math.random() * Math.PI * 2,
        rotationSpeed: (Math.random() - 0.5) * 0.1,
        size: 25 + Math.random() * 15
      });
    }

    // Spawn fluffy tail particle
    function spawnTailParticle(x, y) {
      for (let i = 0; i < 3; i++) {
        particles.push({
          x: x + (Math.random() - 0.5) * 30,
          y: y + (Math.random() - 0.5) * 30,
          vx: (Math.random() - 0.5) * 3,
          vy: (Math.random() - 0.5) * 3 - 1,
          size: 10 + Math.random() * 15,
          life: 1,
          color: `hsl(${25 + Math.random() * 15}, 80%, ${60 + Math.random() * 20}%)`
        });
      }
    }

    // Draw fluffy tail
    function drawTail(x, y, angle, fluffiness) {
      ctx.save();
      ctx.translate(x, y);
      ctx.rotate(angle);

      // Main tail shape with multiple fluffy layers
      for (let layer = 0; layer < 5; layer++) {
        const layerOffset = layer * 3;
        const gradient = ctx.createRadialGradient(40 + layerOffset, 0, 0, 40 + layerOffset, 0, 60 - layer * 5);
        gradient.addColorStop(0, '#ff9966');
        gradient.addColorStop(0.7, '#ff7733');
        gradient.addColorStop(1, '#ff6600');

        ctx.beginPath();
        ctx.fillStyle = gradient;

        // Fluffy tail shape
        const fluff = Math.sin(tailWag * 3 + layer) * fluffiness;
        ctx.moveTo(0, 0);
        ctx.quadraticCurveTo(30 + fluff, -25 - layer * 2, 70 + layerOffset, -15 + fluff);
        ctx.quadraticCurveTo(90 + layerOffset, 0, 70 + layerOffset, 15 - fluff);
        ctx.quadraticCurveTo(30 - fluff, 25 + layer * 2, 0, 0);
        ctx.fill();
      }

      // White tip
      ctx.beginPath();
      ctx.fillStyle = '#fff';
      const tipWobble = Math.sin(tailWag * 4) * 5;
      ctx.ellipse(75, tipWobble, 20, 12, 0, 0, Math.PI * 2);
      ctx.fill();

      ctx.restore();
    }

    // Draw the fox
    function drawFox() {
      const wobble = isTickling ? Math.sin(Date.now() / 50) * 5 : 0;
      const breathe = Math.sin(Date.now() / 500) * 3;

      ctx.save();
      ctx.translate(foxX + wobble, foxY + breathe);

      // Draw tail behind fox
      const tailAngle = Math.sin(tailWag) * 0.5 - 0.3;
      drawTail(-60, 30, tailAngle + Math.PI - 0.5, isTickling ? 8 : 3);

      // Body
      const bodyGradient = ctx.createRadialGradient(0, 20, 0, 0, 20, 80);
      bodyGradient.addColorStop(0, '#ff9966');
      bodyGradient.addColorStop(1, '#ff6600');
      ctx.fillStyle = bodyGradient;
      ctx.beginPath();
      ctx.ellipse(0, 30, 70, 50, 0, 0, Math.PI * 2);
      ctx.fill();

      // White belly
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.ellipse(0, 45, 40, 30, 0, 0, Math.PI * 2);
      ctx.fill();

      // Head
      const headGradient = ctx.createRadialGradient(0, -40, 0, 0, -40, 60);
      headGradient.addColorStop(0, '#ff9966');
      headGradient.addColorStop(1, '#ff7733');
      ctx.fillStyle = headGradient;
      ctx.beginPath();
      ctx.ellipse(0, -40, 55, 45, 0, 0, Math.PI * 2);
      ctx.fill();

      // Ears
      ctx.fillStyle = '#ff6600';
      // Left ear
      ctx.beginPath();
      ctx.moveTo(-35, -70);
      ctx.lineTo(-50, -120);
      ctx.lineTo(-15, -85);
      ctx.fill();
      // Right ear
      ctx.beginPath();
      ctx.moveTo(35, -70);
      ctx.lineTo(50, -120);
      ctx.lineTo(15, -85);
      ctx.fill();

      // Inner ears (pink)
      ctx.fillStyle = '#ffaa99';
      ctx.beginPath();
      ctx.moveTo(-32, -75);
      ctx.lineTo(-42, -105);
      ctx.lineTo(-20, -85);
      ctx.fill();
      ctx.beginPath();
      ctx.moveTo(32, -75);
      ctx.lineTo(42, -105);
      ctx.lineTo(20, -85);
      ctx.fill();

      // White face markings
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.moveTo(0, -70);
      ctx.quadraticCurveTo(-25, -50, -20, -20);
      ctx.quadraticCurveTo(0, -10, 20, -20);
      ctx.quadraticCurveTo(25, -50, 0, -70);
      ctx.fill();

      // Eyes
      const eyeSize = foxEmotion === 'laughing' ? 3 : 8;
      const eyeY = foxEmotion === 'laughing' ? -50 : -45;
      ctx.fillStyle = '#333';

      if (foxEmotion === 'laughing') {
        // Happy closed eyes
        ctx.lineWidth = 3;
        ctx.strokeStyle = '#333';
        ctx.beginPath();
        ctx.arc(-20, eyeY, 10, 0, Math.PI, false);
        ctx.stroke();
        ctx.beginPath();
        ctx.arc(20, eyeY, 10, 0, Math.PI, false);
        ctx.stroke();
      } else {
        // Open eyes
        ctx.beginPath();
        ctx.ellipse(-20, eyeY, eyeSize, eyeSize + 2, 0, 0, Math.PI * 2);
        ctx.ellipse(20, eyeY, eyeSize, eyeSize + 2, 0, 0, Math.PI * 2);
        ctx.fill();

        // Eye shine
        ctx.fillStyle = '#fff';
        ctx.beginPath();
        ctx.arc(-17, eyeY - 2, 3, 0, Math.PI * 2);
        ctx.arc(23, eyeY - 2, 3, 0, Math.PI * 2);
        ctx.fill();
      }

      // Nose
      ctx.fillStyle = '#333';
      ctx.beginPath();
      ctx.ellipse(0, -25, 8, 6, 0, 0, Math.PI * 2);
      ctx.fill();

      // Mouth
      ctx.strokeStyle = '#333';
      ctx.lineWidth = 2;
      ctx.beginPath();
      if (foxEmotion === 'laughing' || isTickling) {
        // Big smile
        ctx.arc(0, -18, 15, 0.2, Math.PI - 0.2);
      } else {
        // Small smile
        ctx.arc(0, -20, 8, 0.3, Math.PI - 0.3);
      }
      ctx.stroke();

      // Blush when tickled
      if (isTickling || foxEmotion === 'laughing') {
        ctx.fillStyle = 'rgba(255, 150, 150, 0.5)';
        ctx.beginPath();
        ctx.ellipse(-35, -35, 12, 8, 0, 0, Math.PI * 2);
        ctx.ellipse(35, -35, 12, 8, 0, 0, Math.PI * 2);
        ctx.fill();
      }

      // Paws
      ctx.fillStyle = '#ff7733';
      ctx.beginPath();
      ctx.ellipse(-40, 75, 20, 15, -0.3, 0, Math.PI * 2);
      ctx.ellipse(40, 75, 20, 15, 0.3, 0, Math.PI * 2);
      ctx.fill();

      ctx.restore();
    }

    // Draw grape
    function drawGrape(grape) {
      ctx.save();
      ctx.translate(grape.x, grape.y);
      ctx.rotate(grape.rotation);

      // Grape cluster
      const grapeColor = '#9b59b6';
      const grapeHighlight = '#c39bd3';

      for (let i = 0; i < 6; i++) {
        const angle = (i / 6) * Math.PI * 2;
        const gx = Math.cos(angle) * grape.size * 0.4;
        const gy = Math.sin(angle) * grape.size * 0.4;

        const grad = ctx.createRadialGradient(gx - 3, gy - 3, 0, gx, gy, grape.size * 0.35);
        grad.addColorStop(0, grapeHighlight);
        grad.addColorStop(1, grapeColor);

        ctx.fillStyle = grad;
        ctx.beginPath();
        ctx.arc(gx, gy, grape.size * 0.35, 0, Math.PI * 2);
        ctx.fill();
      }

      // Center grape
      const centerGrad = ctx.createRadialGradient(-3, -3, 0, 0, 0, grape.size * 0.4);
      centerGrad.addColorStop(0, grapeHighlight);
      centerGrad.addColorStop(1, grapeColor);
      ctx.fillStyle = centerGrad;
      ctx.beginPath();
      ctx.arc(0, 0, grape.size * 0.4, 0, Math.PI * 2);
      ctx.fill();

      // Stem
      ctx.strokeStyle = '#5d4037';
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.moveTo(0, -grape.size * 0.5);
      ctx.lineTo(0, -grape.size * 0.8);
      ctx.stroke();

      // Leaf
      ctx.fillStyle = '#4caf50';
      ctx.beginPath();
      ctx.ellipse(8, -grape.size * 0.7, 10, 6, 0.5, 0, Math.PI * 2);
      ctx.fill();

      ctx.restore();
    }

    // Draw particles
    function drawParticles() {
      particles.forEach(p => {
        ctx.globalAlpha = p.life;
        ctx.fillStyle = p.color;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size * p.life, 0, Math.PI * 2);
        ctx.fill();
      });
      ctx.globalAlpha = 1;
    }

    // Create laugh bubble
    function createLaughBubble(x, y) {
      const bubble = document.createElement('div');
      bubble.className = 'laugh-bubble';
      bubble.textContent = laughs[Math.floor(Math.random() * laughs.length)];
      bubble.style.left = x + 'px';
      bubble.style.top = y + 'px';
      document.getElementById('game-container').appendChild(bubble);
      setTimeout(() => bubble.remove(), 1500);
    }

    // Create grape splash
    function createGrapeSplash(x, y) {
      const splash = document.createElement('div');
      splash.className = 'grape-splash';
      splash.style.left = (x - 30) + 'px';
      splash.style.top = (y - 30) + 'px';
      document.getElementById('game-container').appendChild(splash);
      setTimeout(() => splash.remove(), 500);
    }

    // Check if point is on fox
    function isOnFox(x, y) {
      const dx = x - foxX;
      const dy = y - foxY;
      return Math.sqrt(dx * dx + dy * dy) < 100;
    }

    // Check if point catches grape
    function checkGrapeCatch(x, y) {
      for (let i = grapes.length - 1; i >= 0; i--) {
        const grape = grapes[i];
        const dx = x - grape.x;
        const dy = y - grape.y;
        if (Math.sqrt(dx * dx + dy * dy) < grape.size + 30) {
          createGrapeSplash(grape.x, grape.y);
          playPop();
          grapes.splice(i, 1);
          grapesCaught++;
          document.getElementById('grapes').textContent = grapesCaught;

          // Grapes also tickle the fox if caught near it
          if (isOnFox(grape.x, grape.y)) {
            handleTickle();
          }
          return true;
        }
      }
      return false;
    }

    // Handle tickle
    function handleTickle() {
      tickleCount++;
      document.getElementById('tickles').textContent = tickleCount;
      giggleMeter = Math.min(100, giggleMeter + 5);
      document.getElementById('giggle-bar').style.width = giggleMeter + '%';

      if (Math.random() < 0.3) {
        playGiggle();
        createLaughBubble(foxX + (Math.random() - 0.5) * 100, foxY - 80);
      }

      spawnTailParticle(foxX - 60, foxY + 30);

      // Hide instructions after first tickle
      if (instructionsVisible) {
        document.getElementById('instructions').style.opacity = '0';
        instructionsVisible = false;
      }

      // Check for giggle explosion
      if (giggleMeter >= 100) {
        foxEmotion = 'laughing';
        emotionTimer = 180;
        for (let i = 0; i < 10; i++) {
          createLaughBubble(
            foxX + (Math.random() - 0.5) * 200,
            foxY + (Math.random() - 0.5) * 150
          );
        }
        for (let i = 0; i < 20; i++) {
          spawnTailParticle(foxX + (Math.random() - 0.5) * 100, foxY + (Math.random() - 0.5) * 100);
        }
        giggleMeter = 0;
        document.getElementById('giggle-bar').style.width = '0%';
      }
    }

    // Mouse/touch handlers
    function handleMove(x, y) {
      mouseX = x;
      mouseY = y;

      checkGrapeCatch(x, y);

      if (isOnFox(x, y)) {
        if (!isTickling) {
          isTickling = true;
          tailWagSpeed = 0.15;
        }
        if (Math.random() < 0.1) {
          handleTickle();
        }
      } else {
        isTickling = false;
        tailWagSpeed = 0.05;
      }
    }

    canvas.addEventListener('mousemove', (e) => {
      initAudio();
      handleMove(e.clientX, e.clientY);
    });

    canvas.addEventListener('touchmove', (e) => {
      e.preventDefault();
      initAudio();
      const touch = e.touches[0];
      handleMove(touch.clientX, touch.clientY);
    });

    canvas.addEventListener('click', () => {
      initAudio();
    });

    // Game loop
    function update() {
      // Tail wag
      tailWag += tailWagSpeed;

      // Emotion timer
      if (emotionTimer > 0) {
        emotionTimer--;
        if (emotionTimer === 0) {
          foxEmotion = 'happy';
        }
      }

      // Giggle meter decay
      if (!isTickling && giggleMeter > 0) {
        giggleMeter = Math.max(0, giggleMeter - 0.2);
        document.getElementById('giggle-bar').style.width = giggleMeter + '%';
      }

      // Update grapes
      grapes.forEach(grape => {
        grape.y += grape.vy;
        grape.rotation += grape.rotationSpeed;

        // Check if grape hits fox
        if (isOnFox(grape.x, grape.y)) {
          createGrapeSplash(grape.x, grape.y);
          playPop();
          handleTickle();
          grape.y = height + 100; // Mark for removal
        }
      });

      // Remove off-screen grapes
      grapes = grapes.filter(g => g.y < height + 50);

      // Update particles
      particles.forEach(p => {
        p.x += p.vx;
        p.y += p.vy;
        p.vy += 0.1;
        p.life -= 0.02;
      });
      particles = particles.filter(p => p.life > 0);

      // Spawn new grapes
      if (Math.random() < 0.02) {
        spawnGrape();
      }
    }

    function draw() {
      // Clear with gradient background (done in CSS, just clear canvas)
      ctx.clearRect(0, 0, width, height);

      // Draw background elements
      drawParticles();

      // Draw grapes
      grapes.forEach(drawGrape);

      // Draw fox
      drawFox();
    }

    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    // Start game
    gameLoop();
  </script>
</body>
</html>
