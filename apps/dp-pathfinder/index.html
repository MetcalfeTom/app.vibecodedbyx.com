<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DP Pathfinder Tutorial</title>
  <link rel="icon" href="https://emojicdn.elk.sh/üßÆ">
  <meta property="og:title" content="DP Pathfinder Tutorial">
  <meta property="og:description" content="Learn dynamic programming through interactive pathfinding">
  <meta property="og:url" content="https://sloppy.live/dp-pathfinder">
  <meta property="og:image" content="https://emojicdn.elk.sh/üßÆ?style=apple&size=512">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Space+Grotesk:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg: #0a0f1a;
      --panel: #111827;
      --border: #1f2937;
      --cyan: #06b6d4;
      --green: #10b981;
      --orange: #f59e0b;
      --purple: #8b5cf6;
      --pink: #ec4899;
      --text: #f3f4f6;
      --muted: #6b7280;
    }

    body {
      background: var(--bg);
      font-family: 'Space Grotesk', sans-serif;
      color: var(--text);
      min-height: 100vh;
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      text-align: center;
      padding: 30px 0;
      border-bottom: 1px solid var(--border);
      margin-bottom: 30px;
    }

    h1 {
      font-size: 2.2rem;
      background: linear-gradient(90deg, var(--cyan), var(--purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 10px;
    }

    header p {
      color: var(--muted);
      font-size: 1rem;
    }

    .tutorial-nav {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .nav-btn {
      background: var(--panel);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-family: inherit;
      font-size: 0.9rem;
      transition: all 0.2s;
    }

    .nav-btn:hover {
      border-color: var(--cyan);
    }

    .nav-btn.active {
      background: var(--cyan);
      color: var(--bg);
      border-color: var(--cyan);
    }

    .lesson {
      display: none;
      animation: fadeIn 0.3s ease;
    }

    .lesson.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .content-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
    }

    @media (max-width: 900px) {
      .content-grid {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 25px;
    }

    .panel h2 {
      font-size: 1.3rem;
      color: var(--cyan);
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .panel h3 {
      font-size: 1.1rem;
      color: var(--purple);
      margin: 20px 0 10px;
    }

    .panel p {
      margin-bottom: 15px;
      color: var(--text);
    }

    .highlight {
      background: rgba(6, 182, 212, 0.1);
      border-left: 3px solid var(--cyan);
      padding: 15px;
      border-radius: 0 8px 8px 0;
      margin: 15px 0;
    }

    .formula {
      background: rgba(139, 92, 246, 0.1);
      border: 1px solid var(--purple);
      padding: 15px;
      border-radius: 8px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.9rem;
      margin: 15px 0;
      overflow-x: auto;
    }

    code {
      font-family: 'JetBrains Mono', monospace;
      background: rgba(255, 255, 255, 0.1);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.85rem;
    }

    /* Grid Visualization */
    .grid-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 15px;
    }

    .grid {
      display: grid;
      gap: 3px;
      background: var(--border);
      padding: 3px;
      border-radius: 8px;
    }

    .cell {
      width: 50px;
      height: 50px;
      background: var(--panel);
      border-radius: 4px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.75rem;
      position: relative;
      transition: all 0.3s;
      cursor: pointer;
    }

    .cell:hover {
      background: rgba(6, 182, 212, 0.2);
    }

    .cell.start {
      background: var(--green);
      color: var(--bg);
    }

    .cell.end {
      background: var(--pink);
      color: white;
    }

    .cell.obstacle {
      background: #374151;
      color: var(--muted);
    }

    .cell.path {
      background: rgba(6, 182, 212, 0.4);
    }

    .cell.current {
      background: var(--orange);
      color: var(--bg);
      animation: pulse 0.5s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .cell.visited {
      background: rgba(139, 92, 246, 0.3);
    }

    .cell-cost {
      font-weight: 700;
      font-size: 0.9rem;
    }

    .cell-coords {
      font-size: 0.6rem;
      color: var(--muted);
    }

    .cell-dp {
      position: absolute;
      bottom: 2px;
      right: 4px;
      font-size: 0.6rem;
      color: var(--cyan);
    }

    /* Vector Display */
    .vector-display {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: 15px;
      margin-top: 15px;
    }

    .vector-row {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85rem;
    }

    .vector-label {
      color: var(--muted);
      width: 80px;
    }

    .vector-value {
      color: var(--cyan);
    }

    .vector-arrow {
      color: var(--orange);
    }

    /* Controls */
    .controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 20px;
    }

    .btn {
      background: linear-gradient(135deg, var(--cyan), var(--purple));
      border: none;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-family: inherit;
      font-size: 0.9rem;
      transition: all 0.2s;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 15px rgba(6, 182, 212, 0.3);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .btn.secondary {
      background: var(--panel);
      border: 1px solid var(--border);
    }

    .btn.secondary:hover {
      border-color: var(--cyan);
    }

    /* Speed Control */
    .speed-control {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-top: 15px;
    }

    .speed-control label {
      color: var(--muted);
      font-size: 0.85rem;
    }

    .speed-control input {
      width: 100px;
    }

    /* DP Table */
    .dp-table {
      overflow-x: auto;
      margin-top: 15px;
    }

    .dp-table table {
      border-collapse: collapse;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
    }

    .dp-table th, .dp-table td {
      border: 1px solid var(--border);
      padding: 8px 12px;
      text-align: center;
    }

    .dp-table th {
      background: rgba(139, 92, 246, 0.2);
      color: var(--purple);
    }

    .dp-table td {
      background: var(--panel);
    }

    .dp-table td.highlight-cell {
      background: rgba(6, 182, 212, 0.3);
      color: var(--cyan);
    }

    /* Log */
    .log {
      background: rgba(0, 0, 0, 0.3);
      border-radius: 8px;
      padding: 15px;
      max-height: 200px;
      overflow-y: auto;
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
      margin-top: 15px;
    }

    .log-entry {
      padding: 5px 0;
      border-bottom: 1px solid var(--border);
    }

    .log-entry:last-child {
      border-bottom: none;
    }

    .log-entry .step {
      color: var(--orange);
    }

    .log-entry .calc {
      color: var(--cyan);
    }

    .log-entry .result {
      color: var(--green);
    }

    /* Quiz */
    .quiz-option {
      display: block;
      background: var(--panel);
      border: 1px solid var(--border);
      padding: 12px 15px;
      border-radius: 8px;
      margin: 10px 0;
      cursor: pointer;
      transition: all 0.2s;
    }

    .quiz-option:hover {
      border-color: var(--cyan);
    }

    .quiz-option.correct {
      background: rgba(16, 185, 129, 0.2);
      border-color: var(--green);
    }

    .quiz-option.incorrect {
      background: rgba(239, 68, 68, 0.2);
      border-color: #ef4444;
    }

    .quiz-feedback {
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      display: none;
    }

    .quiz-feedback.show {
      display: block;
    }

    .quiz-feedback.correct {
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid var(--green);
      color: var(--green);
    }

    .quiz-feedback.incorrect {
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid #ef4444;
      color: #ef4444;
    }

    /* Back link */
    .back-link {
      position: fixed;
      bottom: 10px;
      right: 10px;
      color: var(--muted);
      text-decoration: none;
      font-size: 0.75rem;
    }

    .back-link:hover {
      color: var(--cyan);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üßÆ Dynamic Programming Pathfinder</h1>
      <p>Learn DP through interactive vector-based pathfinding</p>
    </header>

    <nav class="tutorial-nav">
      <button class="nav-btn active" onclick="showLesson(0)">1. Introduction</button>
      <button class="nav-btn" onclick="showLesson(1)">2. Vectors</button>
      <button class="nav-btn" onclick="showLesson(2)">3. DP Basics</button>
      <button class="nav-btn" onclick="showLesson(3)">4. Interactive</button>
      <button class="nav-btn" onclick="showLesson(4)">5. Quiz</button>
    </nav>

    <!-- Lesson 1: Introduction -->
    <div class="lesson active" id="lesson-0">
      <div class="content-grid">
        <div class="panel">
          <h2>üìö What is Dynamic Programming?</h2>
          <p>Dynamic Programming (DP) is an optimization technique that solves complex problems by breaking them into simpler subproblems and storing their solutions.</p>

          <div class="highlight">
            <strong>Key Principle:</strong> Solve each subproblem only once, then store the result for future use.
          </div>

          <h3>The Pathfinding Problem</h3>
          <p>Given a grid with costs on each cell, find the minimum cost path from the top-left to bottom-right corner. You can only move <strong>right</strong> or <strong>down</strong>.</p>

          <h3>Why DP?</h3>
          <p>Without DP, we'd need to check all possible paths (exponential time). With DP, we compute the optimal solution in O(n√óm) time by building on previous solutions.</p>

          <div class="formula">
            // Without DP: O(2^(n+m)) paths to check
            // With DP: O(n √ó m) cells to compute
          </div>
        </div>

        <div class="panel">
          <h2>üéØ Example Grid</h2>
          <div class="grid-container">
            <div class="grid" id="intro-grid" style="grid-template-columns: repeat(4, 50px);"></div>
          </div>
          <p style="text-align: center; margin-top: 15px; color: var(--muted);">
            Numbers show the cost of passing through each cell
          </p>

          <div class="vector-display">
            <div class="vector-row">
              <span class="vector-label">Start:</span>
              <span class="vector-value">(0, 0)</span>
              <span class="vector-arrow">‚Üí</span>
              <span>Top-left cell</span>
            </div>
            <div class="vector-row">
              <span class="vector-label">End:</span>
              <span class="vector-value">(3, 3)</span>
              <span class="vector-arrow">‚Üí</span>
              <span>Bottom-right cell</span>
            </div>
            <div class="vector-row">
              <span class="vector-label">Moves:</span>
              <span class="vector-value">‚Üí (1,0) or ‚Üì (0,1)</span>
            </div>
          </div>

          <div class="controls">
            <button class="btn" onclick="showLesson(1)">Next: Vectors ‚Üí</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Lesson 2: Vectors -->
    <div class="lesson" id="lesson-1">
      <div class="content-grid">
        <div class="panel">
          <h2>üìê Vector Calculations</h2>
          <p>In pathfinding, we represent positions and movements as 2D vectors.</p>

          <h3>Position Vector</h3>
          <p>A position <code>(row, col)</code> represents coordinates on our grid.</p>
          <div class="formula">
            position = [row, col]
            // Example: [2, 1] means row 2, column 1
          </div>

          <h3>Movement Vectors</h3>
          <p>We define movement as vector addition:</p>
          <div class="formula">
            right = [0, 1]  // Move one column right
            down  = [1, 0]  // Move one row down

            new_pos = current_pos + movement
            // [2,1] + [0,1] = [2,2] (moved right)
            // [2,1] + [1,0] = [3,1] (moved down)
          </div>

          <h3>Vector Magnitude (Cost)</h3>
          <p>The "cost" to reach a cell is the sum of all cell values along the path.</p>
          <div class="formula">
            cost(path) = Œ£ grid[pos] for pos in path
          </div>
        </div>

        <div class="panel">
          <h2>üî¢ Vector Demo</h2>
          <div class="grid-container">
            <div class="grid" id="vector-grid" style="grid-template-columns: repeat(4, 50px);"></div>
          </div>

          <div class="vector-display">
            <div class="vector-row">
              <span class="vector-label">Current:</span>
              <span class="vector-value" id="current-pos">[0, 0]</span>
            </div>
            <div class="vector-row">
              <span class="vector-label">Movement:</span>
              <span class="vector-value" id="movement-vec">[0, 0]</span>
            </div>
            <div class="vector-row">
              <span class="vector-label">Result:</span>
              <span class="vector-value" id="result-pos">[0, 0]</span>
            </div>
          </div>

          <div class="controls">
            <button class="btn secondary" onclick="vectorMove('right')">‚Üí Right [0,1]</button>
            <button class="btn secondary" onclick="vectorMove('down')">‚Üì Down [1,0]</button>
            <button class="btn secondary" onclick="resetVectorDemo()">Reset</button>
          </div>

          <div class="controls">
            <button class="btn" onclick="showLesson(0)">‚Üê Back</button>
            <button class="btn" onclick="showLesson(2)">Next: DP Basics ‚Üí</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Lesson 3: DP Basics -->
    <div class="lesson" id="lesson-2">
      <div class="content-grid">
        <div class="panel">
          <h2>üß† The DP Formula</h2>
          <p>For each cell, the minimum cost to reach it is:</p>

          <div class="formula">
            dp[i][j] = grid[i][j] + min(dp[i-1][j], dp[i][j-1])

            // Where:
            // dp[i][j] = min cost to reach cell (i,j)
            // grid[i][j] = cost of cell (i,j)
            // dp[i-1][j] = cost from above (if exists)
            // dp[i][j-1] = cost from left (if exists)
          </div>

          <h3>Base Cases</h3>
          <div class="formula">
            // First cell
            dp[0][0] = grid[0][0]

            // First row (can only come from left)
            dp[0][j] = dp[0][j-1] + grid[0][j]

            // First column (can only come from above)
            dp[i][0] = dp[i-1][0] + grid[i][0]
          </div>

          <h3>Vector Form</h3>
          <div class="formula">
            For position p = [i, j]:

            left_neighbor = p + [-1, 0] = [i-1, j]
            top_neighbor  = p + [0, -1] = [i, j-1]

            dp[p] = grid[p] + min(dp[left], dp[top])
          </div>
        </div>

        <div class="panel">
          <h2>üìä DP Table Construction</h2>
          <p>Watch how the DP table is built step by step:</p>

          <div class="grid-container">
            <div class="grid" id="dp-demo-grid" style="grid-template-columns: repeat(4, 50px);"></div>
          </div>

          <div class="dp-table" id="dp-table-container"></div>

          <div class="log" id="dp-log"></div>

          <div class="controls">
            <button class="btn" id="step-btn" onclick="stepDP()">Step ‚Üí</button>
            <button class="btn secondary" onclick="autoRunDP()">Auto Run</button>
            <button class="btn secondary" onclick="resetDPDemo()">Reset</button>
          </div>

          <div class="controls">
            <button class="btn" onclick="showLesson(1)">‚Üê Back</button>
            <button class="btn" onclick="showLesson(3)">Next: Interactive ‚Üí</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Lesson 4: Interactive -->
    <div class="lesson" id="lesson-3">
      <div class="content-grid">
        <div class="panel">
          <h2>üéÆ Interactive Pathfinder</h2>
          <p>Click cells to toggle obstacles, then run the DP algorithm to find the optimal path.</p>

          <div class="grid-container">
            <div class="grid" id="interactive-grid" style="grid-template-columns: repeat(6, 50px);"></div>
          </div>

          <div class="controls">
            <button class="btn" onclick="runInteractiveDP()">Find Path</button>
            <button class="btn secondary" onclick="resetInteractive()">Reset</button>
            <button class="btn secondary" onclick="randomizeCosts()">Randomize</button>
          </div>

          <div class="speed-control">
            <label>Speed:</label>
            <input type="range" id="speed-slider" min="50" max="500" value="200">
            <span id="speed-value">200ms</span>
          </div>
        </div>

        <div class="panel">
          <h2>üìà Results</h2>

          <div class="vector-display">
            <div class="vector-row">
              <span class="vector-label">Min Cost:</span>
              <span class="vector-value" id="min-cost">‚Äî</span>
            </div>
            <div class="vector-row">
              <span class="vector-label">Path Length:</span>
              <span class="vector-value" id="path-length">‚Äî</span>
            </div>
            <div class="vector-row">
              <span class="vector-label">Cells Visited:</span>
              <span class="vector-value" id="cells-visited">‚Äî</span>
            </div>
          </div>

          <h3>Calculation Log</h3>
          <div class="log" id="interactive-log">
            <div class="log-entry">Click "Find Path" to start...</div>
          </div>

          <div class="controls">
            <button class="btn" onclick="showLesson(2)">‚Üê Back</button>
            <button class="btn" onclick="showLesson(4)">Next: Quiz ‚Üí</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Lesson 5: Quiz -->
    <div class="lesson" id="lesson-4">
      <div class="content-grid">
        <div class="panel">
          <h2>üéØ Test Your Knowledge</h2>

          <div id="quiz-container">
            <div class="quiz-question" id="q1">
              <h3>Question 1</h3>
              <p>What is the time complexity of the DP pathfinding solution for an n√óm grid?</p>
              <div class="quiz-option" onclick="checkAnswer(1, 'a', this)">A) O(2^n)</div>
              <div class="quiz-option" onclick="checkAnswer(1, 'b', this)">B) O(n √ó m)</div>
              <div class="quiz-option" onclick="checkAnswer(1, 'c', this)">C) O(n¬≤)</div>
              <div class="quiz-option" onclick="checkAnswer(1, 'd', this)">D) O(n log n)</div>
              <div class="quiz-feedback" id="feedback-1"></div>
            </div>

            <div class="quiz-question" id="q2" style="margin-top: 30px;">
              <h3>Question 2</h3>
              <p>In the DP formula <code>dp[i][j] = grid[i][j] + min(dp[i-1][j], dp[i][j-1])</code>, what does <code>dp[i-1][j]</code> represent?</p>
              <div class="quiz-option" onclick="checkAnswer(2, 'a', this)">A) Cost from the cell to the right</div>
              <div class="quiz-option" onclick="checkAnswer(2, 'b', this)">B) Cost from the cell above</div>
              <div class="quiz-option" onclick="checkAnswer(2, 'c', this)">C) Cost from the cell below</div>
              <div class="quiz-option" onclick="checkAnswer(2, 'd', this)">D) Cost of the current cell</div>
              <div class="quiz-feedback" id="feedback-2"></div>
            </div>

            <div class="quiz-question" id="q3" style="margin-top: 30px;">
              <h3>Question 3</h3>
              <p>Given movement vector <code>right = [0, 1]</code> and position <code>[2, 3]</code>, what is the new position after moving right?</p>
              <div class="quiz-option" onclick="checkAnswer(3, 'a', this)">A) [3, 3]</div>
              <div class="quiz-option" onclick="checkAnswer(3, 'b', this)">B) [2, 4]</div>
              <div class="quiz-option" onclick="checkAnswer(3, 'c', this)">C) [2, 2]</div>
              <div class="quiz-option" onclick="checkAnswer(3, 'd', this)">D) [1, 3]</div>
              <div class="quiz-feedback" id="feedback-3"></div>
            </div>
          </div>
        </div>

        <div class="panel">
          <h2>üìä Your Score</h2>
          <div style="text-align: center; padding: 30px;">
            <div style="font-size: 4rem; margin-bottom: 20px;" id="score-display">0/3</div>
            <p id="score-message">Answer all questions to see your score!</p>
          </div>

          <div class="highlight">
            <strong>Key Takeaways:</strong>
            <ul style="margin-top: 10px; padding-left: 20px;">
              <li>DP breaks problems into overlapping subproblems</li>
              <li>Store results to avoid redundant calculations</li>
              <li>Vectors simplify position and movement math</li>
              <li>Build solutions from base cases upward</li>
            </ul>
          </div>

          <div class="controls">
            <button class="btn" onclick="showLesson(3)">‚Üê Back</button>
            <button class="btn secondary" onclick="resetQuiz()">Retry Quiz</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <a href="https://sloppy.live" class="back-link">‚Üê sloppy.live</a>

  <script>
    // Sample grids
    const sampleGrid = [
      [1, 3, 1, 2],
      [2, 1, 5, 1],
      [4, 2, 1, 3],
      [1, 2, 2, 1]
    ];

    let interactiveGrid = [];
    const INTERACTIVE_SIZE = 6;

    // Lesson navigation
    function showLesson(index) {
      document.querySelectorAll('.lesson').forEach((l, i) => {
        l.classList.toggle('active', i === index);
      });
      document.querySelectorAll('.nav-btn').forEach((b, i) => {
        b.classList.toggle('active', i === index);
      });

      // Initialize lesson-specific content
      if (index === 0) initIntroGrid();
      if (index === 1) initVectorDemo();
      if (index === 2) initDPDemo();
      if (index === 3) initInteractive();
    }

    // Render a grid
    function renderGrid(containerId, grid, options = {}) {
      const container = document.getElementById(containerId);
      container.innerHTML = '';
      container.style.gridTemplateColumns = `repeat(${grid[0].length}, 50px)`;

      grid.forEach((row, i) => {
        row.forEach((cost, j) => {
          const cell = document.createElement('div');
          cell.className = 'cell';
          cell.dataset.row = i;
          cell.dataset.col = j;

          if (i === 0 && j === 0) cell.classList.add('start');
          if (i === grid.length - 1 && j === grid[0].length - 1) cell.classList.add('end');
          if (cost === Infinity) {
            cell.classList.add('obstacle');
            cell.innerHTML = `<span class="cell-cost">X</span>`;
          } else {
            cell.innerHTML = `
              <span class="cell-cost">${cost}</span>
              <span class="cell-coords">(${i},${j})</span>
              ${options.showDP ? `<span class="cell-dp" id="dp-${i}-${j}">‚Äî</span>` : ''}
            `;
          }

          if (options.onClick) {
            cell.addEventListener('click', () => options.onClick(i, j, cell));
          }

          container.appendChild(cell);
        });
      });
    }

    // Intro grid
    function initIntroGrid() {
      renderGrid('intro-grid', sampleGrid);
    }

    // Vector demo
    let vectorPos = [0, 0];

    function initVectorDemo() {
      vectorPos = [0, 0];
      renderGrid('vector-grid', sampleGrid);
      updateVectorDisplay();
      highlightVectorCell();
    }

    function vectorMove(dir) {
      const movement = dir === 'right' ? [0, 1] : [1, 0];
      const newPos = [vectorPos[0] + movement[0], vectorPos[1] + movement[1]];

      if (newPos[0] < 4 && newPos[1] < 4) {
        document.getElementById('movement-vec').textContent = `[${movement[0]}, ${movement[1]}]`;
        vectorPos = newPos;
        updateVectorDisplay();
        highlightVectorCell();
      }
    }

    function updateVectorDisplay() {
      document.getElementById('current-pos').textContent = `[${vectorPos[0]}, ${vectorPos[1]}]`;
      document.getElementById('result-pos').textContent = `[${vectorPos[0]}, ${vectorPos[1]}]`;
    }

    function highlightVectorCell() {
      document.querySelectorAll('#vector-grid .cell').forEach(c => c.classList.remove('current'));
      const cells = document.querySelectorAll('#vector-grid .cell');
      const idx = vectorPos[0] * 4 + vectorPos[1];
      if (cells[idx]) cells[idx].classList.add('current');
    }

    function resetVectorDemo() {
      vectorPos = [0, 0];
      document.getElementById('movement-vec').textContent = '[0, 0]';
      initVectorDemo();
    }

    // DP Demo
    let dpState = { i: 0, j: 0, dp: [], done: false };

    function initDPDemo() {
      dpState = {
        i: 0,
        j: 0,
        dp: sampleGrid.map(row => row.map(() => null)),
        done: false
      };
      renderGrid('dp-demo-grid', sampleGrid, { showDP: true });
      renderDPTable();
      document.getElementById('dp-log').innerHTML = '<div class="log-entry">Press "Step" to begin...</div>';
    }

    function renderDPTable() {
      const container = document.getElementById('dp-table-container');
      let html = '<table><tr><th></th>';
      for (let j = 0; j < 4; j++) html += `<th>Col ${j}</th>`;
      html += '</tr>';

      for (let i = 0; i < 4; i++) {
        html += `<tr><th>Row ${i}</th>`;
        for (let j = 0; j < 4; j++) {
          const val = dpState.dp[i][j];
          const isHighlight = i === dpState.i && j === dpState.j;
          html += `<td class="${isHighlight ? 'highlight-cell' : ''}">${val !== null ? val : '‚Äî'}</td>`;
        }
        html += '</tr>';
      }
      html += '</table>';
      container.innerHTML = html;
    }

    function stepDP() {
      if (dpState.done) return;

      const { i, j, dp } = dpState;
      const grid = sampleGrid;
      const log = document.getElementById('dp-log');

      let logEntry = `<span class="step">Step [${i},${j}]:</span> `;

      if (i === 0 && j === 0) {
        dp[0][0] = grid[0][0];
        logEntry += `<span class="calc">Base case</span> ‚Üí <span class="result">dp[0][0] = ${grid[0][0]}</span>`;
      } else if (i === 0) {
        dp[0][j] = dp[0][j - 1] + grid[0][j];
        logEntry += `<span class="calc">${dp[0][j - 1]} + ${grid[0][j]}</span> ‚Üí <span class="result">dp[0][${j}] = ${dp[0][j]}</span>`;
      } else if (j === 0) {
        dp[i][0] = dp[i - 1][0] + grid[i][0];
        logEntry += `<span class="calc">${dp[i - 1][0]} + ${grid[i][0]}</span> ‚Üí <span class="result">dp[${i}][0] = ${dp[i][0]}</span>`;
      } else {
        const fromTop = dp[i - 1][j];
        const fromLeft = dp[i][j - 1];
        dp[i][j] = grid[i][j] + Math.min(fromTop, fromLeft);
        logEntry += `<span class="calc">min(${fromTop}, ${fromLeft}) + ${grid[i][j]}</span> ‚Üí <span class="result">dp[${i}][${j}] = ${dp[i][j]}</span>`;
      }

      // Update cell display
      const dpCell = document.getElementById(`dp-${i}-${j}`);
      if (dpCell) dpCell.textContent = dp[i][j];

      // Mark as visited
      const cells = document.querySelectorAll('#dp-demo-grid .cell');
      cells[i * 4 + j].classList.add('visited');

      log.innerHTML = `<div class="log-entry">${logEntry}</div>` + log.innerHTML;

      // Move to next cell
      if (j < 3) {
        dpState.j++;
      } else if (i < 3) {
        dpState.i++;
        dpState.j = 0;
      } else {
        dpState.done = true;
        log.innerHTML = `<div class="log-entry"><span class="result">‚úì Complete! Minimum path cost: ${dp[3][3]}</span></div>` + log.innerHTML;
      }

      renderDPTable();
    }

    function autoRunDP() {
      const interval = setInterval(() => {
        if (dpState.done) {
          clearInterval(interval);
          return;
        }
        stepDP();
      }, 300);
    }

    function resetDPDemo() {
      initDPDemo();
    }

    // Interactive
    function initInteractive() {
      interactiveGrid = [];
      for (let i = 0; i < INTERACTIVE_SIZE; i++) {
        interactiveGrid.push([]);
        for (let j = 0; j < INTERACTIVE_SIZE; j++) {
          interactiveGrid[i].push(Math.floor(Math.random() * 9) + 1);
        }
      }

      renderGrid('interactive-grid', interactiveGrid, {
        showDP: true,
        onClick: (i, j, cell) => {
          if ((i === 0 && j === 0) || (i === INTERACTIVE_SIZE - 1 && j === INTERACTIVE_SIZE - 1)) return;
          if (interactiveGrid[i][j] === Infinity) {
            interactiveGrid[i][j] = Math.floor(Math.random() * 9) + 1;
          } else {
            interactiveGrid[i][j] = Infinity;
          }
          renderGrid('interactive-grid', interactiveGrid, {
            showDP: true,
            onClick: arguments.callee
          });
        }
      });

      document.getElementById('min-cost').textContent = '‚Äî';
      document.getElementById('path-length').textContent = '‚Äî';
      document.getElementById('cells-visited').textContent = '‚Äî';
      document.getElementById('interactive-log').innerHTML = '<div class="log-entry">Click "Find Path" to start...</div>';
    }

    async function runInteractiveDP() {
      const grid = interactiveGrid;
      const n = grid.length;
      const dp = grid.map(row => row.map(() => Infinity));
      const log = document.getElementById('interactive-log');
      const speed = parseInt(document.getElementById('speed-slider').value);

      log.innerHTML = '';
      let visited = 0;

      // Clear previous highlights
      document.querySelectorAll('#interactive-grid .cell').forEach(c => {
        c.classList.remove('visited', 'current', 'path');
      });

      // DP computation
      for (let i = 0; i < n; i++) {
        for (let j = 0; j < n; j++) {
          if (grid[i][j] === Infinity) continue;

          const cells = document.querySelectorAll('#interactive-grid .cell');
          cells.forEach(c => c.classList.remove('current'));
          cells[i * n + j].classList.add('current');

          if (i === 0 && j === 0) {
            dp[0][0] = grid[0][0];
          } else if (i === 0) {
            dp[0][j] = dp[0][j - 1] + grid[0][j];
          } else if (j === 0) {
            dp[i][0] = dp[i - 1][0] + grid[i][0];
          } else {
            dp[i][j] = grid[i][j] + Math.min(dp[i - 1][j], dp[i][j - 1]);
          }

          const dpCell = document.getElementById(`dp-${i}-${j}`);
          if (dpCell && dp[i][j] !== Infinity) dpCell.textContent = dp[i][j];

          cells[i * n + j].classList.add('visited');
          visited++;

          log.innerHTML = `<div class="log-entry"><span class="step">[${i},${j}]</span> ‚Üí <span class="result">${dp[i][j]}</span></div>` + log.innerHTML;

          await new Promise(r => setTimeout(r, speed));
        }
      }

      // Trace path back
      let path = [];
      let i = n - 1, j = n - 1;

      if (dp[i][j] !== Infinity) {
        while (i > 0 || j > 0) {
          path.push([i, j]);
          if (i === 0) j--;
          else if (j === 0) i--;
          else if (dp[i - 1][j] < dp[i][j - 1]) i--;
          else j--;
        }
        path.push([0, 0]);

        // Highlight path
        const cells = document.querySelectorAll('#interactive-grid .cell');
        cells.forEach(c => c.classList.remove('current'));
        path.forEach(([pi, pj]) => {
          cells[pi * n + pj].classList.add('path');
        });

        document.getElementById('min-cost').textContent = dp[n - 1][n - 1];
        document.getElementById('path-length').textContent = path.length;
      } else {
        document.getElementById('min-cost').textContent = 'No path!';
        document.getElementById('path-length').textContent = '‚Äî';
      }

      document.getElementById('cells-visited').textContent = visited;
    }

    function resetInteractive() {
      initInteractive();
    }

    function randomizeCosts() {
      for (let i = 0; i < INTERACTIVE_SIZE; i++) {
        for (let j = 0; j < INTERACTIVE_SIZE; j++) {
          if (interactiveGrid[i][j] !== Infinity) {
            interactiveGrid[i][j] = Math.floor(Math.random() * 9) + 1;
          }
        }
      }
      initInteractive();
    }

    // Speed slider
    document.getElementById('speed-slider').addEventListener('input', (e) => {
      document.getElementById('speed-value').textContent = e.target.value + 'ms';
    });

    // Quiz
    const answers = { 1: 'b', 2: 'b', 3: 'b' };
    const explanations = {
      1: 'We visit each cell exactly once, computing the DP value in O(1), giving O(n√óm) total.',
      2: 'dp[i-1][j] is the cell directly above (row i-1, same column j), representing the cost from above.',
      3: '[2,3] + [0,1] = [2+0, 3+1] = [2,4]. We add corresponding components.'
    };
    let quizAnswers = {};

    function checkAnswer(q, answer, element) {
      if (quizAnswers[q]) return;

      const options = element.parentElement.querySelectorAll('.quiz-option');
      options.forEach(opt => {
        opt.style.pointerEvents = 'none';
      });

      quizAnswers[q] = answer;
      const correct = answers[q] === answer;

      element.classList.add(correct ? 'correct' : 'incorrect');

      if (!correct) {
        options.forEach(opt => {
          if (opt.textContent.toLowerCase().startsWith(answers[q])) {
            opt.classList.add('correct');
          }
        });
      }

      const feedback = document.getElementById(`feedback-${q}`);
      feedback.className = `quiz-feedback show ${correct ? 'correct' : 'incorrect'}`;
      feedback.innerHTML = `${correct ? '‚úì Correct!' : '‚úó Incorrect.'} ${explanations[q]}`;

      updateScore();
    }

    function updateScore() {
      let score = 0;
      for (let q in quizAnswers) {
        if (quizAnswers[q] === answers[q]) score++;
      }

      document.getElementById('score-display').textContent = `${score}/3`;

      if (Object.keys(quizAnswers).length === 3) {
        const messages = [
          'Keep practicing! Review the lessons.',
          'Good effort! Try again for a perfect score.',
          'Great job! You\'re almost there!',
          'Perfect! You\'ve mastered DP pathfinding!'
        ];
        document.getElementById('score-message').textContent = messages[score];
      }
    }

    function resetQuiz() {
      quizAnswers = {};
      document.querySelectorAll('.quiz-option').forEach(opt => {
        opt.classList.remove('correct', 'incorrect');
        opt.style.pointerEvents = 'auto';
      });
      document.querySelectorAll('.quiz-feedback').forEach(f => {
        f.className = 'quiz-feedback';
      });
      document.getElementById('score-display').textContent = '0/3';
      document.getElementById('score-message').textContent = 'Answer all questions to see your score!';
    }

    // Initialize
    initIntroGrid();
  </script>
<script src="/sloppy-header/sloppy-bar.js"></script>
</body>
</html>
