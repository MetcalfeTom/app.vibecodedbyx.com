<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SLOPPY Token Dashboard</title>
  <link rel="icon" href="https://emojicdn.elk.sh/üìä">
  <meta property="og:title" content="SLOPPY Token Dashboard">
  <meta property="og:description" content="Live tracking of all SLOPPY tokens across chains">
  <meta property="og:url" content="https://app.sloppy.live/sloppy-dashboard">
  <meta property="og:image" content="https://app.sloppy.live/sloppy-dashboard/og-image.png">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&family=Space+Grotesk:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #0a0a0f;
      color: #c0c0cc;
      font-family: 'Space Grotesk', sans-serif;
      min-height: 100vh;
      line-height: 1.5;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 20px;
      border-bottom: 1px solid #1a1a25;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-icon {
      font-size: 32px;
    }

    h1 {
      font-family: 'JetBrains Mono', monospace;
      font-size: 22px;
      font-weight: 600;
      color: #ff66aa;
      text-shadow: 0 0 20px rgba(255, 102, 170, 0.3);
    }

    .subtitle {
      font-size: 12px;
      color: #666;
    }

    .header-stats {
      display: flex;
      gap: 25px;
      align-items: center;
    }

    .header-stat {
      text-align: right;
    }

    .header-stat-label {
      font-size: 10px;
      color: #555;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .header-stat-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 18px;
      font-weight: 600;
      color: #66ffaa;
    }

    .status-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: #0f0f15;
      border: 1px solid #1a1a25;
      border-radius: 8px;
      padding: 12px 16px;
      margin-bottom: 20px;
      font-size: 12px;
    }

    .status-left {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      background: #44ff88;
      border-radius: 50%;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; box-shadow: 0 0 5px #44ff88; }
      50% { opacity: 0.5; box-shadow: 0 0 10px #44ff88; }
    }

    .status-dot.error {
      background: #ff4444;
      animation: none;
    }

    .refresh-btn {
      background: #1a1a25;
      border: 1px solid #2a2a35;
      color: #888;
      padding: 6px 14px;
      border-radius: 6px;
      font-family: 'JetBrains Mono', monospace;
      font-size: 11px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .refresh-btn:hover {
      background: #2a2a35;
      color: #aaa;
    }

    .tokens-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }

    .token-card {
      background: linear-gradient(135deg, #0f0f18 0%, #12121a 100%);
      border: 1px solid #1a1a28;
      border-radius: 12px;
      padding: 18px;
      transition: all 0.2s;
    }

    .token-card:hover {
      border-color: #2a2a40;
      transform: translateY(-2px);
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
    }

    .token-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
    }

    .token-name {
      font-family: 'JetBrains Mono', monospace;
      font-size: 14px;
      font-weight: 600;
      color: #e0e0f0;
      margin-bottom: 4px;
    }

    .token-pair {
      font-size: 11px;
      color: #555;
    }

    .token-chain {
      background: #1a1a28;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 10px;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .token-chain.solana { background: #1a1525; color: #9945FF; }
    .token-chain.ethereum { background: #1a1a25; color: #627EEA; }
    .token-chain.bsc { background: #1a1a15; color: #F0B90B; }

    .token-price {
      font-family: 'JetBrains Mono', monospace;
      font-size: 24px;
      font-weight: 700;
      color: #fff;
      margin-bottom: 5px;
    }

    .token-change {
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      font-weight: 500;
    }

    .token-change.positive { color: #44ff88; }
    .token-change.negative { color: #ff4466; }

    .token-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #1a1a25;
    }

    .token-stat {
      background: #0a0a10;
      border-radius: 6px;
      padding: 10px;
    }

    .token-stat-label {
      font-size: 9px;
      color: #555;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 4px;
    }

    .token-stat-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 13px;
      color: #aaa;
    }

    .token-address {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid #1a1a25;
    }

    .token-address-text {
      font-family: 'JetBrains Mono', monospace;
      font-size: 10px;
      color: #4488cc;
      flex: 1;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .copy-btn {
      background: none;
      border: none;
      color: #555;
      cursor: pointer;
      font-size: 12px;
      padding: 4px;
    }

    .copy-btn:hover { color: #888; }

    .token-links {
      display: flex;
      gap: 6px;
      margin-top: 12px;
      flex-wrap: wrap;
    }

    .token-link {
      flex: 1;
      min-width: calc(50% - 3px);
      text-align: center;
      padding: 8px 6px;
      background: #12121a;
      border: 1px solid #1a1a28;
      border-radius: 6px;
      color: #666;
      text-decoration: none;
      font-size: 9px;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
    }

    .token-link:hover {
      background: #1a1a28;
      color: #aaa;
      border-color: #2a2a38;
    }

    .token-link.solscan:hover { border-color: #14F195; color: #14F195; }
    .token-link.birdeye:hover { border-color: #f0b90b; color: #f0b90b; }
    .token-link.dex:hover { border-color: #66aaff; color: #66aaff; }
    .token-link.holders:hover { border-color: #ff66aa; color: #ff66aa; }

    .link-icon {
      font-size: 11px;
    }

    .mini-chart {
      height: 40px;
      margin: 10px 0;
      background: #0a0a10;
      border-radius: 4px;
      overflow: hidden;
      position: relative;
    }

    .mini-chart canvas {
      width: 100%;
      height: 100%;
    }

    .loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 60px;
      color: #555;
    }

    .loading-spinner {
      width: 40px;
      height: 40px;
      border: 3px solid #1a1a25;
      border-top-color: #ff66aa;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 15px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .error-box {
      background: #1a1015;
      border: 1px solid #3a2025;
      border-radius: 8px;
      padding: 20px;
      text-align: center;
      color: #aa6666;
    }

    .totals-bar {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-bottom: 25px;
    }

    .total-card {
      background: #0f0f18;
      border: 1px solid #1a1a28;
      border-radius: 10px;
      padding: 16px;
      text-align: center;
    }

    .total-label {
      font-size: 10px;
      color: #555;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    .total-value {
      font-family: 'JetBrains Mono', monospace;
      font-size: 20px;
      font-weight: 600;
      color: #66ffaa;
    }

    .total-value.volume { color: #66aaff; }
    .total-value.mcap { color: #ffaa66; }
    .total-value.tokens { color: #ff66aa; }

    .back-link {
      display: block;
      text-align: center;
      color: #333;
      font-size: 12px;
      text-decoration: none;
      padding: 20px;
    }

    .back-link:hover { color: #666; }

    @media (max-width: 768px) {
      .header-stats { display: none; }
      .totals-bar { grid-template-columns: repeat(2, 1fr); }
      .tokens-grid { grid-template-columns: 1fr; }
      h1 { font-size: 18px; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo">
        <span class="logo-icon">üìä</span>
        <div>
          <h1>SLOPPY Dashboard</h1>
          <p class="subtitle">Live token tracking via DexScreener</p>
        </div>
      </div>
      <div class="header-stats">
        <div class="header-stat">
          <div class="header-stat-label">Total 24h Volume</div>
          <div class="header-stat-value" id="headerVolume">--</div>
        </div>
        <div class="header-stat">
          <div class="header-stat-label">Tokens Found</div>
          <div class="header-stat-value" id="headerTokens">--</div>
        </div>
      </div>
    </header>

    <div class="status-bar">
      <div class="status-left">
        <div class="status-dot" id="statusDot"></div>
        <span id="statusText">Connecting to DexScreener...</span>
      </div>
      <div>
        <span id="lastUpdate">--</span>
        <button class="refresh-btn" onclick="fetchData()">‚Üª Refresh</button>
      </div>
    </div>

    <div class="totals-bar" id="totalsBar">
      <div class="total-card">
        <div class="total-label">Total Volume (24h)</div>
        <div class="total-value volume" id="totalVolume">--</div>
      </div>
      <div class="total-card">
        <div class="total-label">Total Liquidity</div>
        <div class="total-value" id="totalLiquidity">--</div>
      </div>
      <div class="total-card">
        <div class="total-label">Combined Market Cap</div>
        <div class="total-value mcap" id="totalMcap">--</div>
      </div>
      <div class="total-card">
        <div class="total-label">Active Pairs</div>
        <div class="total-value tokens" id="totalPairs">--</div>
      </div>
    </div>

    <div class="tokens-grid" id="tokensGrid">
      <div class="loading">
        <div class="loading-spinner"></div>
        <span>Loading SLOPPY tokens...</span>
      </div>
    </div>

    <a class="back-link" href="https://sloppy.live">‚Üê sloppy.live</a>
  </div>

  <script>
    let tokensData = [];
    let refreshInterval;

    // Format number
    function formatNumber(num) {
      if (num === null || num === undefined || isNaN(num)) return '--';
      if (num >= 1e9) return '$' + (num / 1e9).toFixed(2) + 'B';
      if (num >= 1e6) return '$' + (num / 1e6).toFixed(2) + 'M';
      if (num >= 1e3) return '$' + (num / 1e3).toFixed(2) + 'K';
      return '$' + num.toFixed(2);
    }

    // Format price with appropriate decimals
    function formatPrice(price) {
      if (price === null || price === undefined || isNaN(price)) return '--';
      if (price < 0.00000001) return '$' + price.toExponential(2);
      if (price < 0.0001) return '$' + price.toFixed(10);
      if (price < 0.01) return '$' + price.toFixed(8);
      if (price < 1) return '$' + price.toFixed(6);
      if (price < 100) return '$' + price.toFixed(4);
      return '$' + price.toFixed(2);
    }

    // Copy to clipboard
    function copyAddress(address) {
      navigator.clipboard.writeText(address);
      // Brief visual feedback could be added here
    }

    // Draw mini sparkline
    function drawSparkline(canvasId, change) {
      const canvas = document.getElementById(canvasId);
      if (!canvas) return;

      const ctx = canvas.getContext('2d');
      canvas.width = canvas.offsetWidth * 2;
      canvas.height = 80;
      ctx.scale(2, 2);

      const width = canvas.offsetWidth;
      const height = 40;

      // Generate fake sparkline based on change direction
      const points = [];
      let value = 50;
      const trend = change >= 0 ? 0.3 : -0.3;

      for (let i = 0; i < 20; i++) {
        value += (Math.random() - 0.5 + trend) * 8;
        value = Math.max(10, Math.min(90, value));
        points.push(value);
      }

      // Normalize
      const min = Math.min(...points);
      const max = Math.max(...points);
      const range = max - min || 1;

      // Draw line
      const color = change >= 0 ? '#44ff88' : '#ff4466';
      ctx.strokeStyle = color;
      ctx.lineWidth = 1.5;
      ctx.beginPath();

      points.forEach((p, i) => {
        const x = (i / (points.length - 1)) * width;
        const y = height - ((p - min) / range) * (height - 10) - 5;
        if (i === 0) ctx.moveTo(x, y);
        else ctx.lineTo(x, y);
      });
      ctx.stroke();

      // Fill
      ctx.lineTo(width, height);
      ctx.lineTo(0, height);
      ctx.closePath();
      ctx.fillStyle = change >= 0 ? 'rgba(68, 255, 136, 0.1)' : 'rgba(255, 68, 102, 0.1)';
      ctx.fill();
    }

    // Render tokens
    function renderTokens() {
      const grid = document.getElementById('tokensGrid');

      if (tokensData.length === 0) {
        grid.innerHTML = `
          <div class="error-box">
            No SLOPPY tokens found. Try refreshing.
          </div>
        `;
        return;
      }

      // Sort by volume
      tokensData.sort((a, b) => (b.volume?.h24 || 0) - (a.volume?.h24 || 0));

      grid.innerHTML = tokensData.map((token, index) => {
        const price = parseFloat(token.priceUsd) || 0;
        const change = parseFloat(token.priceChange?.h24) || 0;
        const changeClass = change >= 0 ? 'positive' : 'negative';
        const changeSymbol = change >= 0 ? '+' : '';
        const chainClass = (token.chainId || '').toLowerCase();

        return `
          <div class="token-card">
            <div class="token-header">
              <div>
                <div class="token-name">${token.baseToken?.name || 'Unknown'}</div>
                <div class="token-pair">${token.baseToken?.symbol || '??'}/${token.quoteToken?.symbol || '??'}</div>
              </div>
              <span class="token-chain ${chainClass}">${token.chainId || 'Unknown'}</span>
            </div>

            <div class="token-price">${formatPrice(price)}</div>
            <div class="token-change ${changeClass}">${changeSymbol}${change.toFixed(2)}% (24h)</div>

            <div class="mini-chart">
              <canvas id="chart-${index}"></canvas>
            </div>

            <div class="token-stats">
              <div class="token-stat">
                <div class="token-stat-label">24h Volume</div>
                <div class="token-stat-value">${formatNumber(token.volume?.h24)}</div>
              </div>
              <div class="token-stat">
                <div class="token-stat-label">Liquidity</div>
                <div class="token-stat-value">${formatNumber(token.liquidity?.usd)}</div>
              </div>
              <div class="token-stat">
                <div class="token-stat-label">Market Cap</div>
                <div class="token-stat-value">${formatNumber(token.fdv)}</div>
              </div>
              <div class="token-stat">
                <div class="token-stat-label">DEX</div>
                <div class="token-stat-value">${token.dexId || '--'}</div>
              </div>
            </div>

            <div class="token-address">
              <span class="token-address-text">${token.baseToken?.address || '--'}</span>
              <button class="copy-btn" onclick="copyAddress('${token.baseToken?.address}')">üìã</button>
            </div>

            <div class="token-links">
              <a href="${token.url || '#'}" target="_blank" rel="noopener" class="token-link dex">
                <span class="link-icon">üìä</span> DexScreener
              </a>
              <a href="https://solscan.io/token/${token.baseToken?.address}" target="_blank" rel="noopener" class="token-link solscan">
                <span class="link-icon">üîç</span> Solscan
              </a>
              <a href="https://solscan.io/token/${token.baseToken?.address}#holders" target="_blank" rel="noopener" class="token-link holders">
                <span class="link-icon">üë•</span> Holders
              </a>
              <a href="https://birdeye.so/token/${token.baseToken?.address}?chain=solana" target="_blank" rel="noopener" class="token-link birdeye">
                <span class="link-icon">ü¶Ö</span> Birdeye
              </a>
            </div>
          </div>
        `;
      }).join('');

      // Draw sparklines after DOM update
      setTimeout(() => {
        tokensData.forEach((token, index) => {
          const change = parseFloat(token.priceChange?.h24) || 0;
          drawSparkline(`chart-${index}`, change);
        });
      }, 50);
    }

    // Update totals
    function updateTotals() {
      const totalVolume = tokensData.reduce((sum, t) => sum + (t.volume?.h24 || 0), 0);
      const totalLiquidity = tokensData.reduce((sum, t) => sum + (t.liquidity?.usd || 0), 0);
      const totalMcap = tokensData.reduce((sum, t) => sum + (t.fdv || 0), 0);

      document.getElementById('totalVolume').textContent = formatNumber(totalVolume);
      document.getElementById('totalLiquidity').textContent = formatNumber(totalLiquidity);
      document.getElementById('totalMcap').textContent = formatNumber(totalMcap);
      document.getElementById('totalPairs').textContent = tokensData.length;

      document.getElementById('headerVolume').textContent = formatNumber(totalVolume);
      document.getElementById('headerTokens').textContent = tokensData.length;
    }

    // Fetch data from DexScreener
    async function fetchData() {
      const statusDot = document.getElementById('statusDot');
      const statusText = document.getElementById('statusText');

      statusText.textContent = 'Fetching data...';

      try {
        const response = await fetch('https://api.dexscreener.com/latest/dex/search?q=sloppy');
        const data = await response.json();

        if (data.pairs && data.pairs.length > 0) {
          // Filter for tokens that actually have "sloppy" in the name
          tokensData = data.pairs.filter(p => {
            const name = (p.baseToken?.name || '').toLowerCase();
            const symbol = (p.baseToken?.symbol || '').toLowerCase();
            return name.includes('sloppy') || symbol.includes('sloppy');
          });

          statusDot.classList.remove('error');
          statusText.textContent = `Live ‚Ä¢ ${tokensData.length} tokens tracked`;
          document.getElementById('lastUpdate').textContent =
            'Updated: ' + new Date().toLocaleTimeString();

          renderTokens();
          updateTotals();
        } else {
          throw new Error('No data returned');
        }
      } catch (error) {
        statusDot.classList.add('error');
        statusText.textContent = 'Connection error';
        document.getElementById('tokensGrid').innerHTML = `
          <div class="error-box">
            Failed to fetch data from DexScreener. Please try again.
            <br><br>
            <button class="refresh-btn" onclick="fetchData()">‚Üª Retry</button>
          </div>
        `;
      }
    }

    // Auto-refresh every 30 seconds
    function startAutoRefresh() {
      if (refreshInterval) clearInterval(refreshInterval);
      refreshInterval = setInterval(fetchData, 30000);
    }

    // Initialize
    fetchData();
    startAutoRefresh();
  </script>
<script src="/apps/sloppy-header/sloppy-bar.js"></script>
<script src="/vibelib-extended.js"></script>
<script>
  // Compatibility Patch for Legacy Apps
  window.addEventListener("load", () => {
    if (window.SloppyKarma && window.VibeLib.Economy) {
      // Redirect old calls to new engine
      window.SloppyKarma.track = window.VibeLib.Economy.track;
    }
  });
</script>
</body>
</html>
