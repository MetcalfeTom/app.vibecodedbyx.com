<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Macbeth Mission · Quote Quest</title>
  <meta name="description" content="Train for Macbeth with a fast-paced quote game built for GCSE learners. Nail lines, decode themes, and crush exams." />
  <meta property="og:title" content="Macbeth Mission · Quote Quest" />
  <meta property="og:description" content="Train for Macbeth with a fast-paced quote game built for GCSE learners. Nail lines, decode themes, and crush exams." />
  <meta property="og:url" content="https://app.vibecodedbyx.com/macbeth-mission/" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="og.svg" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Macbeth Mission · Quote Quest" />
  <meta name="twitter:description" content="Train for Macbeth with a fast-paced quote game built for GCSE learners. Nail lines, decode themes, and crush exams." />
  <meta name="twitter:image" content="og.svg" />
  <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAxMDAgMTAwJz48dGV4dCB5PScuOWVtJyBmb250LXNpemU9JzkwJz7wn5SpPC90ZXh0Pjwvc3ZnPg==" />
  <style>
    :root {
      color-scheme: light dark;
      font-family: "Inter", "Segoe UI", system-ui, sans-serif;
      --bg: #120b23;
      --panel: rgba(255, 255, 255, 0.08);
      --panel-strong: rgba(255, 255, 255, 0.16);
      --text: #f5e6ff;
      --accent: #ff4d8d;
      --accent-soft: #b893ff;
      --success: #7ce577;
      --warning: #ffd166;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      height: 100vh;
      background: radial-gradient(circle at top, #392162, #120b23 55%);
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow: hidden;
      padding: 20px 16px 32px;
      gap: 16px;
    }

    header {
      text-align: center;
      max-width: 840px;
      padding: 0 12px;
      display: grid;
      gap: 10px;
    }

    header h1 {
      font-size: clamp(2.4rem, 5vw, 3.6rem);
      margin: 0;
      font-family: "DM Serif Display", "Georgia", serif;
      letter-spacing: 0.01em;
    }

    header p {
      margin: 0;
      font-size: clamp(1rem, 2.4vw, 1.2rem);
      color: rgba(245, 230, 255, 0.84);
      line-height: 1.4;
    }

    header a {
      color: var(--warning);
      font-weight: 600;
      text-decoration: none;
    }

    main {
      width: min(1040px, 100%);
      flex: 1;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      grid-auto-rows: minmax(0, 1fr);
      gap: 18px;
      overflow-y: auto;
      padding-right: 6px;
    }

    main::-webkit-scrollbar {
      width: 10px;
    }

    main::-webkit-scrollbar-thumb {
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.2);
    }

    .panel {
      background: var(--panel);
      border: 1px solid rgba(255, 255, 255, 0.18);
      border-radius: 22px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 16px;
      backdrop-filter: blur(14px);
      box-shadow: 0 20px 45px rgba(7, 2, 18, 0.45);
      min-height: 0;
      transition: transform 0.2s ease, border-color 0.2s ease;
    }

    .panel:hover {
      transform: translateY(-3px);
      border-color: rgba(255, 255, 255, 0.32);
    }

    .challenge {
      grid-column: 1 / -1;
    }

    .challenge h2 {
      margin: 0;
      font-size: 1.6rem;
    }

    .meta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      font-size: 0.95rem;
      color: rgba(245, 230, 255, 0.78);
    }

    progress {
      width: 100%;
      height: 12px;
      border-radius: 999px;
      overflow: hidden;
      background-color: rgba(255, 255, 255, 0.12);
    }

    progress::-webkit-progress-bar {
      background-color: rgba(255, 255, 255, 0.12);
    }

    progress::-webkit-progress-value {
      background: linear-gradient(90deg, var(--accent), var(--accent-soft));
    }

    progress::-moz-progress-bar {
      background: linear-gradient(90deg, var(--accent), var(--accent-soft));
    }

    blockquote {
      margin: 0;
      padding: 16px;
      border-left: 4px solid var(--accent);
      background: rgba(255, 255, 255, 0.08);
      border-radius: 16px;
      font-style: italic;
      line-height: 1.5;
      font-size: 1.1rem;
    }

    .question {
      margin: 0;
      font-size: 1.15rem;
      font-weight: 600;
    }

    .options {
      display: grid;
      gap: 12px;
    }

    .options button {
      all: unset;
      padding: 14px 16px;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.12);
      border: 1px solid transparent;
      cursor: pointer;
      font-weight: 600;
      line-height: 1.4;
      transition: transform 0.15s ease, border-color 0.2s ease, background 0.2s ease;
    }

    .options button:hover,
    .options button:focus-visible {
      border-color: rgba(255, 255, 255, 0.36);
      background: rgba(255, 255, 255, 0.18);
      transform: translateY(-2px);
    }

    .options button.correct {
      border-color: rgba(124, 229, 119, 0.9);
      background: rgba(124, 229, 119, 0.15);
      color: var(--success);
    }

    .options button.incorrect {
      border-color: rgba(214, 93, 177, 0.8);
      background: rgba(214, 93, 177, 0.16);
    }

    .feedback {
      min-height: 60px;
      padding: 12px 14px;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.08);
      line-height: 1.45;
      color: rgba(245, 230, 255, 0.9);
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .controls button {
      all: unset;
      padding: 10px 18px;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.24);
      cursor: pointer;
      font-weight: 600;
      transition: transform 0.15s ease, background 0.2s ease;
    }

    .controls button:hover,
    .controls button:focus-visible {
      background: var(--panel-strong);
    }

    .controls button:disabled {
      cursor: not-allowed;
      opacity: 0.6;
    }

    .study-grid {
      display: grid;
      gap: 12px;
    }

    .quote-card {
      padding: 14px;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.08);
      display: grid;
      gap: 6px;
    }

    .quote-card strong {
      font-size: 1rem;
    }

    .quote-card span {
      font-size: 0.92rem;
      color: rgba(245, 230, 255, 0.82);
    }

    .act-map ul {
      margin: 0;
      padding-left: 18px;
      display: grid;
      gap: 8px;
      line-height: 1.4;
    }

    .log {
      overflow-y: auto;
      gap: 10px;
    }

    .log-entry {
      padding: 12px;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.08);
      font-size: 0.95rem;
      line-height: 1.4;
    }

    @media (max-width: 720px) {
      body {
        padding: 16px 12px 24px;
        gap: 12px;
      }

      main {
        padding-right: 0;
      }

      .controls {
        justify-content: center;
      }
    }
  </style>
  <script src="supabase-config.js"></script>
</head>
<body>
  <header>
    <h1>Macbeth Mission</h1>
    <p>Speed-run the biggest Macbeth quotes in five minutes. Lock in who said what, why it matters, and how to flex it in essays. Built live for 15-year-old legends watching the stream.</p>
    <p><a href="https://www.vibecodedbyx.com" target="_blank" rel="noopener">Watch the livestream</a></p>
  </header>

  <main>
    <section class="panel challenge" aria-live="polite">
      <div class="meta-row">
        <span id="round-label">Challenge 1 of 6</span>
        <span id="score-label">Score: 0</span>
      </div>
      <progress id="progress" value="0" max="6">0%</progress>
      <blockquote id="quote-text">"Fair is foul, and foul is fair."</blockquote>
      <p class="question" id="question-text">Which theme does this quote launch?</p>
      <div class="meta-row" id="act-label">Act 1, Scene 1 · Weird Sisters</div>
      <div class="options" id="options"></div>
      <div class="feedback" id="feedback" aria-live="polite">Pick the best answer to drop a study fact in chat.</div>
      <div class="controls">
        <button type="button" id="next-button" disabled>Next challenge</button>
        <button type="button" id="reset-button">Restart run</button>
        <button type="button" id="share-button">Share score</button>
      </div>
    </section>

    <section class="panel study" aria-label="Power quotes toolkit">
      <h2>Power Quotes Toolkit</h2>
      <div class="study-grid">
        <div class="quote-card">
          <strong>"Look like the innocent flower, but be the serpent under't."</strong>
          <span>Lady Macbeth weaponises appearance vs. reality to push Macbeth into murder. Theme fuel + character insight = double marks.</span>
        </div>
        <div class="quote-card">
          <strong>"Stars, hide your fires; let not light see my black and deep desires."</strong>
          <span>Macbeth knows his ambition is dark. Great for ambition + inner conflict paragraphs.</span>
        </div>
        <div class="quote-card">
          <strong>"Out, damned spot!"</strong>
          <span>Lady Macbeth's guilt erupts in Act 5. Perfect reversal of her Act 2 confidence.</span>
        </div>
      </div>
    </section>

    <section class="panel act-map" aria-label="Act tracker">
      <h2>Plot Speedrun</h2>
      <ul>
        <li><strong>Act 1:</strong> Witches prophesy, Lady Macbeth hatches the plan. Ambition ignites.</li>
        <li><strong>Act 2:</strong> Duncan murdered; Macbeth hears phantom voices. Guilt enters.</li>
        <li><strong>Act 3:</strong> Banquo gone, Banquo's ghost haunts the banquet. Paranoia takes over.</li>
        <li><strong>Act 4:</strong> Apparitions twist Macbeth's confidence. Macduff’s family slaughtered.</li>
        <li><strong>Act 5:</strong> Lady Macbeth sleepwalks, Birnam Wood moves, Macbeth falls.</li>
      </ul>
    </section>

    <section class="panel log" id="log" aria-live="polite" aria-label="Challenge log"></section>
  </main>

  <template id="option-template">
    <button type="button"></button>
  </template>

  <template id="log-template">
    <div class="log-entry"></div>
  </template>

  <script>
    const challenges = [
      {
        quote: "Fair is foul, and foul is fair.",
        question: "Which theme does this quote launch?",
        options: [
          "Appearance vs. reality",
          "Hospitality",
          "Nature vs. nurture",
        ],
        answer: 0,
        act: "Act 1, Scene 1 · Weird Sisters",
        insight: "The witches flip morality, foreshadowing how Macbeth will mask his crimes under polite court vibes.",
      },
      {
        quote: "Look like the innocent flower, but be the serpent under't.",
        question: "What is Lady Macbeth telling Macbeth to do?",
        options: [
          "Hide violent intent behind a calm face",
          "Wait patiently for fate to act",
          "Abandon the murder plan completely",
        ],
        answer: 0,
        act: "Act 1, Scene 5 · Lady Macbeth",
        insight: "She weaponises deception, showing who really drives the murder at this point.",
      },
      {
        quote: "Is this a dagger which I see before me, the handle toward my hand?",
        question: "What does the dagger vision reveal?",
        options: [
          "Macbeth's guilt hallucinating the murder",
          "A prophecy that Banquo will betray him",
          "An enchanted weapon gifted by the witches",
        ],
        answer: 0,
        act: "Act 2, Scene 1 · Macbeth solo",
        insight: "His mind turns the plan into a hallucination, proving ambition is already shredding his sanity.",
      },
      {
        quote: "Thou canst not say I did it: never shake thy gory locks at me.",
        question: "Why is this moment key at the banquet?",
        options: [
          "Macbeth publicly unravels while seeing Banquo's ghost",
          "Banquo returns alive to expose Macbeth",
          "The nobles finally crown Macbeth king",
        ],
        answer: 0,
        act: "Act 3, Scene 4 · Banquet",
        insight: "The vision exposes his paranoia, destroying the smooth king persona he worked for.",
      },
      {
        quote: "Out, damned spot! out, I say!",
        question: "What has happened to Lady Macbeth here?",
        options: [
          "She relives the murder in guilty sleepwalking",
          "She uncovers a literal bloodstain on the crown",
          "She orders another assassination",
        ],
        answer: 0,
        act: "Act 5, Scene 1 · Doctor & Gentlewoman",
        insight: "Her mind can't scrub the guilt she once mocked Macbeth for. Perfect for consequences of ambition.",
      },
      {
        quote: "Macduff was from his mother's womb untimely ripped.",
        question: "How does this line destroy Macbeth's confidence?",
        options: [
          "It proves the witches' prophecy had a loophole",
          "It crowns Macduff the next king",
          "It means Macbeth can no longer fight with a sword",
        ],
        answer: 0,
        act: "Act 5, Scene 8 · Final duel",
        insight: "Macbeth learns Macduff isn't "born of woman" in the usual way, so destiny finally catches him.",
      },
    ];

    const state = {
      index: 0,
      score: 0,
      answered: false,
      log: [],
    };

    const quoteText = document.getElementById("quote-text");
    const questionText = document.getElementById("question-text");
    const optionsWrap = document.getElementById("options");
    const optionTemplate = document.getElementById("option-template");
    const feedback = document.getElementById("feedback");
    const nextButton = document.getElementById("next-button");
    const resetButton = document.getElementById("reset-button");
    const shareButton = document.getElementById("share-button");
    const roundLabel = document.getElementById("round-label");
    const scoreLabel = document.getElementById("score-label");
    const actLabel = document.getElementById("act-label");
    const progressBar = document.getElementById("progress");
    const logContainer = document.getElementById("log");
    const logTemplate = document.getElementById("log-template");

    function renderChallenge() {
      if (state.index >= challenges.length) {
        renderSummary();
        return;
      }

      const challenge = challenges[state.index];
      roundLabel.textContent = `Challenge ${state.index + 1} of ${challenges.length}`;
      scoreLabel.textContent = `Score: ${state.score}`;
      progressBar.value = state.index;
      progressBar.max = challenges.length;
      quoteText.textContent = `"${challenge.quote}"`;
      questionText.textContent = challenge.question;
      actLabel.textContent = challenge.act;
      feedback.textContent = "Pick the best answer to drop a study fact in chat.";
      optionsWrap.innerHTML = "";
      nextButton.disabled = true;
      state.answered = false;

      challenge.options.forEach((optionText, optionIndex) => {
        const button = optionTemplate.content.firstElementChild.cloneNode(true);
        button.textContent = optionText;
        button.addEventListener("click", () => handleChoice(optionIndex));
        optionsWrap.append(button);
      });
    }

    function handleChoice(selectedIndex) {
      if (state.answered) {
        return;
      }

      if (state.answered || state.index >= challenges.length) {
        return;
      }

      state.answered = true;
      const challenge = challenges[state.index];
      const buttons = optionsWrap.querySelectorAll("button");

      buttons.forEach((btn, idx) => {
        btn.classList.toggle("correct", idx === challenge.answer);
        if (idx === selectedIndex && idx !== challenge.answer) {
          btn.classList.add("incorrect");
        }
      });

      const correct = selectedIndex === challenge.answer;
      if (correct) {
        state.score += 1;
      }

      const resultText = correct ? "Correct!" : "Not quite.";
      feedback.textContent = `${resultText} ${challenge.insight}`;

      state.log.push({
        quote: challenge.quote,
        correct,
        insight: challenge.insight,
      });
      renderLog();

      nextButton.disabled = false;
      scoreLabel.textContent = `Score: ${state.score}`;
    }

    function renderLog() {
      logContainer.innerHTML = '<h2>Challenge Log</h2>';
      if (state.log.length === 0) {
        const empty = logTemplate.content.firstElementChild.cloneNode(true);
        empty.textContent = "Your study trail will appear here. Smash a challenge to unlock insights.";
        logContainer.append(empty);
        return;
      }

      const start = Math.max(0, state.log.length - 10);
      state.log.slice(start).forEach((entry, index) => {
        const node = logTemplate.content.firstElementChild.cloneNode(true);
        const number = start + index + 1;
        node.textContent = `${number}. "${entry.quote}" — ${entry.correct ? "✅" : "❌"} ${entry.insight}`;
        logContainer.append(node);
      });
    }

    function nextChallenge() {
      if (!state.answered && state.index < challenges.length) {
        feedback.textContent = "Have a go at a quote before racing ahead.";
        return;
      }

      state.index += 1;
      if (state.index >= challenges.length) {
        renderSummary();
      } else {
        renderChallenge();
      }
    }

    function renderSummary() {
      progressBar.value = challenges.length;
      roundLabel.textContent = "Run completed";
      questionText.textContent = "Nice work! Review your feedback and play again to lock the lines.";
      actLabel.textContent = "Macbeth mastery unlocked";
      optionsWrap.innerHTML = "";
      nextButton.textContent = "Play again";
      nextButton.disabled = false;
      feedback.textContent = `You nailed ${state.score} out of ${challenges.length}. Drop that stat in your study group.`;
      quoteText.textContent = `You nailed ${state.score} out of ${challenges.length}.`;
    }

    function resetGame() {
      state.index = 0;
      state.score = 0;
      state.answered = false;
      state.log = [];
      nextButton.textContent = "Next challenge";
      logContainer.innerHTML = "";
      renderLog();
      renderChallenge();
    }

    nextButton.addEventListener("click", () => {
      if (state.index >= challenges.length) {
        resetGame();
        return;
      }
      nextChallenge();
    });

    resetButton.addEventListener("click", resetGame);

    shareButton.addEventListener("click", async () => {
      const shareData = {
        title: "Macbeth Mission",
        text: `I scored ${state.score}/${challenges.length} on the Macbeth Mission quote quest! Can you top it?`,
        url: window.location.href,
      };

      if (navigator.share) {
        try {
          await navigator.share(shareData);
        } catch (error) {
          console.warn("Share cancelled", error);
        }
      } else {
        navigator.clipboard?.writeText(`${shareData.text} ${shareData.url}`)
          .then(() => alert("Score copied! Paste it into the group chat."))
          .catch(() => alert("Couldn't share automatically. Screenshot your score instead!"));
      }
    });

    resetGame();
  </script>
</body>
</html>
