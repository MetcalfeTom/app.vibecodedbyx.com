<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sloppy's Gift</title>
  <link rel="icon" href="https://emojicdn.elk.sh/üéÅ">

  <meta property="og:title" content="Sloppy's Gift">
  <meta property="og:description" content="Receive a unique digital artifact generated just for you">
  <meta property="og:url" content="https://sloppy.live/sloppys-gift">
  <meta property="og:image" content="https://sloppy.live/sloppys-gift/og-image.png">
  <meta property="og:type" content="website">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #050510;
      --neon-pink: #ff00ff;
      --neon-cyan: #00ffff;
      --neon-green: #00ff88;
      --neon-purple: #aa00ff;
      --neon-orange: #ff8800;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Share Tech Mono', monospace;
      background: var(--bg);
      color: white;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Animated background */
    .bg-grid {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image:
        linear-gradient(rgba(0, 255, 255, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(0, 255, 255, 0.03) 1px, transparent 1px);
      background-size: 50px 50px;
      animation: grid-move 20s linear infinite;
      z-index: 0;
    }

    @keyframes grid-move {
      0% { transform: perspective(500px) rotateX(60deg) translateY(0); }
      100% { transform: perspective(500px) rotateX(60deg) translateY(50px); }
    }

    .main-container {
      position: relative;
      z-index: 1;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 40px;
      padding: 40px 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .gift-section {
      text-align: center;
      flex: 1;
      min-width: 340px;
      max-width: 400px;
    }

    .leaderboard-section {
      flex: 1;
      min-width: 320px;
      max-width: 450px;
    }

    h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 2.2rem;
      margin-bottom: 10px;
      background: linear-gradient(135deg, var(--neon-pink), var(--neon-cyan));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    h2 {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.3rem;
      margin-bottom: 20px;
      color: var(--neon-cyan);
      text-shadow: 0 0 20px var(--neon-cyan);
    }

    .subtitle {
      color: rgba(255, 255, 255, 0.5);
      margin-bottom: 30px;
      font-size: 0.9rem;
    }

    /* Gift card container */
    .gift-card {
      position: relative;
      width: 300px;
      height: 400px;
      margin: 0 auto 30px;
      perspective: 1000px;
    }

    .gift-inner {
      position: relative;
      width: 100%;
      height: 100%;
      background: linear-gradient(135deg, #0a0a1a, #1a1a2e);
      border-radius: 20px;
      padding: 18px;
      box-shadow:
        0 0 40px rgba(255, 0, 255, 0.3),
        0 0 80px rgba(0, 255, 255, 0.2),
        inset 0 0 60px rgba(255, 0, 255, 0.1);
      border: 2px solid;
      border-image: linear-gradient(135deg, var(--neon-pink), var(--neon-cyan)) 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      animation: card-glow 3s ease-in-out infinite;
    }

    @keyframes card-glow {
      0%, 100% { box-shadow: 0 0 40px rgba(255, 0, 255, 0.3), 0 0 80px rgba(0, 255, 255, 0.2); }
      50% { box-shadow: 0 0 60px rgba(255, 0, 255, 0.5), 0 0 100px rgba(0, 255, 255, 0.3); }
    }

    .sigil-container {
      width: 180px;
      height: 180px;
      margin: 8px 0 15px;
    }

    #sigilCanvas {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.4);
    }

    .gift-id {
      font-family: 'Orbitron', sans-serif;
      font-size: 0.65rem;
      color: var(--neon-cyan);
      letter-spacing: 0.15em;
      margin-bottom: 8px;
      text-shadow: 0 0 10px var(--neon-cyan);
    }

    .gift-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 1rem;
      margin-bottom: 6px;
      background: linear-gradient(90deg, var(--neon-pink), var(--neon-cyan));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .gift-message {
      font-size: 0.75rem;
      color: rgba(255, 255, 255, 0.7);
      line-height: 1.4;
      text-align: center;
      padding: 0 8px;
    }

    .gift-stats {
      display: flex;
      gap: 18px;
      margin-top: auto;
      padding-top: 12px;
      border-top: 1px solid rgba(255, 255, 255, 0.1);
      width: 100%;
      justify-content: center;
    }

    .stat-value {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.1rem;
      color: var(--neon-green);
      text-shadow: 0 0 10px var(--neon-green);
    }

    .stat-label {
      font-size: 0.6rem;
      color: rgba(255, 255, 255, 0.4);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .rarity {
      position: absolute;
      top: 12px;
      right: 12px;
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 0.6rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    .rarity-common { background: linear-gradient(135deg, #666, #888); }
    .rarity-uncommon { background: linear-gradient(135deg, #00aa44, #00ff66); color: #000; }
    .rarity-rare { background: linear-gradient(135deg, #0066ff, #00ccff); }
    .rarity-epic { background: linear-gradient(135deg, #aa00ff, #ff00aa); }
    .rarity-legendary { background: linear-gradient(135deg, #ff8800, #ffcc00); color: #000; }

    /* Buttons */
    .actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .btn {
      padding: 12px 20px;
      font-family: 'Orbitron', sans-serif;
      font-size: 0.75rem;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--neon-pink), var(--neon-purple));
      color: white;
      box-shadow: 0 0 20px rgba(255, 0, 255, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 0 40px rgba(255, 0, 255, 0.6);
    }

    .btn-secondary {
      background: transparent;
      color: var(--neon-cyan);
      border: 2px solid var(--neon-cyan);
      box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
    }

    .btn-secondary:hover {
      background: rgba(0, 255, 255, 0.1);
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
    }

    .btn-submit {
      background: linear-gradient(135deg, var(--neon-green), #00aa66);
      color: #000;
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.4);
    }

    .btn-submit:hover {
      box-shadow: 0 0 40px rgba(0, 255, 136, 0.6);
    }

    .btn-submit:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Leaderboard */
    .leaderboard {
      background: rgba(10, 10, 26, 0.9);
      border: 1px solid rgba(0, 255, 255, 0.3);
      border-radius: 12px;
      padding: 20px;
      max-height: 500px;
      overflow-y: auto;
    }

    .leaderboard-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .tab-btn {
      flex: 1;
      padding: 10px;
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: rgba(255, 255, 255, 0.5);
      font-family: 'Orbitron', sans-serif;
      font-size: 0.7rem;
      cursor: pointer;
      border-radius: 6px;
      transition: all 0.2s;
    }

    .tab-btn.active {
      background: rgba(0, 255, 255, 0.1);
      border-color: var(--neon-cyan);
      color: var(--neon-cyan);
    }

    .leaderboard-entry {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      transition: background 0.2s;
    }

    .leaderboard-entry:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .leaderboard-entry:last-child {
      border-bottom: none;
    }

    .rank {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.2rem;
      width: 30px;
      text-align: center;
      color: var(--neon-cyan);
    }

    .rank-1 { color: #ffcc00; text-shadow: 0 0 10px #ffcc00; }
    .rank-2 { color: #ccc; text-shadow: 0 0 10px #ccc; }
    .rank-3 { color: #cd7f32; text-shadow: 0 0 10px #cd7f32; }

    .entry-info {
      flex: 1;
    }

    .entry-user {
      font-size: 0.85rem;
      color: white;
      margin-bottom: 2px;
    }

    .entry-title {
      font-size: 0.7rem;
      color: rgba(255, 255, 255, 0.5);
    }

    .entry-rarity {
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 0.55rem;
      font-weight: 700;
      text-transform: uppercase;
    }

    .entry-score {
      font-family: 'Orbitron', sans-serif;
      font-size: 1rem;
      color: var(--neon-green);
      text-shadow: 0 0 10px var(--neon-green);
    }

    .no-entries {
      text-align: center;
      padding: 40px;
      color: rgba(255, 255, 255, 0.4);
      font-size: 0.85rem;
    }

    .submit-status {
      margin-top: 15px;
      font-size: 0.8rem;
      color: var(--neon-green);
      text-shadow: 0 0 10px var(--neon-green);
    }

    .submit-status.error {
      color: #ff4444;
      text-shadow: 0 0 10px #ff4444;
    }

    footer {
      text-align: center;
      padding: 20px;
      font-size: 0.8rem;
      color: rgba(255, 255, 255, 0.3);
    }

    footer a {
      color: var(--neon-cyan);
      text-decoration: none;
    }

    .generating .gift-inner {
      animation: generating 0.5s ease-in-out;
    }

    @keyframes generating {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(0.95); }
    }

    @media (max-width: 700px) {
      .main-container { flex-direction: column; align-items: center; }
      .leaderboard-section { max-width: 100%; }
    }
  </style>
</head>
<body>
  <div class="bg-grid"></div>

  <div class="main-container">
    <div class="gift-section">
      <h1>SLOPPY'S GIFT</h1>
      <p class="subtitle">A unique digital artifact, generated just for you</p>

      <div class="gift-card" id="giftCard">
        <div class="gift-inner">
          <span class="rarity" id="rarity">Common</span>
          <div class="sigil-container">
            <canvas id="sigilCanvas" width="400" height="400"></canvas>
          </div>
          <div class="gift-id" id="giftId">GIFT-0000-0000</div>
          <div class="gift-title" id="giftTitle">Loading...</div>
          <div class="gift-message" id="giftMessage">Generating your artifact...</div>
          <div class="gift-stats">
            <div class="stat">
              <div class="stat-value" id="statPower">0</div>
              <div class="stat-label">Power</div>
            </div>
            <div class="stat">
              <div class="stat-value" id="statLuck">0</div>
              <div class="stat-label">Luck</div>
            </div>
            <div class="stat">
              <div class="stat-value" id="statVibes">0</div>
              <div class="stat-label">Vibes</div>
            </div>
          </div>
        </div>
      </div>

      <div class="actions">
        <button class="btn btn-primary" onclick="generateGift()">New Gift</button>
        <button class="btn btn-submit" id="submitBtn" onclick="submitToLeaderboard()">Submit</button>
        <button class="btn btn-secondary" onclick="saveGift()">Save</button>
      </div>
      <div class="submit-status" id="submitStatus"></div>
    </div>

    <div class="leaderboard-section">
      <h2>üèÜ LEADERBOARD</h2>
      <div class="leaderboard-tabs">
        <button class="tab-btn active" onclick="switchTab('vibes')">Top Vibes</button>
        <button class="tab-btn" onclick="switchTab('rarity')">Rarest</button>
        <button class="tab-btn" onclick="switchTab('recent')">Recent</button>
      </div>
      <div class="leaderboard" id="leaderboard">
        <div class="no-entries">Loading leaderboard...</div>
      </div>
    </div>
  </div>

  <footer>
    A gift from <a href="https://sloppy.live" target="_blank">sloppy.live</a>
  </footer>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

    const supabaseUrl = 'https://gfzaoppypyaatzglamjv.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdmemFvcHB5cHlhYXR6Z2xhbWp2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzU0MDc0NzgsImV4cCI6MjA1MDk4MzQ3OH0.sz8aCPnSH-7dSOsD7FMiPuznL8599HPsXxj82zPDLdk';
    const supabase = createClient(supabaseUrl, supabaseKey);

    let currentUser = null;
    let currentGift = null;
    let currentTab = 'vibes';

    const titles = [
      "Essence of Chaos", "Digital Sunrise", "Quantum Whisper", "Neon Dreams",
      "Void Walker", "Pixel Phoenix", "Cyber Bloom", "Static Soul",
      "Electric Heart", "Data Stream", "Glitch Garden", "Binary Star",
      "Code Serpent", "Infinite Loop", "Neural Spark", "Astral Byte",
      "Shadow Protocol", "Crystal Matrix", "Flame Algorithm", "Frozen Signal"
    ];

    const messages = [
      "This artifact pulses with the energy of a thousand late-night coding sessions.",
      "Forged in the digital void, it carries the dreams of silicon minds.",
      "A fragment of the collective unconscious, crystallized in pure light.",
      "Listen closely and you'll hear the whispers of forgotten algorithms.",
      "This gift remembers every click, every scroll, every moment of wonder.",
      "Born from chaos, refined by intention, given with digital love.",
      "A piece of the infinite, wrapped in finite pixels for you.",
      "The universe compressed this moment into pure, glowing data.",
      "Somewhere, a random seed chose you. You are the chosen one.",
      "This artifact vibrates at the frequency of pure vibe energy."
    ];

    const rarities = [
      { name: "Common", class: "rarity-common", chance: 0.5, rank: 1 },
      { name: "Uncommon", class: "rarity-uncommon", chance: 0.25, rank: 2 },
      { name: "Rare", class: "rarity-rare", chance: 0.15, rank: 3 },
      { name: "Epic", class: "rarity-epic", chance: 0.08, rank: 4 },
      { name: "Legendary", class: "rarity-legendary", chance: 0.02, rank: 5 }
    ];

    // Auth
    async function initAuth() {
      const { data: { session } } = await supabase.auth.getSession();
      if (session) {
        currentUser = session.user;
      } else {
        const { data, error } = await supabase.auth.signInAnonymously();
        if (data?.user) currentUser = data.user;
      }
    }

    function seededRandom(seed) {
      const x = Math.sin(seed++) * 10000;
      return x - Math.floor(x);
    }

    window.generateGift = function() {
      const seed = Date.now() + Math.random() * 1000000;
      const card = document.getElementById('giftCard');
      card.classList.add('generating');
      setTimeout(() => card.classList.remove('generating'), 500);

      const id = `GIFT-${Math.random().toString(36).substr(2, 4).toUpperCase()}-${Math.random().toString(36).substr(2, 4).toUpperCase()}`;
      document.getElementById('giftId').textContent = id;

      const roll = Math.random();
      let cumulative = 0;
      let rarity = rarities[0];
      for (const r of rarities) {
        cumulative += r.chance;
        if (roll < cumulative) { rarity = r; break; }
      }

      const rarityEl = document.getElementById('rarity');
      rarityEl.textContent = rarity.name;
      rarityEl.className = `rarity ${rarity.class}`;

      const title = titles[Math.floor(Math.random() * titles.length)];
      document.getElementById('giftTitle').textContent = title;
      document.getElementById('giftMessage').textContent = messages[Math.floor(Math.random() * messages.length)];

      const rarityMultiplier = rarities.indexOf(rarity) + 1;
      const power = Math.floor(10 + Math.random() * 20 * rarityMultiplier);
      const luck = Math.floor(5 + Math.random() * 15 * rarityMultiplier);
      const vibes = Math.floor(50 + Math.random() * 50 * rarityMultiplier);

      document.getElementById('statPower').textContent = power;
      document.getElementById('statLuck').textContent = luck;
      document.getElementById('statVibes').textContent = vibes;

      currentGift = {
        gift_id: id,
        title: title,
        rarity: rarity.name,
        rarity_rank: rarity.rank,
        power: power,
        luck: luck,
        vibes: vibes,
        total_score: power + luck + vibes
      };

      drawSigil(seed, rarity);
      document.getElementById('submitStatus').textContent = '';
      document.getElementById('submitBtn').disabled = false;
    };

    function drawSigil(seed, rarity) {
      const canvas = document.getElementById('sigilCanvas');
      const ctx = canvas.getContext('2d');
      const w = canvas.width, h = canvas.height;
      const cx = w / 2, cy = h / 2;

      ctx.fillStyle = '#0a0a1a';
      ctx.fillRect(0, 0, w, h);

      const palettes = {
        'rarity-common': ['#888', '#aaa', '#666'],
        'rarity-uncommon': ['#00ff66', '#00aa44', '#88ffaa'],
        'rarity-rare': ['#00ccff', '#0066ff', '#88ddff'],
        'rarity-epic': ['#ff00aa', '#aa00ff', '#ff88dd'],
        'rarity-legendary': ['#ffcc00', '#ff8800', '#ffee88']
      };
      const colors = palettes[rarity.class] || palettes['rarity-common'];
      let s = seed;

      ctx.strokeStyle = colors[0];
      ctx.lineWidth = 3;
      ctx.shadowColor = colors[0];
      ctx.shadowBlur = 20;
      ctx.beginPath();
      ctx.arc(cx, cy, 180, 0, Math.PI * 2);
      ctx.stroke();

      const numShapes = 3 + Math.floor(seededRandom(s++) * 4);
      for (let i = 0; i < numShapes; i++) {
        const shapeType = Math.floor(seededRandom(s++) * 4);
        const color = colors[Math.floor(seededRandom(s++) * colors.length)];
        ctx.strokeStyle = color;
        ctx.shadowColor = color;
        ctx.shadowBlur = 15;
        ctx.lineWidth = 2;

        if (shapeType === 0) {
          const sides = 3 + Math.floor(seededRandom(s++) * 5);
          const radius = 40 + seededRandom(s++) * 100;
          const rotation = seededRandom(s++) * Math.PI * 2;
          ctx.beginPath();
          for (let j = 0; j <= sides; j++) {
            const angle = rotation + (j / sides) * Math.PI * 2;
            const x = cx + Math.cos(angle) * radius;
            const y = cy + Math.sin(angle) * radius;
            j === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
          }
          ctx.stroke();
        } else if (shapeType === 1) {
          const r1 = 60 + seededRandom(s++) * 60;
          const r2 = 20 + seededRandom(s++) * 40;
          const d = 30 + seededRandom(s++) * 50;
          ctx.beginPath();
          for (let t = 0; t < Math.PI * 20; t += 0.05) {
            const x = cx + (r1 - r2) * Math.cos(t) + d * Math.cos((r1 - r2) / r2 * t);
            const y = cy + (r1 - r2) * Math.sin(t) - d * Math.sin((r1 - r2) / r2 * t);
            t === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
          }
          ctx.stroke();
        } else if (shapeType === 2) {
          const numCircles = 3 + Math.floor(seededRandom(s++) * 4);
          for (let j = 0; j < numCircles; j++) {
            ctx.beginPath();
            ctx.arc(cx, cy, 30 + j * 30, 0, Math.PI * 2);
            ctx.stroke();
          }
        } else {
          const rays = 5 + Math.floor(seededRandom(s++) * 8);
          const innerR = 30 + seededRandom(s++) * 30;
          const outerR = 80 + seededRandom(s++) * 80;
          ctx.beginPath();
          for (let j = 0; j < rays * 2; j++) {
            const angle = (j / (rays * 2)) * Math.PI * 2 - Math.PI / 2;
            const r = j % 2 === 0 ? outerR : innerR;
            ctx.lineTo(cx + Math.cos(angle) * r, cy + Math.sin(angle) * r);
          }
          ctx.closePath();
          ctx.stroke();
        }
      }

      ctx.fillStyle = colors[0];
      ctx.shadowBlur = 30;
      ctx.beginPath();
      ctx.arc(cx, cy, 8, 0, Math.PI * 2);
      ctx.fill();

      ctx.shadowBlur = 10;
      for (let i = 0; i < 20; i++) {
        const angle = seededRandom(s++) * Math.PI * 2;
        const dist = 50 + seededRandom(s++) * 120;
        const size = 1 + seededRandom(s++) * 3;
        ctx.fillStyle = colors[Math.floor(seededRandom(s++) * colors.length)];
        ctx.beginPath();
        ctx.arc(cx + Math.cos(angle) * dist, cy + Math.sin(angle) * dist, size, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    window.saveGift = function() {
      const canvas = document.getElementById('sigilCanvas');
      const link = document.createElement('a');
      link.download = `sloppys-gift-${Date.now()}.png`;
      link.href = canvas.toDataURL('image/png');
      link.click();
    };

    window.submitToLeaderboard = async function() {
      if (!currentGift || !currentUser) {
        document.getElementById('submitStatus').textContent = 'Please generate a gift first';
        document.getElementById('submitStatus').className = 'submit-status error';
        return;
      }

      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;

      try {
        const { error } = await supabase.from('sloppys_gift_leaderboard').insert({
          username: 'Anonymous',
          gift_id: currentGift.gift_id,
          title: currentGift.title,
          rarity: currentGift.rarity,
          rarity_rank: currentGift.rarity_rank,
          power: currentGift.power,
          luck: currentGift.luck,
          vibes: currentGift.vibes,
          total_score: currentGift.total_score,
          user_id: currentUser.id
        });

        if (error) throw error;

        document.getElementById('submitStatus').textContent = '‚úì Submitted to leaderboard!';
        document.getElementById('submitStatus').className = 'submit-status';
        loadLeaderboard();
      } catch (err) {
        console.error(err);
        document.getElementById('submitStatus').textContent = 'Failed to submit';
        document.getElementById('submitStatus').className = 'submit-status error';
        submitBtn.disabled = false;
      }
    };

    window.switchTab = function(tab) {
      currentTab = tab;
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.toggle('active', btn.textContent.toLowerCase().includes(tab));
      });
      loadLeaderboard();
    };

    async function loadLeaderboard() {
      const container = document.getElementById('leaderboard');

      let query = supabase.from('sloppys_gift_leaderboard').select('*').limit(20);

      if (currentTab === 'vibes') {
        query = query.order('vibes', { ascending: false });
      } else if (currentTab === 'rarity') {
        query = query.order('rarity_rank', { ascending: false }).order('total_score', { ascending: false });
      } else {
        query = query.order('created_at', { ascending: false });
      }

      const { data, error } = await query;

      if (error || !data || data.length === 0) {
        container.innerHTML = '<div class="no-entries">No entries yet. Be the first!</div>';
        return;
      }

      container.innerHTML = data.map((entry, i) => `
        <div class="leaderboard-entry">
          <div class="rank ${i < 3 ? 'rank-' + (i + 1) : ''}">${i + 1}</div>
          <div class="entry-info">
            <div class="entry-user">${entry.username || 'Anonymous'}</div>
            <div class="entry-title">${entry.title} (${entry.gift_id})</div>
          </div>
          <span class="entry-rarity rarity-${entry.rarity.toLowerCase()}">${entry.rarity}</span>
          <div class="entry-score">${currentTab === 'vibes' ? entry.vibes : entry.total_score}</div>
        </div>
      `).join('');
    }

    // Init
    async function init() {
      await initAuth();
      window.generateGift();
      loadLeaderboard();
    }

    init();
  </script>
</body>
</html>
