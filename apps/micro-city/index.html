<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Micro City</title>
  <link rel="icon" href="https://emojicdn.elk.sh/üèôÔ∏è">
  <meta property="og:title" content="Micro City">
  <meta property="og:description" content="Build your own tiny city with zones and economy!">
  <meta property="og:url" content="https://sloppy.live/micro-city">
  <meta property="og:image" content="https://sloppy.live/micro-city/og-image.png">
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&family=Space+Mono&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #1a2634;
      min-height: 100vh;
      font-family: 'Outfit', sans-serif;
      color: #e0e8f0;
      display: flex;
      flex-direction: column;
    }

    .header {
      background: #0d1520;
      padding: 10px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 10px;
      border-bottom: 2px solid #2a3f55;
    }

    h1 {
      font-size: 1.4rem;
      font-weight: 700;
      color: #4fc3f7;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .stats {
      display: flex;
      gap: 20px;
      font-family: 'Space Mono', monospace;
      font-size: 0.85rem;
    }

    .stat {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .stat-icon {
      font-size: 1.1rem;
    }

    .stat-value {
      color: #4fc3f7;
      font-weight: 700;
    }

    .main {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    .toolbar {
      background: #0d1520;
      padding: 15px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      border-right: 2px solid #2a3f55;
      width: 180px;
    }

    .tool-section {
      margin-bottom: 10px;
    }

    .tool-label {
      font-size: 0.7rem;
      color: #6a8299;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 8px;
    }

    .tools {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .tool-btn {
      background: #1a2634;
      border: 2px solid #2a3f55;
      padding: 10px;
      font-family: 'Outfit', sans-serif;
      font-size: 0.85rem;
      color: #e0e8f0;
      cursor: pointer;
      border-radius: 6px;
      display: flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s;
    }

    .tool-btn:hover {
      background: #2a3f55;
    }

    .tool-btn.active {
      border-color: #4fc3f7;
      background: rgba(79, 195, 247, 0.15);
    }

    .tool-btn.residential { border-left: 4px solid #4caf50; }
    .tool-btn.commercial { border-left: 4px solid #2196f3; }
    .tool-btn.industrial { border-left: 4px solid #ff9800; }
    .tool-btn.road { border-left: 4px solid #9e9e9e; }
    .tool-btn.bulldoze { border-left: 4px solid #f44336; }

    .tool-key {
      margin-left: auto;
      font-size: 0.7rem;
      color: #6a8299;
      background: #0d1520;
      padding: 2px 6px;
      border-radius: 3px;
    }

    .canvas-container {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      overflow: auto;
    }

    canvas {
      border: 2px solid #2a3f55;
      border-radius: 8px;
      cursor: crosshair;
      image-rendering: pixelated;
    }

    .panel {
      background: #0d1520;
      padding: 15px;
      border-left: 2px solid #2a3f55;
      width: 200px;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .panel-title {
      font-size: 0.8rem;
      font-weight: 700;
      color: #4fc3f7;
      margin-bottom: 10px;
    }

    .demand-bars {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .demand-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .demand-label {
      width: 20px;
      font-size: 0.75rem;
      font-weight: 700;
    }

    .demand-label.r { color: #4caf50; }
    .demand-label.c { color: #2196f3; }
    .demand-label.i { color: #ff9800; }

    .demand-bar-bg {
      flex: 1;
      height: 12px;
      background: #1a2634;
      border-radius: 3px;
      overflow: hidden;
    }

    .demand-bar {
      height: 100%;
      transition: width 0.3s;
    }

    .demand-bar.r { background: #4caf50; }
    .demand-bar.c { background: #2196f3; }
    .demand-bar.i { background: #ff9800; }

    .info-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
    }

    .info-item {
      background: #1a2634;
      padding: 8px;
      border-radius: 4px;
      text-align: center;
    }

    .info-value {
      font-size: 1.1rem;
      font-weight: 700;
      color: #4fc3f7;
    }

    .info-label {
      font-size: 0.65rem;
      color: #6a8299;
      text-transform: uppercase;
    }

    .speed-controls {
      display: flex;
      gap: 5px;
    }

    .speed-btn {
      flex: 1;
      background: #1a2634;
      border: 1px solid #2a3f55;
      padding: 6px;
      color: #e0e8f0;
      cursor: pointer;
      border-radius: 4px;
      font-size: 0.8rem;
    }

    .speed-btn:hover {
      background: #2a3f55;
    }

    .speed-btn.active {
      background: #4fc3f7;
      color: #0d1520;
    }

    .back-link {
      text-align: center;
      padding: 10px;
      color: #2a3f55;
      text-decoration: none;
      font-size: 0.7rem;
    }

    .back-link:hover {
      color: #4fc3f7;
    }

    @media (max-width: 800px) {
      .main {
        flex-direction: column;
      }
      .toolbar {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        border-right: none;
        border-bottom: 2px solid #2a3f55;
      }
      .tool-section {
        margin-bottom: 0;
      }
      .tools {
        flex-direction: row;
      }
      .panel {
        width: 100%;
        border-left: none;
        border-top: 2px solid #2a3f55;
      }
    }
  </style>
</head>
<body>
  <header class="header">
    <h1>üèôÔ∏è Micro City</h1>
    <div class="stats">
      <div class="stat">
        <span class="stat-icon">üë•</span>
        <span class="stat-value" id="population">0</span>
      </div>
      <div class="stat">
        <span class="stat-icon">üí∞</span>
        <span class="stat-value" id="money">$10,000</span>
      </div>
      <div class="stat">
        <span class="stat-icon">üìÖ</span>
        <span class="stat-value" id="date">Year 1</span>
      </div>
    </div>
  </header>

  <div class="main">
    <div class="toolbar">
      <div class="tool-section">
        <div class="tool-label">Zones</div>
        <div class="tools">
          <button class="tool-btn residential active" data-tool="residential">
            üè† Residential
            <span class="tool-key">1</span>
          </button>
          <button class="tool-btn commercial" data-tool="commercial">
            üè™ Commercial
            <span class="tool-key">2</span>
          </button>
          <button class="tool-btn industrial" data-tool="industrial">
            üè≠ Industrial
            <span class="tool-key">3</span>
          </button>
        </div>
      </div>
      <div class="tool-section">
        <div class="tool-label">Infrastructure</div>
        <div class="tools">
          <button class="tool-btn road" data-tool="road">
            üõ§Ô∏è Road
            <span class="tool-key">4</span>
          </button>
        </div>
      </div>
      <div class="tool-section">
        <div class="tool-label">Tools</div>
        <div class="tools">
          <button class="tool-btn bulldoze" data-tool="bulldoze">
            üí• Bulldoze
            <span class="tool-key">5</span>
          </button>
        </div>
      </div>
    </div>

    <div class="canvas-container">
      <canvas id="city"></canvas>
    </div>

    <div class="panel">
      <div>
        <div class="panel-title">RCI Demand</div>
        <div class="demand-bars">
          <div class="demand-row">
            <span class="demand-label r">R</span>
            <div class="demand-bar-bg"><div class="demand-bar r" id="demandR" style="width:50%"></div></div>
          </div>
          <div class="demand-row">
            <span class="demand-label c">C</span>
            <div class="demand-bar-bg"><div class="demand-bar c" id="demandC" style="width:50%"></div></div>
          </div>
          <div class="demand-row">
            <span class="demand-label i">I</span>
            <div class="demand-bar-bg"><div class="demand-bar i" id="demandI" style="width:50%"></div></div>
          </div>
        </div>
      </div>

      <div>
        <div class="panel-title">City Stats</div>
        <div class="info-grid">
          <div class="info-item">
            <div class="info-value" id="resCount">0</div>
            <div class="info-label">Homes</div>
          </div>
          <div class="info-item">
            <div class="info-value" id="comCount">0</div>
            <div class="info-label">Shops</div>
          </div>
          <div class="info-item">
            <div class="info-value" id="indCount">0</div>
            <div class="info-label">Factories</div>
          </div>
          <div class="info-item">
            <div class="info-value" id="roadCount">0</div>
            <div class="info-label">Roads</div>
          </div>
        </div>
      </div>

      <div>
        <div class="panel-title">Game Speed</div>
        <div class="speed-controls">
          <button class="speed-btn" data-speed="0">‚è∏</button>
          <button class="speed-btn active" data-speed="1">‚ñ∂</button>
          <button class="speed-btn" data-speed="2">‚ñ∂‚ñ∂</button>
          <button class="speed-btn" data-speed="3">‚ñ∂‚ñ∂‚ñ∂</button>
        </div>
      </div>
    </div>
  </div>

  <a href="https://sloppy.live" class="back-link">sloppy.live</a>

  <script>
    const canvas = document.getElementById('city');
    const ctx = canvas.getContext('2d');

    // Grid settings
    const GRID_SIZE = 40;
    const CELL_SIZE = 16;
    canvas.width = GRID_SIZE * CELL_SIZE;
    canvas.height = GRID_SIZE * CELL_SIZE;

    // Cell types
    const EMPTY = 0;
    const ROAD = 1;
    const RESIDENTIAL = 2;
    const COMMERCIAL = 3;
    const INDUSTRIAL = 4;

    // Building levels (0 = zone only, 1-3 = building level)
    const grid = [];
    const buildings = [];

    // Initialize grid
    for (let y = 0; y < GRID_SIZE; y++) {
      grid[y] = [];
      buildings[y] = [];
      for (let x = 0; x < GRID_SIZE; x++) {
        grid[y][x] = EMPTY;
        buildings[y][x] = 0;
      }
    }

    // Game state
    let money = 10000;
    let population = 0;
    let year = 1;
    let gameSpeed = 1;
    let selectedTool = 'residential';
    let tickCount = 0;

    // Demand (0-100)
    let demandR = 50;
    let demandC = 50;
    let demandI = 50;

    // Costs
    const costs = {
      residential: 100,
      commercial: 150,
      industrial: 200,
      road: 50,
      bulldoze: 10
    };

    // Colors
    const colors = {
      empty: '#1a2634',
      road: '#4a5568',
      roadLine: '#ffd700',
      zoneR: '#2d4a2d',
      zoneC: '#2d3a4a',
      zoneI: '#4a3a2d',
      buildR: ['#4caf50', '#66bb6a', '#81c784'],
      buildC: ['#2196f3', '#42a5f5', '#64b5f6'],
      buildI: ['#ff9800', '#ffa726', '#ffb74d'],
      grid: '#2a3f55'
    };

    // Tool selection
    document.querySelectorAll('.tool-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        selectedTool = btn.dataset.tool;
      });
    });

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      const keyMap = { '1': 'residential', '2': 'commercial', '3': 'industrial', '4': 'road', '5': 'bulldoze' };
      if (keyMap[e.key]) {
        document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
        document.querySelector(`[data-tool="${keyMap[e.key]}"]`).classList.add('active');
        selectedTool = keyMap[e.key];
      }
    });

    // Speed controls
    document.querySelectorAll('.speed-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.speed-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        gameSpeed = parseInt(btn.dataset.speed);
      });
    });

    // Mouse handling
    let isDrawing = false;

    canvas.addEventListener('mousedown', (e) => {
      isDrawing = true;
      handleDraw(e);
    });

    canvas.addEventListener('mousemove', (e) => {
      if (isDrawing) handleDraw(e);
    });

    canvas.addEventListener('mouseup', () => isDrawing = false);
    canvas.addEventListener('mouseleave', () => isDrawing = false);

    // Touch support
    canvas.addEventListener('touchstart', (e) => {
      e.preventDefault();
      isDrawing = true;
      handleDraw(e.touches[0]);
    });

    canvas.addEventListener('touchmove', (e) => {
      e.preventDefault();
      if (isDrawing) handleDraw(e.touches[0]);
    });

    canvas.addEventListener('touchend', () => isDrawing = false);

    function handleDraw(e) {
      const rect = canvas.getBoundingClientRect();
      const scaleX = canvas.width / rect.width;
      const scaleY = canvas.height / rect.height;
      const x = Math.floor((e.clientX - rect.left) * scaleX / CELL_SIZE);
      const y = Math.floor((e.clientY - rect.top) * scaleY / CELL_SIZE);

      if (x < 0 || x >= GRID_SIZE || y < 0 || y >= GRID_SIZE) return;

      const cost = costs[selectedTool];

      if (selectedTool === 'bulldoze') {
        if (grid[y][x] !== EMPTY) {
          grid[y][x] = EMPTY;
          buildings[y][x] = 0;
          money -= cost;
        }
      } else if (grid[y][x] === EMPTY && money >= cost) {
        const typeMap = { residential: RESIDENTIAL, commercial: COMMERCIAL, industrial: INDUSTRIAL, road: ROAD };
        grid[y][x] = typeMap[selectedTool];
        buildings[y][x] = 0;
        money -= cost;
      }

      updateUI();
      draw();
    }

    function draw() {
      // Clear
      ctx.fillStyle = colors.empty;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Draw grid
      ctx.strokeStyle = colors.grid;
      ctx.lineWidth = 0.5;
      for (let i = 0; i <= GRID_SIZE; i++) {
        ctx.beginPath();
        ctx.moveTo(i * CELL_SIZE, 0);
        ctx.lineTo(i * CELL_SIZE, canvas.height);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(0, i * CELL_SIZE);
        ctx.lineTo(canvas.width, i * CELL_SIZE);
        ctx.stroke();
      }

      // Draw cells
      for (let y = 0; y < GRID_SIZE; y++) {
        for (let x = 0; x < GRID_SIZE; x++) {
          const type = grid[y][x];
          const level = buildings[y][x];
          const px = x * CELL_SIZE;
          const py = y * CELL_SIZE;

          if (type === ROAD) {
            drawRoad(x, y, px, py);
          } else if (type === RESIDENTIAL) {
            ctx.fillStyle = colors.zoneR;
            ctx.fillRect(px + 1, py + 1, CELL_SIZE - 2, CELL_SIZE - 2);
            if (level > 0) drawBuilding(px, py, colors.buildR[level - 1], level);
          } else if (type === COMMERCIAL) {
            ctx.fillStyle = colors.zoneC;
            ctx.fillRect(px + 1, py + 1, CELL_SIZE - 2, CELL_SIZE - 2);
            if (level > 0) drawBuilding(px, py, colors.buildC[level - 1], level);
          } else if (type === INDUSTRIAL) {
            ctx.fillStyle = colors.zoneI;
            ctx.fillRect(px + 1, py + 1, CELL_SIZE - 2, CELL_SIZE - 2);
            if (level > 0) drawFactory(px, py, colors.buildI[level - 1], level);
          }
        }
      }
    }

    function drawRoad(x, y, px, py) {
      ctx.fillStyle = colors.road;
      ctx.fillRect(px, py, CELL_SIZE, CELL_SIZE);

      // Road markings
      ctx.fillStyle = colors.roadLine;
      const hasTop = y > 0 && grid[y-1][x] === ROAD;
      const hasBottom = y < GRID_SIZE-1 && grid[y+1][x] === ROAD;
      const hasLeft = x > 0 && grid[y][x-1] === ROAD;
      const hasRight = x < GRID_SIZE-1 && grid[y][x+1] === ROAD;

      if ((hasTop || hasBottom) && !hasLeft && !hasRight) {
        ctx.fillRect(px + CELL_SIZE/2 - 1, py, 2, CELL_SIZE);
      } else if ((hasLeft || hasRight) && !hasTop && !hasBottom) {
        ctx.fillRect(px, py + CELL_SIZE/2 - 1, CELL_SIZE, 2);
      } else {
        ctx.fillRect(px + CELL_SIZE/2 - 1, py + CELL_SIZE/2 - 1, 2, 2);
      }
    }

    function drawBuilding(px, py, color, level) {
      const height = 4 + level * 3;
      const width = 8 + level * 2;
      const bx = px + (CELL_SIZE - width) / 2;
      const by = py + CELL_SIZE - height - 2;

      ctx.fillStyle = color;
      ctx.fillRect(bx, by, width, height);

      // Windows
      ctx.fillStyle = '#ffeb3b';
      for (let wy = 0; wy < level; wy++) {
        for (let wx = 0; wx < 2; wx++) {
          ctx.fillRect(bx + 2 + wx * 4, by + 2 + wy * 3, 2, 2);
        }
      }
    }

    function drawFactory(px, py, color, level) {
      const width = 10 + level;
      const height = 6 + level * 2;
      const bx = px + (CELL_SIZE - width) / 2;
      const by = py + CELL_SIZE - height - 2;

      ctx.fillStyle = color;
      ctx.fillRect(bx, by, width, height);

      // Chimney
      ctx.fillRect(bx + width - 3, by - 3, 2, 3);

      // Smoke
      if (level > 1) {
        ctx.fillStyle = 'rgba(150, 150, 150, 0.5)';
        ctx.beginPath();
        ctx.arc(bx + width - 2, by - 5, 2, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    function isNearRoad(x, y) {
      const dirs = [[0, -1], [0, 1], [-1, 0], [1, 0]];
      for (const [dx, dy] of dirs) {
        const nx = x + dx;
        const ny = y + dy;
        if (nx >= 0 && nx < GRID_SIZE && ny >= 0 && ny < GRID_SIZE) {
          if (grid[ny][nx] === ROAD) return true;
        }
      }
      return false;
    }

    function gameTick() {
      if (gameSpeed === 0) return;

      tickCount++;

      // Count zones
      let resZones = 0, comZones = 0, indZones = 0;
      let resBuild = 0, comBuild = 0, indBuild = 0;

      for (let y = 0; y < GRID_SIZE; y++) {
        for (let x = 0; x < GRID_SIZE; x++) {
          const type = grid[y][x];
          const level = buildings[y][x];

          if (type === RESIDENTIAL) {
            resZones++;
            if (level > 0) resBuild += level;
          } else if (type === COMMERCIAL) {
            comZones++;
            if (level > 0) comBuild += level;
          } else if (type === INDUSTRIAL) {
            indZones++;
            if (level > 0) indBuild += level;
          }
        }
      }

      // Update demand based on balance
      demandR = 50 + (comBuild + indBuild - resBuild * 0.8) * 2;
      demandC = 50 + (resBuild * 0.5 - comBuild) * 2;
      demandI = 50 + (resBuild * 0.3 + comBuild * 0.3 - indBuild) * 2;

      demandR = Math.max(0, Math.min(100, demandR));
      demandC = Math.max(0, Math.min(100, demandC));
      demandI = Math.max(0, Math.min(100, demandI));

      // Try to develop zones
      if (tickCount % (10 / gameSpeed) === 0) {
        for (let y = 0; y < GRID_SIZE; y++) {
          for (let x = 0; x < GRID_SIZE; x++) {
            const type = grid[y][x];
            const level = buildings[y][x];

            if (type === EMPTY || type === ROAD) continue;
            if (!isNearRoad(x, y)) continue;
            if (level >= 3) continue;

            let canGrow = false;
            let demand = 0;

            if (type === RESIDENTIAL && demandR > 40) {
              demand = demandR;
              canGrow = true;
            } else if (type === COMMERCIAL && demandC > 40) {
              demand = demandC;
              canGrow = true;
            } else if (type === INDUSTRIAL && demandI > 40) {
              demand = demandI;
              canGrow = true;
            }

            if (canGrow && Math.random() < demand / 200) {
              buildings[y][x]++;
            }
          }
        }
      }

      // Calculate population and income
      population = resBuild * 100;
      const income = Math.floor(comBuild * 50 + indBuild * 30);
      const expenses = Math.floor(resBuild * 10 + comBuild * 5 + indBuild * 5);

      if (tickCount % (30 / gameSpeed) === 0) {
        money += income - expenses;
        year++;
      }

      updateUI();
      draw();
    }

    function updateUI() {
      document.getElementById('population').textContent = population.toLocaleString();
      document.getElementById('money').textContent = '$' + money.toLocaleString();
      document.getElementById('date').textContent = 'Year ' + year;

      document.getElementById('demandR').style.width = demandR + '%';
      document.getElementById('demandC').style.width = demandC + '%';
      document.getElementById('demandI').style.width = demandI + '%';

      // Count stats
      let res = 0, com = 0, ind = 0, roads = 0;
      for (let y = 0; y < GRID_SIZE; y++) {
        for (let x = 0; x < GRID_SIZE; x++) {
          if (grid[y][x] === RESIDENTIAL && buildings[y][x] > 0) res++;
          if (grid[y][x] === COMMERCIAL && buildings[y][x] > 0) com++;
          if (grid[y][x] === INDUSTRIAL && buildings[y][x] > 0) ind++;
          if (grid[y][x] === ROAD) roads++;
        }
      }

      document.getElementById('resCount').textContent = res;
      document.getElementById('comCount').textContent = com;
      document.getElementById('indCount').textContent = ind;
      document.getElementById('roadCount').textContent = roads;
    }

    // Game loop
    setInterval(gameTick, 500);

    // Initial draw
    draw();
    updateUI();
  </script>
</body>
</html>
