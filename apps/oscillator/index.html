<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Neon Oscillator</title>
  <link rel="icon" href="https://emojicdn.elk.sh/üéõÔ∏è">
  <meta name="description" content="Synthesize neon soundwaves with multiple oscillators and live visualization">
  <meta property="og:title" content="Neon Oscillator">
  <meta property="og:description" content="Synthesize neon soundwaves with multiple oscillators and live visualization">
  <meta property="og:image" content="https://emojicdn.elk.sh/üéõÔ∏è?style=google">
  <meta property="og:url" content="https://sloppy.live/oscillator">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: linear-gradient(135deg, #0a0a0f 0%, #1a0a2e 50%, #0a1a1f 100%);
      min-height: 100vh;
      font-family: 'Share Tech Mono', monospace;
      color: #fff;
      overflow-x: hidden;
    }
    .back-link {
      position: fixed;
      top: 15px; left: 15px;
      color: rgba(255,255,255,0.3);
      text-decoration: none;
      font-size: 0.8rem;
      z-index: 100;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 60px 20px 20px;
    }
    h1 {
      text-align: center;
      font-size: 1.8rem;
      color: #0ff;
      text-shadow: 0 0 20px #0ff, 0 0 40px #0ff;
      margin-bottom: 30px;
      letter-spacing: 4px;
    }
    .visualizer-container {
      background: rgba(0,0,0,0.5);
      border: 1px solid rgba(0,255,255,0.3);
      border-radius: 10px;
      padding: 10px;
      margin-bottom: 25px;
    }
    #visualizer {
      width: 100%;
      height: 150px;
      display: block;
      border-radius: 5px;
    }
    .vis-modes {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 10px;
    }
    .vis-btn {
      padding: 5px 15px;
      background: rgba(0,255,255,0.1);
      border: 1px solid rgba(0,255,255,0.3);
      color: #0ff;
      font-family: inherit;
      font-size: 0.7rem;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .vis-btn:hover, .vis-btn.active {
      background: rgba(0,255,255,0.3);
      box-shadow: 0 0 15px rgba(0,255,255,0.3);
    }
    .oscillators {
      display: grid;
      gap: 15px;
    }
    .osc-panel {
      background: rgba(0,0,0,0.4);
      border: 1px solid rgba(255,0,255,0.3);
      border-radius: 10px;
      padding: 15px;
    }
    .osc-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }
    .osc-title {
      color: #f0f;
      font-size: 1rem;
      text-shadow: 0 0 10px #f0f;
    }
    .osc-toggle {
      width: 50px;
      height: 26px;
      background: rgba(255,255,255,0.1);
      border-radius: 13px;
      cursor: pointer;
      position: relative;
      transition: all 0.3s;
    }
    .osc-toggle.active {
      background: rgba(0,255,136,0.4);
      box-shadow: 0 0 15px rgba(0,255,136,0.5);
    }
    .osc-toggle::after {
      content: '';
      position: absolute;
      width: 22px;
      height: 22px;
      background: #fff;
      border-radius: 50%;
      top: 2px;
      left: 2px;
      transition: all 0.3s;
    }
    .osc-toggle.active::after {
      left: 26px;
      background: #0f8;
    }
    .osc-controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }
    .control-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    .control-label {
      font-size: 0.7rem;
      color: rgba(255,255,255,0.6);
      display: flex;
      justify-content: space-between;
    }
    .control-value {
      color: #0ff;
    }
    input[type="range"] {
      width: 100%;
      height: 8px;
      -webkit-appearance: none;
      background: rgba(255,255,255,0.1);
      border-radius: 4px;
      outline: none;
    }
    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      background: linear-gradient(135deg, #0ff, #f0f);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 0 10px #0ff;
    }
    .wave-types {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    .wave-btn {
      padding: 8px 12px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.2);
      color: #aaa;
      font-family: inherit;
      font-size: 0.7rem;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .wave-btn:hover {
      border-color: rgba(255,0,255,0.5);
      color: #fff;
    }
    .wave-btn.active {
      background: rgba(255,0,255,0.3);
      border-color: #f0f;
      color: #fff;
      box-shadow: 0 0 15px rgba(255,0,255,0.3);
    }
    .keyboard {
      margin-top: 25px;
      background: rgba(0,0,0,0.4);
      border: 1px solid rgba(255,255,0,0.3);
      border-radius: 10px;
      padding: 15px;
    }
    .keyboard-title {
      color: #ff0;
      font-size: 0.9rem;
      margin-bottom: 10px;
      text-shadow: 0 0 10px #ff0;
    }
    .keys {
      display: flex;
      gap: 3px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .key {
      width: 45px;
      height: 100px;
      background: linear-gradient(180deg, #333 0%, #111 100%);
      border: 1px solid #444;
      border-radius: 0 0 5px 5px;
      cursor: pointer;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      align-items: center;
      padding-bottom: 8px;
      font-size: 0.6rem;
      color: #666;
      transition: all 0.1s;
      user-select: none;
    }
    .key:hover {
      background: linear-gradient(180deg, #444 0%, #222 100%);
    }
    .key.active {
      background: linear-gradient(180deg, #0ff 0%, #08a 100%);
      box-shadow: 0 0 20px rgba(0,255,255,0.5), inset 0 0 20px rgba(255,255,255,0.2);
      color: #000;
    }
    .key .note {
      font-size: 0.7rem;
      color: inherit;
    }
    .key .hotkey {
      font-size: 0.5rem;
      opacity: 0.5;
    }
    .master {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 20px;
      align-items: center;
    }
    .master-vol {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .master-label {
      color: #0f8;
      font-size: 0.8rem;
    }
    .master-slider {
      width: 150px;
    }
    .instructions {
      text-align: center;
      margin-top: 20px;
      font-size: 0.7rem;
      color: rgba(255,255,255,0.4);
    }
  </style>
</head>
<body>
  <a href="https://sloppy.live" class="back-link">‚Üê back</a>
  
  <div class="container">
    <h1>NEON OSCILLATOR</h1>
    
    <div class="visualizer-container">
      <canvas id="visualizer"></canvas>
      <div class="vis-modes">
        <button class="vis-btn active" onclick="setVisMode('wave')">WAVEFORM</button>
        <button class="vis-btn" onclick="setVisMode('bars')">SPECTRUM</button>
        <button class="vis-btn" onclick="setVisMode('circle')">CIRCLE</button>
      </div>
    </div>
    
    <div class="oscillators">
      <div class="osc-panel" id="osc1Panel">
        <div class="osc-header">
          <span class="osc-title">OSC 1</span>
          <div class="osc-toggle active" id="osc1Toggle" onclick="toggleOsc(1)"></div>
        </div>
        <div class="osc-controls">
          <div class="control-group">
            <div class="control-label">WAVE TYPE</div>
            <div class="wave-types" id="wave1">
              <button class="wave-btn active" data-wave="sine">SINE</button>
              <button class="wave-btn" data-wave="square">SQUARE</button>
              <button class="wave-btn" data-wave="sawtooth">SAW</button>
              <button class="wave-btn" data-wave="triangle">TRI</button>
            </div>
          </div>
          <div class="control-group">
            <div class="control-label">DETUNE <span class="control-value" id="detune1Val">0</span></div>
            <input type="range" id="detune1" min="-100" max="100" value="0">
          </div>
          <div class="control-group">
            <div class="control-label">GAIN <span class="control-value" id="gain1Val">0.5</span></div>
            <input type="range" id="gain1" min="0" max="100" value="50">
          </div>
        </div>
      </div>
      
      <div class="osc-panel" id="osc2Panel">
        <div class="osc-header">
          <span class="osc-title">OSC 2</span>
          <div class="osc-toggle" id="osc2Toggle" onclick="toggleOsc(2)"></div>
        </div>
        <div class="osc-controls">
          <div class="control-group">
            <div class="control-label">WAVE TYPE</div>
            <div class="wave-types" id="wave2">
              <button class="wave-btn" data-wave="sine">SINE</button>
              <button class="wave-btn active" data-wave="square">SQUARE</button>
              <button class="wave-btn" data-wave="sawtooth">SAW</button>
              <button class="wave-btn" data-wave="triangle">TRI</button>
            </div>
          </div>
          <div class="control-group">
            <div class="control-label">DETUNE <span class="control-value" id="detune2Val">0</span></div>
            <input type="range" id="detune2" min="-100" max="100" value="0">
          </div>
          <div class="control-group">
            <div class="control-label">GAIN <span class="control-value" id="gain2Val">0.3</span></div>
            <input type="range" id="gain2" min="0" max="100" value="30">
          </div>
        </div>
      </div>
    </div>
    
    <div class="keyboard">
      <div class="keyboard-title">KEYBOARD</div>
      <div class="keys" id="keyboard"></div>
    </div>
    
    <div class="master">
      <div class="master-vol">
        <span class="master-label">MASTER</span>
        <input type="range" class="master-slider" id="masterVol" min="0" max="100" value="70">
      </div>
    </div>
    
    <div class="instructions">Press keys A-L or click to play ‚Ä¢ Toggle oscillators for layered sound</div>
  </div>

  <script>
    // Audio context
    let audioCtx = null;
    let masterGain = null;
    let analyser = null;
    const activeNotes = {};
    
    // Oscillator settings
    const oscSettings = {
      1: { enabled: true, wave: 'sine', detune: 0, gain: 0.5 },
      2: { enabled: false, wave: 'square', detune: 0, gain: 0.3 }
    };
    
    // Notes and frequencies
    const notes = [
      { note: 'C4', freq: 261.63, key: 'a' },
      { note: 'D4', freq: 293.66, key: 's' },
      { note: 'E4', freq: 329.63, key: 'd' },
      { note: 'F4', freq: 349.23, key: 'f' },
      { note: 'G4', freq: 392.00, key: 'g' },
      { note: 'A4', freq: 440.00, key: 'h' },
      { note: 'B4', freq: 493.88, key: 'j' },
      { note: 'C5', freq: 523.25, key: 'k' },
      { note: 'D5', freq: 587.33, key: 'l' },
    ];
    
    // Visualizer
    const canvas = document.getElementById('visualizer');
    const ctx = canvas.getContext('2d');
    let visMode = 'wave';
    
    function resize() {
      canvas.width = canvas.offsetWidth * 2;
      canvas.height = canvas.offsetHeight * 2;
    }
    resize();
    window.addEventListener('resize', resize);
    
    // Initialize audio
    function initAudio() {
      if (audioCtx) return;
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      
      masterGain = audioCtx.createGain();
      masterGain.gain.value = 0.7;
      
      analyser = audioCtx.createAnalyser();
      analyser.fftSize = 2048;
      
      masterGain.connect(analyser);
      analyser.connect(audioCtx.destination);
      
      drawVisualizer();
    }
    
    // Play note
    function playNote(freq, noteId) {
      initAudio();
      
      if (activeNotes[noteId]) return;
      
      const noteData = { oscillators: [], gains: [] };
      
      for (let i = 1; i <= 2; i++) {
        if (!oscSettings[i].enabled) continue;
        
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        
        osc.type = oscSettings[i].wave;
        osc.frequency.value = freq;
        osc.detune.value = oscSettings[i].detune;
        
        gain.gain.value = 0;
        gain.gain.linearRampToValueAtTime(oscSettings[i].gain, audioCtx.currentTime + 0.02);
        
        osc.connect(gain);
        gain.connect(masterGain);
        osc.start();
        
        noteData.oscillators.push(osc);
        noteData.gains.push(gain);
      }
      
      activeNotes[noteId] = noteData;
    }
    
    // Stop note
    function stopNote(noteId) {
      const noteData = activeNotes[noteId];
      if (!noteData) return;
      
      noteData.gains.forEach(gain => {
        gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.1);
      });
      
      setTimeout(() => {
        noteData.oscillators.forEach(osc => osc.stop());
      }, 150);
      
      delete activeNotes[noteId];
    }
    
    // Build keyboard
    const keyboard = document.getElementById('keyboard');
    notes.forEach((n, i) => {
      const key = document.createElement('div');
      key.className = 'key';
      key.dataset.note = n.note;
      key.dataset.freq = n.freq;
      key.innerHTML = '<span class="note">' + n.note + '</span><span class="hotkey">' + n.key.toUpperCase() + '</span>';
      
      key.addEventListener('mousedown', () => {
        key.classList.add('active');
        playNote(n.freq, n.note);
      });
      key.addEventListener('mouseup', () => {
        key.classList.remove('active');
        stopNote(n.note);
      });
      key.addEventListener('mouseleave', () => {
        if (key.classList.contains('active')) {
          key.classList.remove('active');
          stopNote(n.note);
        }
      });
      
      // Touch support
      key.addEventListener('touchstart', (e) => {
        e.preventDefault();
        key.classList.add('active');
        playNote(n.freq, n.note);
      });
      key.addEventListener('touchend', () => {
        key.classList.remove('active');
        stopNote(n.note);
      });
      
      keyboard.appendChild(key);
    });
    
    // Keyboard input
    const keyMap = {};
    notes.forEach(n => keyMap[n.key] = n);
    
    document.addEventListener('keydown', (e) => {
      if (e.repeat) return;
      const n = keyMap[e.key.toLowerCase()];
      if (n) {
        const keyEl = document.querySelector('.key[data-note="' + n.note + '"]');
        if (keyEl) keyEl.classList.add('active');
        playNote(n.freq, n.note);
      }
    });
    
    document.addEventListener('keyup', (e) => {
      const n = keyMap[e.key.toLowerCase()];
      if (n) {
        const keyEl = document.querySelector('.key[data-note="' + n.note + '"]');
        if (keyEl) keyEl.classList.remove('active');
        stopNote(n.note);
      }
    });
    
    // Toggle oscillator
    function toggleOsc(num) {
      oscSettings[num].enabled = !oscSettings[num].enabled;
      document.getElementById('osc' + num + 'Toggle').classList.toggle('active');
    }
    
    // Wave type buttons
    document.querySelectorAll('.wave-types').forEach((container, idx) => {
      const oscNum = idx + 1;
      container.querySelectorAll('.wave-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          container.querySelectorAll('.wave-btn').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          oscSettings[oscNum].wave = btn.dataset.wave;
        });
      });
    });
    
    // Sliders
    ['1', '2'].forEach(num => {
      const detuneSlider = document.getElementById('detune' + num);
      const gainSlider = document.getElementById('gain' + num);
      const detuneVal = document.getElementById('detune' + num + 'Val');
      const gainVal = document.getElementById('gain' + num + 'Val');
      
      detuneSlider.addEventListener('input', () => {
        oscSettings[num].detune = parseInt(detuneSlider.value);
        detuneVal.textContent = detuneSlider.value;
      });
      
      gainSlider.addEventListener('input', () => {
        oscSettings[num].gain = gainSlider.value / 100;
        gainVal.textContent = (gainSlider.value / 100).toFixed(2);
      });
    });
    
    // Master volume
    document.getElementById('masterVol').addEventListener('input', (e) => {
      if (masterGain) masterGain.gain.value = e.target.value / 100;
    });
    
    // Visualizer modes
    function setVisMode(mode) {
      visMode = mode;
      document.querySelectorAll('.vis-btn').forEach(b => b.classList.remove('active'));
      event.target.classList.add('active');
    }
    
    // Draw visualizer
    function drawVisualizer() {
      requestAnimationFrame(drawVisualizer);
      
      const w = canvas.width;
      const h = canvas.height;
      
      ctx.fillStyle = 'rgba(0, 0, 0, 0.2)';
      ctx.fillRect(0, 0, w, h);
      
      if (!analyser) return;
      
      if (visMode === 'wave') {
        const bufferLength = analyser.fftSize;
        const dataArray = new Uint8Array(bufferLength);
        analyser.getByteTimeDomainData(dataArray);
        
        ctx.lineWidth = 3;
        ctx.strokeStyle = '#0ff';
        ctx.shadowColor = '#0ff';
        ctx.shadowBlur = 15;
        
        ctx.beginPath();
        const sliceWidth = w / bufferLength;
        let x = 0;
        
        for (let i = 0; i < bufferLength; i++) {
          const v = dataArray[i] / 128.0;
          const y = v * h / 2;
          
          if (i === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
          
          x += sliceWidth;
        }
        ctx.stroke();
        ctx.shadowBlur = 0;
        
      } else if (visMode === 'bars') {
        const bufferLength = analyser.frequencyBinCount;
        const dataArray = new Uint8Array(bufferLength);
        analyser.getByteFrequencyData(dataArray);
        
        const barCount = 64;
        const barWidth = w / barCount;
        const step = Math.floor(bufferLength / barCount);
        
        for (let i = 0; i < barCount; i++) {
          const value = dataArray[i * step];
          const barHeight = (value / 255) * h * 0.9;
          
          const hue = (i / barCount) * 180 + 180;
          ctx.fillStyle = 'hsl(' + hue + ', 100%, 50%)';
          ctx.shadowColor = 'hsl(' + hue + ', 100%, 50%)';
          ctx.shadowBlur = 10;
          
          ctx.fillRect(i * barWidth + 1, h - barHeight, barWidth - 2, barHeight);
        }
        ctx.shadowBlur = 0;
        
      } else if (visMode === 'circle') {
        const bufferLength = analyser.frequencyBinCount;
        const dataArray = new Uint8Array(bufferLength);
        analyser.getByteFrequencyData(dataArray);
        
        const cx = w / 2;
        const cy = h / 2;
        const baseRadius = Math.min(w, h) * 0.25;
        const points = 128;
        const step = Math.floor(bufferLength / points);
        
        ctx.beginPath();
        for (let i = 0; i <= points; i++) {
          const angle = (i / points) * Math.PI * 2 - Math.PI / 2;
          const value = dataArray[(i % points) * step] / 255;
          const radius = baseRadius + value * baseRadius;
          
          const x = cx + Math.cos(angle) * radius;
          const y = cy + Math.sin(angle) * radius;
          
          if (i === 0) ctx.moveTo(x, y);
          else ctx.lineTo(x, y);
        }
        ctx.closePath();
        
        const gradient = ctx.createRadialGradient(cx, cy, baseRadius * 0.5, cx, cy, baseRadius * 2);
        gradient.addColorStop(0, 'rgba(255, 0, 255, 0.8)');
        gradient.addColorStop(1, 'rgba(0, 255, 255, 0.8)');
        
        ctx.strokeStyle = gradient;
        ctx.lineWidth = 3;
        ctx.shadowColor = '#f0f';
        ctx.shadowBlur = 20;
        ctx.stroke();
        ctx.shadowBlur = 0;
      }
    }
    
    // Start visualizer loop
    drawVisualizer();
  </script>
</body>
</html>
