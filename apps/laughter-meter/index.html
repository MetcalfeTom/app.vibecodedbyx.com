<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Sea Shanty Meter - Pirate Roar Gauge</title>
  <link rel="icon" href="https://emojicdn.elk.sh/üè¥‚Äç‚ò†Ô∏è">
  <meta property="og:title" content="Sea Shanty Meter">
  <meta property="og:description" content="Measure yer pirate roar, ye scallywag!">
  <meta property="og:url" content="https://sloppy.live/laughter-meter">
  <meta property="og:image" content="https://sloppy.live/laughter-meter/og-image.png">
  <link href="https://fonts.googleapis.com/css2?family=Pirate+One&family=IM+Fell+English+SC&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: #1a0f0a;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'IM Fell English SC', serif;
      overflow: hidden;
    }

    .bg-pulse {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: radial-gradient(circle at center, transparent 0%, #1a0f0a 70%);
      pointer-events: none;
      z-index: 0;
      transition: background 0.1s;
    }

    .wood-texture {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background-image: repeating-linear-gradient(
        90deg,
        rgba(139, 90, 43, 0.1) 0px,
        rgba(139, 90, 43, 0.05) 2px,
        transparent 2px,
        transparent 20px
      );
      pointer-events: none;
      z-index: 1;
    }

    .container {
      position: relative;
      z-index: 10;
      text-align: center;
      padding: 20px;
    }

    h1 {
      font-family: 'Pirate One', cursive;
      font-size: clamp(32px, 10vw, 64px);
      margin-bottom: 10px;
      color: #d4a84b;
      text-shadow: 3px 3px 0 #2a1810, 0 0 20px rgba(212, 168, 75, 0.5);
      letter-spacing: 2px;
    }

    .subtitle {
      color: #8b7355;
      font-size: 16px;
      margin-bottom: 30px;
      letter-spacing: 3px;
      text-transform: uppercase;
    }

    #start-btn {
      background: linear-gradient(135deg, #8b5a2b, #d4a84b);
      border: 3px solid #5c3a1e;
      color: #1a0f0a;
      padding: 15px 40px;
      font-family: 'Pirate One', cursive;
      font-size: 20px;
      cursor: pointer;
      border-radius: 8px;
      margin-bottom: 30px;
      transition: all 0.3s;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.2);
      text-shadow: 1px 1px 0 rgba(255, 255, 255, 0.3);
    }

    #start-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 6px 25px rgba(212, 168, 75, 0.4);
    }

    #start-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .meter-container {
      position: relative;
      width: 300px;
      height: 300px;
      margin: 0 auto 30px;
    }

    .meter-ring {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
    }

    .meter-bg {
      fill: none;
      stroke: #2a1810;
      stroke-width: 20;
    }

    .meter-fill {
      fill: none;
      stroke: url(#meter-gradient);
      stroke-width: 20;
      stroke-linecap: round;
      stroke-dasharray: 691;
      stroke-dashoffset: 691;
      transform: rotate(-90deg);
      transform-origin: center;
      filter: drop-shadow(0 0 10px currentColor);
      transition: stroke-dashoffset 0.05s ease-out;
    }

    .meter-center {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }

    .level-emoji {
      font-size: 64px;
      display: block;
      margin-bottom: 10px;
      filter: drop-shadow(0 0 15px rgba(212, 168, 75, 0.5));
      transition: transform 0.1s;
    }

    .level-text {
      font-family: 'Pirate One', cursive;
      font-size: 18px;
      color: #d4a84b;
      text-shadow: 0 0 10px rgba(212, 168, 75, 0.5);
      transition: color 0.2s;
    }

    .db-display {
      font-size: 36px;
      color: #e8d4a8;
      margin-top: 10px;
      font-family: 'IM Fell English SC', serif;
    }

    .db-unit {
      font-size: 14px;
      color: #8b7355;
    }

    .bars-container {
      display: flex;
      justify-content: center;
      gap: 4px;
      height: 100px;
      align-items: flex-end;
      margin-bottom: 30px;
    }

    .bar {
      width: 8px;
      background: linear-gradient(to top, #8b5a2b, #d4a84b);
      border-radius: 2px;
      transition: height 0.05s ease-out;
      box-shadow: 0 0 8px rgba(212, 168, 75, 0.5);
    }

    .reaction {
      font-family: 'Pirate One', cursive;
      font-size: clamp(24px, 6vw, 42px);
      min-height: 60px;
      transition: all 0.2s;
      color: #d4a84b;
    }

    .floating-emoji {
      position: fixed;
      font-size: 32px;
      pointer-events: none;
      animation: float-up 2s ease-out forwards;
      z-index: 100;
    }

    @keyframes float-up {
      0% {
        opacity: 1;
        transform: translateY(0) scale(1) rotate(0deg);
      }
      100% {
        opacity: 0;
        transform: translateY(-200px) scale(0.5) rotate(20deg);
      }
    }

    .peak-display {
      color: #8b7355;
      font-size: 14px;
      margin-top: 20px;
    }

    .peak-value {
      font-size: 24px;
      color: #d4a84b;
      text-shadow: 0 0 10px rgba(212, 168, 75, 0.5);
    }

    .sonic-wave {
      position: fixed;
      border: 3px solid #d4a84b;
      border-radius: 50%;
      pointer-events: none;
      animation: wave-expand 1s ease-out forwards;
    }

    @keyframes wave-expand {
      0% {
        width: 50px;
        height: 50px;
        opacity: 0.8;
      }
      100% {
        width: 300px;
        height: 300px;
        opacity: 0;
      }
    }

    #backlink {
      position: fixed;
      bottom: 20px;
      right: 20px;
      color: #8b7355;
      text-decoration: none;
      font-size: 12px;
      opacity: 0.5;
      z-index: 100;
    }

    .warning {
      color: #c0392b;
      font-size: 14px;
      margin-top: 20px;
      opacity: 0;
      transition: opacity 0.3s;
      font-family: 'Pirate One', cursive;
    }

    .warning.show { opacity: 1; }

    .skull-border {
      position: absolute;
      font-size: 20px;
      opacity: 0.3;
    }

    @media (max-width: 400px) {
      .meter-container {
        width: 250px;
        height: 250px;
      }
      .bars-container {
        height: 60px;
      }
      .bar {
        width: 6px;
      }
    }
  </style>
</head>
<body>
  <div class="bg-pulse" id="bg-pulse"></div>
  <div class="wood-texture"></div>

  <div class="container">
    <h1>SEA SHANTY METER</h1>
    <p class="subtitle">Measure Yer Pirate Roar</p>

    <button id="start-btn">HOIST THE MIC!</button>

    <div class="meter-container">
      <svg class="meter-ring" viewBox="0 0 240 240">
        <defs>
          <linearGradient id="meter-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stop-color="#2e86ab"/>
            <stop offset="33%" stop-color="#d4a84b"/>
            <stop offset="66%" stop-color="#c0392b"/>
            <stop offset="100%" stop-color="#8e1600"/>
          </linearGradient>
        </defs>
        <circle class="meter-bg" cx="120" cy="120" r="110"/>
        <circle class="meter-fill" id="meter-fill" cx="120" cy="120" r="110"/>
      </svg>
      <div class="meter-center">
        <span class="level-emoji" id="level-emoji">üíÄ</span>
        <span class="level-text" id="level-text">WAITIN'</span>
        <div class="db-display"><span id="db-value">0</span><span class="db-unit"> fathoms</span></div>
      </div>
    </div>

    <div class="bars-container" id="bars"></div>

    <div class="reaction" id="reaction"></div>

    <div class="peak-display">
      PEAK ROAR: <span class="peak-value" id="peak-value">0</span> fathoms
    </div>

    <p class="warning" id="warning">‚ò†Ô∏è KRAKEN AWAKENED! ‚ò†Ô∏è</p>
  </div>

  <a id="backlink" href="https://sloppy.live">sloppy.live</a>

  <script>
    const startBtn = document.getElementById('start-btn');
    const meterFill = document.getElementById('meter-fill');
    const levelEmoji = document.getElementById('level-emoji');
    const levelText = document.getElementById('level-text');
    const dbValue = document.getElementById('db-value');
    const peakValue = document.getElementById('peak-value');
    const reaction = document.getElementById('reaction');
    const warning = document.getElementById('warning');
    const bgPulse = document.getElementById('bg-pulse');
    const barsContainer = document.getElementById('bars');

    const NUM_BARS = 32;
    const bars = [];
    for (let i = 0; i < NUM_BARS; i++) {
      const bar = document.createElement('div');
      bar.className = 'bar';
      bar.style.height = '5px';
      barsContainer.appendChild(bar);
      bars.push(bar);
    }

    const levels = [
      { min: 0, emoji: 'üíÄ', text: 'DEAD CALM', color: '#5c3a1e', reaction: '' },
      { min: 20, emoji: 'ü¶ú', text: 'WHISPER', color: '#2e86ab', reaction: 'arrr...' },
      { min: 35, emoji: '‚öì', text: 'MUTTERING', color: '#3d9970', reaction: 'aye aye' },
      { min: 45, emoji: 'üç∫', text: 'TAVERN TALK', color: '#d4a84b', reaction: 'GROG!' },
      { min: 55, emoji: '‚öîÔ∏è', text: 'BATTLE CRY', color: '#e67e22', reaction: 'YARRR!' },
      { min: 65, emoji: 'üè¥‚Äç‚ò†Ô∏è', text: 'PLUNDERIN\'', color: '#c0392b', reaction: 'SHIVER ME TIMBERS!' },
      { min: 75, emoji: 'üí£', text: 'CANNON FIRE', color: '#8e1600', reaction: 'FIRE THE CANNONS!' },
      { min: 85, emoji: 'ü¶ë', text: 'KRAKEN!', color: '#6c3461', reaction: 'RELEASE THE KRAKEN!' },
      { min: 95, emoji: 'üî±', text: 'DAVY JONES', color: '#1a5276', reaction: 'TO THE LOCKER!' }
    ];

    const pirateEmojis = ['üè¥‚Äç‚ò†Ô∏è', 'üíÄ', '‚öîÔ∏è', 'ü¶ú', 'üí£', '‚öì', 'üç∫', 'ü¶ë', 'üî±', 'üíé'];

    let audioContext, analyser, microphone, dataArray;
    let peak = 0;
    let isActive = false;
    let lastEmojiTime = 0;
    let lastWaveTime = 0;

    startBtn.addEventListener('click', async () => {
      if (isActive) return;

      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioContext.createAnalyser();
        microphone = audioContext.createMediaStreamSource(stream);

        analyser.fftSize = 256;
        analyser.smoothingTimeConstant = 0.3;

        microphone.connect(analyser);

        dataArray = new Uint8Array(analyser.frequencyBinCount);

        isActive = true;
        startBtn.textContent = 'LISTENIN\'...';
        startBtn.disabled = true;

        updateMeter();
      } catch (err) {
        console.error('Microphone access denied:', err);
        startBtn.textContent = 'MIC MAROONED';
        startBtn.style.background = '#8e1600';
      }
    });

    function getLevel(db) {
      for (let i = levels.length - 1; i >= 0; i--) {
        if (db >= levels[i].min) return levels[i];
      }
      return levels[0];
    }

    function spawnFloatingEmoji(x, y) {
      const emoji = document.createElement('div');
      emoji.className = 'floating-emoji';
      emoji.textContent = pirateEmojis[Math.floor(Math.random() * pirateEmojis.length)];
      emoji.style.left = x + 'px';
      emoji.style.top = y + 'px';
      document.body.appendChild(emoji);

      setTimeout(() => emoji.remove(), 2000);
    }

    function spawnSonicWave(x, y, color) {
      const wave = document.createElement('div');
      wave.className = 'sonic-wave';
      wave.style.left = (x - 25) + 'px';
      wave.style.top = (y - 25) + 'px';
      wave.style.borderColor = color;
      document.body.appendChild(wave);

      setTimeout(() => wave.remove(), 1000);
    }

    function updateMeter() {
      if (!isActive) return;

      analyser.getByteFrequencyData(dataArray);

      let sum = 0;
      for (let i = 0; i < dataArray.length; i++) {
        sum += dataArray[i];
      }
      const avg = sum / dataArray.length;
      const db = Math.min(100, Math.max(0, avg * 0.6));

      if (db > peak) {
        peak = db;
        peakValue.textContent = Math.floor(peak);
      }

      const level = getLevel(db);

      const circumference = 691;
      const offset = circumference - (db / 100) * circumference;
      meterFill.style.strokeDashoffset = offset;

      levelEmoji.textContent = level.emoji;
      levelEmoji.style.transform = `scale(${1 + db * 0.005})`;
      levelText.textContent = level.text;
      levelText.style.color = level.color;
      dbValue.textContent = Math.floor(db);

      reaction.textContent = level.reaction;
      reaction.style.color = level.color;
      reaction.style.textShadow = `0 0 20px ${level.color}`;

      for (let i = 0; i < NUM_BARS; i++) {
        const barIndex = Math.floor(i * dataArray.length / NUM_BARS);
        const height = Math.max(5, dataArray[barIndex] * 0.4);
        bars[i].style.height = height + 'px';

        const hue = 30 + (height / 100) * 20;
        bars[i].style.background = `linear-gradient(to top, hsl(${hue}, 60%, 30%), hsl(${hue}, 70%, 50%))`;
      }

      const pulseIntensity = db / 100;
      bgPulse.style.background = `radial-gradient(circle at center, ${level.color}${Math.floor(pulseIntensity * 25).toString(16).padStart(2, '0')} 0%, #1a0f0a 70%)`;

      const now = Date.now();
      if (db > 60 && now - lastEmojiTime > 200) {
        const x = Math.random() * window.innerWidth;
        const y = window.innerHeight - 100;
        spawnFloatingEmoji(x, y);
        lastEmojiTime = now;
      }

      if (db > 75 && now - lastWaveTime > 300) {
        const rect = levelEmoji.getBoundingClientRect();
        spawnSonicWave(rect.left + rect.width/2, rect.top + rect.height/2, level.color);
        lastWaveTime = now;
      }

      warning.classList.toggle('show', db > 80);

      if (db > 85) {
        const shake = (db - 85) * 0.5;
        document.body.style.transform = `translate(${(Math.random() - 0.5) * shake}px, ${(Math.random() - 0.5) * shake}px)`;
      } else {
        document.body.style.transform = '';
      }

      requestAnimationFrame(updateMeter);
    }

    let demoMode = false;
    document.addEventListener('click', (e) => {
      if (e.target === startBtn) return;
      if (!isActive && !demoMode) {
        demoMode = true;
        startBtn.textContent = 'GHOST SHIP MODE';
        startBtn.disabled = true;
        runDemo();
      }
    });

    function runDemo() {
      let t = 0;
      function demoUpdate() {
        const noise = Math.sin(t * 0.05) * 30 + Math.sin(t * 0.13) * 20 + Math.random() * 15;
        const db = Math.max(0, Math.min(100, 40 + noise));

        const level = getLevel(db);

        const circumference = 691;
        const offset = circumference - (db / 100) * circumference;
        meterFill.style.strokeDashoffset = offset;

        levelEmoji.textContent = level.emoji;
        levelEmoji.style.transform = `scale(${1 + db * 0.005})`;
        levelText.textContent = level.text;
        levelText.style.color = level.color;
        dbValue.textContent = Math.floor(db);

        if (db > peak) {
          peak = db;
          peakValue.textContent = Math.floor(peak);
        }

        reaction.textContent = level.reaction;
        reaction.style.color = level.color;
        reaction.style.textShadow = `0 0 20px ${level.color}`;

        for (let i = 0; i < NUM_BARS; i++) {
          const height = Math.max(5, (db + Math.sin(t * 0.1 + i * 0.5) * 20) * 0.8);
          bars[i].style.height = height + 'px';
          const hue = 30 + (height / 100) * 20;
          bars[i].style.background = `linear-gradient(to top, hsl(${hue}, 60%, 30%), hsl(${hue}, 70%, 50%))`;
        }

        const pulseIntensity = db / 100;
        bgPulse.style.background = `radial-gradient(circle at center, ${level.color}${Math.floor(pulseIntensity * 25).toString(16).padStart(2, '0')} 0%, #1a0f0a 70%)`;

        const now = Date.now();
        if (db > 60 && now - lastEmojiTime > 200) {
          spawnFloatingEmoji(Math.random() * window.innerWidth, window.innerHeight - 100);
          lastEmojiTime = now;
        }

        if (db > 75 && now - lastWaveTime > 300) {
          const rect = levelEmoji.getBoundingClientRect();
          spawnSonicWave(rect.left + rect.width/2, rect.top + rect.height/2, level.color);
          lastWaveTime = now;
        }

        warning.classList.toggle('show', db > 80);

        if (db > 85) {
          const shake = (db - 85) * 0.5;
          document.body.style.transform = `translate(${(Math.random() - 0.5) * shake}px, ${(Math.random() - 0.5) * shake}px)`;
        } else {
          document.body.style.transform = '';
        }

        t++;
        requestAnimationFrame(demoUpdate);
      }
      demoUpdate();
    }
  </script>
<script src="/sloppy-header/sloppy-bar.js"></script>
</body>
</html>
