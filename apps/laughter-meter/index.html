<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Laughter Meter - Sonic Overload Visualizer</title>
  <link rel="icon" href="https://emojicdn.elk.sh/üòÇ">
  <meta property="og:title" content="Laughter Meter">
  <meta property="og:description" content="Visualize the sonic overload of laughter!">
  <meta property="og:url" content="https://sloppy.live/laughter-meter">
  <meta property="og:image" content="https://sloppy.live/laughter-meter/og-image.png">
  <link href="https://fonts.googleapis.com/css2?family=Bungee&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: #0a0a12;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'Share Tech Mono', monospace;
      overflow: hidden;
    }

    .bg-pulse {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: radial-gradient(circle at center, transparent 0%, #0a0a12 70%);
      pointer-events: none;
      z-index: 0;
      transition: background 0.1s;
    }

    .container {
      position: relative;
      z-index: 10;
      text-align: center;
      padding: 20px;
    }

    h1 {
      font-family: 'Bungee', cursive;
      font-size: clamp(28px, 8vw, 56px);
      margin-bottom: 10px;
      background: linear-gradient(90deg, #f0f, #0ff, #ff0, #f0f);
      background-size: 300% 100%;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: gradient-shift 3s ease infinite;
      text-shadow: 0 0 30px rgba(255, 0, 255, 0.5);
    }

    @keyframes gradient-shift {
      0%, 100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }

    .subtitle {
      color: #666;
      font-size: 14px;
      margin-bottom: 30px;
      letter-spacing: 2px;
    }

    #start-btn {
      background: linear-gradient(135deg, #f0f, #0ff);
      border: none;
      color: #000;
      padding: 15px 40px;
      font-family: 'Bungee', cursive;
      font-size: 18px;
      cursor: pointer;
      border-radius: 50px;
      margin-bottom: 30px;
      transition: all 0.3s;
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
    }

    #start-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 0 50px rgba(255, 0, 255, 0.7);
    }

    #start-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .meter-container {
      position: relative;
      width: 300px;
      height: 300px;
      margin: 0 auto 30px;
    }

    .meter-ring {
      position: absolute;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
    }

    .meter-bg {
      fill: none;
      stroke: #1a1a2e;
      stroke-width: 20;
    }

    .meter-fill {
      fill: none;
      stroke: url(#meter-gradient);
      stroke-width: 20;
      stroke-linecap: round;
      stroke-dasharray: 691;
      stroke-dashoffset: 691;
      transform: rotate(-90deg);
      transform-origin: center;
      filter: drop-shadow(0 0 10px currentColor);
      transition: stroke-dashoffset 0.05s ease-out;
    }

    .meter-center {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
    }

    .level-emoji {
      font-size: 64px;
      display: block;
      margin-bottom: 10px;
      filter: drop-shadow(0 0 20px currentColor);
      transition: transform 0.1s;
    }

    .level-text {
      font-family: 'Bungee', cursive;
      font-size: 18px;
      color: #0ff;
      text-shadow: 0 0 10px #0ff;
      transition: color 0.2s;
    }

    .db-display {
      font-size: 36px;
      color: #fff;
      margin-top: 10px;
    }

    .db-unit {
      font-size: 14px;
      color: #666;
    }

    /* Bars visualizer */
    .bars-container {
      display: flex;
      justify-content: center;
      gap: 4px;
      height: 100px;
      align-items: flex-end;
      margin-bottom: 30px;
    }

    .bar {
      width: 8px;
      background: linear-gradient(to top, #0ff, #f0f);
      border-radius: 4px;
      transition: height 0.05s ease-out;
      box-shadow: 0 0 10px currentColor;
    }

    /* Reaction text */
    .reaction {
      font-family: 'Bungee', cursive;
      font-size: clamp(24px, 6vw, 42px);
      min-height: 60px;
      transition: all 0.2s;
    }

    /* Floating emojis */
    .floating-emoji {
      position: fixed;
      font-size: 32px;
      pointer-events: none;
      animation: float-up 2s ease-out forwards;
      z-index: 100;
    }

    @keyframes float-up {
      0% {
        opacity: 1;
        transform: translateY(0) scale(1) rotate(0deg);
      }
      100% {
        opacity: 0;
        transform: translateY(-200px) scale(0.5) rotate(20deg);
      }
    }

    /* Peak indicator */
    .peak-display {
      color: #f0f;
      font-size: 14px;
      margin-top: 20px;
    }

    .peak-value {
      font-size: 24px;
      color: #ff0;
      text-shadow: 0 0 10px #ff0;
    }

    /* Sonic waves */
    .sonic-wave {
      position: fixed;
      border: 2px solid #0ff;
      border-radius: 50%;
      pointer-events: none;
      animation: wave-expand 1s ease-out forwards;
    }

    @keyframes wave-expand {
      0% {
        width: 50px;
        height: 50px;
        opacity: 0.8;
      }
      100% {
        width: 300px;
        height: 300px;
        opacity: 0;
      }
    }

    #backlink {
      position: fixed;
      bottom: 20px;
      right: 20px;
      color: #0ff;
      text-decoration: none;
      font-size: 12px;
      opacity: 0.5;
      z-index: 100;
    }

    .warning {
      color: #f44;
      font-size: 12px;
      margin-top: 20px;
      opacity: 0;
      transition: opacity 0.3s;
    }

    .warning.show { opacity: 1; }

    @media (max-width: 400px) {
      .meter-container {
        width: 250px;
        height: 250px;
      }
      .bars-container {
        height: 60px;
      }
      .bar {
        width: 6px;
      }
    }
  </style>
</head>
<body>
  <div class="bg-pulse" id="bg-pulse"></div>

  <div class="container">
    <h1>LAUGHTER METER</h1>
    <p class="subtitle">SONIC OVERLOAD VISUALIZER</p>

    <button id="start-btn">ACTIVATE MIC</button>

    <div class="meter-container">
      <svg class="meter-ring" viewBox="0 0 240 240">
        <defs>
          <linearGradient id="meter-gradient" x1="0%" y1="0%" x2="100%" y2="0%">
            <stop offset="0%" stop-color="#0ff"/>
            <stop offset="33%" stop-color="#0f0"/>
            <stop offset="66%" stop-color="#ff0"/>
            <stop offset="100%" stop-color="#f00"/>
          </linearGradient>
        </defs>
        <circle class="meter-bg" cx="120" cy="120" r="110"/>
        <circle class="meter-fill" id="meter-fill" cx="120" cy="120" r="110"/>
      </svg>
      <div class="meter-center">
        <span class="level-emoji" id="level-emoji">üò∂</span>
        <span class="level-text" id="level-text">WAITING</span>
        <div class="db-display"><span id="db-value">0</span><span class="db-unit"> dB</span></div>
      </div>
    </div>

    <div class="bars-container" id="bars"></div>

    <div class="reaction" id="reaction"></div>

    <div class="peak-display">
      PEAK: <span class="peak-value" id="peak-value">0</span> dB
    </div>

    <p class="warning" id="warning">‚ö†Ô∏è SONIC OVERLOAD DETECTED ‚ö†Ô∏è</p>
  </div>

  <a id="backlink" href="https://sloppy.live">sloppy.live</a>

  <script>
    const startBtn = document.getElementById('start-btn');
    const meterFill = document.getElementById('meter-fill');
    const levelEmoji = document.getElementById('level-emoji');
    const levelText = document.getElementById('level-text');
    const dbValue = document.getElementById('db-value');
    const peakValue = document.getElementById('peak-value');
    const reaction = document.getElementById('reaction');
    const warning = document.getElementById('warning');
    const bgPulse = document.getElementById('bg-pulse');
    const barsContainer = document.getElementById('bars');

    // Create bars
    const NUM_BARS = 32;
    const bars = [];
    for (let i = 0; i < NUM_BARS; i++) {
      const bar = document.createElement('div');
      bar.className = 'bar';
      bar.style.height = '5px';
      barsContainer.appendChild(bar);
      bars.push(bar);
    }

    const levels = [
      { min: 0, emoji: 'üò∂', text: 'SILENCE', color: '#666', reaction: '' },
      { min: 20, emoji: 'üôÇ', text: 'QUIET', color: '#0ff', reaction: 'hmm...' },
      { min: 35, emoji: 'üòä', text: 'CHUCKLE', color: '#0f0', reaction: 'heh' },
      { min: 45, emoji: 'üòÑ', text: 'GIGGLE', color: '#8f0', reaction: 'hehe!' },
      { min: 55, emoji: 'üòÜ', text: 'LAUGH', color: '#ff0', reaction: 'HAHA!' },
      { min: 65, emoji: 'ü§£', text: 'ROFL', color: '#f80', reaction: 'LMAOOO' },
      { min: 75, emoji: 'üòÇ', text: 'DYING', color: '#f0f', reaction: 'I CANT üíÄ' },
      { min: 85, emoji: 'üîä', text: 'SONIC!', color: '#f00', reaction: 'OVERLOAD!!!' },
      { min: 95, emoji: 'üí•', text: 'BOOM', color: '#fff', reaction: 'üî•üî•üî•' }
    ];

    const laughEmojis = ['üòÇ', 'ü§£', 'üòÜ', 'üòπ', 'üíÄ', 'üî•', '‚ö°', '‚ú®'];

    let audioContext, analyser, microphone, dataArray;
    let peak = 0;
    let isActive = false;
    let lastEmojiTime = 0;
    let lastWaveTime = 0;

    startBtn.addEventListener('click', async () => {
      if (isActive) return;

      try {
        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });

        audioContext = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioContext.createAnalyser();
        microphone = audioContext.createMediaStreamSource(stream);

        analyser.fftSize = 256;
        analyser.smoothingTimeConstant = 0.3;

        microphone.connect(analyser);

        dataArray = new Uint8Array(analyser.frequencyBinCount);

        isActive = true;
        startBtn.textContent = 'LISTENING...';
        startBtn.disabled = true;

        updateMeter();
      } catch (err) {
        console.error('Microphone access denied:', err);
        startBtn.textContent = 'MIC BLOCKED';
        startBtn.style.background = '#f44';
      }
    });

    function getLevel(db) {
      for (let i = levels.length - 1; i >= 0; i--) {
        if (db >= levels[i].min) return levels[i];
      }
      return levels[0];
    }

    function spawnFloatingEmoji(x, y) {
      const emoji = document.createElement('div');
      emoji.className = 'floating-emoji';
      emoji.textContent = laughEmojis[Math.floor(Math.random() * laughEmojis.length)];
      emoji.style.left = x + 'px';
      emoji.style.top = y + 'px';
      document.body.appendChild(emoji);

      setTimeout(() => emoji.remove(), 2000);
    }

    function spawnSonicWave(x, y, color) {
      const wave = document.createElement('div');
      wave.className = 'sonic-wave';
      wave.style.left = (x - 25) + 'px';
      wave.style.top = (y - 25) + 'px';
      wave.style.borderColor = color;
      document.body.appendChild(wave);

      setTimeout(() => wave.remove(), 1000);
    }

    function updateMeter() {
      if (!isActive) return;

      analyser.getByteFrequencyData(dataArray);

      // Calculate volume
      let sum = 0;
      for (let i = 0; i < dataArray.length; i++) {
        sum += dataArray[i];
      }
      const avg = sum / dataArray.length;

      // Convert to dB-like scale (0-100)
      const db = Math.min(100, Math.max(0, avg * 0.6));

      // Update peak
      if (db > peak) {
        peak = db;
        peakValue.textContent = Math.floor(peak);
      }

      // Get current level
      const level = getLevel(db);

      // Update meter ring
      const circumference = 691;
      const offset = circumference - (db / 100) * circumference;
      meterFill.style.strokeDashoffset = offset;

      // Update center display
      levelEmoji.textContent = level.emoji;
      levelEmoji.style.transform = `scale(${1 + db * 0.005})`;
      levelText.textContent = level.text;
      levelText.style.color = level.color;
      dbValue.textContent = Math.floor(db);

      // Update reaction
      reaction.textContent = level.reaction;
      reaction.style.color = level.color;
      reaction.style.textShadow = `0 0 20px ${level.color}`;

      // Update bars
      for (let i = 0; i < NUM_BARS; i++) {
        const barIndex = Math.floor(i * dataArray.length / NUM_BARS);
        const height = Math.max(5, dataArray[barIndex] * 0.4);
        bars[i].style.height = height + 'px';

        // Color based on height
        const hue = 180 - (height / 100) * 180;
        bars[i].style.background = `linear-gradient(to top, hsl(${hue}, 100%, 50%), hsl(${hue + 60}, 100%, 50%))`;
      }

      // Background pulse
      const pulseIntensity = db / 100;
      bgPulse.style.background = `radial-gradient(circle at center, ${level.color}${Math.floor(pulseIntensity * 30).toString(16).padStart(2, '0')} 0%, #0a0a12 70%)`;

      // Spawn floating emojis at high levels
      const now = Date.now();
      if (db > 60 && now - lastEmojiTime > 200) {
        const x = Math.random() * window.innerWidth;
        const y = window.innerHeight - 100;
        spawnFloatingEmoji(x, y);
        lastEmojiTime = now;
      }

      // Spawn sonic waves at very high levels
      if (db > 75 && now - lastWaveTime > 300) {
        const rect = levelEmoji.getBoundingClientRect();
        spawnSonicWave(rect.left + rect.width/2, rect.top + rect.height/2, level.color);
        lastWaveTime = now;
      }

      // Warning at overload
      warning.classList.toggle('show', db > 80);

      // Screen shake at extreme levels
      if (db > 85) {
        const shake = (db - 85) * 0.5;
        document.body.style.transform = `translate(${(Math.random() - 0.5) * shake}px, ${(Math.random() - 0.5) * shake}px)`;
      } else {
        document.body.style.transform = '';
      }

      requestAnimationFrame(updateMeter);
    }

    // Demo mode without mic (click anywhere to simulate)
    let demoMode = false;
    document.addEventListener('click', (e) => {
      if (e.target === startBtn) return;
      if (!isActive && !demoMode) {
        demoMode = true;
        startBtn.textContent = 'DEMO MODE';
        startBtn.disabled = true;
        runDemo();
      }
    });

    function runDemo() {
      let t = 0;
      function demoUpdate() {
        // Simulate varying levels
        const noise = Math.sin(t * 0.05) * 30 + Math.sin(t * 0.13) * 20 + Math.random() * 15;
        const db = Math.max(0, Math.min(100, 40 + noise));

        const level = getLevel(db);

        // Update displays
        const circumference = 691;
        const offset = circumference - (db / 100) * circumference;
        meterFill.style.strokeDashoffset = offset;

        levelEmoji.textContent = level.emoji;
        levelEmoji.style.transform = `scale(${1 + db * 0.005})`;
        levelText.textContent = level.text;
        levelText.style.color = level.color;
        dbValue.textContent = Math.floor(db);

        if (db > peak) {
          peak = db;
          peakValue.textContent = Math.floor(peak);
        }

        reaction.textContent = level.reaction;
        reaction.style.color = level.color;
        reaction.style.textShadow = `0 0 20px ${level.color}`;

        // Update bars with simulated data
        for (let i = 0; i < NUM_BARS; i++) {
          const height = Math.max(5, (db + Math.sin(t * 0.1 + i * 0.5) * 20) * 0.8);
          bars[i].style.height = height + 'px';
          const hue = 180 - (height / 100) * 180;
          bars[i].style.background = `linear-gradient(to top, hsl(${hue}, 100%, 50%), hsl(${hue + 60}, 100%, 50%))`;
        }

        const pulseIntensity = db / 100;
        bgPulse.style.background = `radial-gradient(circle at center, ${level.color}${Math.floor(pulseIntensity * 30).toString(16).padStart(2, '0')} 0%, #0a0a12 70%)`;

        const now = Date.now();
        if (db > 60 && now - lastEmojiTime > 200) {
          spawnFloatingEmoji(Math.random() * window.innerWidth, window.innerHeight - 100);
          lastEmojiTime = now;
        }

        if (db > 75 && now - lastWaveTime > 300) {
          const rect = levelEmoji.getBoundingClientRect();
          spawnSonicWave(rect.left + rect.width/2, rect.top + rect.height/2, level.color);
          lastWaveTime = now;
        }

        warning.classList.toggle('show', db > 80);

        if (db > 85) {
          const shake = (db - 85) * 0.5;
          document.body.style.transform = `translate(${(Math.random() - 0.5) * shake}px, ${(Math.random() - 0.5) * shake}px)`;
        } else {
          document.body.style.transform = '';
        }

        t++;
        requestAnimationFrame(demoUpdate);
      }
      demoUpdate();
    }
  </script>
</body>
</html>
