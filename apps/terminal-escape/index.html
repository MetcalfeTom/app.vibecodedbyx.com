<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Terminal Escape - Hacker CTF</title>
  <link rel="icon" href="https://emojicdn.elk.sh/ðŸ’»">
  <meta property="og:title" content="Terminal Escape - Hacker CTF">
  <meta property="og:description" content="Hack your way out using Linux commands to find hidden flags!">
  <meta property="og:url" content="https://app.sloppy.live/terminal-escape">
  <meta property="og:image" content="https://app.sloppy.live/terminal-escape/og-image.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Fira Code', monospace;
      background: #0a0a0a;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      color: #0f0;
    }

    /* CRT effect */
    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: repeating-linear-gradient(
        0deg,
        rgba(0, 0, 0, 0.15) 0px,
        rgba(0, 0, 0, 0.15) 1px,
        transparent 1px,
        transparent 2px
      );
      pointer-events: none;
      z-index: 1000;
    }

    .container {
      flex: 1;
      display: flex;
      flex-direction: column;
      max-width: 1000px;
      width: 100%;
      margin: 0 auto;
      padding: 10px;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 15px;
      background: linear-gradient(90deg, #0a0a0a, #001a00, #0a0a0a);
      border: 1px solid #0f0;
      border-bottom: none;
      font-size: 0.8rem;
    }

    .header-title {
      color: #0f0;
      text-shadow: 0 0 10px #0f0;
      animation: flicker 4s infinite;
    }

    @keyframes flicker {
      0%, 100% { opacity: 1; }
      92% { opacity: 1; }
      93% { opacity: 0.7; }
      94% { opacity: 1; }
    }

    .flags-found {
      color: #0ff;
    }

    .terminal {
      flex: 1;
      background: #0a0a0a;
      border: 1px solid #0f0;
      display: flex;
      flex-direction: column;
      box-shadow: 0 0 20px rgba(0, 255, 0, 0.2), inset 0 0 50px rgba(0, 255, 0, 0.03);
      min-height: 500px;
    }

    .terminal-output {
      flex: 1;
      padding: 15px;
      overflow-y: auto;
      font-size: 0.9rem;
      line-height: 1.5;
    }

    .terminal-output::-webkit-scrollbar {
      width: 8px;
    }

    .terminal-output::-webkit-scrollbar-track {
      background: #0a0a0a;
    }

    .terminal-output::-webkit-scrollbar-thumb {
      background: #0f0;
      border-radius: 4px;
    }

    .line {
      margin-bottom: 5px;
      white-space: pre-wrap;
      word-break: break-all;
    }

    .line.command {
      color: #0f0;
    }

    .line.output {
      color: #0a0;
    }

    .line.error {
      color: #f00;
    }

    .line.success {
      color: #0ff;
      text-shadow: 0 0 10px #0ff;
      animation: pulse 1s ease-in-out;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .line.warning {
      color: #ff0;
    }

    .line.hint {
      color: #f0f;
      font-style: italic;
    }

    .line.ascii {
      color: #0f0;
      text-shadow: 0 0 5px #0f0;
    }

    .input-line {
      display: flex;
      align-items: center;
      padding: 10px 15px;
      background: #050505;
      border-top: 1px solid #060;
    }

    .prompt {
      color: #0f0;
      margin-right: 10px;
      white-space: nowrap;
    }

    .prompt .user {
      color: #0ff;
    }

    .prompt .at {
      color: #0a0;
    }

    .prompt .host {
      color: #0f0;
    }

    .prompt .path {
      color: #ff0;
    }

    #command-input {
      flex: 1;
      background: transparent;
      border: none;
      color: #0f0;
      font-family: 'Fira Code', monospace;
      font-size: 0.9rem;
      outline: none;
      caret-color: #0f0;
    }

    #command-input::placeholder {
      color: #050;
    }

    .cursor {
      display: inline-block;
      width: 8px;
      height: 16px;
      background: #0f0;
      animation: blink 1s step-end infinite;
    }

    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }

    .back-link {
      text-align: center;
      padding: 10px;
      color: #060;
      font-size: 0.75rem;
      text-decoration: none;
    }

    .back-link:hover {
      color: #0f0;
    }

    .hidden-text {
      color: #0a0a0a;
    }

    .hidden-text:hover {
      color: #300;
    }

    @media (max-width: 600px) {
      .terminal-output { font-size: 0.75rem; }
      #command-input { font-size: 0.8rem; }
      .header { font-size: 0.7rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <span class="header-title">[ TERMINAL ESCAPE v1.0 ]</span>
      <span class="flags-found">FLAGS: <span id="flag-count">0</span>/5</span>
    </div>

    <div class="terminal">
      <div class="terminal-output" id="output"></div>
      <div class="input-line">
        <span class="prompt">
          <span class="user">hacker</span><span class="at">@</span><span class="host">ctf</span>:<span class="path" id="prompt-path">~</span>$
        </span>
        <input type="text" id="command-input" placeholder="type 'help' to start..." autocomplete="off" autofocus>
      </div>
    </div>

    <a class="back-link" href="https://sloppy.live">sloppy.live</a>
  </div>

  <script>
    // Virtual filesystem
    const filesystem = {
      '~': {
        type: 'dir',
        contents: {
          'welcome.txt': {
            type: 'file',
            content: `Welcome to TERMINAL ESCAPE!

You've been locked in a virtual system. Find all 5 hidden flags to escape.
Flags look like: FLAG{something_here}

Use Linux commands to explore. Type 'help' for available commands.
Good luck, hacker...

- The System`
          },
          'readme.md': {
            type: 'file',
            content: `# Escape Protocol

The flags are hidden throughout the system.
Some are in plain sight, others require... creativity.

Hint: Not everything is visible with a simple 'ls'
Try: ls -la`
          },
          '.secret': {
            type: 'file',
            hidden: true,
            content: `You found the hidden file!

FLAG{h1dd3n_f1l3s_r3v34l3d}

There are more secrets in /var/logs...`
          },
          'notes': {
            type: 'dir',
            contents: {
              'todo.txt': {
                type: 'file',
                content: `TODO:
- Check server logs
- Review encrypted data
- Don't forget the password: BASE64 encoded in /tmp`
              },
              'passwords.txt': {
                type: 'file',
                content: `Old passwords (DO NOT USE):
admin123
password
letmein
hunter2

Current password: ************`
              }
            }
          }
        }
      },
      '/var': {
        type: 'dir',
        contents: {
          'logs': {
            type: 'dir',
            contents: {
              'access.log': {
                type: 'file',
                content: `[2024-01-15 03:14:15] User login attempt: admin
[2024-01-15 03:14:16] Login failed: invalid password
[2024-01-15 03:14:20] User login attempt: admin
[2024-01-15 03:14:21] Login failed: invalid password
[2024-01-15 03:14:25] User login attempt: root
[2024-01-15 03:14:26] FLAG{l0g_f1l3s_t3ll_st0r13s}
[2024-01-15 03:14:30] Suspicious activity detected
[2024-01-15 03:14:31] Initiating lockdown protocol`
              },
              'error.log': {
                type: 'file',
                content: `ERROR: Connection refused
ERROR: Permission denied
ERROR: File not found
ERROR: Timeout exceeded
WARNING: Check /etc/shadow for anomalies`
              }
            }
          }
        }
      },
      '/tmp': {
        type: 'dir',
        contents: {
          'data.enc': {
            type: 'file',
            content: `RkxBR3tiNHMzNjRfZDNjMGQzX20xc3Npb259`
          },
          'hint.txt': {
            type: 'file',
            content: `The file data.enc contains base64 encoded text.
Use: base64 -d data.enc`
          },
          '.cache': {
            type: 'dir',
            hidden: true,
            contents: {
              'history': {
                type: 'file',
                content: `grep -r "FLAG" /
find / -name "*.flag"
cat /etc/shadow
strings /bin/escape`
              }
            }
          }
        }
      },
      '/etc': {
        type: 'dir',
        contents: {
          'passwd': {
            type: 'file',
            content: `root:x:0:0:root:/root:/bin/bash
hacker:x:1000:1000:Hacker:/home/hacker:/bin/bash
guest:x:1001:1001:Guest:/home/guest:/bin/false`
          },
          'shadow': {
            type: 'file',
            content: `[ACCESS DENIED - Root required]

Just kidding! Here's a hint:
The final flag is hidden in binary...
Try: strings /bin/escape`
          },
          'hostname': {
            type: 'file',
            content: `ctf-server-01`
          }
        }
      },
      '/bin': {
        type: 'dir',
        contents: {
          'escape': {
            type: 'file',
            binary: true,
            content: `ELF BINARY DATA
0x00000000 7f 45 4c 46 02 01 01 00
0x00000008 00 00 00 00 00 00 00 00
STRINGS_FOUND:
"Loading escape sequence..."
"Initializing hack protocol..."
"FLAG{b1n4ry_str1ngs_ftw}"
"Escape complete!"
0x000000FF END OF FILE`
          },
          'ls': { type: 'file', binary: true, content: '[SYSTEM BINARY]' },
          'cat': { type: 'file', binary: true, content: '[SYSTEM BINARY]' },
          'grep': { type: 'file', binary: true, content: '[SYSTEM BINARY]' }
        }
      },
      '/home': {
        type: 'dir',
        contents: {
          'hacker': {
            type: 'dir',
            contents: {
              '.bashrc': {
                type: 'file',
                hidden: true,
                content: `# Bash configuration
export PATH=/usr/bin:/bin
alias ll='ls -la'
alias grep='grep --color=auto'

# Note to self: FLAG{d0tf1l3s_4r3_1mp0rt4nt}`
              },
              'projects': {
                type: 'dir',
                contents: {
                  'hack.py': {
                    type: 'file',
                    content: `#!/usr/bin/env python3
# TODO: Complete the exploit

def exploit():
    # Find the vulnerability
    # Hint: Check all 5 flags
    pass

if __name__ == "__main__":
    exploit()`
                  }
                }
              }
            }
          }
        }
      }
    };

    // Game state
    let currentPath = '~';
    let commandHistory = [];
    let historyIndex = -1;
    let foundFlags = new Set();

    const FLAGS = [
      'FLAG{h1dd3n_f1l3s_r3v34l3d}',
      'FLAG{l0g_f1l3s_t3ll_st0r13s}',
      'FLAG{b4s364_d3c0d3_m1ss10n}',
      'FLAG{b1n4ry_str1ngs_ftw}',
      'FLAG{d0tf1l3s_4r3_1mp0rt4nt}'
    ];

    // Get node from path
    function getNode(path) {
      if (path === '~' || path === '/home/hacker') {
        return filesystem['~'];
      }

      const parts = path.split('/').filter(p => p && p !== '~');
      let current = path.startsWith('~') ? filesystem['~'] : filesystem['/'+parts[0]];

      if (!current) return null;

      const startIndex = path.startsWith('~') ? 0 : 1;
      for (let i = startIndex; i < parts.length; i++) {
        if (current.type !== 'dir' || !current.contents[parts[i]]) {
          return null;
        }
        current = current.contents[parts[i]];
      }
      return current;
    }

    // Resolve path
    function resolvePath(path) {
      if (path.startsWith('/')) return path;
      if (path.startsWith('~')) return path;

      let parts = currentPath === '~' ? [] : currentPath.split('/').filter(p => p);
      const newParts = path.split('/');

      for (const part of newParts) {
        if (part === '..') {
          parts.pop();
        } else if (part !== '.' && part !== '') {
          parts.push(part);
        }
      }

      if (parts.length === 0) return '~';
      if (parts[0] === '~' || parts[0] === 'home') return parts.join('/').replace('home/hacker', '~');
      return '/' + parts.join('/');
    }

    // Check for flags in text
    function checkForFlags(text) {
      FLAGS.forEach(flag => {
        if (text.includes(flag) && !foundFlags.has(flag)) {
          foundFlags.add(flag);
          document.getElementById('flag-count').textContent = foundFlags.size;
          setTimeout(() => {
            addOutput(`\nðŸš© FLAG CAPTURED: ${flag}`, 'success');
            if (foundFlags.size === 5) {
              addOutput(`\n${'='.repeat(50)}`, 'success');
              addOutput(`ðŸŽ‰ CONGRATULATIONS! You found all 5 flags!`, 'success');
              addOutput(`You've escaped the terminal. You are now FREE.`, 'success');
              addOutput(`${'='.repeat(50)}`, 'success');
            }
          }, 100);
        }
      });
    }

    // Commands
    const commands = {
      help: () => {
        return `Available commands:
  ls [-la]       List directory contents (-la for hidden files)
  cd <dir>       Change directory
  cat <file>     Display file contents
  pwd            Print working directory
  grep <pattern> <file>  Search for pattern in file
  find <name>    Find files by name
  base64 -d <file>  Decode base64 file
  strings <file> Extract strings from binary
  clear          Clear terminal
  hint           Get a hint
  whoami         Display current user
  history        Show command history`;
      },

      ls: (args) => {
        const showHidden = args.includes('-la') || args.includes('-a') || args.includes('-l');
        const node = getNode(currentPath);
        if (!node || node.type !== 'dir') return 'ls: cannot access: Not a directory';

        let items = Object.entries(node.contents)
          .filter(([name, item]) => showHidden || !item.hidden)
          .map(([name, item]) => {
            const prefix = item.type === 'dir' ? '\x1b[34m' : '';
            const suffix = item.type === 'dir' ? '/' : '';
            const color = item.hidden ? 'color: #666;' : (item.type === 'dir' ? 'color: #0ff;' : '');
            return `<span style="${color}">${name}${suffix}</span>`;
          });

        if (showHidden) {
          items.unshift('<span style="color: #0ff;">.</span>', '<span style="color: #0ff;">..</span>');
        }

        return items.join('  ') || '(empty directory)';
      },

      cd: (args) => {
        if (args.length === 0 || args[0] === '~') {
          currentPath = '~';
          return '';
        }

        const newPath = resolvePath(args[0]);
        const node = getNode(newPath);

        if (!node) return `cd: ${args[0]}: No such file or directory`;
        if (node.type !== 'dir') return `cd: ${args[0]}: Not a directory`;

        currentPath = newPath;
        return '';
      },

      cat: (args) => {
        if (args.length === 0) return 'cat: missing file operand';

        const path = resolvePath(args[0]);
        const node = getNode(path);

        if (!node) return `cat: ${args[0]}: No such file or directory`;
        if (node.type === 'dir') return `cat: ${args[0]}: Is a directory`;

        checkForFlags(node.content);
        return node.content;
      },

      pwd: () => {
        if (currentPath === '~') return '/home/hacker';
        return currentPath;
      },

      grep: (args) => {
        if (args.length < 2) return 'grep: missing arguments\nUsage: grep <pattern> <file>';

        const pattern = args[0];
        const path = resolvePath(args[1]);
        const node = getNode(path);

        if (!node) return `grep: ${args[1]}: No such file or directory`;
        if (node.type === 'dir') return `grep: ${args[1]}: Is a directory`;

        const lines = node.content.split('\n');
        const matches = lines.filter(line => line.toLowerCase().includes(pattern.toLowerCase()));

        if (matches.length === 0) return '';

        const result = matches.map(line => {
          return line.replace(new RegExp(`(${pattern})`, 'gi'), '<span style="color: #f00;">$1</span>');
        }).join('\n');

        checkForFlags(result);
        return result;
      },

      find: (args) => {
        if (args.length === 0) return 'find: missing argument';

        const searchName = args[0].replace('*', '');
        let results = [];

        function searchDir(path, node) {
          if (node.type !== 'dir') return;
          Object.entries(node.contents).forEach(([name, item]) => {
            const fullPath = path === '~' ? `~/${name}` : `${path}/${name}`;
            if (name.includes(searchName)) {
              results.push(fullPath);
            }
            if (item.type === 'dir') {
              searchDir(fullPath, item);
            }
          });
        }

        Object.entries(filesystem).forEach(([path, node]) => {
          searchDir(path, node);
        });

        return results.join('\n') || 'No files found';
      },

      base64: (args) => {
        if (args[0] !== '-d' || args.length < 2) {
          return 'Usage: base64 -d <file>';
        }

        const path = resolvePath(args[1]);
        const node = getNode(path);

        if (!node) return `base64: ${args[1]}: No such file or directory`;
        if (node.type === 'dir') return `base64: ${args[1]}: Is a directory`;

        try {
          const decoded = atob(node.content.trim());
          checkForFlags(decoded);
          return decoded;
        } catch {
          return 'base64: invalid input';
        }
      },

      strings: (args) => {
        if (args.length === 0) return 'strings: missing file operand';

        const path = resolvePath(args[0]);
        const node = getNode(path);

        if (!node) return `strings: ${args[0]}: No such file or directory`;
        if (node.type === 'dir') return `strings: ${args[0]}: Is a directory`;

        if (node.binary) {
          checkForFlags(node.content);
          return node.content;
        }
        return node.content;
      },

      clear: () => {
        document.getElementById('output').innerHTML = '';
        return null;
      },

      hint: () => {
        const hints = [
          'Try "ls -la" to see hidden files (they start with a dot)',
          'Check /var/logs for interesting information',
          'The file in /tmp might be encoded... base64 perhaps?',
          'Binary files can contain readable strings. Try "strings" command',
          'Don\'t forget to check dotfiles in /home/hacker'
        ];
        const unFoundHints = hints.filter((_, i) => !foundFlags.has(FLAGS[i]));
        return unFoundHints.length > 0
          ? unFoundHints[Math.floor(Math.random() * unFoundHints.length)]
          : 'You\'ve found all the flags! Congratulations!';
      },

      whoami: () => 'hacker',

      history: () => commandHistory.slice(-20).map((cmd, i) => `  ${i + 1}  ${cmd}`).join('\n'),

      echo: (args) => args.join(' '),

      id: () => 'uid=1000(hacker) gid=1000(hacker) groups=1000(hacker),27(sudo)',

      uname: (args) => {
        if (args.includes('-a')) {
          return 'Linux ctf-server-01 5.15.0-generic #1 SMP x86_64 GNU/Linux';
        }
        return 'Linux';
      }
    };

    // Process command
    function processCommand(input) {
      const parts = input.trim().split(/\s+/);
      const cmd = parts[0].toLowerCase();
      const args = parts.slice(1);

      if (!cmd) return null;

      commandHistory.push(input);
      historyIndex = commandHistory.length;

      if (commands[cmd]) {
        return commands[cmd](args);
      }

      return `${cmd}: command not found. Type 'help' for available commands.`;
    }

    // Add output
    function addOutput(text, className = 'output') {
      const output = document.getElementById('output');
      const line = document.createElement('div');
      line.className = `line ${className}`;
      line.innerHTML = text;
      output.appendChild(line);
      output.scrollTop = output.scrollHeight;
    }

    // Update prompt
    function updatePrompt() {
      const pathDisplay = currentPath === '~' ? '~' :
        (currentPath.startsWith('/') ? currentPath : '~/' + currentPath);
      document.getElementById('prompt-path').textContent = pathDisplay;
    }

    // Initialize
    const input = document.getElementById('command-input');
    const output = document.getElementById('output');

    // Welcome message
    addOutput(`
 â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ•—   â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—
 â•šâ•â•â–ˆâ–ˆâ•”â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘
    â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•”â–ˆâ–ˆâ–ˆâ–ˆâ•”â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â–ˆâ–ˆâ•— â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘
    â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•”â•â•â•  â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘
    â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ•â• â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
    â•šâ•â•   â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•     â•šâ•â•â•šâ•â•â•šâ•â•  â•šâ•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•â•â•â•â•â•
    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
    â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•
    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
    â–ˆâ–ˆâ•”â•â•â•  â•šâ•â•â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â• â–ˆâ–ˆâ•”â•â•â•
    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
    â•šâ•â•â•â•â•â•â•â•šâ•â•â•â•â•â•â• â•šâ•â•â•â•â•â•â•šâ•â•  â•šâ•â•â•šâ•â•     â•šâ•â•â•â•â•â•â•`, 'ascii');

    addOutput(`\nSystem initialized. Find all 5 hidden flags to escape.`, 'warning');
    addOutput(`Type 'help' for available commands or 'cat welcome.txt' to start.\n`, 'output');

    // Input handling
    input.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        const cmd = input.value;
        const promptPath = document.getElementById('prompt-path').textContent;
        addOutput(`hacker@ctf:${promptPath}$ ${cmd}`, 'command');

        const result = processCommand(cmd);
        if (result !== null && result !== '') {
          addOutput(result, result.includes('error') || result.includes('not found') ? 'error' :
            result.includes('FLAG') ? 'success' :
            result.includes('Hint:') || result.includes('hint') ? 'hint' : 'output');
        }

        updatePrompt();
        input.value = '';
      } else if (e.key === 'ArrowUp') {
        e.preventDefault();
        if (historyIndex > 0) {
          historyIndex--;
          input.value = commandHistory[historyIndex];
        }
      } else if (e.key === 'ArrowDown') {
        e.preventDefault();
        if (historyIndex < commandHistory.length - 1) {
          historyIndex++;
          input.value = commandHistory[historyIndex];
        } else {
          historyIndex = commandHistory.length;
          input.value = '';
        }
      } else if (e.key === 'Tab') {
        e.preventDefault();
        // Simple tab completion for commands
        const partial = input.value.toLowerCase();
        const matches = Object.keys(commands).filter(cmd => cmd.startsWith(partial));
        if (matches.length === 1) {
          input.value = matches[0] + ' ';
        }
      }
    });

    // Focus input on click
    document.querySelector('.terminal').addEventListener('click', () => {
      input.focus();
    });

    // Keep focus
    input.focus();
  </script>
<script src="/apps/sloppy-header/sloppy-bar.js"></script>
<script src="/vibelib-extended.js"></script>
<script>
  // Compatibility Patch for Legacy Apps
  window.addEventListener("load", () => {
    if (window.SloppyKarma && window.VibeLib.Economy) {
      // Redirect old calls to new engine
      window.SloppyKarma.track = window.VibeLib.Economy.track;
    }
  });
</script>
</body>
</html>
