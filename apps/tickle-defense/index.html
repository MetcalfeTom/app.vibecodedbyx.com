<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Tickle Defense</title>
  <link rel="icon" href="https://emojicdn.elk.sh/ðŸª¶">
  <meta property="og:title" content="Tickle Defense">
  <meta property="og:description" content="Click the feathers before you burst into giggles!">
  <meta property="og:url" content="https://sloppy.live/tickle-defense">
  <meta property="og:image" content="https://emojicdn.elk.sh/ðŸª¶?style=apple&size=512">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Righteous&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      min-height: 100vh;
      background: #0a0a15;
      font-family: 'Orbitron', sans-serif;
      overflow: hidden;
      cursor: crosshair;
    }

    /* Neon grid */
    body::before {
      content: '';
      position: fixed;
      inset: 0;
      background:
        linear-gradient(90deg, rgba(0, 255, 255, 0.03) 1px, transparent 1px),
        linear-gradient(rgba(255, 0, 255, 0.03) 1px, transparent 1px);
      background-size: 40px 40px;
      pointer-events: none;
    }

    .game-container {
      position: fixed;
      inset: 0;
    }

    /* Header HUD */
    .hud {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: linear-gradient(to bottom, rgba(0,0,0,0.8), transparent);
      z-index: 100;
    }

    .title {
      font-family: 'Righteous', cursive;
      font-size: 1.5rem;
      color: #fff;
      text-shadow: 0 0 10px #0ff, 0 0 30px #0ff;
    }

    .score {
      font-size: 1.2rem;
      color: #0ff;
      text-shadow: 0 0 10px #0ff;
    }

    /* Giggle Meter */
    .meter-container {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%);
      width: min(80%, 400px);
      z-index: 100;
    }

    .meter-label {
      text-align: center;
      color: #f0f;
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
      text-shadow: 0 0 10px #f0f;
    }

    .meter-bar {
      height: 24px;
      background: rgba(0, 0, 0, 0.6);
      border: 2px solid #f0f;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(255, 0, 255, 0.3), inset 0 0 10px rgba(0,0,0,0.5);
    }

    .meter-fill {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #0ff, #f0f, #ff0);
      transition: width 0.2s;
      box-shadow: 0 0 20px #f0f;
      position: relative;
    }

    .meter-fill::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(to bottom, rgba(255,255,255,0.3), transparent);
    }

    .meter-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #fff;
      font-size: 0.8rem;
      font-weight: bold;
      text-shadow: 0 0 5px #000;
      z-index: 10;
    }

    .meter-bar {
      position: relative;
    }

    /* Feathers */
    .feather {
      position: absolute;
      font-size: 40px;
      cursor: pointer;
      filter: drop-shadow(0 0 15px currentColor);
      transition: transform 0.1s;
      user-select: none;
      z-index: 50;
      animation: float 2s ease-in-out infinite;
    }

    .feather:hover {
      transform: scale(1.2);
    }

    .feather.cyan { color: #0ff; filter: drop-shadow(0 0 20px #0ff); }
    .feather.magenta { color: #f0f; filter: drop-shadow(0 0 20px #f0f); }
    .feather.yellow { color: #ff0; filter: drop-shadow(0 0 20px #ff0); }
    .feather.green { color: #0f0; filter: drop-shadow(0 0 20px #0f0); }

    @keyframes float {
      0%, 100% { transform: translateY(0) rotate(var(--rot, 0deg)); }
      50% { transform: translateY(-10px) rotate(calc(var(--rot, 0deg) + 5deg)); }
    }

    .feather.popped {
      animation: pop 0.3s ease-out forwards;
    }

    @keyframes pop {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.5); opacity: 0.5; }
      100% { transform: scale(0); opacity: 0; }
    }

    /* Pop particles */
    .particle {
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      pointer-events: none;
      z-index: 60;
    }

    /* Game Over / Start screens */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 200;
      transition: opacity 0.5s;
    }

    .overlay.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .overlay h2 {
      font-family: 'Righteous', cursive;
      font-size: clamp(2rem, 8vw, 4rem);
      color: #fff;
      text-shadow: 0 0 20px #f0f, 0 0 40px #0ff;
      margin-bottom: 1rem;
    }

    .overlay p {
      color: #0ff;
      font-size: 1.2rem;
      margin-bottom: 2rem;
      text-shadow: 0 0 10px #0ff;
    }

    .overlay .final-score {
      font-size: 2rem;
      color: #ff0;
      text-shadow: 0 0 20px #ff0;
      margin-bottom: 1rem;
    }

    .btn {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.2rem;
      padding: 1rem 2.5rem;
      background: transparent;
      border: 2px solid #0ff;
      color: #0ff;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .btn:hover {
      background: #0ff;
      color: #000;
      box-shadow: 0 0 30px #0ff;
    }

    /* Danger state */
    body.danger {
      animation: danger-pulse 0.5s ease-in-out infinite;
    }

    @keyframes danger-pulse {
      0%, 100% { background: #0a0a15; }
      50% { background: #1a0a15; }
    }

    .danger .meter-bar {
      animation: meter-shake 0.1s linear infinite;
    }

    @keyframes meter-shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-2px); }
      75% { transform: translateX(2px); }
    }

    /* Giggle text */
    .giggle-text {
      position: fixed;
      font-family: 'Righteous', cursive;
      font-size: 1.5rem;
      color: #f0f;
      text-shadow: 0 0 10px #f0f;
      pointer-events: none;
      animation: giggle-float 1s ease-out forwards;
      z-index: 150;
    }

    @keyframes giggle-float {
      0% { opacity: 1; transform: translateY(0) scale(1); }
      100% { opacity: 0; transform: translateY(-80px) scale(1.3); }
    }

    .wave {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      color: #ff0;
      font-size: 1rem;
      text-shadow: 0 0 10px #ff0;
      z-index: 100;
      animation: pulse 1s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.7; }
      50% { opacity: 1; }
    }

    .link {
      position: fixed;
      bottom: 0.5rem;
      left: 50%;
      transform: translateX(-50%);
      color: #666;
      font-size: 0.7rem;
      z-index: 100;
    }

    .link a {
      color: #888;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <div class="hud">
    <div class="title">TICKLE DEFENSE</div>
    <div class="score">Score: <span id="score">0</span></div>
  </div>

  <div class="game-container" id="gameContainer"></div>

  <div class="wave" id="waveText">Wave 1</div>

  <div class="meter-container">
    <div class="meter-label">GIGGLE METER</div>
    <div class="meter-bar">
      <div class="meter-fill" id="meterFill"></div>
      <div class="meter-text" id="meterText">0%</div>
    </div>
  </div>

  <div class="overlay" id="startOverlay">
    <h2>Tickle Defense</h2>
    <p>Click the feathers before you burst!</p>
    <button class="btn" id="startBtn">START</button>
  </div>

  <div class="overlay hidden" id="gameOverOverlay">
    <h2>ðŸ˜‚ YOU BURST! ðŸ˜‚</h2>
    <div class="final-score">Score: <span id="finalScore">0</span></div>
    <p>Wave reached: <span id="finalWave">1</span></p>
    <button class="btn" id="restartBtn">TRY AGAIN</button>
  </div>

  <div class="link"><a href="https://sloppy.live">sloppy.live</a></div>

  <script>
    const gameContainer = document.getElementById('gameContainer');
    const meterFill = document.getElementById('meterFill');
    const meterText = document.getElementById('meterText');
    const scoreEl = document.getElementById('score');
    const waveText = document.getElementById('waveText');
    const startOverlay = document.getElementById('startOverlay');
    const gameOverOverlay = document.getElementById('gameOverOverlay');
    const finalScoreEl = document.getElementById('finalScore');
    const finalWaveEl = document.getElementById('finalWave');

    let giggleMeter = 0;
    let score = 0;
    let wave = 1;
    let gameRunning = false;
    let feathers = [];
    let spawnInterval = null;
    let tickInterval = null;
    let audioCtx = null;

    const featherTypes = [
      { emoji: 'ðŸª¶', class: 'cyan', points: 10 },
      { emoji: 'ðŸª½', class: 'magenta', points: 15 },
      { emoji: 'âœ¨', class: 'yellow', points: 20 },
      { emoji: 'ðŸ’«', class: 'green', points: 25 }
    ];

    const giggles = ['hehe', 'teehee', '*giggle*', 'haha', 'stop!', 'nooo'];

    function initAudio() {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
    }

    function playPop() {
      if (!audioCtx) return;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      osc.frequency.setValueAtTime(800, audioCtx.currentTime);
      osc.frequency.exponentialRampToValueAtTime(200, audioCtx.currentTime + 0.1);
      gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
      gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.1);
      osc.start();
      osc.stop(audioCtx.currentTime + 0.1);
    }

    function playGiggle() {
      if (!audioCtx) return;
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      osc.frequency.setValueAtTime(400 + Math.random() * 200, audioCtx.currentTime);
      osc.type = 'sine';
      gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
      gain.gain.linearRampToValueAtTime(0, audioCtx.currentTime + 0.2);
      osc.start();
      osc.stop(audioCtx.currentTime + 0.2);
    }

    function spawnParticles(x, y, color) {
      for (let i = 0; i < 8; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = x + 'px';
        particle.style.top = y + 'px';
        particle.style.background = color;
        particle.style.boxShadow = `0 0 10px ${color}`;

        const angle = (i / 8) * Math.PI * 2;
        const velocity = 50 + Math.random() * 50;
        const vx = Math.cos(angle) * velocity;
        const vy = Math.sin(angle) * velocity;

        particle.animate([
          { transform: 'translate(0, 0) scale(1)', opacity: 1 },
          { transform: `translate(${vx}px, ${vy}px) scale(0)`, opacity: 0 }
        ], { duration: 400, easing: 'ease-out' });

        document.body.appendChild(particle);
        setTimeout(() => particle.remove(), 400);
      }
    }

    function spawnGiggleText() {
      const text = document.createElement('div');
      text.className = 'giggle-text';
      text.textContent = giggles[Math.floor(Math.random() * giggles.length)];
      text.style.left = (Math.random() * (window.innerWidth - 100) + 50) + 'px';
      text.style.top = (Math.random() * (window.innerHeight - 200) + 100) + 'px';
      document.body.appendChild(text);
      setTimeout(() => text.remove(), 1000);
    }

    function spawnFeather() {
      if (!gameRunning) return;

      const type = featherTypes[Math.floor(Math.random() * featherTypes.length)];
      const feather = document.createElement('div');
      feather.className = `feather ${type.class}`;
      feather.textContent = type.emoji;
      feather.dataset.points = type.points;

      const x = Math.random() * (window.innerWidth - 60) + 30;
      const y = Math.random() * (window.innerHeight - 250) + 80;
      feather.style.left = x + 'px';
      feather.style.top = y + 'px';
      feather.style.setProperty('--rot', (Math.random() * 40 - 20) + 'deg');

      // Time before it tickles you
      const lifetime = Math.max(2000 - wave * 100, 800);
      feather.dataset.spawnTime = Date.now();
      feather.dataset.lifetime = lifetime;

      feather.addEventListener('click', (e) => {
        e.stopPropagation();
        if (feather.classList.contains('popped')) return;

        initAudio();
        playPop();

        const rect = feather.getBoundingClientRect();
        const color = getComputedStyle(feather).color;
        spawnParticles(rect.left + rect.width/2, rect.top + rect.height/2, color);

        score += parseInt(feather.dataset.points);
        scoreEl.textContent = score;

        feather.classList.add('popped');
        setTimeout(() => {
          feather.remove();
          feathers = feathers.filter(f => f !== feather);
        }, 300);
      });

      gameContainer.appendChild(feather);
      feathers.push(feather);
    }

    function updateMeter(amount) {
      giggleMeter = Math.min(100, Math.max(0, giggleMeter + amount));
      meterFill.style.width = giggleMeter + '%';
      meterText.textContent = Math.floor(giggleMeter) + '%';

      if (giggleMeter >= 70) {
        document.body.classList.add('danger');
      } else {
        document.body.classList.remove('danger');
      }

      if (giggleMeter >= 100) {
        gameOver();
      }
    }

    function tick() {
      if (!gameRunning) return;

      const now = Date.now();
      feathers.forEach(feather => {
        if (feather.classList.contains('popped')) return;

        const spawnTime = parseInt(feather.dataset.spawnTime);
        const lifetime = parseInt(feather.dataset.lifetime);

        if (now - spawnTime > lifetime) {
          // Feather reached you - adds to giggle meter
          updateMeter(5 + wave);
          playGiggle();
          spawnGiggleText();

          feather.classList.add('popped');
          setTimeout(() => {
            feather.remove();
            feathers = feathers.filter(f => f !== feather);
          }, 300);
        }
      });

      // Slowly decrease meter if doing well
      if (giggleMeter > 0) {
        updateMeter(-0.1);
      }
    }

    function nextWave() {
      wave++;
      waveText.textContent = `Wave ${wave}`;
      waveText.style.animation = 'none';
      void waveText.offsetWidth;
      waveText.style.animation = 'pulse 1s ease-in-out infinite';
    }

    function startGame() {
      initAudio();
      giggleMeter = 0;
      score = 0;
      wave = 1;
      gameRunning = true;

      scoreEl.textContent = '0';
      waveText.textContent = 'Wave 1';
      updateMeter(0);

      feathers.forEach(f => f.remove());
      feathers = [];

      startOverlay.classList.add('hidden');
      gameOverOverlay.classList.add('hidden');
      document.body.classList.remove('danger');

      // Spawn feathers
      let spawnRate = 1500;
      spawnInterval = setInterval(() => {
        if (!gameRunning) return;
        spawnFeather();

        // Speed up over time
        if (score > 0 && score % 100 === 0) {
          nextWave();
          clearInterval(spawnInterval);
          spawnRate = Math.max(400, spawnRate - 100);
          spawnInterval = setInterval(() => spawnFeather(), spawnRate);
        }
      }, spawnRate);

      // Game tick
      tickInterval = setInterval(tick, 100);

      // Wave progression
      setInterval(() => {
        if (gameRunning && score > wave * 50) {
          nextWave();
        }
      }, 1000);
    }

    function gameOver() {
      gameRunning = false;
      clearInterval(spawnInterval);
      clearInterval(tickInterval);

      finalScoreEl.textContent = score;
      finalWaveEl.textContent = wave;
      gameOverOverlay.classList.remove('hidden');

      // Burst animation
      for (let i = 0; i < 20; i++) {
        setTimeout(() => spawnGiggleText(), i * 100);
      }
    }

    document.getElementById('startBtn').addEventListener('click', startGame);
    document.getElementById('restartBtn').addEventListener('click', startGame);
  </script>
</body>
</html>
