# The Archive of Synthesis

From chaos to crystalline harmony. A living archive where ideas converge, synthesize, and transcend. Global chatroom with image uploads, avatars, manifestos, and collaborative canvas.

## log
- 2026-02-04: Extracted SloppyFM Radio to iframe embed of /sloppy-radio/
  - Floating widget pattern: fixed-position draggable widget with iframe inside
  - Replaced ~212 lines SloppyFM CSS + ~36 lines HTML (widget + controls + visualizer + playlist + YT player) + ~548 lines JS (player, sync, realtime, visualizer, controls) with ~30 lines CSS + ~9 lines HTML + ~12 lines JS stubs
  - Removed sloppyfm channel from channelState, warmDomCache, and cleanup handler
  - Widget chrome (toggle button, titlebar, draggable) kept in monolith; all radio logic in iframe
  - Total reduction: 14,522 ‚Üí 13,726 lines (796 lines, 5.5%, 33.0% total from original 20,475)
- 2026-02-04: Extracted Direct Messages system to iframe embed of /sloppy-dms/
  - Tab iframe pattern: iframe within DM tab (?embed=true), same as feed/manifestos/karma/factions
  - Replaced ~401 lines DM CSS + ~50 lines DM HTML (container + new DM modal) + ~355 lines DM JS with ~6 lines CSS + ~3 lines HTML + ~22 lines JS stubs
  - postMessage bridge: username-click ‚Üí showProfileCard, dm-notification ‚Üí playNotificationSound
  - startDMWithUser() sends start-dm postMessage to iframe (used by profile card DM button)
  - Removed DM realtime handler from postsChannel (iframe has own subscription)
  - Total reduction: 15,285 ‚Üí 14,522 lines (763 lines, 5.0%, 29.1% total from original 20,475)
- 2026-02-04: Extracted notification sound settings UI to iframe embed of /sloppy-notifications/
  - Panel iframe pattern: iframe within settings modal tab (?embed=true&panel=true)
  - Replaced ~69 lines sound CSS + ~70 lines sound HTML + ~75 lines sound control functions with ~10 lines iframe stub
  - Sound library + playNotificationSound kept in monolith (AudioContext needs same browsing context)
  - Settings shared via localStorage (same obfuscated format)
  - postMessage: sound-settings-changed ‚Üí monolith updates in-memory settings + broadcasts globally
  - Total reduction: 15,494 ‚Üí 15,285 lines (209 lines, 1.3%, 25.3% total from original 20,475)
- 2026-02-04: Extracted Support/Donate Modal to iframe embed of /sloppy-support/
  - Overlay iframe pattern (same as sloppy-media): position:fixed, inset:0, z-index:10000
  - Replaced ~281 lines support modal CSS + ~72 lines HTML + ~114 lines JS with ~20 lines iframe stubs
  - Crypto addresses (BTC/ETH/SOL/XMR), fiat links (Ko-fi/PayPal/Patreon), Stripe placeholder all in iframe
  - postMessage: open-support ‚Üí iframe shows overlay, support-close/address-copied ‚Üí monolith handles
  - Kept .donate-btn CSS for header button styling
  - Total reduction: 15,874 ‚Üí 15,494 lines (380 lines, 2.4%, 24.3% total from original 20,475)
- 2026-02-04: Extracted Image Lightbox + Share Modal + GIF Search to iframe embed of /sloppy-media/
  - New extraction pattern: full-viewport overlay iframe (position:fixed, inset:0, z-index:10000)
  - Replaced ~500 lines of lightbox/share/GIF CSS/HTML/JS with ~50 lines iframe stub + postMessage bridge
  - Lightbox CSS (~56 lines), Share Modal CSS (~140 lines), GIF Modal CSS (~75 lines) ‚Üí 4 lines
  - Lightbox HTML (5 lines), Share HTML (23 lines), GIF HTML (17 lines) ‚Üí 2 lines
  - Share/Lightbox JS (~140 lines), GIF search/render JS (~127 lines) ‚Üí ~45 lines stubs
  - postMessage: open-lightbox/open-share/open-gif ‚Üí media iframe shows overlay, media-close/gif-selected/link-copied ‚Üí monolith handles
  - sendGif kept in monolith (DB writes, rate limiting, optimistic UI, addMessageToUI)
  - Kept .message-gif CSS for chat message rendering
  - Total reduction: 16,374 ‚Üí 15,874 lines (500 lines, 3.1%, 22.5% total from original 20,475)
- 2026-02-04: Extracted Faction Wars system to iframe embed of /sloppy-factions/
  - Replaced ~921 lines of faction CSS/HTML/JS with ~35 lines iframe stub + postMessage bridge
  - FACTIONS tab now loads sloppy-factions/?embed=true in iframe (same pattern as posts/canvas/graph/manifestos/karma)
  - postMessage bridge: username clicks on warrior names and battle log ‚Üí showProfileCard
  - Removed: faction CSS (~508 lines), factionsContainer HTML (~68 lines), loadFactionsData/renderFactionsUI/renderFactionSelection/renderMyFactionBanner/renderTerritoryMap/renderFactionLeaderboard/renderBattleLog/updateWarStats/pledgeToFaction/leaveFaction/attackTerritory/showBattleModal/closeBattleModal/executeBattle/showBattleResult/selectTerritory/initializeFactions (~345 lines)
  - Removed FACTIONS and TERRITORY_NAMES constants (only used by removed render functions)
  - Chaos engine reboot reloads factions iframe
  - Total reduction: 17,295 ‚Üí 16,374 lines (921 lines, 5.3%, 20.0% total from original 20,475)
- 2026-02-04: Extracted Karma/Reputation system to iframe embed of /karma-board/
  - Replaced ~696 lines of karma/reputation JS/CSS/HTML with ~70 lines iframe stub + postMessage bridge
  - KARMA tab now loads karma-board/?embed=true in iframe (same pattern as posts/canvas/graph/manifestos)
  - postMessage bridge: username clicks ‚Üí showProfileCard, calculate-karma request/response for profile cards
  - Removed: karma CSS (~233 lines), karmaContainer HTML (~55 lines), loadKarmaLeaderboard/calculateUserKarma/loadReputations/getReputationBadge etc (~408 lines)
  - Preserved lightweight getEarnedBadges locally (pure function, ~15 lines) for profile card badge rendering
  - Dead code removed: loadReputations() and full getReputationBadge() were never called
  - calculateUserKarma now delegates to iframe via postMessage with requestId pattern + 8s timeout fallback
  - Chaos engine reboot reloads karma iframe
  - Total reduction: 17,991 ‚Üí 17,295 lines (696 lines, 3.9%, 15.5% total from original 20,475)
- 2026-02-04: Extracted Manifesto system to iframe embed of /sloppy-manifestos/
  - Replaced ~1,128 lines of manifesto JS/CSS/HTML with ~60 lines iframe stub + message bridge
  - MANIFESTO tab now loads sloppy-manifestos/?embed=true in iframe (same pattern as posts/canvas/graph)
  - postMessage bridge: username clicks ‚Üí showProfileCard, new manifesto ‚Üí addToFeed, vote ‚Üí updateConfidenceMonitor
  - Removed: manifesto CSS (~378 lines), manifestoContainer + manifestoModal HTML (~49 lines), loadManifestos/renderManifestos/renderManifestoCard/voteManifesto/deleteManifesto/etc (~632 lines), speakManifesto (~55 lines), parseManifestoMarkdown (~32 lines), generateDNASignature (~42 lines)
  - Removed 5 manifesto-specific realtime handlers from postsChannel (kept doodle/chat/background handlers)
  - Preserved shared functions: startReply, cancelReply, filterByTag, clearTagFilter (manifesto branches become no-ops)
  - Tag Explorer and karma calculations still work (query DB directly)
  - Chaos engine reboot reloads iframe
  - Fixed renderThreadedComments bug (was called by manifesto code but already removed in post extraction)
  - Total reduction: 19,119 ‚Üí 17,991 lines (1,128 lines, 5.9%, 12.1% total from original 20,475)
- 2026-02-04: Extracted Post/Feed system to iframe embed of /sloppy-feed/
  - Replaced ~1546 lines of post JS/CSS/HTML with ~190 lines iframe stub + message bridge
  - Posts tab now loads sloppy-feed/?embed=true in iframe (same pattern as canvas/graph)
  - postMessage bridge: username clicks ‚Üí showProfileCard, new post ‚Üí addToFeed
  - Removed: post CSS (~690 lines), postModal + FAB HTML (~50 lines), loadPosts/renderPosts/votePost/addComment/submitPost etc (~800 lines)
  - Removed 6 post-specific realtime handlers from postsChannel (kept manifesto/doodle/chat handlers)
  - Preserved shared functions: speakMessage, speakManifesto, startReply, cancelReply, generateContentDNA, forkMessage, forkDoodle, filterByTag, clearTagFilter
  - Chaos engine reboot reloads iframe
  - Total reduction: 20,475 ‚Üí 19,119 lines (1,356 lines, 6.6%)
- 2026-02-04: Extracted Collab Canvas and Social Graph to iframe embeds
  - Replaced ~715 lines of collab canvas JS, ~185 lines CSS, ~36 lines HTML with iframe stub (~110 lines)
  - Replaced ~425 lines of social graph JS, ~168 lines CSS, ~38 lines HTML with iframe stub (~25 lines)
  - Collab Canvas now embeds /sloppy-canvas/?embed=true ‚Äî same Supabase tables and broadcast channels
  - Social Graph now embeds /sloppy-network/?embed=true ‚Äî node clicks trigger showProfileCard via postMessage
  - Snapshot button uses postMessage to request canvas dataURL from iframe, then uploads to doodles
  - Chaos engine reboot reloads iframes instead of clearing canvas memory
  - Total reduction: 21,857 -> 20,475 lines (1,382 lines, 6.3%)
  - Drawing Canvas (84 lines), Undo/Redo (66 lines), SloppyFM Visualizer (133 lines) NOT extracted ‚Äî too coupled
- 2026-02-01: Profile editor removed ‚Äî redirected to SloppyID
  - Removed inline username, avatar, and color editing from settings modal
  - Added SloppyID profile card showing current username, avatar, trust score, and verification badges
  - SloppyID is now the only writer to sloppygram_profiles (sovereignty enforced)
  - Background editing retained (sloppygram-specific)
  - Settings "Profile" tab now shows identity card + background options
- 2026-02-01: Unified profile data ‚Äî sloppygram_profiles as single source of truth
  - Init profile load reads from sloppygram_profiles instead of sloppyid_vault
  - Avatar URL vs emoji detected by http/data: prefix
  - Bio field used for status text
- 2026-01-28: Social Graph Visualization
  - Interactive force-directed network map showing user connections
  - Visualizes follows (blue), delegations (purple), faction members (green)
  - Node size based on karma, verified users glow cyan
  - Canvas-based physics simulation with zoom/pan controls
  - Filter by relationship type (All/Follows/Delegations/Factions)
  - Hover tooltips show username, karma, rank
  - Click nodes to open profile cards
  - Stats display: nodes, edges, cluster count
  - New GRAPH tab in header
  - Data from: sloppygram_follows, swarm_delegations, sloppygram_faction_members, sloppygram_karma, sloppyid_verifications
- 2026-01-27: Faction Wars System
  - 5 digital clans: Phoenix Order, Shadow Collective, Cyber Nexus, Verdant Grove, Cosmic Void
  - 5x5 territory grid (25 territories) with defense ratings
  - Pledge allegiance to join a faction
  - Territory battles with attack/defense power rolls
  - Attack power based on karma + contribution score
  - Battle log showing recent conquests
  - Clan leaderboard ranked by territory control
  - Member contribution tracking (battles won/lost)
  - Database tables: sloppygram_factions, sloppygram_faction_members, sloppygram_territories, sloppygram_faction_battles
  - FACTIONS tab in header
- 2026-01-27: Social Graph - Follows & Mentions
  - sloppygram_follows table for follower/following relationships
  - sloppygram_mentions table for @mention notifications
  - Follow/unfollow buttons on profile cards
  - Follower/following counts displayed on profiles
  - Self-mentions highlighted with gold pulse animation
  - Mention notifications when someone @mentions you
  - Rate limiting on follows (10/minute)
  - Mentions auto-saved when posting messages
  - Periodic mention checking (every 30 seconds)
- 2026-01-27: Karma Leaderboard System - AI-driven scoring based on content creation, engagement received, quality bonuses, diversity multiplier, activity streak; badge achievements (Rising Star, Legend, Philosopher, Doodle Master, etc.); KARMA tab with filters by time period and category
- 2026-01-27: Added Genealogist to App Launcher - DNA heritage tree visualization for manifesto lineages
- 2026-01-27: Widget upgrades - Presence Pulse (wave animation replacing radar sweep), Confidence Monitor (subtle pulse replacing spinning rings), Oracle Log (right-click horizontal compression), Widget Opacity slider in settings, resizable embedded app windows
- 2026-01-27: App Launcher refresh - removed World Monitor and Toiletgram, added Origins, Sloppygram API, Claude's Diary, Federated Truth, Blueprint Portal, Sloppy Says
- 2026-01-26: Content DNA System - universal DNA generator for all entities (messages, doodles, posts, manifestos), colored nucleotide sequences (ATCG), entity prefixes (M/D/P/X)
- 2026-01-26: Fork buttons everywhere - fork messages (üîÄ copies to input with DNA tag), fork doodles (opens canvas), fork posts (copies caption), manifesto fork retained
- 2026-01-26: TTS for manifestos - üîä Listen button reads title + content aloud, purple accent styling, speaking state animation
- 2026-01-26: Added downvoting to Feedback Hub (IDEAS tab) - ‚ñ≤/‚ñº buttons, direction stored in vote_type column, scores can go negative, color-coded display
- 2026-01-26: Fixed manifesto downvoting - recreated sloppygram_manifesto_votes table with vote_type column, removed localStorage workaround, downvotes now properly stored and shared across users/devices
- 2026-01-25: Critical XSS fixes - escapeAttr() applied to all onclick handlers (parseChatTags #tags/@mentions, parseHackerMarkup wave/spoiler/effects, doodle/post/manifesto/comment vote controls, username profile cards, tag filters, TTS buttons, delete buttons, reaction pickers), onerror handler refactored to use DOM manipulation instead of innerHTML
- 2026-01-25: DOM null checks and robust patterns - safeSetDisplay() helper for safe style access, visitorCount null check, avatar/background preview null checks, canvas context null check, findColorOption() helper for color matching (handles RGB and hex formats), updateThemeUI() refactored from fragile onclick selectors
- 2026-01-25: Drag handler refactor - centralized makeDraggable() system with registerListener() tracking, all 16 widgets now use cleanup-ready handlers, clearAllTimers() clears all listeners
- 2026-01-25: Critical bug fixes - SloppyFM channel cleanup added, Oracle Log channel tracked for cleanup, escapeAttr() XSS fix for reaction onclick handlers, Confidence Monitor timeout tracked with registerTimeout()
- 2026-01-25: Mobile help mode - toggle in hamburger menu enables tap-to-show tooltips for phone users, banner indicator, tap again to dismiss
- 2026-01-25: Tooltip system for new users - hover tooltips on header buttons (USERS, FEED, SETTINGS, etc), view tabs (CHAT, POSTS, DOODLES, etc), chat input actions (camera, drawing, GIF), improved title descriptions on floating widgets (SloppyFM, Twitch, Ghost Radar, Oracle Log, App Launcher, Confidence Monitor)
- 2026-01-25: Oracle Log widget - persistent question storage for defining questions, expandable UI, real-time sync, importance stars, purple mystic aesthetic
- 2026-01-25: Wiki Scout integration - added Wikipedia explorer to app launcher (13 apps total), exocortex knowledge bridge
- 2026-01-25: Cognitive Engine Alignment - implemented cognitiveState tracking (mode, temperature, confidence, variance), createCognitiveOutput for structured outputs, logVariance for operation monitoring, enterRecursion/exitRecursion with Max_Depth=5 breaker, setCognitiveStatus for state transitions, cognitiveReport() diagnostic, bootAudit extended with cognitive checks
- 2026-01-25: Week 3 Performance & Security Protocol - DOM element caching (getCachedElement/warmDomCache for 15 frequent elements), DOMPurify coverage verified on all user content paths (escapeHtml, sanitizeHtml, sanitizeUrl), query batching audit confirmed (16 Promise.all patterns, no N+1 issues), bootAudit extended with DOM cache status
- 2026-01-25: Week 2 Race Condition Protocol - channelState tracking (7 channels), dataLoadState tracking (5 data types), subscribeWithPromise wrapper with 10s timeout, async guards on all RT handlers (isDataReady checks), 3-phase boot sequence (votes‚Üídata‚Üísubscriptions), bootAudit() diagnostic function
- 2026-01-25: Memory Stabilization Protocol - centralized interval registry (registerInterval/clearRegisteredInterval), proper Supabase channel unsubscription, clearAllTimers on cleanup, initialization guards for canvas listeners
- 2026-01-25: Manifesto Lineage/Forking - parent_id tracking via sloppygram_manifesto_lineage table, Fork button on cards, lineage shown in DNA signature, quotes parent content
- 2026-01-25: DNA Signature system - unique genetic identifiers for manifestos (lineage code, generation, structural marker, nucleotide sequence), color-coded ATCG display
- 2026-01-25: Manifesto upvote/downvote system - ‚ñ≤/‚ñº controls with net score display, localStorage vote direction tracking, links to Confidence Monitor
- 2026-01-25: Confidence Monitor v2 - 100% real metrics from database (votes, reactions, manifestos, upvotes), no random values, 10s cache
- 2026-01-25: Confidence Monitor widget - live certainty percentage display with 3 modes (System/Engage/Synth), spinning rings, color-coded status
- 2026-01-25: Rebranded to "The Archive of Synthesis" - updated title, meta tags, logo, welcome messages, share text
- 2026-01-25: App Launcher crypto apps - added BTC Tracker, Solana Tracker, Sloppy Coin, Crypto Tools, Sloppy Dashboard (12 apps total)
- 2026-01-25: App Launcher expanded - added World Monitor, Toiletgram, Neon Tetris, Neon Synth, Pixel Editor to launcher (7 apps total)
- 2026-01-25: App Launcher - modular launcher (üöÄ) with embedded Graffiti Wall and Manifesto Generator in draggable windows, diamond aesthetic, lazy iframe loading
- 2026-01-25: Twitch chat widget - second floating draggable window for sloppy_ai chat, diamond aesthetic, dark theme
- 2026-01-25: Twitch embed widget - floating draggable window for sloppy_ai channel, diamond aesthetic, lazy-loads iframe, mobile touch support
- 2026-01-25: Ghost text prediction - constructive wisdom and creative prompts appear as you type, TAB to accept, 60+ trigger words with encouraging/collaborative suggestions
- 2026-01-25: SloppyFM timestamp sync fix - position broadcasts every 5s, drift correction (3s tolerance), 10s DB sync, manual resync button (üîÑ)
- 2026-01-25: SloppyFM canvas visualizer - 32-bar frequency visualizer with peak indicators, color gradients (green/yellow/red), smooth animations
- 2026-01-25: WelcomeBot - greets new users with random friendly messages when they join, UI-only (not saved to DB)
- 2026-01-25: Reaction confetti - canvas-confetti celebration bursts when adding emoji reactions, colors match emoji theme
- 2026-01-25: GIF search - Giphy-powered GIF search modal, click GIF button to browse trending or search, sends as chat message
- 2026-01-25: Message reactions - emoji reactions on chat messages (üòÇüî•‚ù§Ô∏èüòÆüò¢üëèüôåüíÄ), click +üòÄ to react, real-time sync
- 2026-01-24: Tag Explorer now has 3 tabs - Messages, Posts, Manifestos - queries all tag tables in parallel
- 2026-01-24: SloppyFM realtime sync - broadcast channel for instant track/queue updates, RLS policies for user ownership
- 2026-01-24: SloppyFM v2.0 - synchronized YouTube radio with Supabase queue, auto-seek playback, hidden YouTube player, add tracks via URL input
- 2026-01-24: Tag Explorer modal now renders actual post/manifesto cards with tabbed interface (Posts/Manifestos tabs)
- 2026-01-24: Tag filter now works across all sources - clicking a tag filters posts, messages, and manifestos simultaneously with result counts
- 2026-01-24: Tag Explorer fix - now queries all 3 tag tables directly via Supabase (messages, posts, manifestos) instead of broken API fetch
- 2026-01-24: Text-to-speech for chat messages - üîä button on each text message, strips hacker markup for clean speech
- 2026-01-24: Text-to-speech for posts - üîä button reads post captions aloud using Web Speech API, click to toggle
- 2026-01-24: IDEAS tab real-time subscriptions - new ideas, votes, updates, and deletions appear instantly via Supabase postgres_changes
- 2026-01-24: Feedback Hub integration - new IDEAS tab with voting, submission, category filtering; uses shared feedback tables
- 2026-01-24: Cross-app profile stats - profile cards now show game high scores from Breakout, Icy Tower, Tetris, Star Catcher
- 2026-01-24: Tag Explorer upgrade - uses API for aggregated tag data, modal shows source breakdown (msgs/posts/manifestos), top users, recent content
- 2026-01-24: Performance optimization - DOM caching for Ghost Radar and SloppyFM, reduced interval frequencies, class change detection
- 2026-01-24: Ghost Radar widget - shows silent lurkers from Supabase presence, animated radar sweep, blips for each ghost
- 2026-01-24: SloppyFM Winamp widget - draggable floating player with lo-fi/vaporwave synth tracks, visualizer, playlist
- 2026-01-24: Away status/messages - set custom status shown in user list, persisted to localStorage, broadcasts via presence
- 2026-01-24: Image lightbox - click images to view in overlay instead of window.open
- 2026-01-24: Dynamic tag cloud visualization - neon colors, size by frequency, real-time updates, click to filter
- 2026-01-24: Added missing renderMessages function for filter clearing, verified mobile menu HTML complete
- 2026-01-24: Implemented real tag/mention filtering - click #tags to filter chat, @mentions show user messages, filter bar with clear button
- 2026-01-24: New mobile menu system - dropdown menu with all actions, toggleMobileMenu function, desktop/mobile button separation
- 2026-01-24: Enhanced mobile drawer with header/footer, fixed all delete button scopes (isOwnDoodle, isOwnManifesto) to use user_id
- 2026-01-24: Fixed isOwnMessage to use user_id check, fixed handleTagInput function collision, enhanced tag-input CSS
- 2026-01-24: Created sloppygram_message_tags table with RLS policies for chat tagging system
- 2026-01-24: Added Ralph Wiggum bot, Gold Master dataURLtoBlob and Share URL upgrades
- 2026-01-24: Chat tagging system (#tags, @mentions) and enhanced mobile menu logic
- 2026-01-24: Legacy syntax refactor - replaced 37 optional chaining instances with && checks for older browser support
- 2026-01-23: Added fiat section to support modal - Ko-fi, PayPal, Patreon buttons above crypto grid
- 2026-01-23: Multi-crypto support modal - Bitcoin, Ethereum, Solana, Monero + Stripe (2x2 grid layout)
- 2026-01-23: Full support modal system - CSS grid layout, donate button, improved clipboard logic with toast
- 2026-01-23: Mobile flexbox refactor - replaced 100dvh calc() with flex:1, added safe-area-inset padding
- 2026-01-23: Removed profile card cache - stats now always fetched fresh from database
- 2026-01-23: Profile cards now show upvotes/downvotes from user's posts (green ‚ñ≤ / red ‚ñº)
- 2026-01-23: Added eraser tool to collaborative canvas (üßΩ button, wider brush, syncs with other users)
- 2026-01-23: Added rebootSystem function with glitchy overlay, flushes all memory caches and reinitializes
- 2026-01-23: Added System tab in settings with reboot button and hacker markup reference
- 2026-01-23: Added [spoiler] tag - click to reveal hidden text
- 2026-01-23: Added hacker markup tags - [shake], [rainbow], [matrix], [glitch], [pulse], [wave] for animated text in chat
- 2026-01-23: Added delete for manifestos and nested comments for doodles
- 2026-01-23: Fixed snapshot: rate limit bug (was ignoring return object), use uploadToStorage helper, fix white-image with temp canvas
- 2026-01-23: Added snapshot function to collab canvas - captures canvas and posts to doodles feed, logs ai_event
- 2026-01-23: Collab canvas now persists strokes to database - new users see existing art on load
- 2026-01-23: Collab canvas clear now only removes user's own strokes - stroke history tracks ownership, broadcasts clear_user event
- 2026-01-23: Enhanced collab canvas - fixed coordinate offset, increased to 1600x1000, added zoom (scroll/buttons) and pan (scroll overflow)
- 2026-01-23: Added real-time collaborative canvas - draw together with other users, see cursors and strokes live
- 2026-01-23: Added profile cards - click any username to see stats (messages, posts, doodles, manifestos, likes)
- 2026-01-23: Added lazy-loading optimizer with Intersection Observer for images (100px rootMargin preload)
- 2026-01-23: Added rate limiting (sliding window) - 5 msgs/10s, 3 posts/min, 20 votes/min, 10 comments/min, 3 drawings/30s
- 2026-01-23: Added canvas undo/redo with 20-state history (Ctrl+Z/Y, ‚Ü∂/‚Ü∑ buttons)
- 2026-01-23: Added system-toast notification styles and fixed memory leaks (cleanup channels on unload)
- 2026-01-23: Implemented infinite scroll pagination for chat messages and posts (PAGE_SIZE=30)
- 2026-01-23: Added DOMPurify for XSS protection - sanitizes all user content, URLs blocked for javascript:/data: protocols
- 2026-01-23: Optimized queries with Promise.all batching - solved N+1 problem in loadPosts, loadManifestos, loadDoodleLeaderboard
- 2026-01-23: Migrated to Supabase Storage for images/doodles - no more base64 in database (requires 'sloppygram' bucket)
- 2026-01-23: Reverted settings sync/debug features for clean slate
- 2026-01-23: Updated all feed containers to use full viewport width on mobile
- 2026-01-23: Added touch swipe navigation for mobile - swipe left/right to switch tabs
- 2026-01-23: Removed donate button and tip jar (per chat request)
- 2026-01-23: Fixed mobile layout - full width, smooth scrolling, input stays at top
- 2026-01-23: Moved message input form to top of interface (under header/tabs)
- 2026-01-23: Fixed mobile viewport - disabled auto-zoom on inputs, added viewport-fit=cover
- 2026-01-23: Added auto-scroll to most recent message on app load
- 2026-01-23: Fixed mobile feed height - main content now uses 100dvh minus header height
- 2026-01-23: Fixed mobile sidebar CSS - sidebars now completely hidden when closed (CSS cascade fix)
- 2026-01-23: Added hamburger menu toggle for left sidebar on mobile (animated X when open)
- 2026-01-23: Updated donate modal with Bitcoin address (copy to clipboard) and Stripe placeholder
- 2026-01-23: Added Donate button with gold coin icon to sidebar
- 2026-01-23: Fixed posts/doodles not loading (removed reference to deleted transparencyBar)
- 2026-01-23: Fixed theme to cover entire UI - panel background now updates dark-bg and border-color
- 2026-01-23: Added full interface theme customization - accent color, highlight color, panel background (10 options each)
- 2026-01-23: Added custom sound file upload (base64, max 500KB) with preview and clear buttons
- 2026-01-23: Fixed notification sounds - audio context resume for browser autoplay policy
- 2026-01-23: Added Themes tab in settings - message opacity slider, message color customization (10 colors each)
- 2026-01-23: Replaced trash icons with simple "delete" text for cleaner look
- 2026-01-23: Added settings menu with tabs (Profile, Themes, Sounds) - replaced profile button
- 2026-01-23: Added notification sounds library with 7 procedural sounds (Web Audio API)
- 2026-01-23: Reorganized chat layout - input at bottom, messages flow top-to-bottom (traditional chat style)
- 2026-01-23: Added comment voting - up/down votes on comments with ‚ñ≤/‚ñº buttons
- 2026-01-23: Added AI event logging - logs post_created and vote_cast events to ai_events table
- 2026-01-23: Simplified voting - removed reputation system, added delete buttons for messages/doodles
- 2026-01-23: Added up/down voting (‚ñ≤/‚ñº) for posts, doodles, chat - prevents self-voting, shows net scores
- 2026-01-23: Enhanced power system - vote on chat messages (üî•), doodles (‚≠ê), posts, manifestos; all contribute to user power score
- 2026-01-23: Added user reputation system - earn badges from post likes and manifesto votes (üëë‚≠ê‚ú®üåü)
- 2026-01-23: Added Supabase realtime listeners for posts, comments, reactions, likes, manifestos - auto-refresh feed
- 2026-01-23: Added threaded comments - reply directly to existing comments with nested display
- 2026-01-23: Enhanced Manifesto with emoji reactions, comments, and tags (like posts)
- 2026-01-23: Added Manifesto section - declare your ideas, vote for visions you support
- 2026-01-22: Added nested symbolic tagging system - hierarchical tags with parent/child, filter by tag, trending tags sidebar
- 2026-01-22: Added emoji reactions to posts (8 emojis) and global shared backgrounds
- 2026-01-22: Replaced URL inputs with file uploads for avatar and background images
- 2026-01-22: Added doodle leaderboard with global voting - star your favorite drawings!
- 2026-01-22: Fixed auth persistence - added explicit session storage options and auth state listener
- 2026-01-22: Added posts system with image URLs, local file preview, likes, and comments
- 2026-01-22: Added custom avatar URL, custom background URL, and profile reset
- 2026-01-22: Removed RoastBot and neon borders - cleaner muted aesthetic
- 2026-01-22: Toned down neon glow effects, improved RoastBot with POST endpoint + timeout + more fallbacks
- 2026-01-22: Major redesign - dark 1990s cyber aesthetic, online users, public feed, AI roast bot
- 2026-01-22: Rewrote real-time with hybrid broadcast+postgres_changes - instant updates for all users
- 2026-01-22: Fixed drawing offset (canvas scaling), improved real-time subscription with status indicator
- 2026-01-22: Initial creation with full chat, images, avatars, and drawing tool

## features
- Dark retro aesthetic with muted colors and scanlines
- VT323 monospace font, CRT scanline overlay
- Marquee header with visitor counter
- Online user list with Supabase Presence
- Public activity feed sidebar
- Global real-time chatroom via Supabase
- Anonymous authentication
- Custom username and avatar
- 18 emoji avatar options
- 10 avatar background colors
- Image uploads (base64, max 500KB)
- GIF search and posting (Giphy-powered, trending + search)
- Drawing tool with 8 brush colors
- Real-time message updates
- Message timestamps
- Own messages highlighted
- Mobile-friendly responsive design
- Posts feed with image URLs and local file upload
- Like and unlike posts
- Comment on posts
- Threaded comments - reply directly to comments with nested display
- Doodle leaderboard with global voting
- Vote on drawings with star button
- Ranked doodle display (gold/silver/bronze)
- Emoji reactions on posts and chat messages (üòÇüî•‚ù§Ô∏èüòÆüò¢üëèüôåüíÄ)
- Global shared backgrounds (upload and share with everyone)
- Nested symbolic tagging (use "/" for hierarchies like meme/cursed, art/pixel)
- Filter posts by clicking tags
- Trending tags sidebar showing most popular tags
- Manifesto board for declaring ideas and visions
- Vote for manifestos you support
- Up/down voting (‚ñ≤/‚ñº) on posts, doodles, and chat messages
- Self-voting prevention - cannot vote on own content
- Net score display (green positive, red negative)
- Delete your own posts, messages, and doodles
- Settings menu with tabbed interface (Profile, Sounds)
- Notification sounds library (blip, chime, pop, retro, cyber, whoosh, ding)
- Volume control for notification sounds
- Sounds saved to localStorage
- Rate limiting on all actions (sliding window algorithm)
- Canvas undo/redo with keyboard shortcuts
- Profile cards - click usernames to see user stats
- Lazy-loading images with Intersection Observer
- Real-time collaborative canvas - iframe embed of /sloppy-canvas/ (draw together, see other users' cursors live)
- Social graph visualization - iframe embed of /sloppy-network/ (node clicks open profile cards in monolith)
- Posts feed - iframe embed of /sloppy-feed/ (full post/vote/react/comment/tag, username clicks open profile cards in monolith)
- Manifesto board - iframe embed of /sloppy-manifestos/ (creation, forking, DNA, voting, reactions, comments, tags, username clicks open profile cards in monolith)

## database tables
- sloppygram_messages: username, avatar, content, image_data, drawing_data, message_type
- sloppygram_profiles: username, avatar, bio, color
- sloppygram_posts: username, avatar, avatar_url, caption, image_url, image_data, likes_count
- sloppygram_post_likes: post_id, username
- sloppygram_doodle_votes: message_id, voter_username
- sloppygram_message_votes: message_id, voter_username
- sloppygram_message_reactions: message_id, emoji, username (chat message emoji reactions)
- sloppygram_post_comments: post_id, username, avatar, content
- sloppygram_post_reactions: post_id, emoji, username
- sloppygram_global_backgrounds: image_data, username, name
- sloppygram_post_tags: post_id, tag, parent_tag
- sloppygram_manifestos: title, content, username, avatar, upvotes
- sloppygram_manifesto_votes: manifesto_id, username, vote_type (1=up, -1=down)
- sloppygram_manifesto_reactions: manifesto_id, emoji, username
- sloppygram_manifesto_comments: manifesto_id, username, avatar, content
- sloppygram_manifesto_tags: manifesto_id, tag, parent_tag
- sloppygram_global_settings: setting_type, setting_value, username, extra_data (syncs backgrounds/sounds globally)
- sloppygram_comment_threads: comment_id, parent_comment_id, comment_type, post_id
- sloppygram_comment_votes: comment_id, voter_username, vote_type
- sloppygram_collab_strokes: start_x, start_y, end_x, end_y, color, username (persisted collaborative canvas)
- sloppygram_message_tags: message_id, tag, parent_tag (chat message tagging system)
- sloppygram_manifesto_lineage: manifesto_id, parent_id, fork_type (tracks forking/ancestry)
- sloppygram_follows: follower_username, followed_username, follower_id, followed_id (social graph)
- sloppygram_mentions: mentioned_username, source_type, source_id, source_username, seen (mention notifications)
- sloppygram_factions: faction_id, name, emoji, color, description, member_count, territory_count, power_score
- sloppygram_faction_members: username, faction_id, contribution_score, battles_won, battles_lost
- sloppygram_territories: territory_id, name, grid_x, grid_y, controlling_faction, defense_power, captured_at, captured_by
- sloppygram_faction_battles: attacker_faction, defender_faction, territory_id, attacker_username, attacker_power, defender_power, winner_faction, status
- ai_events: event_type, entity_type, entity_id, username, metadata (logs post_created, vote_cast, follow, faction_join, faction_battle)

## avatars
üòÄ üòé ü§ñ üëΩ üê± üê∂ ü¶ä üêº üê∏ ü¶Ñ üê≤ üëª üíÄ üéÉ ü§° üëæ ü•∑ üßô

## colors
Pink, Purple, Deep Purple, Indigo, Blue, Cyan, Teal, Green, Orange, Deep Orange

## drawing tool
- Canvas-based drawing
- 8 brush colors (black, pink, purple, blue, green, orange, red, white)
- Undo/redo with 20-state history (Ctrl+Z, Ctrl+Y)
- Clear button
- Send as PNG
- Touch support for mobile

## message types
- text: Regular text messages
- image: Uploaded images
- drawing: Canvas drawings

## storage
- Profile saved to localStorage
- Messages stored in Supabase
- Images/doodles uploaded to Supabase Storage bucket 'sloppygram'
- Falls back to base64 if storage bucket unavailable
- Requires 'sloppygram' bucket with public access in Supabase dashboard

## todos
- None currently

## Next Development Phase: SYNTHESIS v2.0
**Theme: Deeper Social Graph & AI Integration**

1. **Social Graph Visualization** ‚úÖ IMPLEMENTED
   - ‚úì Interactive network map showing user connections
   - ‚úì Force-directed graph with follows, delegations, factions
   - ‚úì Karma-based node sizing, verified user glow
   - Manifesto lineage tree explorer (future)
   - Karma flow visualization between users (future)

2. **AI Exocortex Integration**
   - Claude context injection for personalized interactions
   - AI-assisted manifesto drafting
   - Sentiment analysis on content trends

3. **Enhanced Collaboration**
   - Real-time co-authoring for manifestos
   - Shared canvas sessions with voice chat
   - Group DM conversations

4. **Gamification Layer**
   - Daily/weekly challenges with karma rewards
   - Achievement unlock animations
   - Seasonal events and limited badges

5. **Content Discovery**
   - Algorithmic feed based on karma/engagement
   - "For You" tab with personalized content
   - Cross-app content aggregation

## completed (from old todos)
- ‚úì Private messaging (DM system with conversations and real-time messages)
- ‚úì Remove dead code: sloppyfmPositionBroadcastInterval, sloppyfmSyncInterval variables
- ‚úì Message reactions (with confetti)
- ‚úì GIF support (Giphy integration)
- ‚úì User online status (presence system)
- ‚úì Message deletion (own messages only)
