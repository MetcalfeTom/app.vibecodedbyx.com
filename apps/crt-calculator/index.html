<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CRT Calculator</title>
  <meta name="description" content="Retro calculator with CRT glow and mechanical clicks">
  <meta property="og:title" content="CRT Calculator">
  <meta property="og:description" content="A satisfying retro calculator with green CRT glow">
  <meta property="og:url" content="https://sloppy.live/crt-calculator/">
  <meta property="og:image" content="https://sloppy.live/crt-calculator/og-image.png">
  <link rel="icon" href="https://emojicdn.elk.sh/ðŸ–©">
  <link href="https://fonts.googleapis.com/css2?family=VT323&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #0a0a0a;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'VT323', monospace;
      overflow: hidden;
    }

    .calculator {
      position: relative;
      background: linear-gradient(145deg, #1a1a1a 0%, #0d0d0d 50%, #1a1a1a 100%);
      border: 4px solid #333;
      border-radius: 12px;
      padding: 2rem;
      box-shadow:
        0 0 0 2px #222,
        0 10px 40px rgba(0, 0, 0, 0.8),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }

    .calculator::before {
      content: 'VOID-CALC 3000';
      position: absolute;
      top: 0.8rem;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.7rem;
      color: #333;
      letter-spacing: 0.3em;
    }

    /* CRT Screen */
    .screen-container {
      position: relative;
      background: #0a0f0a;
      border: 3px solid #222;
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 1.5rem;
      overflow: hidden;
    }

    .screen-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(
        rgba(0, 0, 0, 0) 50%,
        rgba(0, 0, 0, 0.15) 50%
      );
      background-size: 100% 4px;
      pointer-events: none;
      z-index: 10;
    }

    .screen-container::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(
        ellipse at center,
        transparent 0%,
        rgba(0, 0, 0, 0.3) 90%,
        rgba(0, 0, 0, 0.6) 100%
      );
      pointer-events: none;
      z-index: 11;
    }

    .screen {
      position: relative;
      min-height: 80px;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      align-items: flex-end;
    }

    .expression {
      font-family: 'Share Tech Mono', monospace;
      font-size: 1rem;
      color: #0a0;
      text-shadow: 0 0 5px #0f0, 0 0 10px #0f0;
      opacity: 0.7;
      min-height: 1.2rem;
      word-break: break-all;
    }

    .display {
      font-family: 'Share Tech Mono', monospace;
      font-size: 2.8rem;
      color: #0f0;
      text-shadow:
        0 0 5px #0f0,
        0 0 10px #0f0,
        0 0 20px #0f0,
        0 0 40px #0a0;
      animation: flicker 0.1s infinite;
      word-break: break-all;
      max-width: 280px;
      text-align: right;
    }

    @keyframes flicker {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.98; }
    }

    .screen-glow {
      position: absolute;
      top: -20px;
      left: -20px;
      right: -20px;
      bottom: -20px;
      background: radial-gradient(ellipse at center, rgba(0, 255, 0, 0.1) 0%, transparent 70%);
      pointer-events: none;
      z-index: -1;
    }

    /* Buttons */
    .buttons {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 0.6rem;
    }

    .btn {
      font-family: 'VT323', monospace;
      font-size: 1.5rem;
      padding: 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.05s;
      position: relative;
      text-shadow: 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    .btn-number {
      background: linear-gradient(180deg, #2a2a2a 0%, #1a1a1a 100%);
      color: #0f0;
      border: 1px solid #333;
      box-shadow:
        0 4px 0 #111,
        0 5px 5px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.05);
    }

    .btn-number:hover {
      background: linear-gradient(180deg, #333 0%, #222 100%);
      color: #3f3;
    }

    .btn-operator {
      background: linear-gradient(180deg, #1a3a1a 0%, #0a2a0a 100%);
      color: #0f0;
      border: 1px solid #2a4a2a;
      box-shadow:
        0 4px 0 #051505,
        0 5px 5px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(100, 255, 100, 0.1);
    }

    .btn-operator:hover {
      background: linear-gradient(180deg, #2a5a2a 0%, #1a4a1a 100%);
      color: #5f5;
    }

    .btn-equals {
      background: linear-gradient(180deg, #0a4a0a 0%, #083808 100%);
      color: #0f0;
      border: 1px solid #0a6a0a;
      box-shadow:
        0 4px 0 #031503,
        0 5px 5px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(100, 255, 100, 0.2);
      grid-row: span 2;
    }

    .btn-equals:hover {
      background: linear-gradient(180deg, #1a6a1a 0%, #0a5a0a 100%);
      color: #5f5;
    }

    .btn-clear {
      background: linear-gradient(180deg, #4a1a1a 0%, #2a0a0a 100%);
      color: #f66;
      border: 1px solid #5a2a2a;
      box-shadow:
        0 4px 0 #150505,
        0 5px 5px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 100, 100, 0.1);
    }

    .btn-clear:hover {
      background: linear-gradient(180deg, #6a2a2a 0%, #4a1a1a 100%);
      color: #f88;
    }

    .btn-special {
      background: linear-gradient(180deg, #2a2a1a 0%, #1a1a0a 100%);
      color: #ff0;
      border: 1px solid #3a3a2a;
      box-shadow:
        0 4px 0 #0a0a05,
        0 5px 5px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 100, 0.1);
    }

    .btn-special:hover {
      background: linear-gradient(180deg, #3a3a2a 0%, #2a2a1a 100%);
      color: #ff5;
    }

    .btn:active {
      transform: translateY(3px);
      box-shadow:
        0 1px 0 #111,
        0 2px 3px rgba(0, 0, 0, 0.3);
    }

    .btn.pressed {
      animation: buttonPress 0.1s ease-out;
    }

    @keyframes buttonPress {
      0% { transform: translateY(0); }
      50% { transform: translateY(3px); }
      100% { transform: translateY(0); }
    }

    /* Power LED */
    .power-led {
      position: absolute;
      bottom: 0.8rem;
      right: 1rem;
      width: 8px;
      height: 8px;
      background: #0f0;
      border-radius: 50%;
      box-shadow: 0 0 5px #0f0, 0 0 10px #0f0;
      animation: ledPulse 2s ease-in-out infinite;
    }

    @keyframes ledPulse {
      0%, 100% { opacity: 1; box-shadow: 0 0 5px #0f0, 0 0 10px #0f0; }
      50% { opacity: 0.7; box-shadow: 0 0 3px #0f0, 0 0 6px #0f0; }
    }

    /* CRT curved edges effect */
    .crt-curve {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border-radius: 12px;
      pointer-events: none;
      box-shadow: inset 0 0 100px rgba(0, 255, 0, 0.03);
    }

    .backlink {
      position: fixed;
      bottom: 0.5rem;
      right: 0.5rem;
      font-size: 0.8rem;
      z-index: 100;
      opacity: 0.4;
    }

    .backlink a {
      color: #0f0;
      text-decoration: none;
    }

    /* Ambient glow */
    .ambient-glow {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 600px;
      height: 600px;
      background: radial-gradient(ellipse at center, rgba(0, 255, 0, 0.05) 0%, transparent 60%);
      pointer-events: none;
      z-index: -1;
    }

    @media (max-width: 400px) {
      .calculator {
        padding: 1.5rem;
        margin: 1rem;
      }

      .display {
        font-size: 2rem;
        max-width: 220px;
      }

      .btn {
        padding: 0.8rem;
        font-size: 1.3rem;
      }

      .buttons {
        gap: 0.4rem;
      }
    }
  </style>
</head>
<body>
  <div class="ambient-glow"></div>

  <div class="calculator">
    <div class="crt-curve"></div>

    <div class="screen-container">
      <div class="screen-glow"></div>
      <div class="screen">
        <div class="expression" id="expression"></div>
        <div class="display" id="display">0</div>
      </div>
    </div>

    <div class="buttons">
      <button class="btn btn-clear" data-action="clear">AC</button>
      <button class="btn btn-special" data-action="negate">Â±</button>
      <button class="btn btn-special" data-action="percent">%</button>
      <button class="btn btn-operator" data-action="operator" data-value="/">Ã·</button>

      <button class="btn btn-number" data-action="number" data-value="7">7</button>
      <button class="btn btn-number" data-action="number" data-value="8">8</button>
      <button class="btn btn-number" data-action="number" data-value="9">9</button>
      <button class="btn btn-operator" data-action="operator" data-value="*">Ã—</button>

      <button class="btn btn-number" data-action="number" data-value="4">4</button>
      <button class="btn btn-number" data-action="number" data-value="5">5</button>
      <button class="btn btn-number" data-action="number" data-value="6">6</button>
      <button class="btn btn-operator" data-action="operator" data-value="-">âˆ’</button>

      <button class="btn btn-number" data-action="number" data-value="1">1</button>
      <button class="btn btn-number" data-action="number" data-value="2">2</button>
      <button class="btn btn-number" data-action="number" data-value="3">3</button>
      <button class="btn btn-equals" data-action="equals">=</button>

      <button class="btn btn-number" data-action="number" data-value="0" style="grid-column: span 2;">0</button>
      <button class="btn btn-number" data-action="decimal">.</button>
    </div>

    <div class="power-led"></div>
  </div>

  <div class="backlink"><a href="https://sloppy.live">sloppy.live</a></div>

  <script>
    // Audio Context for mechanical clicks
    let audioCtx = null;

    function initAudio() {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
    }

    function playClick(type = 'normal') {
      if (!audioCtx) return;

      const now = audioCtx.currentTime;

      // Create nodes
      const osc = audioCtx.createOscillator();
      const osc2 = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      const gain2 = audioCtx.createGain();
      const filter = audioCtx.createBiquadFilter();

      // Configure based on type
      if (type === 'normal') {
        // Mechanical key click
        osc.type = 'square';
        osc.frequency.value = 1800;
        osc.frequency.exponentialRampToValueAtTime(400, now + 0.02);

        osc2.type = 'noise' in OscillatorNode.prototype ? 'noise' : 'sawtooth';
        osc2.frequency.value = 100;

        filter.type = 'highpass';
        filter.frequency.value = 800;

        gain.gain.value = 0.15;
        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.05);

        gain2.gain.value = 0.08;
        gain2.gain.exponentialRampToValueAtTime(0.01, now + 0.03);

        osc.connect(filter);
        filter.connect(gain);
        gain.connect(audioCtx.destination);

        osc2.connect(gain2);
        gain2.connect(audioCtx.destination);

        osc.start(now);
        osc.stop(now + 0.05);
        osc2.start(now);
        osc2.stop(now + 0.03);

      } else if (type === 'operator') {
        // Slightly different click for operators
        osc.type = 'square';
        osc.frequency.value = 2200;
        osc.frequency.exponentialRampToValueAtTime(600, now + 0.025);

        gain.gain.value = 0.12;
        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.06);

        osc.connect(gain);
        gain.connect(audioCtx.destination);

        osc.start(now);
        osc.stop(now + 0.06);

      } else if (type === 'equals') {
        // Satisfying thunk for equals
        osc.type = 'sine';
        osc.frequency.value = 150;
        osc.frequency.exponentialRampToValueAtTime(80, now + 0.1);

        osc2.type = 'square';
        osc2.frequency.value = 2000;
        osc2.frequency.exponentialRampToValueAtTime(500, now + 0.03);

        gain.gain.value = 0.2;
        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);

        gain2.gain.value = 0.1;
        gain2.gain.exponentialRampToValueAtTime(0.01, now + 0.04);

        osc.connect(gain);
        gain.connect(audioCtx.destination);

        osc2.connect(gain2);
        gain2.connect(audioCtx.destination);

        osc.start(now);
        osc.stop(now + 0.1);
        osc2.start(now);
        osc2.stop(now + 0.04);

      } else if (type === 'clear') {
        // Error/clear beep
        osc.type = 'sawtooth';
        osc.frequency.value = 800;
        osc.frequency.setValueAtTime(800, now + 0.05);
        osc.frequency.exponentialRampToValueAtTime(200, now + 0.15);

        gain.gain.value = 0.15;
        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);

        filter.type = 'lowpass';
        filter.frequency.value = 2000;

        osc.connect(filter);
        filter.connect(gain);
        gain.connect(audioCtx.destination);

        osc.start(now);
        osc.stop(now + 0.15);
      }
    }

    // Calculator state
    let currentValue = '0';
    let previousValue = null;
    let operator = null;
    let waitingForOperand = false;
    let expression = '';

    const display = document.getElementById('display');
    const expressionDisplay = document.getElementById('expression');

    function updateDisplay() {
      // Format number for display
      let displayValue = currentValue;

      // Handle very long numbers
      if (displayValue.length > 12) {
        const num = parseFloat(displayValue);
        if (Math.abs(num) >= 1e10 || (Math.abs(num) < 0.0001 && num !== 0)) {
          displayValue = num.toExponential(5);
        } else {
          displayValue = num.toPrecision(10);
        }
      }

      display.textContent = displayValue;
      expressionDisplay.textContent = expression;
    }

    function inputNumber(num) {
      if (waitingForOperand) {
        currentValue = num;
        waitingForOperand = false;
      } else {
        if (currentValue === '0' && num !== '.') {
          currentValue = num;
        } else if (currentValue.length < 15) {
          currentValue += num;
        }
      }
      updateDisplay();
    }

    function inputDecimal() {
      if (waitingForOperand) {
        currentValue = '0.';
        waitingForOperand = false;
      } else if (!currentValue.includes('.')) {
        currentValue += '.';
      }
      updateDisplay();
    }

    function inputOperator(op) {
      const value = parseFloat(currentValue);

      if (previousValue === null) {
        previousValue = value;
      } else if (operator && !waitingForOperand) {
        const result = calculate(previousValue, value, operator);
        currentValue = String(result);
        previousValue = result;
      }

      const opSymbols = { '/': 'Ã·', '*': 'Ã—', '-': 'âˆ’', '+': '+' };
      expression = `${previousValue} ${opSymbols[op] || op}`;

      operator = op;
      waitingForOperand = true;
      updateDisplay();
    }

    function calculate(a, b, op) {
      switch (op) {
        case '+': return a + b;
        case '-': return a - b;
        case '*': return a * b;
        case '/': return b !== 0 ? a / b : 'ERROR';
        default: return b;
      }
    }

    function performEquals() {
      if (operator && previousValue !== null) {
        const value = parseFloat(currentValue);
        const result = calculate(previousValue, value, operator);

        const opSymbols = { '/': 'Ã·', '*': 'Ã—', '-': 'âˆ’', '+': '+' };
        expression = `${previousValue} ${opSymbols[operator]} ${value} =`;

        currentValue = String(result);
        previousValue = null;
        operator = null;
        waitingForOperand = true;
        updateDisplay();
      }
    }

    function clear() {
      currentValue = '0';
      previousValue = null;
      operator = null;
      waitingForOperand = false;
      expression = '';
      updateDisplay();
    }

    function negate() {
      const value = parseFloat(currentValue);
      currentValue = String(-value);
      updateDisplay();
    }

    function percent() {
      const value = parseFloat(currentValue);
      currentValue = String(value / 100);
      updateDisplay();
    }

    // Button click handler
    document.querySelectorAll('.btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        initAudio();

        const action = btn.dataset.action;
        const value = btn.dataset.value;

        // Visual feedback
        btn.classList.add('pressed');
        setTimeout(() => btn.classList.remove('pressed'), 100);

        // Sound and action
        switch (action) {
          case 'number':
            playClick('normal');
            inputNumber(value);
            break;
          case 'decimal':
            playClick('normal');
            inputDecimal();
            break;
          case 'operator':
            playClick('operator');
            inputOperator(value);
            break;
          case 'equals':
            playClick('equals');
            performEquals();
            break;
          case 'clear':
            playClick('clear');
            clear();
            break;
          case 'negate':
            playClick('operator');
            negate();
            break;
          case 'percent':
            playClick('operator');
            percent();
            break;
        }
      });
    });

    // Keyboard support
    document.addEventListener('keydown', (e) => {
      initAudio();

      const key = e.key;
      let btn = null;

      if (/[0-9]/.test(key)) {
        btn = document.querySelector(`[data-value="${key}"]`);
        playClick('normal');
        inputNumber(key);
      } else if (key === '.') {
        btn = document.querySelector('[data-action="decimal"]');
        playClick('normal');
        inputDecimal();
      } else if (['+', '-', '*', '/'].includes(key)) {
        btn = document.querySelector(`[data-value="${key}"]`);
        playClick('operator');
        inputOperator(key);
      } else if (key === 'Enter' || key === '=') {
        btn = document.querySelector('[data-action="equals"]');
        playClick('equals');
        performEquals();
      } else if (key === 'Escape' || key === 'c' || key === 'C') {
        btn = document.querySelector('[data-action="clear"]');
        playClick('clear');
        clear();
      } else if (key === 'Backspace') {
        if (currentValue.length > 1) {
          currentValue = currentValue.slice(0, -1);
        } else {
          currentValue = '0';
        }
        playClick('normal');
        updateDisplay();
      }

      if (btn) {
        btn.classList.add('pressed');
        setTimeout(() => btn.classList.remove('pressed'), 100);
      }
    });

    // Initial display
    updateDisplay();
  </script>
<script src="/sloppy-header/sloppy-bar.js"></script>
</body>
</html>
