<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PIRATE AI STRATEGY WARS</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            font-family: 'Courier New', monospace;
            color: #fff;
            overflow-x: hidden;
        }
        .game-container {
            display: flex;
            height: 100vh;
        }
        .game-map {
            flex: 1;
            position: relative;
            background: radial-gradient(circle, #0f2027, #203a43, #2c5364);
            border: 2px solid #e74c3c;
        }
        .sidebar {
            width: 300px;
            background: rgba(0,0,0,0.8);
            padding: 20px;
            overflow-y: auto;
        }
        canvas {
            width: 100%;
            height: 100%;
            cursor: crosshair;
        }
        .faction {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid;
        }
        .faction:hover {
            transform: scale(1.2);
        }
        .faction.red { background: #e74c3c; border-color: #c0392b; }
        .faction.blue { background: #3498db; border-color: #2980b9; }
        .faction.green { background: #27ae60; border-color: #229954; }
        .faction.yellow { background: #f39c12; border-color: #e67e22; }
        .faction.purple { background: #9b59b6; border-color: #8e44ad; }
        
        .controls {
            margin-bottom: 20px;
        }
        button {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
        }
        button:hover { background: #c0392b; }
        button.active { background: #27ae60; }
        
        .faction-info {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #e74c3c;
        }
        
        .backlink {
            position: fixed;
            top: 10px;
            left: 10px;
            background: #34495e;
            color: #ecf0f1;
            padding: 8px 12px;
            border-radius: 5px;
            text-decoration: none;
            font-size: 12px;
            z-index: 1000;
        }
        
        .auto-save-indicator {
            position: fixed;
            bottom: 10px;
            right: 10px;
            background: rgba(39, 174, 96, 0.8);
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 10px;
        }
        
        .mod-support {
            background: rgba(155, 89, 182, 0.2);
            border: 1px solid #9b59b6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        
        .mod-support h4 {
            color: #9b59b6;
            margin: 0 0 10px 0;
        }
        
        input[type="file"] {
            width: 100%;
            padding: 5px;
            background: rgba(255,255,255,0.1);
            border: 1px solid #666;
            color: white;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <a href="../../index.html" class="backlink">‚Üê BACK TO HARBOR</a>
    
    <div class="game-container">
        <div class="game-map" id="gameMap">
            <canvas id="gameCanvas"></canvas>
        </div>
        
        <div class="sidebar">
            <h2 style="color: #e74c3c; margin-top: 0;">‚öîÔ∏è PIRATE AI WARS ‚öîÔ∏è</h2>
            
            <div class="controls">
                <button id="pauseBtn" onclick="togglePause()">PAUSE</button>
                <button onclick="resetGame()">RESET</button>
                <button onclick="addRandomFaction()">ADD FACTION</button>
                <button id="speedBtn" onclick="toggleSpeed()">NORMAL SPEED</button>
            </div>
            
            <div class="mod-support">
                <h4>üîß MODDING SUPPORT</h4>
                <input type="file" id="modFile" accept=".json" onchange="loadMod(this)">
                <button onclick="exportGameState()">EXPORT STATE</button>
                <small>LOAD CUSTOM FACTIONS, MAPS & RULES!</small>
            </div>
            
            <div id="factionStats">
                <h3>FACTION STATUS:</h3>
                <div id="statsContainer"></div>
            </div>
            
            <div class="faction-info">
                <h4>GAME RULES:</h4>
                <ul style="font-size: 11px; line-height: 1.4;">
                    <li>FACTIONS EXPAND AUTOMATICALLY</li>
                    <li>LARGER FACTIONS CONSUME SMALLER ONES</li>
                    <li>CLICK TO PLACE NEW FACTIONS</li>
                    <li>AI USES DIFFERENT STRATEGIES</li>
                    <li>AUTO-SAVES EVERY 30 SECONDS</li>
                </ul>
            </div>
        </div>
    </div>
    
    <div class="auto-save-indicator" id="autoSaveStatus">GAME SAVED</div>

    <script>
        class AIFaction {
            constructor(x, y, color, name, strategy = 'aggressive') {
                this.x = x;
                this.y = y;
                this.color = color;
                this.name = name;
                this.size = Math.random() * 20 + 10;
                this.maxSize = 100;
                this.strategy = strategy;
                this.age = 0;
                this.expansion = Math.random() * 0.5 + 0.1;
                this.aggression = Math.random();
                this.intelligence = Math.random();
                this.resources = 100;
            }
            
            update(allFactions) {
                this.age++;
                
                // AI Strategy Implementation
                switch(this.strategy) {
                    case 'aggressive':
                        this.aggressiveStrategy(allFactions);
                        break;
                    case 'defensive':
                        this.defensiveStrategy(allFactions);
                        break;
                    case 'economic':
                        this.economicStrategy(allFactions);
                        break;
                    case 'expansionist':
                        this.expansionistStrategy(allFactions);
                        break;
                }
                
                // Natural growth
                if (this.size < this.maxSize) {
                    this.size += this.expansion * (this.resources / 100);
                }
                
                // Resource management
                this.resources += 0.1 * this.size;
                if (this.resources > 1000) this.resources = 1000;
            }
            
            aggressiveStrategy(allFactions) {
                // Seek nearby enemies to attack
                const nearbyEnemies = allFactions.filter(f => 
                    f !== this && 
                    Math.hypot(f.x - this.x, f.y - this.y) < 100
                );
                
                if (nearbyEnemies.length > 0) {
                    const target = nearbyEnemies[0];
                    const dx = target.x - this.x;
                    const dy = target.y - this.y;
                    const dist = Math.hypot(dx, dy);
                    
                    this.x += (dx / dist) * 0.5;
                    this.y += (dy / dist) * 0.5;
                }
            }
            
            defensiveStrategy(allFactions) {
                // Avoid enemies, grow defensively
                const nearbyEnemies = allFactions.filter(f => 
                    f !== this && 
                    Math.hypot(f.x - this.x, f.y - this.y) < 80
                );
                
                if (nearbyEnemies.length > 0) {
                    const threat = nearbyEnemies[0];
                    const dx = this.x - threat.x;
                    const dy = this.y - threat.y;
                    const dist = Math.hypot(dx, dy);
                    
                    this.x += (dx / dist) * 0.3;
                    this.y += (dy / dist) * 0.3;
                }
                this.expansion *= 1.1; // Grow faster when defensive
            }
            
            economicStrategy(allFactions) {
                // Focus on resource gathering and growth
                this.resources += 0.5;
                this.expansion += 0.01;
                
                // Move towards resource-rich areas (edges)
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const dx = this.x - centerX;
                const dy = this.y - centerY;
                const dist = Math.hypot(dx, dy);
                
                if (dist < 200) {
                    this.x += (dx / dist) * 0.2;
                    this.y += (dy / dist) * 0.2;
                }
            }
            
            expansionistStrategy(allFactions) {
                // Constant movement and territory claiming
                this.x += (Math.random() - 0.5) * 2;
                this.y += (Math.random() - 0.5) * 2;
                this.expansion *= 1.05;
            }
        }
        
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        let factions = [];
        let gameRunning = true;
        let gameSpeed = 1;
        let lastSave = Date.now();
        
        const colors = ['red', 'blue', 'green', 'yellow', 'purple'];
        const strategies = ['aggressive', 'defensive', 'economic', 'expansionist'];
        const factionNames = [
            'REDBEARD RAIDERS', 'BLUE TIDE PIRATES', 'GREEN ISLE BUCCANEERS',
            'GOLDEN SKULL CREW', 'PURPLE STORM CORSAIRS', 'CRIMSON WAVE',
            'AZURE BROTHERHOOD', 'EMERALD FLEET', 'AMBER SERPENTS'
        ];
        
        function resizeCanvas() {
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
        }
        
        function initGame() {
            resizeCanvas();
            
            // Load saved game state
            const saved = localStorage.getItem('pirateStrategyGame');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    factions = data.factions.map(f => Object.assign(new AIFaction(0, 0, '', ''), f));
                } catch(e) {
                    console.log('COULD NOT LOAD SAVED GAME, STARTIN\' FRESH!');
                    createInitialFactions();
                }
            } else {
                createInitialFactions();
            }
        }
        
        function createInitialFactions() {
            factions = [];
            for (let i = 0; i < 5; i++) {
                addRandomFaction();
            }
        }
        
        function addRandomFaction() {
            const x = Math.random() * (canvas.width - 100) + 50;
            const y = Math.random() * (canvas.height - 100) + 50;
            const color = colors[Math.floor(Math.random() * colors.length)];
            const strategy = strategies[Math.floor(Math.random() * strategies.length)];
            const name = factionNames[Math.floor(Math.random() * factionNames.length)];
            
            factions.push(new AIFaction(x, y, color, name, strategy));
        }
        
        function gameLoop() {
            if (!gameRunning) return;
            
            // Clear canvas
            ctx.fillStyle = 'rgba(15, 32, 39, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Update and draw factions
            for (let i = factions.length - 1; i >= 0; i--) {
                const faction = factions[i];
                faction.update(factions);
                
                // Keep in bounds
                faction.x = Math.max(faction.size/2, Math.min(canvas.width - faction.size/2, faction.x));
                faction.y = Math.max(faction.size/2, Math.min(canvas.height - faction.size/2, faction.y));
                
                // Draw faction
                ctx.beginPath();
                ctx.arc(faction.x, faction.y, faction.size, 0, Math.PI * 2);
                ctx.fillStyle = faction.color;
                ctx.globalAlpha = 0.7;
                ctx.fill();
                ctx.globalAlpha = 1;
                
                // Draw border
                ctx.strokeStyle = faction.color;
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Draw name
                ctx.fillStyle = 'white';
                ctx.font = '10px Courier New';
                ctx.textAlign = 'center';
                ctx.fillText(faction.name.substring(0, 8), faction.x, faction.y - faction.size - 5);
                
                // Check collisions and absorption
                for (let j = i - 1; j >= 0; j--) {
                    const other = factions[j];
                    const distance = Math.hypot(faction.x - other.x, faction.y - other.y);
                    
                    if (distance < (faction.size + other.size) / 2) {
                        if (faction.size > other.size) {
                            faction.size += other.size * 0.3;
                            faction.resources += other.resources * 0.5;
                            factions.splice(j, 1);
                            i--; // Adjust index
                        } else {
                            other.size += faction.size * 0.3;
                            other.resources += faction.resources * 0.5;
                            factions.splice(i, 1);
                            break;
                        }
                    }
                }
            }
            
            updateStats();
            
            // Auto-save every 30 seconds
            if (Date.now() - lastSave > 30000) {
                autoSave();
            }
            
            setTimeout(() => requestAnimationFrame(gameLoop), 100 / gameSpeed);
        }
        
        function updateStats() {
            const container = document.getElementById('statsContainer');
            container.innerHTML = '';
            
            factions.forEach(faction => {
                const div = document.createElement('div');
                div.style.cssText = `
                    background: ${faction.color}; 
                    margin: 5px 0; 
                    padding: 8px; 
                    border-radius: 3px; 
                    font-size: 10px; 
                    opacity: 0.9;
                `;
                div.innerHTML = `
                    <strong>${faction.name}</strong><br>
                    Size: ${Math.round(faction.size)} | Resources: ${Math.round(faction.resources)}<br>
                    Strategy: ${faction.strategy.toUpperCase()} | Age: ${faction.age}
                `;
                container.appendChild(div);
            });
        }
        
        function togglePause() {
            gameRunning = !gameRunning;
            const btn = document.getElementById('pauseBtn');
            btn.textContent = gameRunning ? 'PAUSE' : 'RESUME';
            btn.className = gameRunning ? '' : 'active';
            if (gameRunning) gameLoop();
        }
        
        function toggleSpeed() {
            gameSpeed = gameSpeed === 1 ? 3 : gameSpeed === 3 ? 0.5 : 1;
            const btn = document.getElementById('speedBtn');
            btn.textContent = gameSpeed === 1 ? 'NORMAL SPEED' : gameSpeed === 3 ? 'FAST SPEED' : 'SLOW SPEED';
        }
        
        function resetGame() {
            factions = [];
            createInitialFactions();
            autoSave();
        }
        
        function autoSave() {
            const gameState = {
                factions: factions,
                timestamp: Date.now()
            };
            localStorage.setItem('pirateStrategyGame', JSON.stringify(gameState));
            lastSave = Date.now();
            
            const indicator = document.getElementById('autoSaveStatus');
            indicator.textContent = 'GAME SAVED: ' + new Date().toLocaleTimeString();
            indicator.style.background = 'rgba(39, 174, 96, 0.8)';
            setTimeout(() => {
                indicator.style.background = 'rgba(52, 73, 94, 0.8)';
                indicator.textContent = 'AUTO-SAVE ACTIVE';
            }, 2000);
        }
        
        // Modding Support
        function loadMod(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const mod = JSON.parse(e.target.result);
                        if (mod.customFactions) {
                            factions = mod.customFactions.map(f => Object.assign(new AIFaction(0, 0, '', ''), f));
                        }
                        if (mod.gameSettings) {
                            gameSpeed = mod.gameSettings.speed || gameSpeed;
                        }
                        alert('MOD LOADED SUCCESSFULLY, MATEY!');
                        autoSave();
                    } catch(err) {
                        alert('INVALID MOD FILE, ARRR!');
                    }
                };
                reader.readAsText(file);
            }
        }
        
        function exportGameState() {
            const gameState = {
                customFactions: factions,
                gameSettings: { speed: gameSpeed },
                version: '1.0'
            };
            const blob = new Blob([JSON.stringify(gameState, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'pirate_strategy_mod.json';
            a.click();
        }
        
        // Event listeners
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            const color = colors[Math.floor(Math.random() * colors.length)];
            const strategy = strategies[Math.floor(Math.random() * strategies.length)];
            const name = factionNames[Math.floor(Math.random() * factionNames.length)];
            
            factions.push(new AIFaction(x, y, color, name, strategy));
        });
        
        window.addEventListener('resize', resizeCanvas);
        window.addEventListener('beforeunload', autoSave);
        
        // Initialize and start
        initGame();
        gameLoop();
    </script>
</body>
</html>