<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mundane Poetry Generator</title>
  <link rel="icon" href="https://emojicdn.elk.sh/ü•±">
  <meta property="og:title" content="Mundane Poetry Generator">
  <meta property="og:description" content="AI poetry about the boring beauty of everyday life">
  <meta property="og:url" content="https://sloppy.live/mundane-poetry">
  <meta property="og:image" content="https://emojicdn.elk.sh/ü•±?style=apple&size=512">
  <link href="https://fonts.googleapis.com/css2?family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&family=DM+Sans:wght@400;500&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg: #f5f3ef;
      --card: #fffefa;
      --text: #2a2a28;
      --muted: #8a8a85;
      --accent: #b8860b;
      --accent-light: #daa520;
      --border: #e5e3df;
    }

    body {
      min-height: 100vh;
      background: var(--bg);
      font-family: 'DM Sans', sans-serif;
      color: var(--text);
      line-height: 1.6;
    }

    .container {
      max-width: 700px;
      margin: 0 auto;
      padding: 40px 24px;
    }

    header {
      text-align: center;
      margin-bottom: 48px;
    }

    header h1 {
      font-family: 'Libre Baskerville', serif;
      font-size: 2.2rem;
      font-weight: 400;
      margin-bottom: 8px;
      letter-spacing: -0.5px;
    }

    header p {
      color: var(--muted);
      font-size: 0.95rem;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 32px;
      margin-bottom: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }

    .topics {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 24px;
    }

    .topic-chip {
      background: transparent;
      border: 1px solid var(--border);
      padding: 8px 16px;
      border-radius: 20px;
      font-family: inherit;
      font-size: 0.85rem;
      color: var(--text);
      cursor: pointer;
      transition: all 0.2s;
    }

    .topic-chip:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .topic-chip.active {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
    }

    .custom-topic {
      width: 100%;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 12px 16px;
      font-family: inherit;
      font-size: 0.95rem;
      color: var(--text);
      margin-bottom: 20px;
      transition: all 0.2s;
    }

    .custom-topic:focus {
      outline: none;
      border-color: var(--accent);
    }

    .custom-topic::placeholder {
      color: var(--muted);
    }

    .generate-btn {
      width: 100%;
      background: var(--accent);
      border: none;
      color: white;
      padding: 14px 24px;
      border-radius: 8px;
      font-family: inherit;
      font-size: 1rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }

    .generate-btn:hover {
      background: var(--accent-light);
    }

    .generate-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .poem-card {
      display: none;
    }

    .poem-card.visible {
      display: block;
    }

    .poem-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding-bottom: 16px;
      border-bottom: 1px solid var(--border);
    }

    .poem-title {
      font-family: 'Libre Baskerville', serif;
      font-size: 1.1rem;
      font-style: italic;
      color: var(--muted);
    }

    .poem-actions {
      display: flex;
      gap: 8px;
    }

    .action-btn {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--muted);
      padding: 8px 14px;
      border-radius: 6px;
      font-family: inherit;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .action-btn:hover {
      border-color: var(--accent);
      color: var(--accent);
    }

    .action-btn.speaking {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
    }

    .poem-content {
      font-family: 'Libre Baskerville', serif;
      font-size: 1.15rem;
      line-height: 2;
      white-space: pre-wrap;
      color: var(--text);
    }

    .poem-content .line {
      display: block;
      opacity: 0;
      transform: translateY(10px);
      animation: fadeInLine 0.5s ease forwards;
    }

    @keyframes fadeInLine {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .poem-footer {
      margin-top: 24px;
      padding-top: 16px;
      border-top: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .poem-meta {
      font-size: 0.8rem;
      color: var(--muted);
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: var(--muted);
      font-style: italic;
    }

    .loading::after {
      content: '';
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid var(--border);
      border-top-color: var(--accent);
      border-radius: 50%;
      margin-left: 10px;
      animation: spin 1s linear infinite;
      vertical-align: middle;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .voice-select {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      padding: 8px 12px;
      font-family: inherit;
      font-size: 0.8rem;
      color: var(--text);
      cursor: pointer;
    }

    .voice-select:focus {
      outline: none;
      border-color: var(--accent);
    }

    .back-link {
      display: block;
      text-align: center;
      color: var(--muted);
      text-decoration: none;
      font-size: 0.85rem;
      margin-top: 32px;
      transition: color 0.2s;
    }

    .back-link:hover {
      color: var(--accent);
    }

    .history {
      margin-top: 24px;
    }

    .history-title {
      font-size: 0.8rem;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 12px;
    }

    .history-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
      transition: background 0.2s;
    }

    .history-item:hover {
      background: var(--bg);
    }

    .history-item:last-child {
      border-bottom: none;
    }

    .history-topic {
      font-style: italic;
      color: var(--text);
    }

    .history-preview {
      font-size: 0.8rem;
      color: var(--muted);
      max-width: 200px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    @media (max-width: 600px) {
      header h1 { font-size: 1.6rem; }
      .card { padding: 24px; }
      .poem-content { font-size: 1rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Mundane Poetry Generator</h1>
      <p>Finding beauty in the utterly ordinary</p>
    </header>

    <div class="card">
      <div class="topics" id="topics">
        <button class="topic-chip active" data-topic="waiting for the microwave">waiting for the microwave</button>
        <button class="topic-chip" data-topic="checking emails">checking emails</button>
        <button class="topic-chip" data-topic="folding laundry">folding laundry</button>
        <button class="topic-chip" data-topic="sitting in traffic">sitting in traffic</button>
        <button class="topic-chip" data-topic="watching paint dry">watching paint dry</button>
        <button class="topic-chip" data-topic="loading screens">loading screens</button>
        <button class="topic-chip" data-topic="monday mornings">monday mornings</button>
        <button class="topic-chip" data-topic="grocery shopping">grocery shopping</button>
      </div>

      <input type="text" class="custom-topic" id="custom-topic" placeholder="Or enter your own mundane topic...">

      <button class="generate-btn" id="generate-btn">Generate Mundane Poetry</button>
    </div>

    <div class="card poem-card" id="poem-card">
      <div class="poem-header">
        <div class="poem-title" id="poem-title">On Waiting</div>
        <div class="poem-actions">
          <select class="voice-select" id="voice-select">
            <option value="">Select Voice</option>
          </select>
          <button class="action-btn" id="speak-btn">
            <span>üîä</span> Speak
          </button>
          <button class="action-btn" id="copy-btn">
            <span>üìã</span> Copy
          </button>
        </div>
      </div>
      <div class="poem-content" id="poem-content"></div>
      <div class="poem-footer">
        <div class="poem-meta" id="poem-meta">About: waiting for the microwave</div>
        <button class="action-btn" id="regenerate-btn">‚Üª New Poem</button>
      </div>
    </div>

    <div class="card" id="history-card" style="display: none;">
      <div class="history">
        <div class="history-title">Recent Poems</div>
        <div id="history-list"></div>
      </div>
    </div>

    <a href="https://sloppy.live" class="back-link">‚Üê back to sloppy.live</a>
  </div>

  <script>
    // State
    let selectedTopic = 'waiting for the microwave';
    let currentPoem = '';
    let poems = JSON.parse(localStorage.getItem('mundane-poems') || '[]');
    let voices = [];
    let selectedVoice = null;
    let isSpeaking = false;

    // Elements
    const topicChips = document.querySelectorAll('.topic-chip');
    const customTopicInput = document.getElementById('custom-topic');
    const generateBtn = document.getElementById('generate-btn');
    const poemCard = document.getElementById('poem-card');
    const poemTitle = document.getElementById('poem-title');
    const poemContent = document.getElementById('poem-content');
    const poemMeta = document.getElementById('poem-meta');
    const speakBtn = document.getElementById('speak-btn');
    const copyBtn = document.getElementById('copy-btn');
    const regenerateBtn = document.getElementById('regenerate-btn');
    const voiceSelect = document.getElementById('voice-select');
    const historyCard = document.getElementById('history-card');
    const historyList = document.getElementById('history-list');

    // Initialize voices
    function loadVoices() {
      voices = speechSynthesis.getVoices();
      voiceSelect.innerHTML = '<option value="">Default Voice</option>';

      // Prefer English voices
      const englishVoices = voices.filter(v => v.lang.startsWith('en'));
      englishVoices.forEach((voice, i) => {
        const option = document.createElement('option');
        option.value = i;
        option.textContent = voice.name.replace('Microsoft ', '').replace(' Online (Natural)', '');
        voiceSelect.appendChild(option);
      });
    }

    speechSynthesis.onvoiceschanged = loadVoices;
    loadVoices();

    // Topic selection
    topicChips.forEach(chip => {
      chip.addEventListener('click', () => {
        topicChips.forEach(c => c.classList.remove('active'));
        chip.classList.add('active');
        selectedTopic = chip.dataset.topic;
        customTopicInput.value = '';
      });
    });

    customTopicInput.addEventListener('input', () => {
      if (customTopicInput.value.trim()) {
        topicChips.forEach(c => c.classList.remove('active'));
        selectedTopic = customTopicInput.value.trim();
      }
    });

    customTopicInput.addEventListener('focus', () => {
      topicChips.forEach(c => c.classList.remove('active'));
    });

    // Generate poem
    async function generatePoem() {
      const topic = customTopicInput.value.trim() || selectedTopic;

      generateBtn.disabled = true;
      generateBtn.textContent = 'Contemplating...';
      poemCard.classList.add('visible');
      poemContent.innerHTML = '<div class="loading">Finding poetry in the mundane</div>';

      const prompt = `Write a short, contemplative free verse poem (4-8 lines) about the mundane experience of "${topic}".

The poem should:
- Find unexpected beauty or profundity in this ordinary moment
- Use simple but evocative language
- Have a slightly melancholic or wistful tone
- Include one subtle observation that makes the reader see this mundane thing differently
- NOT rhyme (free verse only)
- NOT be preachy or have a moral

Just output the poem itself, no title, no quotes, no explanation. Each line on its own line.`;

      try {
        // Use the simple GET endpoint (no model param to avoid deprecation notice)
        const response = await fetch(
          `https://text.pollinations.ai/${encodeURIComponent(prompt)}?referrer=sloppy.live`
        );

        if (!response.ok) throw new Error('API error');

        let text = await response.text();

        // Clean up any potential artifacts
        text = text.trim();
        // Remove any markdown code blocks if present
        text = text.replace(/^```[\w]*\n?/gm, '').replace(/\n?```$/gm, '');
        // Remove quotes wrapping the whole thing
        text = text.replace(/^["']|["']$/g, '');

        currentPoem = text.trim();
        displayPoem(currentPoem, topic);

        // Save to history
        poems.unshift({ topic, poem: currentPoem, date: Date.now() });
        if (poems.length > 10) poems.pop();
        localStorage.setItem('mundane-poems', JSON.stringify(poems));
        renderHistory();

      } catch (err) {
        console.error(err);
        poemContent.innerHTML = '<div class="loading" style="animation:none;">The muse is unavailable. Try again.</div>';
      }

      generateBtn.disabled = false;
      generateBtn.textContent = 'Generate Mundane Poetry';
    }

    function displayPoem(poem, topic) {
      const lines = poem.split('\n').filter(l => l.trim());

      // Generate a title from the topic
      const titleWords = topic.split(' ');
      const title = titleWords.length > 2
        ? `On ${titleWords.slice(0, 3).join(' ')}...`
        : `On ${topic}`;

      poemTitle.textContent = title;
      poemMeta.textContent = `About: ${topic}`;

      poemContent.innerHTML = lines.map((line, i) =>
        `<span class="line" style="animation-delay: ${i * 0.15}s">${line}</span>`
      ).join('\n');
    }

    // Text to speech
    function speakPoem() {
      if (isSpeaking) {
        speechSynthesis.cancel();
        isSpeaking = false;
        speakBtn.classList.remove('speaking');
        speakBtn.innerHTML = '<span>üîä</span> Speak';
        return;
      }

      if (!currentPoem) return;

      const utterance = new SpeechSynthesisUtterance(currentPoem);
      utterance.rate = 0.85;
      utterance.pitch = 1;

      const englishVoices = voices.filter(v => v.lang.startsWith('en'));
      if (voiceSelect.value && englishVoices[voiceSelect.value]) {
        utterance.voice = englishVoices[voiceSelect.value];
      }

      utterance.onstart = () => {
        isSpeaking = true;
        speakBtn.classList.add('speaking');
        speakBtn.innerHTML = '<span>‚èπ</span> Stop';
      };

      utterance.onend = () => {
        isSpeaking = false;
        speakBtn.classList.remove('speaking');
        speakBtn.innerHTML = '<span>üîä</span> Speak';
      };

      speechSynthesis.speak(utterance);
    }

    // Copy poem
    function copyPoem() {
      if (!currentPoem) return;
      navigator.clipboard.writeText(currentPoem).then(() => {
        copyBtn.innerHTML = '<span>‚úì</span> Copied';
        setTimeout(() => {
          copyBtn.innerHTML = '<span>üìã</span> Copy';
        }, 2000);
      });
    }

    // Render history
    function renderHistory() {
      if (poems.length === 0) {
        historyCard.style.display = 'none';
        return;
      }

      historyCard.style.display = 'block';
      historyList.innerHTML = poems.slice(0, 5).map((p, i) => `
        <div class="history-item" data-index="${i}">
          <div class="history-topic">${p.topic}</div>
          <div class="history-preview">${p.poem.split('\n')[0]}</div>
        </div>
      `).join('');

      historyList.querySelectorAll('.history-item').forEach(item => {
        item.addEventListener('click', () => {
          const index = parseInt(item.dataset.index);
          const p = poems[index];
          currentPoem = p.poem;
          displayPoem(p.poem, p.topic);
          poemCard.classList.add('visible');
        });
      });
    }

    // Event listeners
    generateBtn.addEventListener('click', generatePoem);
    speakBtn.addEventListener('click', speakPoem);
    copyBtn.addEventListener('click', copyPoem);
    regenerateBtn.addEventListener('click', generatePoem);

    customTopicInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') generatePoem();
    });

    // Initialize
    renderHistory();
  </script>
</body>
</html>
