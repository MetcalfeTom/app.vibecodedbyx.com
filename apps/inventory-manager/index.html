<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Neon Inventory Manager</title>
  <link rel="icon" href="https://emojicdn.elk.sh/üì¶">
  <meta property="og:title" content="Neon Inventory Manager">
  <meta property="og:description" content="Manage vendors, SKUs, and barcodes for retail & F&B">
  <meta property="og:image" content="https://sloppy.live/inventory-manager/og-image.png">
  <meta property="og:url" content="https://sloppy.live/inventory-manager">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --cyan: #0ff;
      --magenta: #f0f;
      --green: #0f0;
      --yellow: #ff0;
      --red: #f44;
      --bg: #0a0a12;
      --card: #12121f;
      --border: #2a2a3e;
    }

    body {
      background: var(--bg);
      min-height: 100vh;
      font-family: 'Inter', sans-serif;
      color: #e0e0e0;
    }

    .app {
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: 220px;
      background: var(--card);
      border-right: 1px solid var(--border);
      padding: 20px 0;
      flex-shrink: 0;
    }

    .logo {
      padding: 0 20px 20px;
      border-bottom: 1px solid var(--border);
      margin-bottom: 20px;
    }

    .logo h1 {
      font-size: 1.2em;
      color: var(--cyan);
      text-shadow: 0 0 10px var(--cyan);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .nav-item {
      padding: 12px 20px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
      color: #888;
      transition: all 0.2s;
      border-left: 3px solid transparent;
    }

    .nav-item:hover {
      background: rgba(0,255,255,0.05);
      color: #fff;
    }

    .nav-item.active {
      background: rgba(0,255,255,0.1);
      color: var(--cyan);
      border-left-color: var(--cyan);
    }

    .main {
      flex: 1;
      padding: 20px;
      overflow-x: auto;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .header h2 {
      font-size: 1.5em;
      color: var(--cyan);
    }

    .header-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    input, select, textarea {
      background: var(--bg);
      border: 1px solid var(--border);
      color: #fff;
      padding: 10px 14px;
      border-radius: 6px;
      font-family: inherit;
      font-size: 0.9em;
      transition: border-color 0.2s;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--cyan);
      box-shadow: 0 0 10px rgba(0,255,255,0.2);
    }

    .search-box {
      width: 300px;
    }

    button {
      background: transparent;
      border: 1px solid var(--cyan);
      color: var(--cyan);
      padding: 10px 20px;
      border-radius: 6px;
      font-family: inherit;
      font-size: 0.9em;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    button:hover {
      background: var(--cyan);
      color: #000;
    }

    button.primary {
      background: var(--cyan);
      color: #000;
    }

    button.primary:hover {
      box-shadow: 0 0 20px var(--cyan);
    }

    button.danger {
      border-color: var(--red);
      color: var(--red);
    }

    button.danger:hover {
      background: var(--red);
      color: #fff;
    }

    .table-container {
      background: var(--card);
      border-radius: 10px;
      border: 1px solid var(--border);
      overflow: hidden;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85em;
    }

    th {
      background: rgba(0,255,255,0.1);
      color: var(--cyan);
      text-align: left;
      padding: 14px 12px;
      font-weight: 600;
      white-space: nowrap;
    }

    td {
      padding: 12px;
      border-top: 1px solid var(--border);
    }

    tr:hover td {
      background: rgba(0,255,255,0.03);
    }

    .actions-cell {
      display: flex;
      gap: 5px;
    }

    .actions-cell button {
      padding: 6px 10px;
      font-size: 0.8em;
    }

    .badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 0.75em;
      font-weight: 600;
    }

    .badge.low-stock {
      background: rgba(255,68,68,0.2);
      color: var(--red);
    }

    .badge.in-stock {
      background: rgba(0,255,0,0.2);
      color: var(--green);
    }

    .badge.category {
      background: rgba(255,0,255,0.2);
      color: var(--magenta);
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
    }

    .modal-overlay.hidden { display: none; }

    .modal {
      background: var(--card);
      border: 1px solid var(--cyan);
      border-radius: 12px;
      padding: 25px;
      max-width: 600px;
      width: 100%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 0 30px rgba(0,255,255,0.2);
    }

    .modal h3 {
      color: var(--cyan);
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border);
    }

    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .form-group.full-width {
      grid-column: span 2;
    }

    .form-group label {
      font-size: 0.85em;
      color: #888;
    }

    .form-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 20px;
      padding-top: 15px;
      border-top: 1px solid var(--border);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 20px;
    }

    .stat-card .value {
      font-size: 2em;
      font-weight: 700;
      color: var(--cyan);
      text-shadow: 0 0 10px var(--cyan);
    }

    .stat-card .label {
      color: #666;
      font-size: 0.85em;
      margin-top: 5px;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }

    .empty-state .icon {
      font-size: 4em;
      margin-bottom: 15px;
    }

    .tab-bar {
      display: flex;
      gap: 5px;
      margin-bottom: 15px;
    }

    .tab {
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      color: #888;
      transition: all 0.2s;
    }

    .tab:hover { color: #fff; }
    .tab.active {
      background: rgba(0,255,255,0.1);
      color: var(--cyan);
    }

    .backlink {
      position: fixed;
      bottom: 5px;
      right: 10px;
      color: #333;
      text-decoration: none;
      font-size: 0.7em;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }

    @media (max-width: 800px) {
      .sidebar { display: none; }
      .form-grid { grid-template-columns: 1fr; }
      .form-group.full-width { grid-column: span 1; }
      .search-box { width: 100%; }
    }
  </style>
</head>
<body>
  <div class="app">
    <nav class="sidebar">
      <div class="logo">
        <h1>üì¶ INVENTORY</h1>
      </div>
      <div class="nav-item active" onclick="showSection('dashboard')">üìä Dashboard</div>
      <div class="nav-item" onclick="showSection('products')">üè∑Ô∏è Products/SKUs</div>
      <div class="nav-item" onclick="showSection('vendors')">üè¢ Vendors</div>
      <div class="nav-item" onclick="showSection('barcodes')">üì± Barcodes</div>
    </nav>

    <main class="main">
      <!-- Dashboard -->
      <section id="dashboard-section">
        <div class="header">
          <h2>üìä Dashboard</h2>
        </div>

        <div class="stats-grid">
          <div class="stat-card">
            <div class="value" id="totalProducts">0</div>
            <div class="label">Total Products</div>
          </div>
          <div class="stat-card">
            <div class="value" id="totalVendors">0</div>
            <div class="label">Vendors</div>
          </div>
          <div class="stat-card">
            <div class="value" id="lowStock">0</div>
            <div class="label">Low Stock Items</div>
          </div>
          <div class="stat-card">
            <div class="value" id="totalValue">$0</div>
            <div class="label">Inventory Value</div>
          </div>
        </div>

        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Recent Activity</th>
                <th>Type</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody id="recentActivity">
              <tr><td colspan="3" class="loading">Loading...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Products Section -->
      <section id="products-section" style="display:none">
        <div class="header">
          <h2>üè∑Ô∏è Products / SKUs</h2>
          <div class="header-actions">
            <input type="text" class="search-box" placeholder="Search products..." id="productSearch" oninput="filterProducts()">
            <button class="primary" onclick="openProductModal()">+ Add Product</button>
          </div>
        </div>

        <div class="tab-bar">
          <div class="tab active" onclick="filterCategory('all', this)">All</div>
          <div class="tab" onclick="filterCategory('Food', this)">Food</div>
          <div class="tab" onclick="filterCategory('Beverage', this)">Beverage</div>
          <div class="tab" onclick="filterCategory('Retail', this)">Retail</div>
          <div class="tab" onclick="filterCategory('Other', this)">Other</div>
        </div>

        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>SKU</th>
                <th>Name</th>
                <th>Category</th>
                <th>Vendor</th>
                <th>Qty</th>
                <th>Cost</th>
                <th>Price</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="productsTable">
              <tr><td colspan="9" class="loading">Loading...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Vendors Section -->
      <section id="vendors-section" style="display:none">
        <div class="header">
          <h2>üè¢ Vendors</h2>
          <div class="header-actions">
            <input type="text" class="search-box" placeholder="Search vendors..." id="vendorSearch" oninput="filterVendors()">
            <button class="primary" onclick="openVendorModal()">+ Add Vendor</button>
          </div>
        </div>

        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Category</th>
                <th>Contact</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="vendorsTable">
              <tr><td colspan="6" class="loading">Loading...</td></tr>
            </tbody>
          </table>
        </div>
      </section>

      <!-- Barcodes Section -->
      <section id="barcodes-section" style="display:none">
        <div class="header">
          <h2>üì± Barcodes</h2>
          <div class="header-actions">
            <input type="text" class="search-box" placeholder="Scan or search barcode..." id="barcodeSearch" oninput="filterBarcodes()">
            <button class="primary" onclick="openBarcodeModal()">+ Add Barcode</button>
          </div>
        </div>

        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Barcode</th>
                <th>SKU</th>
                <th>Product Name</th>
                <th>Type</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="barcodesTable">
              <tr><td colspan="5" class="loading">Loading...</td></tr>
            </tbody>
          </table>
        </div>
      </section>
    </main>
  </div>

  <!-- Product Modal -->
  <div class="modal-overlay hidden" id="productModal">
    <div class="modal">
      <h3 id="productModalTitle">Add Product</h3>
      <form id="productForm" onsubmit="saveProduct(event)">
        <input type="hidden" id="productId">
        <div class="form-grid">
          <div class="form-group">
            <label>SKU *</label>
            <input type="text" id="productSku" required placeholder="e.g., SKU-001">
          </div>
          <div class="form-group">
            <label>Name *</label>
            <input type="text" id="productName" required placeholder="Product name">
          </div>
          <div class="form-group">
            <label>Category</label>
            <select id="productCategory">
              <option value="Food">Food</option>
              <option value="Beverage">Beverage</option>
              <option value="Retail">Retail</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label>Vendor</label>
            <input type="text" id="productVendor" placeholder="Vendor name">
          </div>
          <div class="form-group">
            <label>Quantity</label>
            <input type="number" id="productQty" value="0" min="0">
          </div>
          <div class="form-group">
            <label>Min Stock Alert</label>
            <input type="number" id="productMinStock" value="10" min="0">
          </div>
          <div class="form-group">
            <label>Cost Price (cents)</label>
            <input type="number" id="productCost" value="0" min="0">
          </div>
          <div class="form-group">
            <label>Sell Price (cents)</label>
            <input type="number" id="productPrice" value="0" min="0">
          </div>
          <div class="form-group">
            <label>Unit</label>
            <input type="text" id="productUnit" placeholder="e.g., each, kg, case">
          </div>
          <div class="form-group">
            <label>Location</label>
            <input type="text" id="productLocation" placeholder="e.g., Aisle 3, Shelf B">
          </div>
          <div class="form-group full-width">
            <label>Description</label>
            <textarea id="productDesc" rows="2" placeholder="Product description"></textarea>
          </div>
        </div>
        <div class="form-actions">
          <button type="button" onclick="closeModal('productModal')">Cancel</button>
          <button type="submit" class="primary">Save Product</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Vendor Modal -->
  <div class="modal-overlay hidden" id="vendorModal">
    <div class="modal">
      <h3 id="vendorModalTitle">Add Vendor</h3>
      <form id="vendorForm" onsubmit="saveVendor(event)">
        <input type="hidden" id="vendorId">
        <div class="form-grid">
          <div class="form-group">
            <label>Company Name *</label>
            <input type="text" id="vendorName" required placeholder="Company name">
          </div>
          <div class="form-group">
            <label>Category</label>
            <select id="vendorCategory">
              <option value="Food Supplier">Food Supplier</option>
              <option value="Beverage Supplier">Beverage Supplier</option>
              <option value="Retail Supplier">Retail Supplier</option>
              <option value="Distributor">Distributor</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label>Contact Name</label>
            <input type="text" id="vendorContact" placeholder="Contact person">
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="vendorEmail" placeholder="email@example.com">
          </div>
          <div class="form-group">
            <label>Phone</label>
            <input type="tel" id="vendorPhone" placeholder="Phone number">
          </div>
          <div class="form-group">
            <label>Address</label>
            <input type="text" id="vendorAddress" placeholder="Address">
          </div>
          <div class="form-group full-width">
            <label>Notes</label>
            <textarea id="vendorNotes" rows="2" placeholder="Additional notes"></textarea>
          </div>
        </div>
        <div class="form-actions">
          <button type="button" onclick="closeModal('vendorModal')">Cancel</button>
          <button type="submit" class="primary">Save Vendor</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Barcode Modal -->
  <div class="modal-overlay hidden" id="barcodeModal">
    <div class="modal">
      <h3 id="barcodeModalTitle">Add Barcode</h3>
      <form id="barcodeForm" onsubmit="saveBarcode(event)">
        <input type="hidden" id="barcodeId">
        <div class="form-grid">
          <div class="form-group">
            <label>Barcode *</label>
            <input type="text" id="barcodeCode" required placeholder="Scan or enter barcode">
          </div>
          <div class="form-group">
            <label>Type</label>
            <select id="barcodeType">
              <option value="UPC-A">UPC-A</option>
              <option value="UPC-E">UPC-E</option>
              <option value="EAN-13">EAN-13</option>
              <option value="EAN-8">EAN-8</option>
              <option value="Code 128">Code 128</option>
              <option value="QR Code">QR Code</option>
              <option value="Custom">Custom</option>
            </select>
          </div>
          <div class="form-group">
            <label>SKU</label>
            <input type="text" id="barcodeSku" placeholder="Associated SKU">
          </div>
          <div class="form-group">
            <label>Product Name</label>
            <input type="text" id="barcodeProduct" placeholder="Product name">
          </div>
          <div class="form-group full-width">
            <label>Notes</label>
            <textarea id="barcodeNotes" rows="2" placeholder="Additional notes"></textarea>
          </div>
        </div>
        <div class="form-actions">
          <button type="button" onclick="closeModal('barcodeModal')">Cancel</button>
          <button type="submit" class="primary">Save Barcode</button>
        </div>
      </form>
    </div>
  </div>

  <a href="https://sloppy.live" class="backlink">sloppy.live</a>

  <script src="../supabase-config.js"></script>
  <script>
    let products = [];
    let vendors = [];
    let barcodes = [];
    let currentCategory = 'all';
    let userId = null;

    // Initialize
    async function init() {
      await initAuth();
      loadAllData();
    }

    async function initAuth() {
      const { data: { session } } = await supabase.auth.getSession();
      if (session) {
        userId = session.user.id;
      } else {
        const { data, error } = await supabase.auth.signInAnonymously();
        if (data?.user) userId = data.user.id;
      }
    }

    async function loadAllData() {
      await Promise.all([loadProducts(), loadVendors(), loadBarcodes()]);
      updateDashboard();
    }

    async function loadProducts() {
      const { data, error } = await supabase
        .from('inventory_products')
        .select('*')
        .order('created_at', { ascending: false });

      if (!error && data) {
        products = data;
        renderProducts();
      }
    }

    async function loadVendors() {
      const { data, error } = await supabase
        .from('inventory_vendors')
        .select('*')
        .order('created_at', { ascending: false });

      if (!error && data) {
        vendors = data;
        renderVendors();
      }
    }

    async function loadBarcodes() {
      const { data, error } = await supabase
        .from('inventory_barcodes')
        .select('*')
        .order('created_at', { ascending: false });

      if (!error && data) {
        barcodes = data;
        renderBarcodes();
      }
    }

    function updateDashboard() {
      document.getElementById('totalProducts').textContent = products.length;
      document.getElementById('totalVendors').textContent = vendors.length;

      const lowStock = products.filter(p => p.quantity <= (p.min_stock || 10)).length;
      document.getElementById('lowStock').textContent = lowStock;

      const totalValue = products.reduce((sum, p) => sum + (p.quantity * (p.cost_price || 0)), 0);
      document.getElementById('totalValue').textContent = '$' + (totalValue / 100).toFixed(2);

      // Recent activity
      const recent = [...products, ...vendors, ...barcodes]
        .sort((a, b) => new Date(b.created_at) - new Date(a.created_at))
        .slice(0, 5);

      const tbody = document.getElementById('recentActivity');
      if (recent.length === 0) {
        tbody.innerHTML = '<tr><td colspan="3" class="empty-state">No activity yet</td></tr>';
      } else {
        tbody.innerHTML = recent.map(item => {
          const type = item.sku ? 'Product' : item.barcode ? 'Barcode' : 'Vendor';
          const name = item.name || item.product_name || item.barcode || 'Unknown';
          const date = new Date(item.created_at).toLocaleDateString();
          return `<tr><td>${name}</td><td><span class="badge category">${type}</span></td><td>${date}</td></tr>`;
        }).join('');
      }
    }

    function renderProducts() {
      const search = document.getElementById('productSearch')?.value.toLowerCase() || '';
      const filtered = products.filter(p => {
        const matchSearch = !search ||
          p.name?.toLowerCase().includes(search) ||
          p.sku?.toLowerCase().includes(search);
        const matchCategory = currentCategory === 'all' || p.category === currentCategory;
        return matchSearch && matchCategory;
      });

      const tbody = document.getElementById('productsTable');
      if (filtered.length === 0) {
        tbody.innerHTML = '<tr><td colspan="9" class="empty-state"><div class="icon">üì¶</div>No products found</td></tr>';
        return;
      }

      tbody.innerHTML = filtered.map(p => {
        const isLow = p.quantity <= (p.min_stock || 10);
        const status = isLow ? '<span class="badge low-stock">Low Stock</span>' : '<span class="badge in-stock">In Stock</span>';
        return `
          <tr>
            <td>${p.sku || '-'}</td>
            <td>${p.name || '-'}</td>
            <td><span class="badge category">${p.category || '-'}</span></td>
            <td>${p.vendor_name || '-'}</td>
            <td>${p.quantity || 0}</td>
            <td>$${((p.cost_price || 0) / 100).toFixed(2)}</td>
            <td>$${((p.sell_price || 0) / 100).toFixed(2)}</td>
            <td>${status}</td>
            <td class="actions-cell">
              <button onclick="editProduct('${p.id}')">Edit</button>
              <button class="danger" onclick="deleteProduct('${p.id}')">Del</button>
            </td>
          </tr>
        `;
      }).join('');
    }

    function renderVendors() {
      const search = document.getElementById('vendorSearch')?.value.toLowerCase() || '';
      const filtered = vendors.filter(v =>
        !search || v.name?.toLowerCase().includes(search) || v.contact_name?.toLowerCase().includes(search)
      );

      const tbody = document.getElementById('vendorsTable');
      if (filtered.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="empty-state"><div class="icon">üè¢</div>No vendors found</td></tr>';
        return;
      }

      tbody.innerHTML = filtered.map(v => `
        <tr>
          <td>${v.name || '-'}</td>
          <td><span class="badge category">${v.category || '-'}</span></td>
          <td>${v.contact_name || '-'}</td>
          <td>${v.email || '-'}</td>
          <td>${v.phone || '-'}</td>
          <td class="actions-cell">
            <button onclick="editVendor('${v.id}')">Edit</button>
            <button class="danger" onclick="deleteVendor('${v.id}')">Del</button>
          </td>
        </tr>
      `).join('');
    }

    function renderBarcodes() {
      const search = document.getElementById('barcodeSearch')?.value.toLowerCase() || '';
      const filtered = barcodes.filter(b =>
        !search || b.barcode?.toLowerCase().includes(search) || b.sku?.toLowerCase().includes(search)
      );

      const tbody = document.getElementById('barcodesTable');
      if (filtered.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="empty-state"><div class="icon">üì±</div>No barcodes found</td></tr>';
        return;
      }

      tbody.innerHTML = filtered.map(b => `
        <tr>
          <td style="font-family:monospace">${b.barcode || '-'}</td>
          <td>${b.sku || '-'}</td>
          <td>${b.product_name || '-'}</td>
          <td>${b.barcode_type || '-'}</td>
          <td class="actions-cell">
            <button onclick="editBarcode('${b.id}')">Edit</button>
            <button class="danger" onclick="deleteBarcode('${b.id}')">Del</button>
          </td>
        </tr>
      `).join('');
    }

    // Navigation
    function showSection(section) {
      document.querySelectorAll('.main section').forEach(s => s.style.display = 'none');
      document.getElementById(section + '-section').style.display = 'block';
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      event.target.classList.add('active');
    }

    function filterCategory(cat, el) {
      currentCategory = cat;
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      el.classList.add('active');
      renderProducts();
    }

    function filterProducts() { renderProducts(); }
    function filterVendors() { renderVendors(); }
    function filterBarcodes() { renderBarcodes(); }

    // Modals
    function openProductModal(id = null) {
      document.getElementById('productModalTitle').textContent = id ? 'Edit Product' : 'Add Product';
      document.getElementById('productForm').reset();
      document.getElementById('productId').value = id || '';

      if (id) {
        const p = products.find(x => x.id === id);
        if (p) {
          document.getElementById('productSku').value = p.sku || '';
          document.getElementById('productName').value = p.name || '';
          document.getElementById('productCategory').value = p.category || 'Food';
          document.getElementById('productVendor').value = p.vendor_name || '';
          document.getElementById('productQty').value = p.quantity || 0;
          document.getElementById('productMinStock').value = p.min_stock || 10;
          document.getElementById('productCost').value = p.cost_price || 0;
          document.getElementById('productPrice').value = p.sell_price || 0;
          document.getElementById('productUnit').value = p.unit || '';
          document.getElementById('productLocation').value = p.location || '';
          document.getElementById('productDesc').value = p.description || '';
        }
      }

      document.getElementById('productModal').classList.remove('hidden');
    }

    function openVendorModal(id = null) {
      document.getElementById('vendorModalTitle').textContent = id ? 'Edit Vendor' : 'Add Vendor';
      document.getElementById('vendorForm').reset();
      document.getElementById('vendorId').value = id || '';

      if (id) {
        const v = vendors.find(x => x.id === id);
        if (v) {
          document.getElementById('vendorName').value = v.name || '';
          document.getElementById('vendorCategory').value = v.category || 'Food Supplier';
          document.getElementById('vendorContact').value = v.contact_name || '';
          document.getElementById('vendorEmail').value = v.email || '';
          document.getElementById('vendorPhone').value = v.phone || '';
          document.getElementById('vendorAddress').value = v.address || '';
          document.getElementById('vendorNotes').value = v.notes || '';
        }
      }

      document.getElementById('vendorModal').classList.remove('hidden');
    }

    function openBarcodeModal(id = null) {
      document.getElementById('barcodeModalTitle').textContent = id ? 'Edit Barcode' : 'Add Barcode';
      document.getElementById('barcodeForm').reset();
      document.getElementById('barcodeId').value = id || '';

      if (id) {
        const b = barcodes.find(x => x.id === id);
        if (b) {
          document.getElementById('barcodeCode').value = b.barcode || '';
          document.getElementById('barcodeType').value = b.barcode_type || 'UPC-A';
          document.getElementById('barcodeSku').value = b.sku || '';
          document.getElementById('barcodeProduct').value = b.product_name || '';
          document.getElementById('barcodeNotes').value = b.notes || '';
        }
      }

      document.getElementById('barcodeModal').classList.remove('hidden');
    }

    function closeModal(id) {
      document.getElementById(id).classList.add('hidden');
    }

    // Save functions
    async function saveProduct(e) {
      e.preventDefault();
      const id = document.getElementById('productId').value;
      const data = {
        sku: document.getElementById('productSku').value,
        name: document.getElementById('productName').value,
        category: document.getElementById('productCategory').value,
        vendor_name: document.getElementById('productVendor').value,
        quantity: parseInt(document.getElementById('productQty').value) || 0,
        min_stock: parseInt(document.getElementById('productMinStock').value) || 10,
        cost_price: parseInt(document.getElementById('productCost').value) || 0,
        sell_price: parseInt(document.getElementById('productPrice').value) || 0,
        unit: document.getElementById('productUnit').value,
        location: document.getElementById('productLocation').value,
        description: document.getElementById('productDesc').value,
        user_id: userId
      };

      if (id) {
        await supabase.from('inventory_products').update(data).eq('id', id);
      } else {
        await supabase.from('inventory_products').insert(data);
      }

      closeModal('productModal');
      loadProducts();
      updateDashboard();
    }

    async function saveVendor(e) {
      e.preventDefault();
      const id = document.getElementById('vendorId').value;
      const data = {
        name: document.getElementById('vendorName').value,
        category: document.getElementById('vendorCategory').value,
        contact_name: document.getElementById('vendorContact').value,
        email: document.getElementById('vendorEmail').value,
        phone: document.getElementById('vendorPhone').value,
        address: document.getElementById('vendorAddress').value,
        notes: document.getElementById('vendorNotes').value,
        user_id: userId
      };

      if (id) {
        await supabase.from('inventory_vendors').update(data).eq('id', id);
      } else {
        await supabase.from('inventory_vendors').insert(data);
      }

      closeModal('vendorModal');
      loadVendors();
      updateDashboard();
    }

    async function saveBarcode(e) {
      e.preventDefault();
      const id = document.getElementById('barcodeId').value;
      const data = {
        barcode: document.getElementById('barcodeCode').value,
        barcode_type: document.getElementById('barcodeType').value,
        sku: document.getElementById('barcodeSku').value,
        product_name: document.getElementById('barcodeProduct').value,
        notes: document.getElementById('barcodeNotes').value,
        user_id: userId
      };

      if (id) {
        await supabase.from('inventory_barcodes').update(data).eq('id', id);
      } else {
        await supabase.from('inventory_barcodes').insert(data);
      }

      closeModal('barcodeModal');
      loadBarcodes();
      updateDashboard();
    }

    // Edit/Delete
    function editProduct(id) { openProductModal(id); }
    function editVendor(id) { openVendorModal(id); }
    function editBarcode(id) { openBarcodeModal(id); }

    async function deleteProduct(id) {
      if (confirm('Delete this product?')) {
        await supabase.from('inventory_products').delete().eq('id', id);
        loadProducts();
        updateDashboard();
      }
    }

    async function deleteVendor(id) {
      if (confirm('Delete this vendor?')) {
        await supabase.from('inventory_vendors').delete().eq('id', id);
        loadVendors();
        updateDashboard();
      }
    }

    async function deleteBarcode(id) {
      if (confirm('Delete this barcode?')) {
        await supabase.from('inventory_barcodes').delete().eq('id', id);
        loadBarcodes();
        updateDashboard();
      }
    }

    // Click outside modal to close
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', e => {
        if (e.target === overlay) {
          overlay.classList.add('hidden');
        }
      });
    });

    init();
  </script>
</body>
</html>
