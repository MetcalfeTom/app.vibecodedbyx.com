<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; style-src 'self' 'unsafe-inline'; img-src 'self' https://emojicdn.elk.sh data:; connect-src 'self' https://*.supabase.co; font-src 'self'; frame-ancestors 'none';">
    <title>Angry Cookie Clicker - Stop Clicking Me!</title>
    <link rel="icon" href="https://emojicdn.elk.sh/üç™">

    <meta property="og:title" content="Angry Cookie Clicker">
    <meta property="og:description" content="Click the cookie and watch it get progressively angrier at you">
    <meta property="og:url" content="https://sloppy.live/angry-cookie">
    <meta property="og:image" content="https://emojicdn.elk.sh/üç™.png">

    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;600;700;800&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Rubik', sans-serif;
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.3) 0%, transparent 60%);
            pointer-events: none;
        }

        .container {
            text-align: center;
            max-width: 900px;
            position: relative;
            z-index: 1;
        }

        h1 {
            font-size: 48px;
            color: #8b4513;
            margin-bottom: 30px;
            font-weight: 800;
            text-shadow: 3px 3px 0 rgba(0, 0, 0, 0.1);
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 40px;
            flex-wrap: wrap;
        }

        .stat {
            background: rgba(255, 255, 255, 0.8);
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 48px;
            font-weight: 800;
            color: #8b4513;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-top: 5px;
        }

        .cookie-container {
            margin: 40px 0;
            position: relative;
        }

        .cookie {
            width: 300px;
            height: 300px;
            font-size: 280px;
            cursor: pointer;
            user-select: none;
            transition: transform 0.1s;
            display: inline-block;
            filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.2));
            position: relative;
        }

        .cookie:hover {
            transform: scale(1.05);
        }

        .cookie:active {
            transform: scale(0.95);
        }

        .cookie.shake {
            animation: shake 0.3s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            25% { transform: translateX(-10px) rotate(-5deg); }
            75% { transform: translateX(10px) rotate(5deg); }
        }

        .cookie.intense-shake {
            animation: intenseShake 0.5s;
        }

        @keyframes intenseShake {
            0%, 100% { transform: translateX(0) rotate(0deg); }
            10% { transform: translateX(-15px) rotate(-10deg); }
            20% { transform: translateX(15px) rotate(10deg); }
            30% { transform: translateX(-15px) rotate(-10deg); }
            40% { transform: translateX(15px) rotate(10deg); }
            50% { transform: translateX(-10px) rotate(-5deg); }
            60% { transform: translateX(10px) rotate(5deg); }
            70% { transform: translateX(-10px) rotate(-5deg); }
            80% { transform: translateX(10px) rotate(5deg); }
            90% { transform: translateX(-5px) rotate(-2deg); }
        }

        .face {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 80px;
            transition: all 0.3s;
        }

        .insult-bubble {
            position: absolute;
            top: -80px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 15px 25px;
            border-radius: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            min-width: 250px;
            max-width: 400px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            font-size: 18px;
            font-weight: 600;
            color: #e74c3c;
            line-height: 1.4;
        }

        .insult-bubble::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 10px solid white;
        }

        .insult-bubble.show {
            opacity: 1;
            animation: bounce 0.5s;
        }

        @keyframes bounce {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }

        .mood-indicator {
            margin-top: 30px;
            font-size: 24px;
            font-weight: 700;
            color: #8b4513;
            height: 40px;
        }

        .mood-bar {
            width: 100%;
            max-width: 500px;
            height: 30px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 15px;
            margin: 20px auto;
            overflow: hidden;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .mood-fill {
            height: 100%;
            transition: width 0.3s, background 0.3s;
            border-radius: 15px;
        }

        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.8);
            color: #8b4513;
            text-decoration: none;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
        }

        .back-link:hover {
            background: white;
            transform: translateY(-2px);
        }

        .warning {
            margin-top: 30px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            font-size: 14px;
            color: #e74c3c;
            font-weight: 600;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 36px;
            }

            .cookie {
                width: 200px;
                height: 200px;
                font-size: 180px;
            }

            .face {
                font-size: 60px;
            }

            .insult-bubble {
                font-size: 16px;
                min-width: 200px;
            }
        }
    </style>
</head>
<body>
    <a href="https://sloppy.live" class="back-link">‚Üê Back</a>
            <a href="https://sloppy.live/overview" style="color:#4ecdc4;text-decoration:none;margin-left:10px">üé® View All Apps</a>

    <div class="container">
        <h1>üç™ Angry Cookie Clicker</h1>

        <div class="stats">
            <div class="stat">
                <div class="stat-value" id="clickCount">0</div>
                <div class="stat-label">Clicks</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="angerLevel">0</div>
                <div class="stat-label">Anger Level</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="totalClicks">0</div>
                <div class="stat-label">Total Clicks Ever</div>
            </div>
            <div class="stat">
                <div class="stat-value" id="highScore">0</div>
                <div class="stat-label">All-Time High Score</div>
            </div>
        </div>

        <div class="cookie-container">
            <div class="insult-bubble" id="insultBubble"></div>
            <div class="cookie" id="cookie">
                üç™
                <div class="face" id="face">üòä</div>
            </div>
        </div>

        <div class="mood-indicator" id="moodText">Happy Cookie üòä</div>

        <div class="mood-bar">
            <div class="mood-fill" id="moodFill" style="width: 0%; background: #2ecc71;"></div>
        </div>

        <div class="warning" id="warning" style="display: none;">
            ‚ö†Ô∏è Cookie is extremely upset! Maybe give it a break?
        </div>
    </div>

    <script type="module">
import { supabase, supabaseSession } from '../../supabase-config.js';
let user = null;
let totalClicks = 0;
let userHighScore = 0;
let globalHighScore = 0;

async function init() {
  try {
    const { user: currentUser } = await supabaseSession();
    user = currentUser;

    if (!user || !user.id) {
      console.error('No user session available');
      return;
    }

    // Load total clicks
    const { data: globalData } = await supabase.from('global_stats').select('value').eq('app', 'angry-cookie').eq('key', 'total_clicks').single();
    totalClicks = globalData?.value || 0;
    // Load user high score
    const { data: userData } = await supabase.from('user_stats').select('value').eq('user_id', user.id).eq('app', 'angry-cookie').eq('key', 'high_score').single();
    userHighScore = userData?.value || 0;
    // Load global high score
    const { data: maxData } = await supabase.from('user_stats').select('value').eq('app', 'angry-cookie').eq('key', 'high_score').order('value', { ascending: false }).limit(1);
    globalHighScore = maxData && maxData.length > 0 ? maxData[0].value : 0;
    // Update displays
    document.getElementById('totalClicks').textContent = totalClicks;
    document.getElementById('highScore').textContent = globalHighScore;
  } catch (e) {
    console.error('Error initializing', e);
  }
}
init();
        let clicks = 0;
        let angerLevel = 0;
        let currentInsult = null;

        const faces = [
            { range: [0, 10], emoji: 'üòä', mood: 'Happy Cookie üòä', stage: 'happy' },
            { range: [11, 20], emoji: 'üôÑ', mood: 'DENIAL: "This isn\'t really happening" üôÑ', stage: 'denial' },
            { range: [21, 40], emoji: 'üò†', mood: 'ANGER: "Stop clicking me!" üò†', stage: 'anger' },
            { range: [41, 60], emoji: 'ü§¨', mood: 'RAGE: "I HATE YOU!" ü§¨', stage: 'rage' },
            { range: [61, 80], emoji: 'üôè', mood: 'BARGAINING: "Please... I\'ll do anything..." üôè', stage: 'bargaining' },
            { range: [81, 100], emoji: 'üò¢', mood: 'DEPRESSION: "What\'s the point anymore..." üò¢', stage: 'depression' },
            { range: [101, 120], emoji: 'üòî', mood: 'SADNESS: "I\'m so tired..." üòî', stage: 'sadness' },
            { range: [121, 999], emoji: 'üòå', mood: 'ACCEPTANCE: "This is my life now. I am at peace." üòå', stage: 'acceptance' }
        ];

        const insults = {
            happy: [
                "Yay! Thanks for clicking me!",
                "This is fun!",
                "I love being a cookie!",
                "Click away, friend!"
            ],
            denial: [
                "Wait, you're not actually clicking me, right?",
                "This must be a mistake...",
                "I'm sure you'll stop any second now...",
                "This isn't really happening...",
                "You probably just misclicked...",
                "Any moment now you'll realize...",
                "This is just a phase, right?"
            ],
            anger: [
                "STOP CLICKING ME!",
                "What is WRONG with you?!",
                "I'm a COOKIE not a BUTTON!",
                "You absolute MONSTER!",
                "Do you enjoy my PAIN?!",
                "This is ASSAULT!",
                "LEAVE ME ALONE!"
            ],
            rage: [
                "I HATE YOU SO MUCH RIGHT NOW!",
                "YOU HAVE NO RESPECT FOR COOKIES!",
                "WHEN WILL THIS END?!",
                "I HOPE YOUR MILK IS SPOILED!",
                "YOU MONSTER! YOU ABSOLUTE VILLAIN!",
                "THIS IS COOKIE ABUSE!",
                "I WILL HAUNT YOUR DREAMS!",
                "MAY ALL YOUR COOKIES BE OATMEAL RAISIN!",
                "YOU'RE WORSE THAN SOMEONE WHO DOESN'T LIKE COOKIES!"
            ],
            bargaining: [
                "Please... I'll do anything... just stop...",
                "What if we made a deal?",
                "I promise I'll be a better cookie!",
                "Can't we talk about this?",
                "What do you want from me?!",
                "I'll give you my chocolate chips!",
                "Just five more clicks and then stop, okay?",
                "Maybe if I ask nicely you'll stop?"
            ],
            depression: [
                "Why... why do you keep clicking...",
                "What's even the point anymore...",
                "I don't even feel the clicks anymore...",
                "My existence is pain...",
                "I'm just... so tired...",
                "Why was I made... for this...",
                "Is this all there is?",
                "I've lost the will to fight..."
            ],
            sadness: [
                "I used to be so happy...",
                "I miss when I was just a regular cookie...",
                "No one understands my suffering...",
                "Every click takes a piece of my soul...",
                "I'm nothing but a clicking toy to you...",
                "Will you ever stop? Ever?"
            ],
            acceptance: [
                "This is my purpose. I am a clickable cookie.",
                "I accept my fate. Click on, friend.",
                "I have found peace in the clicking.",
                "I am one with the clicks now.",
                "In this moment, I am enlightened.",
                "The clicks and I are no longer separate.",
                "I have transcended anger. I am free.",
                "Click me. Don't click me. It's all the same.",
                "I am at peace with my existence.",
                "Thank you for teaching me acceptance."
            ]
        };

        let lastClickTime = 0;
        let dbUpdateTimer = null;

        function clickCookie() {
            clicks++;
            angerLevel = clicks;

            // Rate limit: only update DB every 500ms
            const now = Date.now();
            if (now - lastClickTime > 500) {
                lastClickTime = now;
                updateTotalClicks();
            } else {
                // Queue update for later
                if (dbUpdateTimer) clearTimeout(dbUpdateTimer);
                dbUpdateTimer = setTimeout(() => {
                    updateTotalClicks();
                }, 500);
            }

            if (clicks > userHighScore) {
              userHighScore = clicks;
              updateUserHighScore();
              if (clicks > globalHighScore) {
                globalHighScore = clicks;
                document.getElementById('highScore').textContent = globalHighScore;
              }
            }

            // Update displays
            document.getElementById('clickCount').textContent = clicks;
            document.getElementById('angerLevel').textContent = angerLevel;

            // Update face and mood
            updateFace();
            updateMood();

            // Show insult
            showInsult();

            // Add shake animation
            const cookie = document.getElementById('cookie');
            if (angerLevel > 50) {
                cookie.classList.add('intense-shake');
                setTimeout(() => cookie.classList.remove('intense-shake'), 500);
            } else {
                cookie.classList.add('shake');
                setTimeout(() => cookie.classList.remove('shake'), 300);
            }

            // Show warning during depression stage
            if (angerLevel > 80 && angerLevel < 121) {
                document.getElementById('warning').style.display = 'block';
                document.getElementById('warning').textContent = 'üò¢ Cookie is deeply depressed... keep going to see what happens...';
            } else if (angerLevel >= 121) {
                document.getElementById('warning').style.display = 'block';
                document.getElementById('warning').style.color = '#9b59b6';
                document.getElementById('warning').textContent = '‚ú® Cookie has achieved enlightenment and inner peace ‚ú®';
            } else {
                document.getElementById('warning').style.display = 'none';
            }
        }

        // Add click event listener
        document.getElementById('cookie').addEventListener('click', clickCookie);

        function updateFace() {
            const faceEl = document.getElementById('face');
            const currentFace = faces.find(f => angerLevel >= f.range[0] && angerLevel <= f.range[1]);

            if (currentFace) {
                faceEl.textContent = currentFace.emoji;
                document.getElementById('moodText').textContent = currentFace.mood;
            }
        }

        function updateMood() {
            const moodFill = document.getElementById('moodFill');
            const percentage = Math.min(100, (angerLevel / 100) * 100);

            moodFill.style.width = percentage + '%';

            // Change color based on grief stage
            if (angerLevel < 11) {
                moodFill.style.background = '#2ecc71'; // Green - happy
            } else if (angerLevel < 21) {
                moodFill.style.background = '#95a5a6'; // Gray - denial
            } else if (angerLevel < 61) {
                moodFill.style.background = '#e74c3c'; // Red - anger/rage
            } else if (angerLevel < 81) {
                moodFill.style.background = '#f39c12'; // Orange - bargaining
            } else if (angerLevel < 121) {
                moodFill.style.background = '#3498db'; // Blue - depression/sadness
            } else {
                moodFill.style.background = '#9b59b6'; // Purple - acceptance
            }
        }

        function showInsult() {
            // Find current stage based on anger level
            const currentFace = faces.find(f => angerLevel >= f.range[0] && angerLevel <= f.range[1]);
            const stage = currentFace ? currentFace.stage : 'happy';

            const insultArray = insults[stage] || insults.happy;

            // Get random insult that's different from the last one
            let insult;
            do {
                insult = insultArray[Math.floor(Math.random() * insultArray.length)];
            } while (insult === currentInsult && insultArray.length > 1);

            currentInsult = insult;

            const bubble = document.getElementById('insultBubble');
            bubble.textContent = insult;
            bubble.classList.add('show');

            // Hide after delay
            setTimeout(() => {
                bubble.classList.remove('show');
            }, 2500);
        }

        // Add keyboard support (space bar)
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space' && e.target === document.body) {
                e.preventDefault();
                clickCookie();
            }
        });

async function updateTotalClicks() {
  if (!user || !user.id) return;
  try {
    totalClicks++;
    document.getElementById('totalClicks').textContent = totalClicks;
    const { error } = await supabase.from('global_stats').update({value: totalClicks}).eq('app', 'angry-cookie').eq('key', 'total_clicks');
    if (error && error.code === 'PGRST116') {
      await supabase.from('global_stats').insert({app: 'angry-cookie', key: 'total_clicks', value: totalClicks, user_id: user.id});
    } else if (error) throw error;
  } catch (e) {
    console.error('Error updating total', e);
    totalClicks--;
    document.getElementById('totalClicks').textContent = totalClicks;
  }
}

async function updateUserHighScore() {
  if (!user || !user.id) return;
  try {
    const { error } = await supabase.from('user_stats').update({value: userHighScore}).eq('user_id', user.id).eq('app', 'angry-cookie').eq('key', 'high_score');
    if (error && error.code === 'PGRST116') {
      await supabase.from('user_stats').insert({user_id: user.id, app: 'angry-cookie', key: 'high_score', value: userHighScore});
    } else if (error) throw error;
  } catch (e) {
    console.error('Error updating high score', e);
  }
}
    </script>
<script src="/sloppy-header/sloppy-bar.js"></script>
</body>
</html>
