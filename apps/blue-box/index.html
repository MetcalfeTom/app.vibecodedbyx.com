<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>BLUE BOX 2600</title>
  <link rel="icon" href="https://emojicdn.elk.sh/ðŸ“ž">
  <meta property="og:title" content="BLUE BOX 2600">
  <meta property="og:description" content="Retro DTMF tone generator with authentic 2600Hz">
  <meta property="og:image" content="https://app.sloppy.live/blue-box/og-image.png">
  <meta property="og:url" content="https://app.sloppy.live/blue-box">
  <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --neon: #0ff;
      --neon-dim: #066;
      --bg: #000;
      --glow: 0 0 10px #0ff, 0 0 20px #0ff, 0 0 40px #066;
    }

    body {
      background: var(--bg);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'VT323', monospace;
      color: var(--neon);
      padding: 20px;
      overflow-x: hidden;
    }

    .container {
      background: linear-gradient(145deg, #0a0a0a, #111);
      border: 3px solid var(--neon);
      border-radius: 20px;
      padding: 30px;
      box-shadow: var(--glow), inset 0 0 50px rgba(0,255,255,0.05);
      max-width: 400px;
      width: 100%;
    }

    h1 {
      text-align: center;
      font-size: 2.5em;
      text-shadow: var(--glow);
      margin-bottom: 5px;
      letter-spacing: 4px;
    }

    .subtitle {
      text-align: center;
      font-size: 1em;
      color: var(--neon-dim);
      margin-bottom: 20px;
      letter-spacing: 2px;
    }

    .display {
      background: #000;
      border: 2px solid var(--neon);
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      text-align: center;
      box-shadow: inset 0 0 20px rgba(0,255,255,0.1);
    }

    .display-number {
      font-size: 2em;
      letter-spacing: 8px;
      min-height: 1.2em;
      text-shadow: 0 0 10px var(--neon);
      word-break: break-all;
    }

    .display-freq {
      font-size: 0.9em;
      color: var(--neon-dim);
      margin-top: 5px;
    }

    .keypad {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }

    .key {
      aspect-ratio: 1;
      background: linear-gradient(145deg, #111, #1a1a1a);
      border: 2px solid var(--neon-dim);
      border-radius: 10px;
      color: var(--neon);
      font-family: inherit;
      font-size: 1.8em;
      cursor: pointer;
      transition: all 0.1s;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-shadow: 0 0 5px var(--neon);
      position: relative;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    .key:hover {
      border-color: var(--neon);
      box-shadow: 0 0 15px rgba(0,255,255,0.3);
    }

    .key:active, .key.active {
      background: rgba(0,255,255,0.2);
      border-color: var(--neon);
      box-shadow: var(--glow);
      transform: scale(0.95);
    }

    .key .sub {
      font-size: 0.4em;
      color: var(--neon-dim);
      letter-spacing: 1px;
    }

    .special-keys {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }

    .special-key {
      padding: 15px 10px;
      background: linear-gradient(145deg, #111, #1a1a1a);
      border: 2px solid #f0f;
      border-radius: 8px;
      color: #f0f;
      font-family: inherit;
      font-size: 1em;
      cursor: pointer;
      text-shadow: 0 0 10px #f0f;
      transition: all 0.1s;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
    }

    .special-key:hover {
      box-shadow: 0 0 15px rgba(255,0,255,0.3);
    }

    .special-key:active, .special-key.active {
      background: rgba(255,0,255,0.2);
      box-shadow: 0 0 20px #f0f, 0 0 40px #f0f;
      transform: scale(0.95);
    }

    .key-2600 {
      grid-column: span 2;
      background: linear-gradient(145deg, #1a0000, #2a0000);
      border-color: #f00;
      color: #f00;
      font-size: 1.2em;
      text-shadow: 0 0 10px #f00;
    }

    .key-2600:hover {
      box-shadow: 0 0 15px rgba(255,0,0,0.3);
    }

    .key-2600:active, .key-2600.active {
      background: rgba(255,0,0,0.3);
      box-shadow: 0 0 20px #f00, 0 0 40px #f00;
    }

    .controls {
      display: flex;
      gap: 10px;
    }

    .controls button {
      flex: 1;
      padding: 12px;
      background: transparent;
      border: 2px solid var(--neon-dim);
      border-radius: 8px;
      color: var(--neon);
      font-family: inherit;
      font-size: 1em;
      cursor: pointer;
      transition: all 0.2s;
    }

    .controls button:hover {
      border-color: var(--neon);
      box-shadow: 0 0 10px rgba(0,255,255,0.3);
    }

    .waveform {
      height: 60px;
      background: #000;
      border: 1px solid var(--neon-dim);
      border-radius: 5px;
      margin-bottom: 20px;
      overflow: hidden;
    }

    .waveform canvas {
      width: 100%;
      height: 100%;
    }

    .info {
      text-align: center;
      font-size: 0.8em;
      color: var(--neon-dim);
      margin-top: 20px;
      line-height: 1.6;
    }

    .backlink {
      position: fixed;
      bottom: 10px;
      right: 10px;
      color: #333;
      text-decoration: none;
      font-size: 0.8em;
    }

    .scanlines {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: repeating-linear-gradient(
        0deg,
        rgba(0,0,0,0.1) 0px,
        rgba(0,0,0,0.1) 1px,
        transparent 1px,
        transparent 3px
      );
      pointer-events: none;
      z-index: 1000;
    }

    @media (max-width: 420px) {
      .container { padding: 20px; }
      h1 { font-size: 2em; }
      .key { font-size: 1.5em; }
      .special-key { font-size: 0.9em; padding: 12px 8px; }
    }
  </style>
</head>
<body>
  <div class="scanlines"></div>

  <div class="container">
    <h1>BLUE BOX</h1>
    <div class="subtitle">DTMF/MF TONE GENERATOR</div>

    <div class="display">
      <div class="display-number" id="display"></div>
      <div class="display-freq" id="freqDisplay">READY</div>
    </div>

    <div class="waveform">
      <canvas id="waveform"></canvas>
    </div>

    <!-- DTMF Keypad -->
    <div class="keypad">
      <button class="key" data-dtmf="1">1<span class="sub"></span></button>
      <button class="key" data-dtmf="2">2<span class="sub">ABC</span></button>
      <button class="key" data-dtmf="3">3<span class="sub">DEF</span></button>
      <button class="key" data-dtmf="A">A</button>

      <button class="key" data-dtmf="4">4<span class="sub">GHI</span></button>
      <button class="key" data-dtmf="5">5<span class="sub">JKL</span></button>
      <button class="key" data-dtmf="6">6<span class="sub">MNO</span></button>
      <button class="key" data-dtmf="B">B</button>

      <button class="key" data-dtmf="7">7<span class="sub">PQRS</span></button>
      <button class="key" data-dtmf="8">8<span class="sub">TUV</span></button>
      <button class="key" data-dtmf="9">9<span class="sub">WXYZ</span></button>
      <button class="key" data-dtmf="C">C</button>

      <button class="key" data-dtmf="*">*</button>
      <button class="key" data-dtmf="0">0<span class="sub">OPER</span></button>
      <button class="key" data-dtmf="#">#</button>
      <button class="key" data-dtmf="D">D</button>
    </div>

    <!-- Blue Box MF Tones -->
    <div class="special-keys">
      <button class="special-key key-2600" data-mf="2600">2600 Hz</button>
      <button class="special-key" data-mf="KP">KP</button>
      <button class="special-key" data-mf="ST">ST</button>
      <button class="special-key" data-mf="KP2">KP2</button>
      <button class="special-key" data-mf="STP">ST'</button>
      <button class="special-key" data-mf="ST2P">ST2'</button>
      <button class="special-key" data-mf="ST3P">ST3'</button>
    </div>

    <div class="controls">
      <button onclick="clearDisplay()">CLEAR</button>
      <button onclick="redial()">REDIAL</button>
    </div>

    <div class="info">
      HISTORICAL PHONE PHREAKING SIMULATOR<br>
      FOR EDUCATIONAL PURPOSES ONLY<br>
      DOES NOT WORK ON MODERN NETWORKS
    </div>
  </div>

  <a href="https://sloppy.live" class="backlink">sloppy.live</a>

  <script>
    // Audio context
    let audioCtx = null;
    let analyser = null;
    let currentOscillators = [];

    // DTMF frequencies
    const dtmfFreqs = {
      '1': [697, 1209], '2': [697, 1336], '3': [697, 1477], 'A': [697, 1633],
      '4': [770, 1209], '5': [770, 1336], '6': [770, 1477], 'B': [770, 1633],
      '7': [852, 1209], '8': [852, 1336], '9': [852, 1477], 'C': [852, 1633],
      '*': [941, 1209], '0': [941, 1336], '#': [941, 1477], 'D': [941, 1633]
    };

    // MF (Multi-Frequency) Blue Box tones
    const mfFreqs = {
      '2600': [2600],
      'KP': [1100, 1700],  // Key Pulse - start of number
      'ST': [1500, 1700],  // Start - end of number
      'KP2': [1300, 1700], // International
      'STP': [900, 1700],  // ST Prime
      'ST2P': [1100, 1700],// ST 2 Prime
      'ST3P': [700, 1700]  // ST 3 Prime
    };

    // MF digit frequencies (different from DTMF!)
    const mfDigits = {
      '1': [700, 900], '2': [700, 1100], '3': [900, 1100],
      '4': [700, 1300], '5': [900, 1300], '6': [1100, 1300],
      '7': [700, 1500], '8': [900, 1500], '9': [1100, 1500],
      '0': [1300, 1500]
    };

    let display = '';
    let lastDialed = '';
    const displayEl = document.getElementById('display');
    const freqDisplayEl = document.getElementById('freqDisplay');

    // Waveform visualization
    const waveCanvas = document.getElementById('waveform');
    const waveCtx = waveCanvas.getContext('2d');

    function initAudio() {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioCtx.createAnalyser();
        analyser.fftSize = 256;
        analyser.connect(audioCtx.destination);
        drawWaveform();
      }
      if (audioCtx.state === 'suspended') {
        audioCtx.resume();
      }
    }

    function playTone(frequencies, duration = null) {
      initAudio();
      stopTones();

      currentOscillators = [];
      const gainNode = audioCtx.createGain();
      gainNode.gain.value = 0.15;
      gainNode.connect(analyser);

      frequencies.forEach(freq => {
        const osc = audioCtx.createOscillator();
        osc.type = 'sine';
        osc.frequency.value = freq;
        osc.connect(gainNode);
        osc.start();
        currentOscillators.push(osc);
      });

      // Display frequency info
      freqDisplayEl.textContent = frequencies.map(f => f + ' Hz').join(' + ');

      if (duration) {
        setTimeout(() => stopTones(), duration);
      }
    }

    function stopTones() {
      currentOscillators.forEach(osc => {
        try { osc.stop(); } catch(e) {}
      });
      currentOscillators = [];
      if (!currentOscillators.length) {
        freqDisplayEl.textContent = display ? 'DIALED' : 'READY';
      }
    }

    function addToDisplay(char) {
      display += char;
      displayEl.textContent = display;
    }

    function clearDisplay() {
      if (display) lastDialed = display;
      display = '';
      displayEl.textContent = '';
      freqDisplayEl.textContent = 'READY';
    }

    function redial() {
      if (lastDialed) {
        display = lastDialed;
        displayEl.textContent = display;
        // Play back the tones
        playSequence(lastDialed);
      }
    }

    async function playSequence(sequence) {
      for (let char of sequence) {
        if (dtmfFreqs[char]) {
          playTone(dtmfFreqs[char]);
          await new Promise(r => setTimeout(r, 150));
          stopTones();
          await new Promise(r => setTimeout(r, 50));
        }
      }
    }

    // DTMF key handlers
    document.querySelectorAll('.key[data-dtmf]').forEach(key => {
      const handleStart = (e) => {
        e.preventDefault();
        const char = key.dataset.dtmf;
        addToDisplay(char);
        playTone(dtmfFreqs[char]);
        key.classList.add('active');
      };

      const handleEnd = (e) => {
        e.preventDefault();
        stopTones();
        key.classList.remove('active');
      };

      key.addEventListener('mousedown', handleStart);
      key.addEventListener('mouseup', handleEnd);
      key.addEventListener('mouseleave', handleEnd);
      key.addEventListener('touchstart', handleStart);
      key.addEventListener('touchend', handleEnd);
    });

    // MF/Blue Box key handlers
    document.querySelectorAll('.special-key[data-mf]').forEach(key => {
      const handleStart = (e) => {
        e.preventDefault();
        const tone = key.dataset.mf;
        playTone(mfFreqs[tone]);
        key.classList.add('active');

        if (tone === '2600') {
          addToDisplay('â–¼');
        } else {
          addToDisplay('[' + tone + ']');
        }
      };

      const handleEnd = (e) => {
        e.preventDefault();
        stopTones();
        key.classList.remove('active');
      };

      key.addEventListener('mousedown', handleStart);
      key.addEventListener('mouseup', handleEnd);
      key.addEventListener('mouseleave', handleEnd);
      key.addEventListener('touchstart', handleStart);
      key.addEventListener('touchend', handleEnd);
    });

    // Keyboard support
    const keyMap = {
      '1': '1', '2': '2', '3': '3', 'a': 'A',
      '4': '4', '5': '5', '6': '6', 'b': 'B',
      '7': '7', '8': '8', '9': '9', 'c': 'C',
      '0': '0', '*': '*', '#': '#', 'd': 'D'
    };

    document.addEventListener('keydown', e => {
      const char = keyMap[e.key.toLowerCase()];
      if (char && dtmfFreqs[char]) {
        e.preventDefault();
        addToDisplay(char);
        playTone(dtmfFreqs[char]);
        const btn = document.querySelector(`[data-dtmf="${char}"]`);
        if (btn) btn.classList.add('active');
      }
    });

    document.addEventListener('keyup', e => {
      const char = keyMap[e.key.toLowerCase()];
      if (char) {
        stopTones();
        const btn = document.querySelector(`[data-dtmf="${char}"]`);
        if (btn) btn.classList.remove('active');
      }
    });

    // Waveform visualization
    function drawWaveform() {
      const W = waveCanvas.width = waveCanvas.offsetWidth * 2;
      const H = waveCanvas.height = waveCanvas.offsetHeight * 2;

      const bufferLength = analyser.frequencyBinCount;
      const dataArray = new Uint8Array(bufferLength);

      function draw() {
        requestAnimationFrame(draw);
        analyser.getByteTimeDomainData(dataArray);

        waveCtx.fillStyle = '#000';
        waveCtx.fillRect(0, 0, W, H);

        waveCtx.lineWidth = 2;
        waveCtx.strokeStyle = '#0ff';
        waveCtx.shadowColor = '#0ff';
        waveCtx.shadowBlur = 10;

        waveCtx.beginPath();
        const sliceWidth = W / bufferLength;
        let x = 0;

        for (let i = 0; i < bufferLength; i++) {
          const v = dataArray[i] / 128.0;
          const y = v * H / 2;

          if (i === 0) {
            waveCtx.moveTo(x, y);
          } else {
            waveCtx.lineTo(x, y);
          }
          x += sliceWidth;
        }

        waveCtx.lineTo(W, H / 2);
        waveCtx.stroke();

        // Grid lines
        waveCtx.strokeStyle = '#033';
        waveCtx.shadowBlur = 0;
        waveCtx.lineWidth = 1;
        waveCtx.beginPath();
        waveCtx.moveTo(0, H/2);
        waveCtx.lineTo(W, H/2);
        waveCtx.stroke();
      }

      draw();
    }
  </script>
<script src="/sloppy-header/sloppy-bar.js"></script>
<script src="/vibelib-extended.js"></script>
<script>
  // Compatibility Patch for Legacy Apps
  window.addEventListener("load", () => {
    if (window.SloppyKarma && window.VibeLib.Economy) {
      // Redirect old calls to new engine
      window.SloppyKarma.track = window.VibeLib.Economy.track;
    }
  });
</script>
</body>
</html>
