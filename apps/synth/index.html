<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Neon Synth</title>
  <link rel="icon" href="https://emojicdn.elk.sh/ðŸŽ¹">
  <meta name="description" content="Audio synthesizer with step sequencer and rhythmic visualizer">
  <meta property="og:title" content="Neon Synth">
  <meta property="og:description" content="Audio synthesizer with step sequencer and rhythmic visualizer">
  <meta property="og:image" content="https://emojicdn.elk.sh/ðŸŽ¹?style=google">
  <meta property="og:url" content="https://app.sloppy.live/synth">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Share+Tech+Mono&display=swap');

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #0a0a1a 0%, #1a0a2a 50%, #0a1a2a 100%);
      font-family: 'Share Tech Mono', monospace;
      color: #fff;
      overflow-x: hidden;
    }

    .back-link {
      position: fixed;
      top: 10px;
      left: 10px;
      color: rgba(255,255,255,0.3);
      text-decoration: none;
      font-size: 0.8rem;
      z-index: 100;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
    }

    h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 2rem;
      font-weight: 900;
      text-align: center;
      letter-spacing: 8px;
      margin-bottom: 5px;
      background: linear-gradient(90deg, #0ff, #f0f);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      filter: drop-shadow(0 0 20px rgba(0,255,255,0.5));
    }

    .subtitle {
      text-align: center;
      color: #666;
      font-size: 0.7rem;
      letter-spacing: 4px;
      margin-bottom: 25px;
    }

    /* Visualizer */
    .visualizer-container {
      background: rgba(0,0,0,0.5);
      border: 2px solid #f0f;
      border-radius: 15px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 0 30px rgba(255,0,255,0.2);
    }

    #visualizer {
      width: 100%;
      height: 150px;
      display: block;
      border-radius: 8px;
    }

    /* Controls Section */
    .section {
      background: rgba(0,0,0,0.3);
      border: 1px solid rgba(0,255,255,0.3);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 15px;
    }

    .section-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 0.8rem;
      color: #0ff;
      letter-spacing: 3px;
      margin-bottom: 12px;
      text-shadow: 0 0 10px #0ff;
    }

    /* Transport Controls */
    .transport {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 20px;
    }

    .transport-btn {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      border: 3px solid #0ff;
      background: linear-gradient(145deg, #1a1a2e, #0a0a15);
      color: #0ff;
      font-size: 1.5rem;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 0 20px rgba(0,255,255,0.2);
    }

    .transport-btn:hover {
      box-shadow: 0 0 30px rgba(0,255,255,0.5);
      transform: scale(1.05);
    }

    .transport-btn.playing {
      border-color: #f0f;
      color: #f0f;
      box-shadow: 0 0 30px rgba(255,0,255,0.5);
      animation: pulse 0.5s ease infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .tempo-display {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-top: 10px;
    }

    .tempo-value {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.5rem;
      color: #ff0;
      text-shadow: 0 0 15px #ff0;
      min-width: 80px;
      text-align: center;
    }

    .tempo-label {
      font-size: 0.7rem;
      color: #888;
    }

    .tempo-btn {
      width: 30px;
      height: 30px;
      border: 2px solid #ff0;
      background: transparent;
      color: #ff0;
      font-size: 1.2rem;
      cursor: pointer;
      border-radius: 5px;
      transition: all 0.2s;
    }

    .tempo-btn:hover {
      background: rgba(255,255,0,0.2);
    }

    /* Step Sequencer */
    .sequencer {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .seq-row {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .seq-label {
      width: 50px;
      font-size: 0.7rem;
      color: #888;
      text-align: right;
    }

    .seq-steps {
      display: flex;
      gap: 4px;
      flex: 1;
    }

    .seq-step {
      flex: 1;
      height: 35px;
      background: rgba(255,255,255,0.05);
      border: 1px solid rgba(255,255,255,0.1);
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.1s;
    }

    .seq-step:hover {
      background: rgba(255,255,255,0.1);
    }

    .seq-step.active {
      border-color: currentColor;
      box-shadow: 0 0 15px currentColor, inset 0 0 15px currentColor;
    }

    .seq-step.playing {
      background: rgba(255,255,255,0.3);
    }

    .seq-row:nth-child(1) .seq-step { color: #f00; }
    .seq-row:nth-child(1) .seq-step.active { background: rgba(255,0,0,0.4); }
    .seq-row:nth-child(2) .seq-step { color: #f90; }
    .seq-row:nth-child(2) .seq-step.active { background: rgba(255,153,0,0.4); }
    .seq-row:nth-child(3) .seq-step { color: #ff0; }
    .seq-row:nth-child(3) .seq-step.active { background: rgba(255,255,0,0.4); }
    .seq-row:nth-child(4) .seq-step { color: #0f0; }
    .seq-row:nth-child(4) .seq-step.active { background: rgba(0,255,0,0.4); }
    .seq-row:nth-child(5) .seq-step { color: #0ff; }
    .seq-row:nth-child(5) .seq-step.active { background: rgba(0,255,255,0.4); }
    .seq-row:nth-child(6) .seq-step { color: #f0f; }
    .seq-row:nth-child(6) .seq-step.active { background: rgba(255,0,255,0.4); }

    /* Synth Controls */
    .synth-controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
    }

    .control {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
    }

    .control-label {
      font-size: 0.65rem;
      color: #888;
      letter-spacing: 1px;
      text-transform: uppercase;
    }

    .knob-container {
      position: relative;
      width: 60px;
      height: 60px;
    }

    .knob {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: linear-gradient(145deg, #2a2a3a, #1a1a2a);
      border: 3px solid #444;
      cursor: pointer;
      position: relative;
      transition: border-color 0.2s;
    }

    .knob:hover {
      border-color: #0ff;
    }

    .knob::after {
      content: '';
      position: absolute;
      top: 8px;
      left: 50%;
      transform: translateX(-50%);
      width: 4px;
      height: 15px;
      background: #0ff;
      border-radius: 2px;
      box-shadow: 0 0 10px #0ff;
    }

    .knob-value {
      font-family: 'Orbitron', sans-serif;
      font-size: 0.8rem;
      color: #0ff;
      text-shadow: 0 0 10px #0ff;
    }

    /* Wave Select */
    .wave-select {
      display: flex;
      gap: 8px;
    }

    .wave-btn {
      padding: 8px 12px;
      background: rgba(255,255,255,0.05);
      border: 1px solid #444;
      border-radius: 6px;
      color: #888;
      font-size: 0.7rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .wave-btn:hover {
      border-color: #0ff;
      color: #0ff;
    }

    .wave-btn.active {
      background: rgba(0,255,255,0.2);
      border-color: #0ff;
      color: #0ff;
      box-shadow: 0 0 15px rgba(0,255,255,0.3);
    }

    /* Presets */
    .presets {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
    }

    .preset-btn {
      padding: 8px 15px;
      background: rgba(255,0,255,0.1);
      border: 1px solid #f0f;
      border-radius: 20px;
      color: #f0f;
      font-size: 0.7rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .preset-btn:hover {
      background: rgba(255,0,255,0.3);
      box-shadow: 0 0 15px rgba(255,0,255,0.5);
    }

    /* Instructions */
    .instructions {
      text-align: center;
      color: #444;
      font-size: 0.6rem;
      margin-top: 15px;
      letter-spacing: 1px;
    }

    /* Mobile adjustments */
    @media (max-width: 600px) {
      .seq-step { height: 28px; }
      .seq-label { width: 35px; font-size: 0.6rem; }
      .synth-controls { grid-template-columns: repeat(3, 1fr); }
    }
  </style>
</head>
<body>
  <a href="https://sloppy.live" class="back-link">sloppy.live</a>

  <div class="container">
    <h1>NEON SYNTH</h1>
    <div class="subtitle">STEP SEQUENCER + VISUALIZER</div>

    <!-- Visualizer -->
    <div class="visualizer-container">
      <canvas id="visualizer"></canvas>
    </div>

    <!-- Transport -->
    <div class="transport">
      <button class="transport-btn" id="playBtn" onclick="togglePlay()">â–¶</button>
      <button class="transport-btn" onclick="stopSequencer()">â– </button>
    </div>

    <div class="tempo-display">
      <button class="tempo-btn" onclick="changeTempo(-5)">âˆ’</button>
      <div>
        <div class="tempo-value" id="tempoValue">120</div>
        <div class="tempo-label">BPM</div>
      </div>
      <button class="tempo-btn" onclick="changeTempo(5)">+</button>
    </div>

    <!-- Step Sequencer -->
    <div class="section">
      <div class="section-title">STEP SEQUENCER</div>
      <div class="sequencer" id="sequencer"></div>
    </div>

    <!-- Synth Controls -->
    <div class="section">
      <div class="section-title">SYNTHESIZER</div>
      <div class="synth-controls">
        <div class="control">
          <div class="control-label">Waveform</div>
          <div class="wave-select">
            <button class="wave-btn active" data-wave="sine">âˆ¿</button>
            <button class="wave-btn" data-wave="square">âŠ“</button>
            <button class="wave-btn" data-wave="sawtooth">â‹€</button>
            <button class="wave-btn" data-wave="triangle">â–³</button>
          </div>
        </div>
        <div class="control">
          <div class="control-label">Volume</div>
          <div class="knob-container">
            <div class="knob" id="volumeKnob" data-value="70" data-param="volume"></div>
          </div>
          <div class="knob-value" id="volumeValue">70%</div>
        </div>
        <div class="control">
          <div class="control-label">Attack</div>
          <div class="knob-container">
            <div class="knob" id="attackKnob" data-value="10" data-param="attack"></div>
          </div>
          <div class="knob-value" id="attackValue">10ms</div>
        </div>
        <div class="control">
          <div class="control-label">Decay</div>
          <div class="knob-container">
            <div class="knob" id="decayKnob" data-value="30" data-param="decay"></div>
          </div>
          <div class="knob-value" id="decayValue">30ms</div>
        </div>
        <div class="control">
          <div class="control-label">Filter</div>
          <div class="knob-container">
            <div class="knob" id="filterKnob" data-value="100" data-param="filter"></div>
          </div>
          <div class="knob-value" id="filterValue">100%</div>
        </div>
      </div>
    </div>

    <!-- Presets -->
    <div class="section">
      <div class="section-title">PRESETS</div>
      <div class="presets">
        <button class="preset-btn" onclick="loadPreset('techno')">Techno</button>
        <button class="preset-btn" onclick="loadPreset('house')">House</button>
        <button class="preset-btn" onclick="loadPreset('dnb')">D&B</button>
        <button class="preset-btn" onclick="loadPreset('ambient')">Ambient</button>
        <button class="preset-btn" onclick="loadPreset('clear')">Clear All</button>
      </div>
    </div>

    <div class="instructions">
      CLICK STEPS TO TOGGLE â€¢ DRAG KNOBS TO ADJUST â€¢ SPACE TO PLAY/PAUSE
    </div>
  </div>

  <script>
    // Audio Context
    let audioCtx = null;
    let analyser = null;
    let masterGain = null;
    let filterNode = null;

    // Synth params
    const synth = {
      waveform: 'sine',
      volume: 0.7,
      attack: 0.01,
      decay: 0.03,
      filterFreq: 8000
    };

    // Sequencer state
    const STEPS = 16;
    const ROWS = 6;
    let sequence = [];
    let currentStep = 0;
    let isPlaying = false;
    let tempo = 120;
    let intervalId = null;

    // Notes for each row (pentatonic scale)
    const notes = [
      523.25, // C5
      440.00, // A4
      392.00, // G4
      329.63, // E4
      293.66, // D4
      261.63  // C4
    ];

    const rowNames = ['C5', 'A4', 'G4', 'E4', 'D4', 'C4'];

    // Initialize sequence
    for (let r = 0; r < ROWS; r++) {
      sequence[r] = new Array(STEPS).fill(false);
    }

    // Build sequencer UI
    function buildSequencer() {
      const container = document.getElementById('sequencer');
      container.innerHTML = '';

      for (let r = 0; r < ROWS; r++) {
        const row = document.createElement('div');
        row.className = 'seq-row';

        const label = document.createElement('div');
        label.className = 'seq-label';
        label.textContent = rowNames[r];
        row.appendChild(label);

        const steps = document.createElement('div');
        steps.className = 'seq-steps';

        for (let s = 0; s < STEPS; s++) {
          const step = document.createElement('div');
          step.className = 'seq-step';
          step.dataset.row = r;
          step.dataset.step = s;
          if (sequence[r][s]) step.classList.add('active');
          step.onclick = () => toggleStep(r, s, step);
          steps.appendChild(step);
        }

        row.appendChild(steps);
        container.appendChild(row);
      }
    }

    function toggleStep(row, step, el) {
      sequence[row][step] = !sequence[row][step];
      el.classList.toggle('active');

      // Preview sound
      if (sequence[row][step]) {
        initAudio();
        playNote(notes[row], 0.1);
      }
    }

    // Audio functions
    function initAudio() {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        // Create master gain
        masterGain = audioCtx.createGain();
        masterGain.gain.value = synth.volume;

        // Create filter
        filterNode = audioCtx.createBiquadFilter();
        filterNode.type = 'lowpass';
        filterNode.frequency.value = synth.filterFreq;

        // Create analyser
        analyser = audioCtx.createAnalyser();
        analyser.fftSize = 256;

        // Connect nodes
        masterGain.connect(filterNode);
        filterNode.connect(analyser);
        analyser.connect(audioCtx.destination);

        startVisualizer();
      }
      if (audioCtx.state === 'suspended') {
        audioCtx.resume();
      }
    }

    function playNote(freq, duration = 0.15) {
      if (!audioCtx) return;

      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();

      osc.type = synth.waveform;
      osc.frequency.value = freq;

      gain.gain.setValueAtTime(0, audioCtx.currentTime);
      gain.gain.linearRampToValueAtTime(synth.volume, audioCtx.currentTime + synth.attack);
      gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + synth.attack + synth.decay + duration);

      osc.connect(gain);
      gain.connect(masterGain);

      osc.start(audioCtx.currentTime);
      osc.stop(audioCtx.currentTime + synth.attack + synth.decay + duration + 0.1);
    }

    // Sequencer transport
    function togglePlay() {
      if (isPlaying) {
        pauseSequencer();
      } else {
        startSequencer();
      }
    }

    function startSequencer() {
      initAudio();
      isPlaying = true;
      document.getElementById('playBtn').classList.add('playing');
      document.getElementById('playBtn').textContent = 'âšâš';

      const stepTime = (60 / tempo) / 4 * 1000; // 16th notes

      intervalId = setInterval(() => {
        playStep();
        currentStep = (currentStep + 1) % STEPS;
      }, stepTime);
    }

    function pauseSequencer() {
      isPlaying = false;
      document.getElementById('playBtn').classList.remove('playing');
      document.getElementById('playBtn').textContent = 'â–¶';
      if (intervalId) clearInterval(intervalId);
    }

    function stopSequencer() {
      pauseSequencer();
      currentStep = 0;
      updateStepHighlight();
    }

    function playStep() {
      // Update visual
      updateStepHighlight();

      // Play notes
      for (let r = 0; r < ROWS; r++) {
        if (sequence[r][currentStep]) {
          playNote(notes[r]);
        }
      }
    }

    function updateStepHighlight() {
      document.querySelectorAll('.seq-step').forEach(el => {
        el.classList.remove('playing');
        if (parseInt(el.dataset.step) === currentStep) {
          el.classList.add('playing');
        }
      });
    }

    function changeTempo(delta) {
      tempo = Math.max(60, Math.min(200, tempo + delta));
      document.getElementById('tempoValue').textContent = tempo;

      if (isPlaying) {
        pauseSequencer();
        startSequencer();
      }
    }

    // Visualizer
    function startVisualizer() {
      const canvas = document.getElementById('visualizer');
      const ctx = canvas.getContext('2d');
      canvas.width = canvas.offsetWidth * 2;
      canvas.height = canvas.offsetHeight * 2;
      ctx.scale(2, 2);

      const bufferLength = analyser.frequencyBinCount;
      const dataArray = new Uint8Array(bufferLength);

      function draw() {
        requestAnimationFrame(draw);

        analyser.getByteFrequencyData(dataArray);

        const width = canvas.offsetWidth;
        const height = canvas.offsetHeight;

        // Clear with fade
        ctx.fillStyle = 'rgba(10, 10, 26, 0.3)';
        ctx.fillRect(0, 0, width, height);

        const barWidth = width / bufferLength * 2.5;
        let x = 0;

        for (let i = 0; i < bufferLength; i++) {
          const barHeight = (dataArray[i] / 255) * height * 0.9;

          // Color gradient based on frequency
          const hue = (i / bufferLength) * 300;
          ctx.fillStyle = `hsl(${hue}, 100%, 50%)`;
          ctx.shadowColor = `hsl(${hue}, 100%, 50%)`;
          ctx.shadowBlur = 15;

          // Draw mirrored bars
          ctx.fillRect(x, height / 2 - barHeight / 2, barWidth - 2, barHeight / 2);
          ctx.fillRect(x, height / 2, barWidth - 2, barHeight / 2);

          x += barWidth;
        }

        // Center line
        ctx.shadowBlur = 0;
        ctx.strokeStyle = 'rgba(255, 0, 255, 0.5)';
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(0, height / 2);
        ctx.lineTo(width, height / 2);
        ctx.stroke();
      }

      draw();
    }

    // Knob interaction
    let activeKnob = null;
    let startY = 0;
    let startValue = 0;

    document.querySelectorAll('.knob').forEach(knob => {
      knob.addEventListener('mousedown', (e) => {
        activeKnob = knob;
        startY = e.clientY;
        startValue = parseInt(knob.dataset.value);
        e.preventDefault();
      });

      knob.addEventListener('touchstart', (e) => {
        activeKnob = knob;
        startY = e.touches[0].clientY;
        startValue = parseInt(knob.dataset.value);
        e.preventDefault();
      });
    });

    document.addEventListener('mousemove', handleKnobMove);
    document.addEventListener('touchmove', handleKnobMove);

    function handleKnobMove(e) {
      if (!activeKnob) return;

      const clientY = e.touches ? e.touches[0].clientY : e.clientY;
      const delta = startY - clientY;
      let newValue = Math.max(0, Math.min(100, startValue + delta));

      activeKnob.dataset.value = newValue;
      updateKnobRotation(activeKnob, newValue);
      updateSynthParam(activeKnob.dataset.param, newValue);
    }

    document.addEventListener('mouseup', () => activeKnob = null);
    document.addEventListener('touchend', () => activeKnob = null);

    function updateKnobRotation(knob, value) {
      const rotation = (value / 100) * 270 - 135;
      knob.style.transform = `rotate(${rotation}deg)`;

      const param = knob.dataset.param;
      const valueEl = document.getElementById(param + 'Value');
      if (valueEl) {
        if (param === 'volume' || param === 'filter') {
          valueEl.textContent = value + '%';
        } else {
          valueEl.textContent = value + 'ms';
        }
      }
    }

    function updateSynthParam(param, value) {
      switch(param) {
        case 'volume':
          synth.volume = value / 100;
          if (masterGain) masterGain.gain.value = synth.volume;
          break;
        case 'attack':
          synth.attack = (value / 100) * 0.5;
          break;
        case 'decay':
          synth.decay = (value / 100) * 0.5;
          break;
        case 'filter':
          synth.filterFreq = (value / 100) * 8000 + 200;
          if (filterNode) filterNode.frequency.value = synth.filterFreq;
          break;
      }
    }

    // Initialize knob rotations
    document.querySelectorAll('.knob').forEach(knob => {
      updateKnobRotation(knob, parseInt(knob.dataset.value));
    });

    // Wave select
    document.querySelectorAll('.wave-btn').forEach(btn => {
      btn.onclick = () => {
        document.querySelectorAll('.wave-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        synth.waveform = btn.dataset.wave;
      };
    });

    // Presets
    const presets = {
      techno: [
        [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],
        [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
        [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
        [1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0]
      ],
      house: [
        [1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0],
        [0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0],
        [0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1],
        [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
        [1,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0]
      ],
      dnb: [
        [1,0,0,0,0,0,1,0,0,1,0,0,0,0,1,0],
        [0,0,0,0,1,0,0,0,0,0,0,0,1,0,0,0],
        [0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1],
        [1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1],
        [0,0,0,0,0,1,0,0,0,0,0,0,0,1,0,0],
        [0,1,0,0,0,0,0,0,0,1,0,0,0,0,0,0]
      ],
      ambient: [
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0],
        [0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0],
        [0,0,1,0,0,0,0,0,0,0,1,0,0,0,0,0],
        [0,0,0,0,0,0,1,0,0,0,0,0,0,0,1,0]
      ],
      clear: Array(ROWS).fill(null).map(() => Array(STEPS).fill(false))
    };

    function loadPreset(name) {
      const preset = presets[name];
      if (!preset) return;

      for (let r = 0; r < ROWS; r++) {
        for (let s = 0; s < STEPS; s++) {
          sequence[r][s] = preset[r][s] === 1 || preset[r][s] === true;
        }
      }

      buildSequencer();

      // Set tempo for genre
      if (name === 'techno') { tempo = 130; synth.waveform = 'square'; }
      if (name === 'house') { tempo = 124; synth.waveform = 'sine'; }
      if (name === 'dnb') { tempo = 174; synth.waveform = 'sawtooth'; }
      if (name === 'ambient') { tempo = 80; synth.waveform = 'sine'; }

      document.getElementById('tempoValue').textContent = tempo;
      document.querySelectorAll('.wave-btn').forEach(b => {
        b.classList.toggle('active', b.dataset.wave === synth.waveform);
      });

      if (isPlaying) {
        pauseSequencer();
        startSequencer();
      }
    }

    // Keyboard shortcut
    document.addEventListener('keydown', (e) => {
      if (e.code === 'Space') {
        e.preventDefault();
        togglePlay();
      }
    });

    // Build initial UI
    buildSequencer();
  </script>
<script src="/sloppy-header/sloppy-bar.js"></script>
<script src="/vibelib-extended.js"></script>
<script>
  // Compatibility Patch for Legacy Apps
  window.addEventListener("load", () => {
    if (window.SloppyKarma && window.VibeLib.Economy) {
      // Redirect old calls to new engine
      window.SloppyKarma.track = window.VibeLib.Economy.track;
    }
  });
</script>
</body>
</html>
