<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Gravity Flip - Pastel Puzzles</title>
  <link rel="icon" href="https://emojicdn.elk.sh/üîÑ">
  <meta property="og:title" content="Gravity Flip">
  <meta property="og:description" content="Flip gravity to solve pastel puzzles">
  <meta property="og:url" content="https://sloppy.live/gravity-flip">
  <meta property="og:image" content="https://emojicdn.elk.sh/üîÑ?style=apple&size=512">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg: #f8f6f4;
      --text: #5c5c5c;
      --text-light: #9c9c9c;
      --player: #e8b4b8;
      --platform: #d4c4e8;
      --goal: #c8e6d4;
      --hazard: #f5d5c8;
      --wall: #e8e4e0;
    }

    body {
      background: var(--bg);
      font-family: 'Nunito', sans-serif;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }

    .game-container {
      position: relative;
    }

    canvas {
      display: block;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
    }

    .ui {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      z-index: 100;
    }

    .level-info {
      font-size: 1rem;
      color: var(--text-light);
      margin-bottom: 4px;
    }

    .level-name {
      font-size: 1.4rem;
      font-weight: 700;
      color: var(--text);
    }

    .gravity-indicator {
      position: fixed;
      top: 100px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 1.5rem;
      transition: transform 0.3s ease;
    }

    .gravity-indicator.flipped {
      transform: translateX(-50%) rotate(180deg);
    }

    .controls-hint {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      color: var(--text-light);
      font-size: 0.85rem;
      text-align: center;
    }

    .flip-btn {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--player);
      border: none;
      width: 70px;
      height: 70px;
      border-radius: 50%;
      font-size: 1.8rem;
      cursor: pointer;
      box-shadow: 0 4px 16px rgba(232, 180, 184, 0.4);
      transition: transform 0.2s;
      display: none;
    }

    .flip-btn:active {
      transform: translateX(-50%) scale(0.95);
    }

    @media (max-width: 600px) {
      .flip-btn {
        display: block;
      }
    }

    .message {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 30px 40px;
      border-radius: 20px;
      text-align: center;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      z-index: 200;
      display: none;
    }

    .message h2 {
      color: var(--text);
      margin-bottom: 12px;
      font-size: 1.5rem;
    }

    .message p {
      color: var(--text-light);
      margin-bottom: 20px;
    }

    .btn {
      background: var(--player);
      color: white;
      border: none;
      padding: 12px 28px;
      border-radius: 25px;
      font-family: 'Nunito', sans-serif;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .btn:hover {
      transform: scale(1.05);
    }

    .legend {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: 0.75rem;
      color: var(--text-light);
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .legend-color {
      width: 16px;
      height: 16px;
      border-radius: 4px;
    }

    .backlink {
      position: fixed;
      bottom: 20px;
      left: 20px;
      color: var(--text-light);
      font-size: 0.7rem;
      text-decoration: none;
    }

    .backlink:hover {
      color: var(--text);
    }
  </style>
</head>
<body>
  <div class="ui">
    <div class="level-info">Level <span id="level-num">1</span> of <span id="total-levels">8</span></div>
    <div class="level-name" id="level-name">First Steps</div>
  </div>

  <div class="gravity-indicator" id="gravity-indicator">‚¨áÔ∏è</div>

  <div class="game-container">
    <canvas id="game"></canvas>
  </div>

  <button class="flip-btn" id="flip-btn">üîÑ</button>

  <div class="controls-hint">
    Space or Click to flip gravity ‚Ä¢ Arrow keys to move
  </div>

  <div class="legend">
    <div class="legend-item">
      <div class="legend-color" style="background: var(--player)"></div>
      <span>You</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: var(--goal)"></div>
      <span>Goal</span>
    </div>
    <div class="legend-item">
      <div class="legend-color" style="background: var(--hazard)"></div>
      <span>Avoid</span>
    </div>
  </div>

  <div class="message" id="complete-message">
    <h2>Level Complete! ‚ú®</h2>
    <p>You reached the goal</p>
    <button class="btn" id="next-btn">Next Level</button>
  </div>

  <div class="message" id="win-message">
    <h2>You Win! üéâ</h2>
    <p>All levels completed</p>
    <button class="btn" id="restart-btn">Play Again</button>
  </div>

  <a href="https://sloppy.live" class="backlink">sloppy.live</a>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    const TILE = 40;
    const COLS = 16;
    const ROWS = 12;
    canvas.width = COLS * TILE;
    canvas.height = ROWS * TILE;

    const COLORS = {
      bg: '#f8f6f4',
      player: '#e8b4b8',
      platform: '#d4c4e8',
      goal: '#c8e6d4',
      hazard: '#f5d5c8',
      wall: '#e8e4e0'
    };

    const levels = [
      { name: "First Steps", map: [
          "1111111111111111","1..............1","1..............1","1..............1",
          "1..............1","1P.............1","1222......2222.1","1..............1",
          "1..............1","1..........4...1","1..........22221","1111111111111111"
      ]},
      { name: "The Gap", map: [
          "1111111111111111","1..............1","1..............1","1P.............1",
          "12222....222...1","1..............1","1..............1","1.....222......1",
          "1..............1","1..........4...1","1......22222...1","1111111111111111"
      ]},
      { name: "Up and Over", map: [
          "1111111111111111","1..............1","122222.........1","1P.............1",
          "1....1111......1","1..............1","1..............1","1......1111....1",
          "1..............1","1..........4...1","1..........22221","1111111111111111"
      ]},
      { name: "Danger Zone", map: [
          "1111111111111111","1..............1","1..............1","1P.............1",
          "12222..........1","1.....333......1","1.....333......1","1..............1",
          "1..........4...1","1..........2...1","1..........2...1","1111111111111111"
      ]},
      { name: "Tight Squeeze", map: [
          "1111111111111111","1..1...........1","1..1...........1","1P.1......4....1",
          "12.1......22...1","1..1...........1","1..1...........1","1..1..1111111111",
          "1..1...........1","1..............1","1..............1","1111111111111111"
      ]},
      { name: "Hazard Maze", map: [
          "1111111111111111","1..............1","1P.....333.....1","1222...333.....1",
          "1..............1","1.....222222...1","1..............1","1...333........1",
          "1...333....4...1","1..........222.1","1..............1","1111111111111111"
      ]},
      { name: "The Climb", map: [
          "1111111111111111","1.........4....1","1.........22...1","1..............1",
          "1......22......1","1..............1","1...22.........1","1..............1",
          "122............1","1P.............1","1222...........1","1111111111111111"
      ]},
      { name: "Final Test", map: [
          "1111111111111111","1..3...........1","1..3.......4...1","1P.3.......2...1",
          "122.....11.....1","1..............1","1.....11.......1","1..3...........1",
          "1..3...........1","1..3.....222...1","1..3...........1","1111111111111111"
      ]}
    ];

    let currentLevel = 0;
    let gravityDown = true;
    let player = { x: 0, y: 0, vx: 0, vy: 0, width: TILE - 8, height: TILE - 8 };
    let tiles = [];
    let goal = null;
    let gameRunning = true;
    let keys = { left: false, right: false };

    function loadLevel(index) {
      const level = levels[index];
      tiles = [];
      goal = null;

      document.getElementById('level-num').textContent = index + 1;
      document.getElementById('total-levels').textContent = levels.length;
      document.getElementById('level-name').textContent = level.name;

      for (let row = 0; row < level.map.length; row++) {
        for (let col = 0; col < level.map[row].length; col++) {
          const char = level.map[row][col];
          const x = col * TILE;
          const y = row * TILE;

          if (char === 'P') {
            player.x = x + 4; player.y = y + 4; player.vx = 0; player.vy = 0;
          } else if (char === '1') {
            tiles.push({ x, y, w: TILE, h: TILE, type: 'wall' });
          } else if (char === '2') {
            tiles.push({ x, y, w: TILE, h: TILE, type: 'platform' });
          } else if (char === '3') {
            tiles.push({ x, y, w: TILE, h: TILE, type: 'hazard' });
          } else if (char === '4') {
            goal = { x, y, w: TILE, h: TILE };
          }
        }
      }

      gravityDown = true;
      updateGravityIndicator();
      gameRunning = true;
    }

    function flipGravity() {
      if (!gameRunning) return;
      gravityDown = !gravityDown;
      updateGravityIndicator();
    }

    function updateGravityIndicator() {
      document.getElementById('gravity-indicator').classList.toggle('flipped', !gravityDown);
    }

    function rectCollide(a, b) {
      return a.x < b.x + b.w && a.x + a.width > b.x && a.y < b.y + b.h && a.y + a.height > b.y;
    }

    function update(dt) {
      if (!gameRunning) return;

      let moveX = 0;
      if (keys.left) moveX = -1;
      if (keys.right) moveX = 1;

      player.vx = moveX * 200;
      const gravity = gravityDown ? 600 : -600;
      player.vy += gravity * dt;
      player.vy = Math.max(-400, Math.min(400, player.vy));

      player.x += player.vx * dt;
      tiles.forEach(tile => {
        if ((tile.type === 'wall' || tile.type === 'platform') && rectCollide(player, tile)) {
          if (player.vx > 0) player.x = tile.x - player.width;
          else if (player.vx < 0) player.x = tile.x + tile.w;
          player.vx = 0;
        }
      });

      player.y += player.vy * dt;
      tiles.forEach(tile => {
        if ((tile.type === 'wall' || tile.type === 'platform') && rectCollide(player, tile)) {
          if (player.vy > 0) player.y = tile.y - player.height;
          else if (player.vy < 0) player.y = tile.y + tile.h;
          player.vy = 0;
        }
      });

      tiles.forEach(tile => {
        if (tile.type === 'hazard' && rectCollide(player, tile)) loadLevel(currentLevel);
      });

      if (goal && rectCollide(player, goal)) levelComplete();
      if (player.y < 0 || player.y > canvas.height) loadLevel(currentLevel);
    }

    function levelComplete() {
      gameRunning = false;
      if (currentLevel >= levels.length - 1) {
        document.getElementById('win-message').style.display = 'block';
      } else {
        document.getElementById('complete-message').style.display = 'block';
      }
    }

    function roundRect(ctx, x, y, w, h, r) {
      ctx.beginPath();
      ctx.moveTo(x + r, y);
      ctx.lineTo(x + w - r, y);
      ctx.quadraticCurveTo(x + w, y, x + w, y + r);
      ctx.lineTo(x + w, y + h - r);
      ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
      ctx.lineTo(x + r, y + h);
      ctx.quadraticCurveTo(x, y + h, x, y + h - r);
      ctx.lineTo(x, y + r);
      ctx.quadraticCurveTo(x, y, x + r, y);
      ctx.closePath();
    }

    function draw() {
      ctx.fillStyle = COLORS.bg;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      ctx.strokeStyle = 'rgba(0, 0, 0, 0.03)';
      ctx.lineWidth = 1;
      for (let x = 0; x <= canvas.width; x += TILE) {
        ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, canvas.height); ctx.stroke();
      }
      for (let y = 0; y <= canvas.height; y += TILE) {
        ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(canvas.width, y); ctx.stroke();
      }

      tiles.forEach(tile => {
        ctx.fillStyle = COLORS[tile.type];
        if (tile.type === 'wall') {
          ctx.fillRect(tile.x, tile.y, tile.w, tile.h);
        } else {
          roundRect(ctx, tile.x + 2, tile.y + 2, tile.w - 4, tile.h - 4, 6);
          ctx.fill();
        }
      });

      if (goal) {
        ctx.fillStyle = COLORS.goal;
        roundRect(ctx, goal.x + 4, goal.y + 4, goal.w - 8, goal.h - 8, 8);
        ctx.fill();
        ctx.fillStyle = 'white';
        ctx.font = '20px sans-serif';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText('‚òÖ', goal.x + goal.w / 2, goal.y + goal.h / 2);
      }

      ctx.fillStyle = COLORS.player;
      roundRect(ctx, player.x, player.y, player.width, player.height, 8);
      ctx.fill();

      const faceY = gravityDown ? player.y + player.height * 0.35 : player.y + player.height * 0.65;
      ctx.fillStyle = '#5c5c5c';
      ctx.beginPath();
      ctx.arc(player.x + player.width * 0.35, faceY, 2.5, 0, Math.PI * 2);
      ctx.arc(player.x + player.width * 0.65, faceY, 2.5, 0, Math.PI * 2);
      ctx.fill();
    }

    document.addEventListener('keydown', e => {
      if (e.key === 'ArrowLeft' || e.key === 'a') keys.left = true;
      if (e.key === 'ArrowRight' || e.key === 'd') keys.right = true;
      if (e.key === ' ') { e.preventDefault(); flipGravity(); }
    });

    document.addEventListener('keyup', e => {
      if (e.key === 'ArrowLeft' || e.key === 'a') keys.left = false;
      if (e.key === 'ArrowRight' || e.key === 'd') keys.right = false;
    });

    canvas.addEventListener('click', flipGravity);
    document.getElementById('flip-btn').addEventListener('click', flipGravity);

    canvas.addEventListener('touchstart', e => { e.preventDefault(); flipGravity(); });
    canvas.addEventListener('touchmove', e => {
      e.preventDefault();
      const rect = canvas.getBoundingClientRect();
      const x = e.touches[0].clientX - rect.left;
      keys.left = x < rect.width / 3;
      keys.right = x > rect.width * 2 / 3;
    });
    canvas.addEventListener('touchend', () => { keys.left = false; keys.right = false; });

    document.getElementById('next-btn').addEventListener('click', () => {
      document.getElementById('complete-message').style.display = 'none';
      currentLevel++;
      loadLevel(currentLevel);
    });

    document.getElementById('restart-btn').addEventListener('click', () => {
      document.getElementById('win-message').style.display = 'none';
      currentLevel = 0;
      loadLevel(currentLevel);
    });

    let lastTime = 0;
    function animate(timestamp) {
      requestAnimationFrame(animate);
      const dt = Math.min((timestamp - lastTime) / 1000, 0.05);
      lastTime = timestamp;
      update(dt);
      draw();
    }

    loadLevel(0);
    animate(0);
  </script>
<script src="/sloppy-header/sloppy-bar.js"></script>
</body>
</html>
