<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>PIRATE LASER - Blast the Fog!</title>
  <link rel="icon" href="https://emojicdn.elk.sh/üè¥‚Äç‚ò†Ô∏è">
  <meta property="og:title" content="PIRATE LASER - Blast the Fog!">
  <meta property="og:description" content="Command your neon pirate ship and blast fog clouds with laser eyes!">
  <meta property="og:url" content="https://app.sloppy.live/pirate-laser">
  <meta property="og:image" content="https://emojicdn.elk.sh/‚ö°?style=apple&size=512">
  <link href="https://fonts.googleapis.com/css2?family=Pirata+One&family=Orbitron:wght@700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      min-height: 100vh;
      background: #05080f;
      font-family: 'Orbitron', sans-serif;
      overflow: hidden;
      cursor: crosshair;
    }
    .game-container {
      position: relative;
      width: 100vw;
      height: 100vh;
    }
    canvas { display: block; width: 100%; height: 100%; }
    .hud {
      position: absolute;
      top: 15px;
      left: 20px;
      right: 20px;
      display: flex;
      justify-content: space-between;
      pointer-events: none;
      z-index: 10;
    }
    .title {
      font-family: 'Pirata One', cursive;
      font-size: 1.5rem;
      color: #0ff;
      text-shadow: 0 0 20px #0ff, 0 0 40px #08f;
      letter-spacing: 0.05em;
    }
    .stats {
      text-align: right;
    }
    .score {
      font-size: 1rem;
      color: #f0f;
      text-shadow: 0 0 15px #f0f;
    }
    .combo {
      font-size: 0.7rem;
      color: #ff0;
      margin-top: 5px;
    }
    .overlay {
      position: absolute;
      inset: 0;
      background: rgba(5, 8, 15, 0.95);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 100;
      transition: opacity 0.5s;
    }
    .overlay.hidden { opacity: 0; pointer-events: none; }
    .overlay-title {
      font-family: 'Pirata One', cursive;
      font-size: 3rem;
      color: #0ff;
      text-shadow: 0 0 30px #0ff, 0 0 60px #f0f;
      margin-bottom: 10px;
    }
    .overlay-sub {
      font-size: 0.8rem;
      color: #888;
      margin-bottom: 30px;
      text-align: center;
    }
    .btn {
      font-family: 'Orbitron', sans-serif;
      font-size: 1rem;
      padding: 15px 40px;
      background: transparent;
      border: 2px solid #0ff;
      color: #0ff;
      cursor: pointer;
      letter-spacing: 0.1em;
      transition: all 0.2s;
    }
    .btn:hover {
      background: #0ff;
      color: #05080f;
      box-shadow: 0 0 30px #0ff;
    }
    .final-score {
      font-size: 2.5rem;
      color: #f0f;
      text-shadow: 0 0 20px #f0f;
      margin: 10px 0 20px;
    }
    .health-bar {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      width: 200px;
      height: 15px;
      background: rgba(0,0,0,0.5);
      border: 2px solid #0ff;
      border-radius: 8px;
      overflow: hidden;
    }
    .health-fill {
      height: 100%;
      background: linear-gradient(90deg, #f00, #ff0, #0f0);
      transition: width 0.2s;
    }
    .back-link {
      position: fixed;
      bottom: 5px;
      right: 10px;
      color: #0ff;
      text-decoration: none;
      font-size: 0.6rem;
      opacity: 0.4;
    }
  </style>
</head>
<body>
  <div class="game-container">
    <canvas id="canvas"></canvas>
    <div class="hud">
      <div class="title">üè¥‚Äç‚ò†Ô∏è PIRATE LASER</div>
      <div class="stats">
        <div class="score">SCORE: <span id="score">0</span></div>
        <div class="combo">FOG BLASTED: <span id="fogCount">0</span></div>
      </div>
    </div>
    <div class="health-bar">
      <div class="health-fill" id="healthFill" style="width: 100%"></div>
    </div>

    <div class="overlay" id="startOverlay">
      <div class="overlay-title">PIRATE LASER</div>
      <div class="overlay-sub">Click to shoot üëÅÔ∏è‚Äçüó®Ô∏è laser eyes at the fog!<br>Don't let fog reach your ship!</div>
      <button class="btn" id="startBtn">SET SAIL</button>
    </div>

    <div class="overlay hidden" id="gameOverOverlay">
      <div class="overlay-title">YE BE FOGGED!</div>
      <div class="final-score" id="finalScore">0</div>
      <button class="btn" id="restartBtn">SAIL AGAIN</button>
    </div>
  </div>
  <a href="https://sloppy.live" class="back-link">sloppy.live</a>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let gameRunning = false;
let frameCount = 0;
let score = 0;
let health = 100;
let fogBlasted = 0;
let mouseX = 0, mouseY = 0;

const ship = { x: 0, y: 0, width: 120, height: 80 };
const lasers = [];
const fogClouds = [];
const particles = [];
const explosions = [];

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  ship.x = canvas.width / 2;
  ship.y = canvas.height - 120;
}

function spawnFog() {
  const size = 40 + Math.random() * 60;
  fogClouds.push({
    x: 50 + Math.random() * (canvas.width - 100),
    y: -size,
    size,
    speed: 1 + Math.random() * 2 + score / 500,
    wobble: Math.random() * Math.PI * 2,
    alpha: 0.6 + Math.random() * 0.3,
    health: Math.ceil(size / 30)
  });
}

function shootLaser(targetX, targetY) {
  const angle = Math.atan2(targetY - ship.y, targetX - ship.x);
  lasers.push({
    x: ship.x,
    y: ship.y - 30,
    vx: Math.cos(angle) * 15,
    vy: Math.sin(angle) * 15,
    angle
  });
}

function spawnParticle(x, y, color, count = 6) {
  for (let i = 0; i < count; i++) {
    const angle = Math.random() * Math.PI * 2;
    particles.push({
      x, y,
      vx: Math.cos(angle) * (2 + Math.random() * 4),
      vy: Math.sin(angle) * (2 + Math.random() * 4),
      radius: 2 + Math.random() * 4,
      color,
      alpha: 1
    });
  }
}

function spawnExplosion(x, y) {
  explosions.push({
    x, y,
    radius: 10,
    maxRadius: 50 + Math.random() * 30,
    alpha: 1
  });
}

function update() {
  if (!gameRunning) return;

  frameCount++;

  // Spawn fog
  const spawnRate = Math.max(30, 90 - Math.floor(score / 50));
  if (frameCount % spawnRate === 0) {
    spawnFog();
  }

  // Update lasers
  for (let i = lasers.length - 1; i >= 0; i--) {
    const laser = lasers[i];
    laser.x += laser.vx;
    laser.y += laser.vy;

    // Check fog collision
    for (let j = fogClouds.length - 1; j >= 0; j--) {
      const fog = fogClouds[j];
      const dx = laser.x - fog.x;
      const dy = laser.y - fog.y;
      const dist = Math.sqrt(dx * dx + dy * dy);

      if (dist < fog.size * 0.6) {
        fog.health--;
        spawnParticle(laser.x, laser.y, '#0ff', 4);
        lasers.splice(i, 1);

        if (fog.health <= 0) {
          score += Math.floor(fog.size);
          fogBlasted++;
          document.getElementById('score').textContent = score;
          document.getElementById('fogCount').textContent = fogBlasted;
          spawnExplosion(fog.x, fog.y);
          spawnParticle(fog.x, fog.y, '#88f', 12);
          fogClouds.splice(j, 1);
        }
        break;
      }
    }

    // Remove off-screen lasers
    if (laser.x < -50 || laser.x > canvas.width + 50 ||
        laser.y < -50 || laser.y > canvas.height + 50) {
      lasers.splice(i, 1);
    }
  }

  // Update fog
  for (let i = fogClouds.length - 1; i >= 0; i--) {
    const fog = fogClouds[i];
    fog.y += fog.speed;
    fog.wobble += 0.03;
    fog.x += Math.sin(fog.wobble) * 0.5;

    // Check if fog reached ship
    if (fog.y > ship.y - fog.size * 0.5) {
      health -= 10;
      document.getElementById('healthFill').style.width = health + '%';
      spawnParticle(fog.x, fog.y, '#666', 8);
      fogClouds.splice(i, 1);

      if (health <= 0) {
        gameOver();
      }
    }
  }

  // Update particles
  for (let i = particles.length - 1; i >= 0; i--) {
    const p = particles[i];
    p.x += p.vx;
    p.y += p.vy;
    p.vy += 0.1;
    p.alpha -= 0.03;
    if (p.alpha <= 0) particles.splice(i, 1);
  }

  // Update explosions
  for (let i = explosions.length - 1; i >= 0; i--) {
    const e = explosions[i];
    e.radius += 4;
    e.alpha -= 0.05;
    if (e.alpha <= 0) explosions.splice(i, 1);
  }
}

function drawShip() {
  ctx.save();
  ctx.translate(ship.x, ship.y);

  // Ship glow
  const glow = ctx.createRadialGradient(0, 0, 10, 0, 0, 80);
  glow.addColorStop(0, 'rgba(0, 255, 255, 0.3)');
  glow.addColorStop(1, 'transparent');
  ctx.fillStyle = glow;
  ctx.beginPath();
  ctx.arc(0, 0, 80, 0, Math.PI * 2);
  ctx.fill();

  // Hull
  ctx.fillStyle = '#1a1a2e';
  ctx.strokeStyle = '#0ff';
  ctx.lineWidth = 3;
  ctx.shadowColor = '#0ff';
  ctx.shadowBlur = 20;

  ctx.beginPath();
  ctx.moveTo(-50, 20);
  ctx.lineTo(-60, 0);
  ctx.lineTo(-40, -30);
  ctx.lineTo(40, -30);
  ctx.lineTo(60, 0);
  ctx.lineTo(50, 20);
  ctx.closePath();
  ctx.fill();
  ctx.stroke();

  // Mast
  ctx.strokeStyle = '#f0f';
  ctx.lineWidth = 4;
  ctx.beginPath();
  ctx.moveTo(0, -30);
  ctx.lineTo(0, -80);
  ctx.stroke();

  // Sail (neon triangle)
  ctx.fillStyle = 'rgba(255, 0, 255, 0.3)';
  ctx.strokeStyle = '#f0f';
  ctx.lineWidth = 2;
  ctx.beginPath();
  ctx.moveTo(0, -75);
  ctx.lineTo(35, -35);
  ctx.lineTo(0, -35);
  ctx.closePath();
  ctx.fill();
  ctx.stroke();

  // Skull emblem
  ctx.fillStyle = '#fff';
  ctx.font = '20px serif';
  ctx.textAlign = 'center';
  ctx.shadowBlur = 10;
  ctx.fillText('‚ò†Ô∏è', 0, 0);

  // Cannons (eyes that shoot)
  ctx.fillStyle = '#ff0';
  ctx.shadowColor = '#ff0';
  ctx.shadowBlur = 15;
  ctx.beginPath();
  ctx.arc(-25, -20, 8, 0, Math.PI * 2);
  ctx.arc(25, -20, 8, 0, Math.PI * 2);
  ctx.fill();

  // Laser aim lines
  const aimAngle = Math.atan2(mouseY - ship.y, mouseX - ship.x);
  ctx.strokeStyle = 'rgba(255, 255, 0, 0.3)';
  ctx.lineWidth = 1;
  ctx.setLineDash([5, 10]);
  ctx.beginPath();
  ctx.moveTo(0, -30);
  ctx.lineTo(Math.cos(aimAngle) * 200, Math.sin(aimAngle) * 200 - 30);
  ctx.stroke();
  ctx.setLineDash([]);

  ctx.restore();
}

function drawLaser(laser) {
  ctx.save();
  ctx.translate(laser.x, laser.y);
  ctx.rotate(laser.angle);

  // Laser glow
  ctx.shadowColor = '#ff0';
  ctx.shadowBlur = 20;

  // Emoji laser eye
  ctx.font = '30px serif';
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText('üëÅÔ∏è‚Äçüó®Ô∏è', 0, 0);

  // Trail
  ctx.strokeStyle = '#ff0';
  ctx.lineWidth = 3;
  ctx.beginPath();
  ctx.moveTo(-20, 0);
  ctx.lineTo(-50, 0);
  ctx.stroke();

  ctx.restore();
}

function drawFog(fog) {
  ctx.save();
  ctx.translate(fog.x, fog.y);
  ctx.globalAlpha = fog.alpha;

  // Multiple cloud puffs
  const puffs = [
    [0, 0, 1], [-0.5, 0.2, 0.7], [0.5, 0.2, 0.7],
    [-0.3, -0.3, 0.6], [0.3, -0.3, 0.6]
  ];

  for (const [px, py, scale] of puffs) {
    const x = px * fog.size;
    const y = py * fog.size;
    const r = fog.size * 0.4 * scale;

    const fogGrad = ctx.createRadialGradient(x, y, 0, x, y, r);
    fogGrad.addColorStop(0, 'rgba(150, 150, 170, 0.8)');
    fogGrad.addColorStop(0.5, 'rgba(100, 100, 120, 0.5)');
    fogGrad.addColorStop(1, 'transparent');

    ctx.fillStyle = fogGrad;
    ctx.beginPath();
    ctx.arc(x, y, r, 0, Math.PI * 2);
    ctx.fill();
  }

  // Angry face on fog
  ctx.fillStyle = '#333';
  ctx.font = `${fog.size * 0.4}px serif`;
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText('üò§', 0, 0);

  ctx.restore();
}

function drawExplosion(e) {
  ctx.globalAlpha = e.alpha;
  const grad = ctx.createRadialGradient(e.x, e.y, 0, e.x, e.y, e.radius);
  grad.addColorStop(0, '#fff');
  grad.addColorStop(0.3, '#0ff');
  grad.addColorStop(0.6, '#f0f');
  grad.addColorStop(1, 'transparent');
  ctx.fillStyle = grad;
  ctx.beginPath();
  ctx.arc(e.x, e.y, e.radius, 0, Math.PI * 2);
  ctx.fill();
  ctx.globalAlpha = 1;
}

function drawParticles() {
  for (const p of particles) {
    ctx.globalAlpha = p.alpha;
    ctx.fillStyle = p.color;
    ctx.shadowColor = p.color;
    ctx.shadowBlur = 10;
    ctx.beginPath();
    ctx.arc(p.x, p.y, p.radius, 0, Math.PI * 2);
    ctx.fill();
  }
  ctx.globalAlpha = 1;
  ctx.shadowBlur = 0;
}

function drawWater() {
  // Animated waves
  ctx.fillStyle = '#0a1525';
  ctx.beginPath();
  ctx.moveTo(0, canvas.height);
  for (let x = 0; x <= canvas.width; x += 30) {
    const y = canvas.height - 40 + Math.sin(x * 0.02 + frameCount * 0.05) * 10;
    ctx.lineTo(x, y);
  }
  ctx.lineTo(canvas.width, canvas.height);
  ctx.fill();

  // Wave highlights
  ctx.strokeStyle = 'rgba(0, 255, 255, 0.2)';
  ctx.lineWidth = 2;
  ctx.beginPath();
  for (let x = 0; x <= canvas.width; x += 30) {
    const y = canvas.height - 40 + Math.sin(x * 0.02 + frameCount * 0.05) * 10;
    if (x === 0) ctx.moveTo(x, y);
    else ctx.lineTo(x, y);
  }
  ctx.stroke();
}

function render() {
  // Sky gradient
  const sky = ctx.createLinearGradient(0, 0, 0, canvas.height);
  sky.addColorStop(0, '#05080f');
  sky.addColorStop(0.7, '#0a1020');
  sky.addColorStop(1, '#0a1525');
  ctx.fillStyle = sky;
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // Stars
  ctx.fillStyle = '#fff';
  for (let i = 0; i < 80; i++) {
    const x = (i * 137 + frameCount * 0.1) % canvas.width;
    const y = (i * 89) % (canvas.height * 0.6);
    const twinkle = 0.3 + Math.sin(frameCount * 0.05 + i) * 0.3;
    ctx.globalAlpha = twinkle;
    ctx.beginPath();
    ctx.arc(x, y, 1, 0, Math.PI * 2);
    ctx.fill();
  }
  ctx.globalAlpha = 1;

  // Draw explosions behind fog
  for (const e of explosions) {
    drawExplosion(e);
  }

  // Draw fog clouds
  for (const fog of fogClouds) {
    drawFog(fog);
  }

  drawWater();
  drawShip();

  // Draw lasers
  for (const laser of lasers) {
    drawLaser(laser);
  }

  drawParticles();

  // Vignette
  const vignette = ctx.createRadialGradient(
    canvas.width / 2, canvas.height / 2, canvas.height * 0.5,
    canvas.width / 2, canvas.height / 2, canvas.height
  );
  vignette.addColorStop(0, 'transparent');
  vignette.addColorStop(1, 'rgba(0, 0, 0, 0.5)');
  ctx.fillStyle = vignette;
  ctx.fillRect(0, 0, canvas.width, canvas.height);
}

function gameLoop() {
  update();
  render();
  requestAnimationFrame(gameLoop);
}

function startGame() {
  document.getElementById('startOverlay').classList.add('hidden');
  document.getElementById('gameOverOverlay').classList.add('hidden');

  lasers.length = 0;
  fogClouds.length = 0;
  particles.length = 0;
  explosions.length = 0;
  frameCount = 0;
  score = 0;
  health = 100;
  fogBlasted = 0;

  document.getElementById('score').textContent = '0';
  document.getElementById('fogCount').textContent = '0';
  document.getElementById('healthFill').style.width = '100%';

  gameRunning = true;
}

function gameOver() {
  gameRunning = false;
  document.getElementById('finalScore').textContent = score;
  document.getElementById('gameOverOverlay').classList.remove('hidden');
}

// Events
document.getElementById('startBtn').addEventListener('click', startGame);
document.getElementById('restartBtn').addEventListener('click', startGame);

canvas.addEventListener('mousemove', e => {
  mouseX = e.clientX;
  mouseY = e.clientY;
});

canvas.addEventListener('click', e => {
  if (gameRunning) {
    shootLaser(e.clientX, e.clientY);
  }
});

canvas.addEventListener('touchstart', e => {
  e.preventDefault();
  if (gameRunning) {
    const touch = e.touches[0];
    mouseX = touch.clientX;
    mouseY = touch.clientY;
    shootLaser(touch.clientX, touch.clientY);
  }
});

canvas.addEventListener('touchmove', e => {
  e.preventDefault();
  mouseX = e.touches[0].clientX;
  mouseY = e.touches[0].clientY;
});

window.addEventListener('resize', resize);

resize();
gameLoop();
</script>
<script src="/sloppy-header/sloppy-bar.js"></script>
<script src="/vibelib-extended.js"></script>
<script>
  // Compatibility Patch for Legacy Apps
  window.addEventListener("load", () => {
    if (window.SloppyKarma && window.VibeLib.Economy) {
      // Redirect old calls to new engine
      window.SloppyKarma.track = window.VibeLib.Economy.track;
    }
  });
</script>
</body>
</html>
