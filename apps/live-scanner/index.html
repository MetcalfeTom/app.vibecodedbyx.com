<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Live Security Scanner</title>
  <link rel="icon" href="https://emojicdn.elk.sh/üîç">

  <meta property="og:title" content="Live Security Scanner">
  <meta property="og:description" content="Scan apps for exposed credentials and secrets">
  <meta property="og:url" content="https://app.sloppy.live/live-scanner">
  <meta property="og:image" content="https://app.sloppy.live/live-scanner/og-image.png">
  <meta property="og:type" content="website">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg: #0a0a0f;
      --bg-card: #12121a;
      --border: #2a2a3a;
      --text: #e0e0e0;
      --text-dim: #666;
      --neon-green: #0f0;
      --neon-red: #f00;
      --neon-yellow: #ff0;
      --neon-cyan: #0ff;
      --neon-orange: #f90;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'JetBrains Mono', monospace;
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.5;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 40px 24px;
    }

    header {
      text-align: center;
      margin-bottom: 40px;
    }

    h1 {
      font-size: 2rem;
      color: var(--neon-green);
      text-shadow: 0 0 20px rgba(0,255,0,0.5);
      margin-bottom: 8px;
    }

    .subtitle {
      color: var(--text-dim);
      font-size: 0.9rem;
    }

    /* Stats */
    .stats {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin: 30px 0;
      flex-wrap: wrap;
    }

    .stat {
      text-align: center;
    }

    .stat-value {
      font-size: 2.5rem;
      font-weight: 700;
    }

    .stat-value.critical { color: var(--neon-red); text-shadow: 0 0 10px var(--neon-red); }
    .stat-value.high { color: var(--neon-orange); text-shadow: 0 0 10px var(--neon-orange); }
    .stat-value.medium { color: var(--neon-yellow); text-shadow: 0 0 10px var(--neon-yellow); }
    .stat-value.clean { color: var(--neon-green); text-shadow: 0 0 10px var(--neon-green); }

    .stat-label {
      font-size: 0.75rem;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.1em;
    }

    /* Controls */
    .controls {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 12px 24px;
      background: var(--bg-card);
      border: 2px solid var(--neon-green);
      color: var(--neon-green);
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
      text-transform: uppercase;
      letter-spacing: 0.05em;
    }

    .btn:hover:not(:disabled) {
      background: var(--neon-green);
      color: #000;
      box-shadow: 0 0 20px rgba(0,255,0,0.4);
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .btn.stop {
      border-color: var(--neon-red);
      color: var(--neon-red);
    }

    .btn.stop:hover:not(:disabled) {
      background: var(--neon-red);
      color: #000;
    }

    /* Progress */
    .progress-container {
      background: var(--bg-card);
      border: 1px solid var(--border);
      padding: 20px;
      margin-bottom: 30px;
    }

    .progress-header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
      font-size: 0.85rem;
    }

    .progress-bar {
      height: 8px;
      background: var(--border);
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: var(--neon-green);
      box-shadow: 0 0 10px var(--neon-green);
      transition: width 0.3s;
      width: 0%;
    }

    .current-scan {
      margin-top: 10px;
      font-size: 0.8rem;
      color: var(--text-dim);
    }

    /* Results */
    .results {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .finding {
      background: var(--bg-card);
      border-left: 4px solid;
      padding: 16px;
    }

    .finding.critical { border-color: var(--neon-red); }
    .finding.high { border-color: var(--neon-orange); }
    .finding.medium { border-color: var(--neon-yellow); }

    .finding-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
      margin-bottom: 12px;
      flex-wrap: wrap;
    }

    .finding-app {
      font-weight: 600;
      color: var(--neon-cyan);
    }

    .severity-badge {
      padding: 4px 10px;
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      border: 1px solid;
    }

    .severity-badge.critical {
      color: var(--neon-red);
      border-color: var(--neon-red);
      background: rgba(255,0,0,0.1);
    }

    .severity-badge.high {
      color: var(--neon-orange);
      border-color: var(--neon-orange);
      background: rgba(255,153,0,0.1);
    }

    .severity-badge.medium {
      color: var(--neon-yellow);
      border-color: var(--neon-yellow);
      background: rgba(255,255,0,0.1);
    }

    .finding-type {
      font-size: 0.9rem;
      margin-bottom: 8px;
    }

    .finding-match {
      background: #000;
      border: 1px solid var(--border);
      padding: 10px;
      font-size: 0.8rem;
      overflow-x: auto;
      margin-top: 8px;
      word-break: break-all;
    }

    .finding-match .redacted {
      color: var(--neon-red);
      background: rgba(255,0,0,0.2);
      padding: 0 4px;
    }

    .finding-line {
      color: var(--text-dim);
      font-size: 0.75rem;
      margin-top: 8px;
    }

    /* Log */
    .log-container {
      background: #000;
      border: 1px solid var(--neon-green);
      padding: 16px;
      max-height: 200px;
      overflow-y: auto;
      font-size: 0.8rem;
      margin-top: 30px;
    }

    .log-entry {
      margin-bottom: 4px;
      opacity: 0.8;
    }

    .log-entry.error { color: var(--neon-red); }
    .log-entry.success { color: var(--neon-green); }
    .log-entry.warning { color: var(--neon-yellow); }

    /* Filter tabs */
    .filter-tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .filter-tab {
      padding: 8px 16px;
      background: var(--bg-card);
      border: 1px solid var(--border);
      color: var(--text-dim);
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .filter-tab:hover {
      border-color: var(--text);
      color: var(--text);
    }

    .filter-tab.active {
      border-color: var(--neon-cyan);
      color: var(--neon-cyan);
      background: rgba(0,255,255,0.1);
    }

    footer {
      text-align: center;
      margin-top: 40px;
      padding-top: 20px;
      border-top: 1px solid var(--border);
      color: var(--text-dim);
      font-size: 0.8rem;
    }

    footer a {
      color: var(--neon-cyan);
      text-decoration: none;
    }

    @media (max-width: 600px) {
      h1 { font-size: 1.5rem; }
      .stats { gap: 20px; }
      .stat-value { font-size: 1.8rem; }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>üîç LIVE SECURITY SCANNER</h1>
      <p class="subtitle">Scanning apps for exposed credentials and secrets</p>
    </header>

    <div class="stats">
      <div class="stat">
        <div class="stat-value critical" id="criticalCount">0</div>
        <div class="stat-label">Critical</div>
      </div>
      <div class="stat">
        <div class="stat-value high" id="highCount">0</div>
        <div class="stat-label">High</div>
      </div>
      <div class="stat">
        <div class="stat-value medium" id="mediumCount">0</div>
        <div class="stat-label">Medium</div>
      </div>
      <div class="stat">
        <div class="stat-value clean" id="scannedCount">0</div>
        <div class="stat-label">Scanned</div>
      </div>
    </div>

    <div class="controls">
      <button class="btn" id="startBtn" onclick="startScan()">Start Scan</button>
      <button class="btn stop" id="stopBtn" onclick="stopScan()" disabled>Stop</button>
    </div>

    <div class="progress-container">
      <div class="progress-header">
        <span id="progressText">Ready to scan</span>
        <span id="progressPercent">0%</span>
      </div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="current-scan" id="currentScan">&gt; Waiting...</div>
    </div>

    <div class="filter-tabs">
      <button class="filter-tab active" data-filter="all" onclick="filterResults('all')">All</button>
      <button class="filter-tab" data-filter="critical" onclick="filterResults('critical')">Critical</button>
      <button class="filter-tab" data-filter="high" onclick="filterResults('high')">High</button>
      <button class="filter-tab" data-filter="medium" onclick="filterResults('medium')">Medium</button>
    </div>

    <div class="results" id="results"></div>

    <div class="log-container" id="logContainer">
      <div class="log-entry">&gt; Scanner initialized</div>
    </div>

    <footer>
      <p>Security tool from <a href="https://sloppy.live" target="_blank">sloppy.live</a></p>
    </footer>
  </div>

  <script>
    // Detection patterns for credentials and secrets
    const patterns = [
      {
        name: 'Supabase API Key',
        severity: 'critical',
        regex: /eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9\.[A-Za-z0-9_-]+\.[A-Za-z0-9_-]+/g,
        description: 'Exposed Supabase/JWT token'
      },
      {
        name: 'Supabase URL',
        severity: 'high',
        regex: /https:\/\/[a-z0-9]+\.supabase\.co/gi,
        description: 'Supabase project URL exposed'
      },
      {
        name: 'API Key Pattern',
        severity: 'critical',
        regex: /['"]?(?:api[_-]?key|apikey)['"]?\s*[:=]\s*['"][a-zA-Z0-9_-]{20,}['"]/gi,
        description: 'Hardcoded API key'
      },
      {
        name: 'Secret/Token',
        severity: 'critical',
        regex: /['"]?(?:secret|token|password|passwd|pwd)['"]?\s*[:=]\s*['"][^'"]{8,}['"]/gi,
        description: 'Hardcoded secret or token'
      },
      {
        name: 'AWS Access Key',
        severity: 'critical',
        regex: /AKIA[0-9A-Z]{16}/g,
        description: 'AWS Access Key ID'
      },
      {
        name: 'AWS Secret Key',
        severity: 'critical',
        regex: /['"][A-Za-z0-9\/+=]{40}['"]/g,
        description: 'Potential AWS Secret Key'
      },
      {
        name: 'Private Key',
        severity: 'critical',
        regex: /-----BEGIN\s+(RSA\s+)?PRIVATE\s+KEY-----/g,
        description: 'Private key in source'
      },
      {
        name: 'OpenAI API Key',
        severity: 'critical',
        regex: /sk-[a-zA-Z0-9]{48}/g,
        description: 'OpenAI API key'
      },
      {
        name: 'Stripe Key',
        severity: 'critical',
        regex: /(?:sk|pk)_(?:test|live)_[a-zA-Z0-9]{24,}/g,
        description: 'Stripe API key'
      },
      {
        name: 'GitHub Token',
        severity: 'critical',
        regex: /ghp_[a-zA-Z0-9]{36}/g,
        description: 'GitHub personal access token'
      },
      {
        name: 'Slack Token',
        severity: 'high',
        regex: /xox[baprs]-[0-9a-zA-Z-]+/g,
        description: 'Slack token'
      },
      {
        name: 'Discord Token',
        severity: 'high',
        regex: /[MN][A-Za-z\d]{23,}\.[\w-]{6}\.[\w-]{27}/g,
        description: 'Discord bot token'
      },
      {
        name: 'Google API Key',
        severity: 'high',
        regex: /AIza[0-9A-Za-z_-]{35}/g,
        description: 'Google API key'
      },
      {
        name: 'Firebase Config',
        severity: 'medium',
        regex: /['"]?(?:firebase|firebaseConfig)['"]?\s*[:=]\s*\{[^}]+apiKey/gi,
        description: 'Firebase configuration with API key'
      },
      {
        name: 'Basic Auth Header',
        severity: 'high',
        regex: /Authorization['"]?\s*[:=]\s*['"]Basic\s+[A-Za-z0-9+/=]+['"]/gi,
        description: 'Hardcoded Basic Auth'
      },
      {
        name: 'Bearer Token',
        severity: 'high',
        regex: /Authorization['"]?\s*[:=]\s*['"]Bearer\s+[A-Za-z0-9._-]+['"]/gi,
        description: 'Hardcoded Bearer token'
      },
      {
        name: 'Database URL',
        severity: 'high',
        regex: /(?:postgres|mysql|mongodb):\/\/[^'">\s]+:[^'">\s]+@[^'">\s]+/gi,
        description: 'Database connection string with credentials'
      },
      {
        name: 'Hex Encoded Secret',
        severity: 'medium',
        regex: /['"]?(?:key|secret|token)['"]?\s*[:=]\s*['"][a-f0-9]{32,}['"]/gi,
        description: 'Hex-encoded secret value'
      }
    ];

    // App list (subset for demo - add more as needed)
    const apps = [
      'sloppygram', 'confession-wall', 'cosmic-chat', 'simple-chat', 'toiletgram',
      'graffiti-wall', 'neon-guestbook', 'knowledge-chaos', 'gratitude-journal',
      'accountability-hub', 'calorie-tracker', 'breakout-terminal', 'tetris',
      'snake', 'asteroids', 'space-invaders', 'icy-tower', 'star-catcher',
      'btc-tracker', 'solana-tracker', 'crypto-tools', 'bags-tracker',
      'synth', 'drum-machine', 'oscillator', 'neon-synth',
      'lava-lamp', 'fractal-dance', 'kaleidoscope', 'disco-ball',
      'sloppys-gift', 'sloppys-manifesto', 'gift-gallery', 'app-taxonomist',
      'claudes-digital-diary', 'genealogist', 'origins', 'federated-truth',
      'cat-pics', 'news-gen', 'fake-reviews', 'deprecated-trivia',
      'neon-pet', 'cozy-pet', 'angry-cookie', 'beef-clicker',
      'win95', 'xp-desktop', 'vhs-deck', 'crt-calculator',
      'doom-3d', 'minecraft', 'pokemon-clone', 'pho-game'
    ];

    let scanning = false;
    let findings = [];
    let scannedCount = 0;

    function log(message, type = 'info') {
      const logContainer = document.getElementById('logContainer');
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      entry.textContent = `> ${new Date().toLocaleTimeString()} - ${message}`;
      logContainer.appendChild(entry);
      logContainer.scrollTop = logContainer.scrollHeight;
    }

    function updateStats() {
      const critical = findings.filter(f => f.severity === 'critical').length;
      const high = findings.filter(f => f.severity === 'high').length;
      const medium = findings.filter(f => f.severity === 'medium').length;

      document.getElementById('criticalCount').textContent = critical;
      document.getElementById('highCount').textContent = high;
      document.getElementById('mediumCount').textContent = medium;
      document.getElementById('scannedCount').textContent = scannedCount;
    }

    function updateProgress(current, total, appName) {
      const percent = Math.round((current / total) * 100);
      document.getElementById('progressFill').style.width = percent + '%';
      document.getElementById('progressPercent').textContent = percent + '%';
      document.getElementById('progressText').textContent = `Scanning ${current}/${total} apps`;
      document.getElementById('currentScan').textContent = `> Scanning: ${appName}`;
    }

    function redactSecret(match) {
      if (match.length <= 16) return match;
      const visible = 8;
      return match.slice(0, visible) + '‚ñà'.repeat(Math.min(match.length - visible * 2, 20)) + match.slice(-visible);
    }

    function renderFindings(filter = 'all') {
      const resultsEl = document.getElementById('results');
      let filtered = findings;

      if (filter !== 'all') {
        filtered = findings.filter(f => f.severity === filter);
      }

      if (filtered.length === 0) {
        resultsEl.innerHTML = `<div style="text-align: center; padding: 40px; color: var(--text-dim);">
          ${scanning ? 'Scanning in progress...' : 'No findings yet. Start a scan to detect exposed credentials.'}
        </div>`;
        return;
      }

      resultsEl.innerHTML = filtered.map(f => `
        <div class="finding ${f.severity}" data-severity="${f.severity}">
          <div class="finding-header">
            <span class="finding-app">${f.app}</span>
            <span class="severity-badge ${f.severity}">${f.severity}</span>
          </div>
          <div class="finding-type">${f.patternName}: ${f.description}</div>
          <div class="finding-match">
            <span class="redacted">${redactSecret(f.match)}</span>
          </div>
          <div class="finding-line">Found in source code</div>
        </div>
      `).join('');
    }

    function filterResults(filter) {
      document.querySelectorAll('.filter-tab').forEach(tab => {
        tab.classList.toggle('active', tab.dataset.filter === filter);
      });
      renderFindings(filter);
    }

    async function scanApp(appName) {
      try {
        const url = `https://app.sloppy.live/${appName}/index.html`;
        const response = await fetch(url);

        if (!response.ok) {
          log(`Failed to fetch ${appName}: ${response.status}`, 'error');
          return;
        }

        const html = await response.text();

        // Scan for each pattern
        for (const pattern of patterns) {
          const matches = html.match(pattern.regex);
          if (matches) {
            for (const match of matches) {
              // Avoid duplicate findings
              const exists = findings.some(f =>
                f.app === appName && f.patternName === pattern.name && f.match === match
              );

              if (!exists) {
                findings.push({
                  app: appName,
                  patternName: pattern.name,
                  severity: pattern.severity,
                  description: pattern.description,
                  match: match.slice(0, 100) // Truncate long matches
                });

                log(`Found ${pattern.severity.toUpperCase()}: ${pattern.name} in ${appName}`,
                    pattern.severity === 'critical' ? 'error' : 'warning');
              }
            }
          }
        }

      } catch (error) {
        log(`Error scanning ${appName}: ${error.message}`, 'error');
      }
    }

    async function startScan() {
      if (scanning) return;

      scanning = true;
      findings = [];
      scannedCount = 0;

      document.getElementById('startBtn').disabled = true;
      document.getElementById('stopBtn').disabled = false;

      log('Starting security scan...', 'success');
      renderFindings();
      updateStats();

      for (let i = 0; i < apps.length && scanning; i++) {
        const app = apps[i];
        updateProgress(i + 1, apps.length, app);

        await scanApp(app);
        scannedCount++;
        updateStats();
        renderFindings();

        // Small delay to prevent overwhelming the server
        await new Promise(r => setTimeout(r, 200));
      }

      scanning = false;
      document.getElementById('startBtn').disabled = false;
      document.getElementById('stopBtn').disabled = true;

      if (scannedCount === apps.length) {
        log(`Scan complete. Scanned ${scannedCount} apps, found ${findings.length} issues.`, 'success');
        document.getElementById('currentScan').textContent = '> Scan complete';
      } else {
        log('Scan stopped.', 'warning');
      }
    }

    function stopScan() {
      scanning = false;
      log('Stopping scan...', 'warning');
      document.getElementById('stopBtn').disabled = true;
    }

    // Initialize
    renderFindings();
  </script>
<script src="/sloppy-header/sloppy-bar.js"></script>
<script src="/vibelib-extended.js"></script>
<script>
  // Compatibility Patch for Legacy Apps
  window.addEventListener("load", () => {
    if (window.SloppyKarma && window.VibeLib.Economy) {
      // Redirect old calls to new engine
      window.SloppyKarma.track = window.VibeLib.Economy.track;
    }
  });
</script>
</body>
</html>
