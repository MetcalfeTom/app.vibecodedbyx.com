<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sticker Workshop - Create Cute Emoji Stickers</title>
  <meta name="description" content="Mix and match emojis to create your own digital stickers">
  <meta property="og:title" content="Sticker Workshop">
  <meta property="og:description" content="Create cute custom emoji stickers by mixing and matching icons">
  <meta property="og:url" content="https://app.sloppy.live/sticker-workshop">
  <meta property="og:image" content="https://app.sloppy.live/sticker-workshop/og-image.png">
  <link rel="icon" href="https://emojicdn.elk.sh/‚ú®">
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --pink: #ff6b9d;
      --purple: #c44dff;
      --blue: #4d9dff;
      --mint: #4dffc3;
      --yellow: #ffe14d;
      --peach: #ffb38a;
      --bg: #fef6ff;
      --card: #ffffff;
      --text: #4a3f5c;
      --text-light: #8a7fa0;
    }

    body {
      min-height: 100vh;
      background: var(--bg);
      background-image:
        radial-gradient(circle at 20% 80%, rgba(255, 107, 157, 0.1) 0%, transparent 30%),
        radial-gradient(circle at 80% 20%, rgba(196, 77, 255, 0.1) 0%, transparent 30%);
      font-family: 'Nunito', sans-serif;
      color: var(--text);
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      margin-bottom: 20px;
    }

    h1 {
      font-size: 28px;
      font-weight: 800;
      background: linear-gradient(135deg, var(--pink), var(--purple));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .subtitle {
      font-size: 14px;
      color: var(--text-light);
    }

    .workshop {
      display: grid;
      grid-template-columns: 1fr 280px;
      gap: 20px;
    }

    @media (max-width: 700px) {
      .workshop {
        grid-template-columns: 1fr;
      }
    }

    .canvas-area {
      background: var(--card);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
    }

    .canvas-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .canvas-title {
      font-weight: 600;
      font-size: 14px;
      color: var(--text-light);
    }

    .canvas-actions {
      display: flex;
      gap: 8px;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 20px;
      font-family: 'Nunito', sans-serif;
      font-weight: 600;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn-clear {
      background: #f0f0f5;
      color: var(--text-light);
    }

    .btn-clear:hover {
      background: #e5e5ea;
    }

    .btn-save {
      background: linear-gradient(135deg, var(--pink), var(--purple));
      color: white;
    }

    .btn-save:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 15px rgba(196, 77, 255, 0.3);
    }

    .sticker-canvas {
      position: relative;
      width: 100%;
      aspect-ratio: 1;
      border-radius: 16px;
      overflow: hidden;
      cursor: crosshair;
    }

    .canvas-bg {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
    }

    .bg-solid { background: #ffffff; }
    .bg-pink { background: linear-gradient(135deg, #fff0f5, #ffe0eb); }
    .bg-purple { background: linear-gradient(135deg, #f5f0ff, #e8e0ff); }
    .bg-blue { background: linear-gradient(135deg, #f0f8ff, #e0f0ff); }
    .bg-mint { background: linear-gradient(135deg, #f0fff8, #e0ffef); }
    .bg-yellow { background: linear-gradient(135deg, #fffef0, #fff8e0); }
    .bg-dots {
      background: white;
      background-image: radial-gradient(circle, #e0e0e8 1px, transparent 1px);
      background-size: 15px 15px;
    }
    .bg-hearts {
      background: #fff0f5;
      background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext x='5' y='15' font-size='10' opacity='0.15'%3E‚ô•%3C/text%3E%3C/svg%3E");
    }
    .bg-stars {
      background: #f5f0ff;
      background-image: url("data:image/svg+xml,%3Csvg width='20' height='20' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Ctext x='5' y='15' font-size='10' opacity='0.15'%3E‚ú¶%3C/text%3E%3C/svg%3E");
    }

    .sticker-item {
      position: absolute;
      cursor: move;
      user-select: none;
      transition: filter 0.1s;
    }

    .sticker-item:hover {
      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.15));
    }

    .sticker-item.selected {
      outline: 2px dashed var(--purple);
      outline-offset: 4px;
    }

    .sticker-emoji {
      font-size: 48px;
      line-height: 1;
      display: block;
    }

    .resize-handle {
      position: absolute;
      bottom: -6px;
      right: -6px;
      width: 14px;
      height: 14px;
      background: var(--purple);
      border-radius: 50%;
      cursor: se-resize;
      opacity: 0;
      transition: opacity 0.2s;
    }

    .sticker-item.selected .resize-handle {
      opacity: 1;
    }

    .delete-handle {
      position: absolute;
      top: -8px;
      right: -8px;
      width: 20px;
      height: 20px;
      background: var(--pink);
      border-radius: 50%;
      cursor: pointer;
      opacity: 0;
      transition: opacity 0.2s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      color: white;
    }

    .sticker-item.selected .delete-handle {
      opacity: 1;
    }

    .sidebar {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .panel {
      background: var(--card);
      border-radius: 16px;
      padding: 15px;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
    }

    .panel-title {
      font-weight: 600;
      font-size: 13px;
      color: var(--text-light);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .bg-options {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 8px;
    }

    .bg-option {
      aspect-ratio: 1;
      border-radius: 10px;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.2s;
    }

    .bg-option:hover {
      transform: scale(1.1);
    }

    .bg-option.active {
      border-color: var(--purple);
      box-shadow: 0 0 0 2px rgba(196, 77, 255, 0.2);
    }

    .emoji-tabs {
      display: flex;
      gap: 4px;
      margin-bottom: 10px;
      flex-wrap: wrap;
    }

    .emoji-tab {
      padding: 6px 10px;
      border: none;
      background: #f5f5fa;
      border-radius: 10px;
      cursor: pointer;
      font-size: 16px;
      transition: all 0.2s;
    }

    .emoji-tab:hover {
      background: #ebe5f5;
    }

    .emoji-tab.active {
      background: linear-gradient(135deg, var(--pink), var(--purple));
    }

    .emoji-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 6px;
      max-height: 200px;
      overflow-y: auto;
    }

    .emoji-btn {
      aspect-ratio: 1;
      border: none;
      background: #f8f8fc;
      border-radius: 10px;
      cursor: pointer;
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .emoji-btn:hover {
      background: #f0e8ff;
      transform: scale(1.15);
    }

    .size-slider {
      width: 100%;
      margin-top: 8px;
      accent-color: var(--purple);
    }

    .size-label {
      display: flex;
      justify-content: space-between;
      font-size: 12px;
      color: var(--text-light);
    }

    .back-link {
      display: block;
      text-align: center;
      margin-top: 20px;
      color: var(--text-light);
      text-decoration: none;
      font-size: 12px;
      transition: color 0.2s;
    }

    .back-link:hover {
      color: var(--purple);
    }

    .tip {
      font-size: 11px;
      color: var(--text-light);
      text-align: center;
      margin-top: 10px;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>‚ú® Sticker Workshop</h1>
      <p class="subtitle">Mix & match emojis to create cute stickers!</p>
    </header>

    <div class="workshop">
      <div class="canvas-area">
        <div class="canvas-header">
          <span class="canvas-title">Your Sticker</span>
          <div class="canvas-actions">
            <button class="btn btn-clear" onclick="clearCanvas()">Clear</button>
            <button class="btn btn-save" onclick="saveSticker()">Save ‚Üì</button>
          </div>
        </div>
        <div class="sticker-canvas" id="canvas">
          <div class="canvas-bg bg-pink" id="canvasBg"></div>
        </div>
        <p class="tip">Click emojis to add ‚Ä¢ Drag to move ‚Ä¢ Select to resize or delete</p>
      </div>

      <div class="sidebar">
        <div class="panel">
          <div class="panel-title">üé® Background</div>
          <div class="bg-options">
            <div class="bg-option bg-solid" onclick="setBg('solid')"></div>
            <div class="bg-option bg-pink active" onclick="setBg('pink')"></div>
            <div class="bg-option bg-purple" onclick="setBg('purple')"></div>
            <div class="bg-option bg-blue" onclick="setBg('blue')"></div>
            <div class="bg-option bg-mint" onclick="setBg('mint')"></div>
            <div class="bg-option bg-yellow" onclick="setBg('yellow')"></div>
            <div class="bg-option bg-dots" onclick="setBg('dots')"></div>
            <div class="bg-option bg-hearts" onclick="setBg('hearts')"></div>
          </div>
        </div>

        <div class="panel">
          <div class="panel-title">üòä Emojis</div>
          <div class="emoji-tabs">
            <button class="emoji-tab active" data-cat="faces">üòÄ</button>
            <button class="emoji-tab" data-cat="animals">üê±</button>
            <button class="emoji-tab" data-cat="food">üçï</button>
            <button class="emoji-tab" data-cat="nature">üå∏</button>
            <button class="emoji-tab" data-cat="objects">üíñ</button>
            <button class="emoji-tab" data-cat="symbols">‚ú®</button>
          </div>
          <div class="emoji-grid" id="emojiGrid"></div>
        </div>

        <div class="panel">
          <div class="panel-title">üìê Size</div>
          <input type="range" class="size-slider" id="sizeSlider" min="24" max="96" value="48" oninput="updateSize(this.value)">
          <div class="size-label">
            <span>Small</span>
            <span id="sizeValue">48px</span>
            <span>Large</span>
          </div>
        </div>
      </div>
    </div>

    <a href="https://sloppy.live" class="back-link">sloppy.live</a>
  </div>

  <script>
    const emojiCategories = {
      faces: ['üòÄ', 'üòÉ', 'üòÑ', 'üòÅ', 'üòÜ', 'ü•π', 'üòÖ', 'üòÇ', 'ü§£', 'ü•≤', 'üòä', 'üòá', 'üôÇ', 'üòâ', 'üòå', 'üòç', 'ü•∞', 'üòò', 'üòó', 'üòô', 'üòö', 'üòã', 'üòõ', 'üòú', 'ü§™', 'üòù', 'ü§ë', 'ü§ó', 'ü§≠', 'ü§´', 'ü§î', 'ü´°', 'ü§ê', 'ü§®', 'üòê', 'üòë', 'üò∂', 'ü´•', 'üòè', 'üòí', 'üôÑ', 'üò¨', 'ü§•', 'üòî', 'üò™', 'ü§§', 'üò¥', 'üò∑', 'ü§í', 'ü§ï', 'ü§¢', 'ü§Æ', 'ü§ß', 'ü•µ', 'ü•∂', 'ü•¥', 'üòµ', 'ü§Ø', 'ü§†', 'ü•≥', 'ü•∏', 'üòé', 'ü§ì', 'üßê'],
      animals: ['üê∂', 'üê±', 'üê≠', 'üêπ', 'üê∞', 'ü¶ä', 'üêª', 'üêº', 'üêª‚Äç‚ùÑÔ∏è', 'üê®', 'üêØ', 'ü¶Å', 'üêÆ', 'üê∑', 'üê∏', 'üêµ', 'üôà', 'üôâ', 'üôä', 'üêî', 'üêß', 'üê¶', 'üê§', 'ü¶Ü', 'ü¶Ö', 'ü¶â', 'ü¶á', 'üê∫', 'üêó', 'üê¥', 'ü¶Ñ', 'üêù', 'ü™±', 'üêõ', 'ü¶ã', 'üêå', 'üêû', 'üêú', 'ü™∞', 'ü™≤', 'ü™≥', 'ü¶ü', 'ü¶ó', 'üï∑Ô∏è', 'üê¢', 'üêç', 'ü¶é', 'ü¶ñ', 'ü¶ï', 'üêô', 'ü¶ë', 'ü¶ê', 'ü¶û', 'ü¶Ä', 'üê°', 'üê†', 'üêü', 'üê¨', 'üê≥', 'üêã', 'ü¶à', 'üêä'],
      food: ['üçï', 'üçî', 'üçü', 'üå≠', 'üçø', 'üßÇ', 'ü•ì', 'ü•ö', 'üç≥', 'üßá', 'ü•û', 'üßà', 'üçû', 'ü•ê', 'ü•ñ', 'ü•®', 'üßÄ', 'ü•ó', 'ü•ô', 'ü•™', 'üåÆ', 'üåØ', 'ü´î', 'ü•´', 'üçù', 'üçú', 'üç≤', 'üçõ', 'üç£', 'üç±', 'ü•ü', 'ü¶™', 'üç§', 'üçô', 'üçö', 'üçò', 'üç•', 'ü•†', 'ü•Æ', 'üç¢', 'üç°', 'üçß', 'üç®', 'üç¶', 'ü•ß', 'üßÅ', 'üç∞', 'üéÇ', 'üçÆ', 'üç≠', 'üç¨', 'üç´', 'üç©', 'üç™', 'üå∞', 'ü•ú', 'üçØ', 'ü•õ', 'üçº', '‚òï', 'ü´ñ', 'üçµ', 'üßÉ', 'ü•§', 'üßã', 'üç∂', 'üç∫', 'üçª', 'ü•Ç', 'üç∑', 'ü•É', 'üç∏', 'üçπ', 'üßâ', 'üçæ'],
      nature: ['üå∏', 'üíÆ', 'üèµÔ∏è', 'üåπ', 'ü•Ä', 'üå∫', 'üåª', 'üåº', 'üå∑', 'üå±', 'ü™¥', 'üå≤', 'üå≥', 'üå¥', 'üåµ', 'üåæ', 'üåø', '‚òòÔ∏è', 'üçÄ', 'üçÅ', 'üçÇ', 'üçÉ', 'ü™π', 'ü™∫', 'üçÑ', 'üå∞', 'ü¶Ä', 'ü¶û', 'ü¶ê', 'ü¶ë', 'üåç', 'üåé', 'üåè', 'üåê', 'ü™®', 'üåë', 'üåí', 'üåì', 'üåî', 'üåï', 'üåñ', 'üåó', 'üåò', 'üåô', 'üåö', 'üåõ', 'üåú', '‚òÄÔ∏è', 'üåù', 'üåû', '‚≠ê', 'üåü', 'üå†', '‚òÅÔ∏è', '‚õÖ', '‚õàÔ∏è', 'üå§Ô∏è', 'üå•Ô∏è', 'üå¶Ô∏è', 'üåßÔ∏è', 'üå®Ô∏è', 'üå©Ô∏è', 'üå™Ô∏è', 'üå´Ô∏è', 'üå¨Ô∏è', 'üåÄ', 'üåà', 'üíß', 'üí¶', '‚òî', '‚ö°', '‚ùÑÔ∏è', 'üî•', 'üí•', '‚ú®'],
      objects: ['üíñ', 'üíù', 'üíò', 'üíó', 'üíì', 'üíû', 'üíï', '‚ù£Ô∏è', 'üíî', '‚ù§Ô∏è‚Äçüî•', '‚ù§Ô∏è‚Äçü©π', '‚ù§Ô∏è', 'üß°', 'üíõ', 'üíö', 'üíô', 'üíú', 'üñ§', 'ü§ç', 'ü§é', 'üíã', 'üíØ', 'üí¢', 'üí¨', 'üëÅÔ∏è‚Äçüó®Ô∏è', 'üó®Ô∏è', 'üóØÔ∏è', 'üí≠', 'üí§', 'üëã', 'ü§ö', 'üñêÔ∏è', '‚úã', 'üññ', 'üëå', 'ü§å', 'ü§è', '‚úåÔ∏è', 'ü§û', 'ü´∞', 'ü§ü', 'ü§ò', 'ü§ô', 'üëà', 'üëâ', 'üëÜ', 'üñï', 'üëá', '‚òùÔ∏è', 'ü´µ', 'üëç', 'üëé', '‚úä', 'üëä', 'ü§õ', 'ü§ú', 'üëè', 'üôå', 'ü´∂', 'üëê', 'ü§≤', 'ü§ù', 'üôè'],
      symbols: ['‚ú®', 'üí´', '‚≠ê', 'üåü', '‚ú°Ô∏è', 'üîØ', 'üïé', '‚òØÔ∏è', '‚òÆÔ∏è', 'üïâÔ∏è', '‚úùÔ∏è', '‚ò™Ô∏è', 'ü™Ø', '‚ò∏Ô∏è', '‚öõÔ∏è', 'üõê', '‚öúÔ∏è', 'üî±', 'üìõ', 'üî∞', '‚≠ï', '‚úÖ', '‚òëÔ∏è', '‚úîÔ∏è', '‚ùå', '‚ùé', '‚ûï', '‚ûñ', '‚ûó', '‚úñÔ∏è', 'üí≤', 'üí±', '¬©Ô∏è', '¬ÆÔ∏è', '‚Ñ¢Ô∏è', 'üî¥', 'üü†', 'üü°', 'üü¢', 'üîµ', 'üü£', 'üü§', '‚ö´', '‚ö™', 'üü•', 'üüß', 'üü®', 'üü©', 'üü¶', 'üü™', 'üü´', '‚¨õ', '‚¨ú', '‚óºÔ∏è', '‚óªÔ∏è', 'üî∂', 'üî∑', 'üî∏', 'üîπ', 'üî∫', 'üîª', 'üí†', 'üîò', 'üî≥', 'üî≤']
    };

    let currentCategory = 'faces';
    let currentSize = 48;
    let selectedSticker = null;
    let stickers = [];
    let isDragging = false;
    let isResizing = false;
    let dragOffset = { x: 0, y: 0 };

    const canvas = document.getElementById('canvas');
    const canvasBg = document.getElementById('canvasBg');
    const emojiGrid = document.getElementById('emojiGrid');

    // Initialize emoji grid
    function renderEmojis(category) {
      emojiGrid.innerHTML = '';
      emojiCategories[category].forEach(emoji => {
        const btn = document.createElement('button');
        btn.className = 'emoji-btn';
        btn.textContent = emoji;
        btn.onclick = () => addSticker(emoji);
        emojiGrid.appendChild(btn);
      });
    }

    // Tab switching
    document.querySelectorAll('.emoji-tab').forEach(tab => {
      tab.onclick = () => {
        document.querySelector('.emoji-tab.active').classList.remove('active');
        tab.classList.add('active');
        currentCategory = tab.dataset.cat;
        renderEmojis(currentCategory);
      };
    });

    // Add sticker to canvas
    function addSticker(emoji) {
      const sticker = document.createElement('div');
      sticker.className = 'sticker-item';
      sticker.innerHTML = `
        <span class="sticker-emoji">${emoji}</span>
        <div class="resize-handle"></div>
        <div class="delete-handle">√ó</div>
      `;

      // Random position near center
      const canvasRect = canvas.getBoundingClientRect();
      const x = canvasRect.width / 2 - currentSize / 2 + (Math.random() - 0.5) * 100;
      const y = canvasRect.height / 2 - currentSize / 2 + (Math.random() - 0.5) * 100;

      sticker.style.left = x + 'px';
      sticker.style.top = y + 'px';
      sticker.style.fontSize = currentSize + 'px';
      sticker.querySelector('.sticker-emoji').style.fontSize = currentSize + 'px';

      // Events
      sticker.addEventListener('mousedown', (e) => startDrag(e, sticker));
      sticker.addEventListener('touchstart', (e) => startDrag(e, sticker));

      sticker.querySelector('.resize-handle').addEventListener('mousedown', (e) => startResize(e, sticker));
      sticker.querySelector('.resize-handle').addEventListener('touchstart', (e) => startResize(e, sticker));

      sticker.querySelector('.delete-handle').addEventListener('click', (e) => {
        e.stopPropagation();
        sticker.remove();
        stickers = stickers.filter(s => s !== sticker);
        selectedSticker = null;
      });

      canvas.appendChild(sticker);
      stickers.push(sticker);
      selectSticker(sticker);
    }

    function selectSticker(sticker) {
      if (selectedSticker) {
        selectedSticker.classList.remove('selected');
      }
      selectedSticker = sticker;
      if (sticker) {
        sticker.classList.add('selected');
        // Update size slider
        const fontSize = parseInt(sticker.querySelector('.sticker-emoji').style.fontSize) || 48;
        document.getElementById('sizeSlider').value = fontSize;
        document.getElementById('sizeValue').textContent = fontSize + 'px';
      }
    }

    function startDrag(e, sticker) {
      if (e.target.classList.contains('resize-handle') || e.target.classList.contains('delete-handle')) return;

      e.preventDefault();
      selectSticker(sticker);
      isDragging = true;

      const rect = sticker.getBoundingClientRect();
      const canvasRect = canvas.getBoundingClientRect();
      const clientX = e.clientX || e.touches[0].clientX;
      const clientY = e.clientY || e.touches[0].clientY;

      dragOffset.x = clientX - rect.left;
      dragOffset.y = clientY - rect.top;
    }

    function startResize(e, sticker) {
      e.preventDefault();
      e.stopPropagation();
      isResizing = true;
      selectSticker(sticker);
    }

    document.addEventListener('mousemove', handleMove);
    document.addEventListener('touchmove', handleMove);

    function handleMove(e) {
      if (!selectedSticker) return;

      const canvasRect = canvas.getBoundingClientRect();
      const clientX = e.clientX || (e.touches && e.touches[0].clientX);
      const clientY = e.clientY || (e.touches && e.touches[0].clientY);

      if (isDragging) {
        const x = clientX - canvasRect.left - dragOffset.x;
        const y = clientY - canvasRect.top - dragOffset.y;
        selectedSticker.style.left = Math.max(0, Math.min(canvasRect.width - 50, x)) + 'px';
        selectedSticker.style.top = Math.max(0, Math.min(canvasRect.height - 50, y)) + 'px';
      }

      if (isResizing) {
        const stickerRect = selectedSticker.getBoundingClientRect();
        const size = Math.max(24, Math.min(96, clientX - stickerRect.left + 20));
        selectedSticker.querySelector('.sticker-emoji').style.fontSize = size + 'px';
        document.getElementById('sizeSlider').value = size;
        document.getElementById('sizeValue').textContent = Math.round(size) + 'px';
      }
    }

    document.addEventListener('mouseup', stopDrag);
    document.addEventListener('touchend', stopDrag);

    function stopDrag() {
      isDragging = false;
      isResizing = false;
    }

    // Click on canvas to deselect
    canvas.addEventListener('click', (e) => {
      if (e.target === canvas || e.target === canvasBg) {
        selectSticker(null);
      }
    });

    // Background selection
    function setBg(type) {
      document.querySelectorAll('.bg-option').forEach(opt => opt.classList.remove('active'));
      document.querySelector(`.bg-option.bg-${type}`).classList.add('active');
      canvasBg.className = 'canvas-bg bg-' + type;
    }

    // Size slider
    function updateSize(size) {
      currentSize = parseInt(size);
      document.getElementById('sizeValue').textContent = size + 'px';

      if (selectedSticker) {
        selectedSticker.querySelector('.sticker-emoji').style.fontSize = size + 'px';
      }
    }

    // Clear canvas
    function clearCanvas() {
      stickers.forEach(s => s.remove());
      stickers = [];
      selectedSticker = null;
    }

    // Save sticker
    function saveSticker() {
      // Deselect for clean export
      selectSticker(null);

      // Use html2canvas-like approach with SVG foreignObject
      const canvasRect = canvas.getBoundingClientRect();
      const size = Math.min(canvasRect.width, canvasRect.height);

      const svgNS = 'http://www.w3.org/2000/svg';
      const svg = document.createElementNS(svgNS, 'svg');
      svg.setAttribute('width', size);
      svg.setAttribute('height', size);
      svg.setAttribute('xmlns', svgNS);

      // Clone canvas content
      const foreignObject = document.createElementNS(svgNS, 'foreignObject');
      foreignObject.setAttribute('width', '100%');
      foreignObject.setAttribute('height', '100%');

      const clone = canvas.cloneNode(true);
      clone.style.width = size + 'px';
      clone.style.height = size + 'px';
      clone.querySelectorAll('.resize-handle, .delete-handle').forEach(el => el.remove());
      clone.querySelectorAll('.sticker-item').forEach(el => {
        el.classList.remove('selected');
        el.style.outline = 'none';
      });

      foreignObject.appendChild(clone);
      svg.appendChild(foreignObject);

      // Convert to image
      const svgData = new XMLSerializer().serializeToString(svg);
      const svgBlob = new Blob([svgData], { type: 'image/svg+xml;charset=utf-8' });
      const url = URL.createObjectURL(svgBlob);

      const img = new Image();
      img.onload = () => {
        const exportCanvas = document.createElement('canvas');
        exportCanvas.width = size;
        exportCanvas.height = size;
        const exportCtx = exportCanvas.getContext('2d');
        exportCtx.drawImage(img, 0, 0);

        exportCanvas.toBlob((blob) => {
          const link = document.createElement('a');
          link.download = 'sticker.png';
          link.href = URL.createObjectURL(blob);
          link.click();
          URL.revokeObjectURL(url);
        });
      };
      img.src = url;
    }

    // Initialize
    renderEmojis('faces');
  </script>
<script src="/sloppy-header/sloppy-bar.js"></script>
<script src="/vibelib-extended.js"></script>
<script>
  // Compatibility Patch for Legacy Apps
  window.addEventListener("load", () => {
    if (window.SloppyKarma && window.VibeLib.Economy) {
      // Redirect old calls to new engine
      window.SloppyKarma.track = window.VibeLib.Economy.track;
    }
  });
</script>
</body>
</html>
