<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Voxel World</title>
  <meta name="description" content="Explore and build in a blocky 3D world">
  <meta property="og:title" content="Voxel World">
  <meta property="og:description" content="A Minecraft-like voxel game with achievements">
  <meta property="og:url" content="https://sloppy.live/voxel-world/">
  <meta property="og:image" content="https://sloppy.live/voxel-world/og-image.png">
  <link rel="icon" href="https://emojicdn.elk.sh/üß±">
  <link href="https://fonts.googleapis.com/css2?family=VT323&family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #2a1a3a;
      overflow: hidden;
      font-family: 'VT323', monospace;
    }

    #gameCanvas {
      display: block;
    }

    .ui-overlay {
      position: fixed;
      z-index: 100;
      pointer-events: none;
    }

    .crosshair {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 20px;
      height: 20px;
      z-index: 100;
    }

    .crosshair::before,
    .crosshair::after {
      content: '';
      position: absolute;
      background: #fff;
      box-shadow: 0 0 3px #000;
    }

    .crosshair::before {
      width: 2px;
      height: 100%;
      left: 50%;
      transform: translateX(-50%);
    }

    .crosshair::after {
      width: 100%;
      height: 2px;
      top: 50%;
      transform: translateY(-50%);
    }

    .hud {
      top: 1rem;
      left: 1rem;
      color: #fff;
      text-shadow: 2px 2px 0 #000;
      font-size: 1.2rem;
    }

    .hud-item {
      margin: 0.3rem 0;
    }

    .hotbar {
      position: fixed;
      bottom: 1rem;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 4px;
      z-index: 100;
      pointer-events: none;
    }

    .hotbar-slot {
      width: 50px;
      height: 50px;
      background: rgba(0, 0, 0, 0.6);
      border: 3px solid #555;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8rem;
      position: relative;
    }

    .hotbar-slot.selected {
      border-color: #fff;
      background: rgba(255, 255, 255, 0.2);
    }

    .hotbar-slot .slot-number {
      position: absolute;
      top: 2px;
      left: 4px;
      font-size: 0.7rem;
      color: #aaa;
    }

    .achievements-panel {
      position: fixed;
      top: 1rem;
      right: 1rem;
      width: 280px;
      max-height: 400px;
      background: rgba(0, 0, 0, 0.8);
      border: 3px solid #5a5;
      padding: 1rem;
      z-index: 100;
      overflow-y: auto;
      display: none;
    }

    .achievements-panel.visible {
      display: block;
    }

    .achievements-title {
      font-family: 'Press Start 2P', cursive;
      font-size: 0.8rem;
      color: #5f5;
      margin-bottom: 1rem;
      text-align: center;
    }

    .achievement {
      background: rgba(50, 50, 50, 0.8);
      border: 2px solid #333;
      padding: 0.6rem;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }

    .achievement.unlocked {
      border-color: #5a5;
      background: rgba(50, 100, 50, 0.4);
    }

    .achievement.locked {
      opacity: 0.5;
    }

    .achievement-icon {
      font-size: 1.5rem;
      min-width: 30px;
      text-align: center;
    }

    .achievement-info {
      flex: 1;
    }

    .achievement-name {
      font-size: 0.9rem;
      color: #fff;
    }

    .achievement-desc {
      font-size: 0.75rem;
      color: #888;
    }

    .achievement-popup {
      position: fixed;
      top: 100px;
      left: 50%;
      transform: translateX(-50%) translateY(-20px);
      background: linear-gradient(180deg, #2a5a2a 0%, #1a3a1a 100%);
      border: 3px solid #5f5;
      padding: 1rem 2rem;
      z-index: 200;
      opacity: 0;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      gap: 1rem;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
    }

    .achievement-popup.visible {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    .achievement-popup .popup-icon {
      font-size: 2rem;
    }

    .achievement-popup .popup-text {
      color: #fff;
    }

    .achievement-popup .popup-title {
      font-size: 0.8rem;
      color: #5f5;
    }

    .achievement-popup .popup-name {
      font-size: 1.2rem;
    }

    .start-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 300;
    }

    .start-screen.hidden {
      display: none;
    }

    .start-screen h1 {
      font-family: 'Press Start 2P', cursive;
      font-size: 2rem;
      color: #5f5;
      margin-bottom: 1rem;
      text-shadow: 4px 4px 0 #000;
    }

    .start-screen p {
      color: #888;
      margin-bottom: 2rem;
      text-align: center;
      max-width: 400px;
      line-height: 1.6;
    }

    .start-btn {
      font-family: 'Press Start 2P', cursive;
      font-size: 0.9rem;
      padding: 1rem 2rem;
      background: #2a5a2a;
      border: 3px solid #5f5;
      color: #fff;
      cursor: pointer;
      transition: all 0.2s;
    }

    .start-btn:hover {
      background: #3a7a3a;
      transform: scale(1.05);
    }

    .controls-hint {
      position: fixed;
      bottom: 5rem;
      left: 50%;
      transform: translateX(-50%);
      color: #666;
      font-size: 0.9rem;
      text-align: center;
      z-index: 100;
      pointer-events: none;
    }

    .toggle-achievements {
      position: fixed;
      top: 1rem;
      right: 1rem;
      background: rgba(0, 0, 0, 0.6);
      border: 2px solid #5a5;
      color: #5f5;
      padding: 0.5rem 1rem;
      font-family: 'VT323', monospace;
      font-size: 1rem;
      cursor: pointer;
      z-index: 100;
    }

    .toggle-achievements:hover {
      background: rgba(50, 100, 50, 0.4);
    }

    .backlink {
      position: fixed;
      bottom: 0.5rem;
      right: 0.5rem;
      font-size: 0.8rem;
      z-index: 100;
      opacity: 0.4;
    }

    .backlink a {
      color: #5f5;
      text-decoration: none;
    }

    @media (max-width: 600px) {
      .hotbar-slot {
        width: 40px;
        height: 40px;
        font-size: 1.4rem;
      }

      .achievements-panel {
        width: 250px;
        right: 0.5rem;
      }

      .controls-hint {
        font-size: 0.75rem;
      }
    }
  </style>
</head>
<body>
  <div class="start-screen" id="startScreen">
    <h1>VOXEL WORLD</h1>
    <p>
      Explore a blocky world!<br>
      Break and place blocks to build.<br>
      Unlock achievements as you play.
    </p>
    <button class="start-btn" id="startBtn">CLICK TO PLAY</button>
  </div>

  <div class="crosshair" id="crosshair"></div>

  <div class="ui-overlay hud">
    <div class="hud-item">Blocks Placed: <span id="blocksPlaced">0</span></div>
    <div class="hud-item">Blocks Broken: <span id="blocksBroken">0</span></div>
    <div class="hud-item">Position: <span id="position">0, 0, 0</span></div>
  </div>

  <div class="hotbar" id="hotbar"></div>

  <button class="toggle-achievements" id="toggleAchievements">üèÜ Achievements</button>

  <div class="achievements-panel" id="achievementsPanel">
    <div class="achievements-title">üèÜ ACHIEVEMENTS</div>
    <div id="achievementsList"></div>
  </div>

  <div class="achievement-popup" id="achievementPopup">
    <span class="popup-icon" id="popupIcon">üèÜ</span>
    <div class="popup-text">
      <div class="popup-title">ACHIEVEMENT UNLOCKED!</div>
      <div class="popup-name" id="popupName"></div>
    </div>
  </div>

  <div class="controls-hint">
    WASD = Move | SPACE = Jump | MOUSE = Look | LEFT CLICK = Break | RIGHT CLICK = Place | 1-6 = Select Block | TAB = Achievements
  </div>

  <div class="backlink"><a href="https://sloppy.live">sloppy.live</a></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    // Game state
    let scene, camera, renderer;
    let world = {};
    let selectedBlock = 0;
    let blocksPlaced = 0;
    let blocksBroken = 0;
    let isPlaying = false;
    let moveForward = false, moveBackward = false, moveLeft = false, moveRight = false;
    let canJump = true;
    let velocity = new THREE.Vector3();
    let direction = new THREE.Vector3();
    let playerHeight = 1.7;
    let raycaster = new THREE.Raycaster();
    let mouse = new THREE.Vector2();

    // Block types - Purple Desert Theme
    const blockTypes = [
      { name: 'Purple Sand', color: 0x6a4c7a, emoji: 'üü™' },
      { name: 'Dark Sand', color: 0x4a3050, emoji: 'üü´' },
      { name: 'Obsite', color: 0x2d1f3d, emoji: '‚¨õ' },
      { name: 'Driftwood', color: 0x5c4033, emoji: 'ü™µ' },
      { name: 'Sandstone', color: 0x9a7b6a, emoji: 'üß±' },
      { name: 'Amethyst', color: 0xb266ff, emoji: 'üíé' }
    ];

    // Achievements
    const achievements = [
      { id: 'first_block', name: 'First Steps', desc: 'Place your first block', icon: 'üß±', check: () => blocksPlaced >= 1 },
      { id: 'builder', name: 'Builder', desc: 'Place 10 blocks', icon: 'üèóÔ∏è', check: () => blocksPlaced >= 10 },
      { id: 'architect', name: 'Architect', desc: 'Place 50 blocks', icon: 'üèõÔ∏è', check: () => blocksPlaced >= 50 },
      { id: 'master_builder', name: 'Master Builder', desc: 'Place 100 blocks', icon: 'üë∑', check: () => blocksPlaced >= 100 },
      { id: 'first_break', name: 'Destruction', desc: 'Break your first block', icon: 'üí•', check: () => blocksBroken >= 1 },
      { id: 'miner', name: 'Miner', desc: 'Break 25 blocks', icon: '‚õèÔ∏è', check: () => blocksBroken >= 25 },
      { id: 'demolition', name: 'Demolition Expert', desc: 'Break 100 blocks', icon: 'üß®', check: () => blocksBroken >= 100 },
      { id: 'explorer', name: 'Explorer', desc: 'Travel 100 blocks from spawn', icon: 'üß≠', check: () => getDistanceFromSpawn() >= 100 },
      { id: 'mountaineer', name: 'Mountaineer', desc: 'Reach height 30', icon: '‚õ∞Ô∏è', check: () => camera && camera.position.y >= 30 },
      { id: 'gold_rush', name: 'Crystal Collector', desc: 'Place an amethyst block', icon: 'üíé', check: () => hasPlacedGold },
      { id: 'variety', name: 'Variety Pack', desc: 'Use all block types', icon: 'üé®', check: () => usedBlockTypes.size >= 6 },
      { id: 'sky_high', name: 'Sky High', desc: 'Build a tower 20 blocks tall', icon: 'üóº', check: () => highestBuild >= 20 },
      { id: 'punching_air', name: 'Punching Air', desc: 'Swing at nothing like a fool', icon: 'üëä', check: () => punchedAir },
      { id: 'void_fall', name: 'Into the Void', desc: 'Fall into the endless abyss', icon: 'üï≥Ô∏è', check: () => fellIntoVoid },
      { id: 'first_dirt', name: 'Dark Sands', desc: 'Collect your first dark sand', icon: 'üü´', check: () => collectedDirt }
    ];

    let unlockedAchievements = new Set();
    let hasPlacedGold = false;
    let usedBlockTypes = new Set();
    let highestBuild = 0;
    let punchedAir = false;
    let fellIntoVoid = false;
    let collectedDirt = false;

    function getDistanceFromSpawn() {
      if (!camera) return 0;
      const dx = camera.position.x;
      const dz = camera.position.z;
      return Math.sqrt(dx * dx + dz * dz);
    }

    // Initialize Three.js
    function init() {
      scene = new THREE.Scene();
      scene.background = new THREE.Color(0x2a1a3a); // Purple twilight sky
      scene.fog = new THREE.Fog(0x2a1a3a, 20, 80);

      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
      camera.position.set(0, 10, 10);

      renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.shadowMap.enabled = true;
      document.body.insertBefore(renderer.domElement, document.body.firstChild);

      // Lighting - Purple Desert Twilight
      const ambientLight = new THREE.AmbientLight(0x8866aa, 0.5);
      scene.add(ambientLight);

      const directionalLight = new THREE.DirectionalLight(0xffaa66, 0.7); // Warm sunset light
      directionalLight.position.set(50, 100, 50);
      directionalLight.castShadow = true;
      scene.add(directionalLight);

      // Add purple rim light
      const rimLight = new THREE.DirectionalLight(0x9966ff, 0.3);
      rimLight.position.set(-50, 50, -50);
      scene.add(rimLight);

      // Generate world
      generateWorld();

      // Create hotbar
      createHotbar();

      // Render achievements list
      renderAchievements();

      // Events
      window.addEventListener('resize', onWindowResize);
      document.addEventListener('keydown', onKeyDown);
      document.addEventListener('keyup', onKeyUp);
      document.addEventListener('mousedown', onMouseDown);
      document.addEventListener('mousemove', onMouseMove);

      animate();
    }

    function generateWorld() {
      const size = 24;
      const geometry = new THREE.BoxGeometry(1, 1, 1);

      for (let x = -size; x <= size; x++) {
        for (let z = -size; z <= size; z++) {
          // Simple height map
          const height = Math.floor(
            Math.sin(x * 0.1) * 2 +
            Math.cos(z * 0.1) * 2 +
            Math.sin((x + z) * 0.05) * 3
          ) + 3;

          for (let y = 0; y <= height; y++) {
            let blockType;
            if (y === height) {
              blockType = 0; // Grass on top
            } else if (y > height - 3) {
              blockType = 1; // Dirt
            } else {
              blockType = 2; // Stone
            }

            createBlock(x, y, z, blockType);
          }
        }
      }
    }

    function createBlock(x, y, z, typeIndex) {
      const key = `${x},${y},${z}`;
      if (world[key]) return;

      const geometry = new THREE.BoxGeometry(1, 1, 1);
      const material = new THREE.MeshLambertMaterial({
        color: blockTypes[typeIndex].color
      });

      const block = new THREE.Mesh(geometry, material);
      block.position.set(x, y, z);
      block.castShadow = true;
      block.receiveShadow = true;
      block.userData = { type: typeIndex };

      scene.add(block);
      world[key] = block;

      // Track highest build
      if (y > highestBuild) {
        highestBuild = y;
      }

      return block;
    }

    function removeBlock(x, y, z) {
      const key = `${x},${y},${z}`;
      const block = world[key];
      if (block && y > 0) { // Don't remove bedrock level
        scene.remove(block);
        delete world[key];
        return true;
      }
      return false;
    }

    function createHotbar() {
      const hotbar = document.getElementById('hotbar');
      hotbar.innerHTML = blockTypes.map((block, i) => `
        <div class="hotbar-slot ${i === selectedBlock ? 'selected' : ''}" data-index="${i}">
          <span class="slot-number">${i + 1}</span>
          ${block.emoji}
        </div>
      `).join('');

      hotbar.querySelectorAll('.hotbar-slot').forEach(slot => {
        slot.addEventListener('click', () => {
          selectedBlock = parseInt(slot.dataset.index);
          updateHotbar();
        });
      });
    }

    function updateHotbar() {
      document.querySelectorAll('.hotbar-slot').forEach((slot, i) => {
        slot.classList.toggle('selected', i === selectedBlock);
      });
    }

    function onWindowResize() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    }

    let euler = new THREE.Euler(0, 0, 0, 'YXZ');
    let sensitivity = 0.002;

    function onMouseMove(event) {
      if (!isPlaying || !document.pointerLockElement) return;

      euler.setFromQuaternion(camera.quaternion);
      euler.y -= event.movementX * sensitivity;
      euler.x -= event.movementY * sensitivity;
      euler.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, euler.x));
      camera.quaternion.setFromEuler(euler);
    }

    function onKeyDown(event) {
      if (!isPlaying) return;

      switch (event.code) {
        case 'KeyW': moveForward = true; break;
        case 'KeyS': moveBackward = true; break;
        case 'KeyA': moveLeft = true; break;
        case 'KeyD': moveRight = true; break;
        case 'Space':
          if (canJump) {
            velocity.y = 8;
            canJump = false;
          }
          break;
        case 'Digit1': case 'Digit2': case 'Digit3':
        case 'Digit4': case 'Digit5': case 'Digit6':
          selectedBlock = parseInt(event.code.charAt(5)) - 1;
          updateHotbar();
          break;
        case 'Tab':
          event.preventDefault();
          toggleAchievements();
          break;
      }
    }

    function onKeyUp(event) {
      switch (event.code) {
        case 'KeyW': moveForward = false; break;
        case 'KeyS': moveBackward = false; break;
        case 'KeyA': moveLeft = false; break;
        case 'KeyD': moveRight = false; break;
      }
    }

    function onMouseDown(event) {
      if (!isPlaying) return;

      raycaster.setFromCamera(mouse, camera);
      const blocks = Object.values(world);
      const intersects = raycaster.intersectObjects(blocks);

      // Check for punching air (left click with no hit)
      if (event.button === 0 && intersects.length === 0) {
        punchedAir = true;
        checkAchievements();
      }

      if (intersects.length > 0) {
        const hit = intersects[0];
        const pos = hit.object.position;

        if (event.button === 0) {
          // Left click - break block
          const blockType = hit.object.userData.type;
          if (removeBlock(pos.x, pos.y, pos.z)) {
            blocksBroken++;
            document.getElementById('blocksBroken').textContent = blocksBroken;

            // Check if it was dirt (type 1)
            if (blockType === 1) {
              collectedDirt = true;
            }

            checkAchievements();
          }
        } else if (event.button === 2) {
          // Right click - place block
          const normal = hit.face.normal;
          const newPos = {
            x: Math.round(pos.x + normal.x),
            y: Math.round(pos.y + normal.y),
            z: Math.round(pos.z + normal.z)
          };

          // Don't place inside player
          const playerPos = camera.position;
          const dx = Math.abs(newPos.x - playerPos.x);
          const dy = Math.abs(newPos.y - playerPos.y);
          const dz = Math.abs(newPos.z - playerPos.z);

          if (!(dx < 0.6 && dz < 0.6 && dy < playerHeight)) {
            createBlock(newPos.x, newPos.y, newPos.z, selectedBlock);
            blocksPlaced++;
            document.getElementById('blocksPlaced').textContent = blocksPlaced;

            usedBlockTypes.add(selectedBlock);
            if (selectedBlock === 5) hasPlacedGold = true;

            checkAchievements();
          }
        }
      }
    }

    function getGroundHeight(x, z) {
      for (let y = 50; y >= 0; y--) {
        const key = `${Math.floor(x)},${y},${Math.floor(z)}`;
        if (world[key]) return y + 1;
      }
      return 1;
    }

    function updatePlayer(delta) {
      // Gravity
      velocity.y -= 20 * delta;

      // Movement direction
      direction.z = Number(moveForward) - Number(moveBackward);
      direction.x = Number(moveRight) - Number(moveLeft);
      direction.normalize();

      const speed = 5;

      if (moveForward || moveBackward) {
        velocity.z = direction.z * speed;
      } else {
        velocity.z = 0;
      }

      if (moveLeft || moveRight) {
        velocity.x = direction.x * speed;
      } else {
        velocity.x = 0;
      }

      // Apply movement in camera direction
      const forward = new THREE.Vector3();
      camera.getWorldDirection(forward);
      forward.y = 0;
      forward.normalize();

      const right = new THREE.Vector3();
      right.crossVectors(forward, new THREE.Vector3(0, 1, 0));

      const moveVec = new THREE.Vector3();
      moveVec.addScaledVector(forward, velocity.z * delta);
      moveVec.addScaledVector(right, velocity.x * delta);

      camera.position.add(moveVec);
      camera.position.y += velocity.y * delta;

      // Ground collision
      const groundY = getGroundHeight(camera.position.x, camera.position.z) + playerHeight;
      if (camera.position.y < groundY) {
        camera.position.y = groundY;
        velocity.y = 0;
        canJump = true;
      }

      // Check for falling into the void
      if (camera.position.y < -10 && !fellIntoVoid) {
        fellIntoVoid = true;
        checkAchievements();
        // Respawn player
        setTimeout(() => {
          camera.position.set(0, 15, 0);
          velocity.y = 0;
        }, 1000);
      }

      // Update position display
      document.getElementById('position').textContent =
        `${Math.floor(camera.position.x)}, ${Math.floor(camera.position.y)}, ${Math.floor(camera.position.z)}`;

      checkAchievements();
    }

    // Achievements
    function checkAchievements() {
      achievements.forEach(achievement => {
        if (!unlockedAchievements.has(achievement.id) && achievement.check()) {
          unlockAchievement(achievement);
        }
      });
    }

    function unlockAchievement(achievement) {
      unlockedAchievements.add(achievement.id);
      showAchievementPopup(achievement);
      renderAchievements();
    }

    function showAchievementPopup(achievement) {
      const popup = document.getElementById('achievementPopup');
      document.getElementById('popupIcon').textContent = achievement.icon;
      document.getElementById('popupName').textContent = achievement.name;
      popup.classList.add('visible');

      setTimeout(() => {
        popup.classList.remove('visible');
      }, 3000);
    }

    function renderAchievements() {
      const list = document.getElementById('achievementsList');
      list.innerHTML = achievements.map(a => {
        const unlocked = unlockedAchievements.has(a.id);
        return `
          <div class="achievement ${unlocked ? 'unlocked' : 'locked'}">
            <span class="achievement-icon">${unlocked ? a.icon : 'üîí'}</span>
            <div class="achievement-info">
              <div class="achievement-name">${a.name}</div>
              <div class="achievement-desc">${a.desc}</div>
            </div>
          </div>
        `;
      }).join('');
    }

    function toggleAchievements() {
      document.getElementById('achievementsPanel').classList.toggle('visible');
    }

    document.getElementById('toggleAchievements').addEventListener('click', toggleAchievements);

    // Game loop
    let prevTime = performance.now();

    function animate() {
      requestAnimationFrame(animate);

      if (isPlaying) {
        const time = performance.now();
        const delta = (time - prevTime) / 1000;
        prevTime = time;

        updatePlayer(Math.min(delta, 0.1));
      }

      renderer.render(scene, camera);
    }

    // Start game
    document.getElementById('startBtn').addEventListener('click', () => {
      document.getElementById('startScreen').classList.add('hidden');
      document.body.requestPointerLock();
      isPlaying = true;
      prevTime = performance.now();
    });

    document.addEventListener('pointerlockchange', () => {
      isPlaying = document.pointerLockElement !== null;
      document.getElementById('crosshair').style.display = isPlaying ? 'block' : 'none';
    });

    // Disable context menu
    document.addEventListener('contextmenu', e => e.preventDefault());

    // Initialize
    init();
  </script>
<script src="/sloppy-header/sloppy-bar.js"></script>
</body>
</html>
