<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Archive - Internet Wayback Machine</title>
    <link rel="icon" href="https://emojicdn.elk.sh/üìö">

    <meta property="og:title" content="Web Archive">
    <meta property="og:description" content="Save and browse snapshots of web pages over time">
    <meta property="og:url" content="https://sloppy.live/web-archive">
    <meta property="og:image" content="https://image.pollinations.ai/prompt/internet%20archive%20wayback%20machine%20library%20digital%20preservation?width=1200&height=630&referrer=sloppy.live">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f5f5f5;
            color: #333;
        }

        /* Header */
        header {
            background: #fff;
            border-bottom: 3px solid #4a90e2;
            padding: 20px 40px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 28px;
            font-weight: 700;
            color: #4a90e2;
            text-decoration: none;
        }

        .logo-icon {
            font-size: 36px;
        }

        .nav-links {
            display: flex;
            gap: 25px;
            margin-left: auto;
        }

        .nav-links a {
            color: #666;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #4a90e2;
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            padding: 60px 40px;
            text-align: center;
        }

        .hero h1 {
            font-size: 48px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .hero p {
            font-size: 20px;
            margin-bottom: 40px;
            opacity: 0.95;
        }

        /* Search Box */
        .search-container {
            max-width: 800px;
            margin: -40px auto 40px;
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            padding: 30px;
        }

        .search-box {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            outline: none;
            transition: border-color 0.3s;
        }

        .search-input:focus {
            border-color: #4a90e2;
        }

        .search-btn {
            padding: 15px 30px;
            background: #4a90e2;
            color: #fff;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        .search-btn:hover {
            background: #357abd;
        }

        .archive-btn {
            background: #50c878;
        }

        .archive-btn:hover {
            background: #3da863;
        }

        .search-note {
            font-size: 14px;
            color: #666;
            text-align: center;
        }

        /* Main Content */
        .container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 40px;
        }

        .section {
            background: #fff;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }

        .section-title {
            font-size: 28px;
            margin-bottom: 20px;
            color: #333;
            border-bottom: 2px solid #4a90e2;
            padding-bottom: 10px;
        }

        /* Timeline */
        .timeline {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .timeline-item {
            display: flex;
            gap: 20px;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #4a90e2;
            cursor: pointer;
            transition: all 0.3s;
        }

        .timeline-item:hover {
            background: #f0f0f0;
            transform: translateX(5px);
        }

        .timeline-date {
            font-size: 14px;
            color: #4a90e2;
            font-weight: 600;
            min-width: 150px;
        }

        .timeline-content {
            flex: 1;
        }

        .timeline-title {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .timeline-description {
            font-size: 14px;
            color: #666;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #fff;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-number {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 14px;
            opacity: 0.9;
        }

        /* Recent Snapshots */
        .snapshot-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .snapshot-card {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .snapshot-card:hover {
            border-color: #4a90e2;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .snapshot-url {
            font-size: 14px;
            font-weight: 600;
            color: #4a90e2;
            margin-bottom: 8px;
            word-break: break-all;
        }

        .snapshot-date {
            font-size: 12px;
            color: #999;
            margin-bottom: 8px;
        }

        .snapshot-preview {
            font-size: 13px;
            color: #666;
            line-height: 1.4;
        }

        /* Footer */
        footer {
            background: #333;
            color: #fff;
            padding: 40px;
            text-align: center;
            margin-top: 60px;
        }

        .footer-links {
            display: flex;
            gap: 30px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .footer-links a {
            color: #fff;
            text-decoration: none;
            transition: opacity 0.3s;
        }

        .footer-links a:hover {
            opacity: 0.7;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 32px;
            }

            .search-box {
                flex-direction: column;
            }

            .container {
                padding: 0 20px;
            }

            header {
                padding: 20px;
            }

            .nav-links {
                display: none;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <a href="#" class="logo">
                <span class="logo-icon">üìö</span>
                <span>Web Archive</span>
            </a>
            <div class="nav-links">
                <a href="#browse">Browse</a>
                <a href="#about">About</a>
                <a href="https://sloppy.live">VibeCodedByX</a> | <a href="https://sloppy.live/overview" style="color:#4ecdc4;text-decoration:none">üé® View All Apps</a>
            </div>
        </div>
    </header>

    <section class="hero">
        <h1>The Internet Time Machine</h1>
        <p>Save and browse snapshots of web pages over time</p>
    </section>

    <div class="search-container">
        <div class="search-box">
            <input
                type="url"
                class="search-input"
                id="searchInput"
                placeholder="Enter a website URL (e.g., https://example.com)"
            />
            <button class="search-btn" onclick="searchArchive()">üîç Search History</button>
            <button class="search-btn archive-btn" onclick="saveSnapshot()">üíæ Save Now</button>
        </div>
        <p class="search-note">Search for archived snapshots or save a new snapshot to the archive</p>
    </div>

    <div class="container">
        <section class="section">
            <h2 class="section-title">üìä Archive Statistics</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalSnapshots">0</div>
                    <div class="stat-label">Total Snapshots</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalUrls">0</div>
                    <div class="stat-label">Unique URLs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="todaySnapshots">0</div>
                    <div class="stat-label">Saved Today</div>
                </div>
            </div>
        </section>

        <section class="section" id="browse">
            <h2 class="section-title">üìú Recent Snapshots</h2>
            <div class="snapshot-grid" id="snapshotGrid">
                <div class="loading">Loading recent snapshots...</div>
            </div>
        </section>

        <section class="section" id="timeline" style="display: none;">
            <h2 class="section-title">üïê Timeline for <span id="timelineUrl"></span></h2>
            <div class="timeline" id="timelineContent"></div>
        </section>

        <section class="section" id="about">
            <h2 class="section-title">About Web Archive</h2>
            <p style="line-height: 1.8; color: #666;">
                Web Archive is a digital time capsule for the internet. Save snapshots of web pages and browse their history over time.
                Perfect for preserving important content, tracking website changes, or just satisfying your curiosity about how sites looked in the past.
            </p>
            <p style="margin-top: 15px; line-height: 1.8; color: #666;">
                Built with ‚ù§Ô∏è as part of <a href="https://sloppy.live" style="color: #4a90e2;">sloppy.live</a>
            </p>
        </section>
    </div>

    <footer>
        <div class="footer-links">
            <a href="#browse">Browse Archive</a>
            <a href="#about">About</a>
            <a href="https://sloppy.live">VibeCodedByX</a>
        </div>
        <p>Web Archive - Preserving the Internet, One Snapshot at a Time</p>
    </footer>

    <script type="module">
        import { supabase, supabaseSession } from '../../supabase-config.js';

        let currentUser = null;

        async function init() {
            try {
                const { user } = await supabaseSession();
                currentUser = user;
                await loadStats();
                await loadRecentSnapshots();
            } catch (e) {
                console.error('Init error:', e);
            }
        }

        async function loadStats() {
            try {
                const { data: snapshots, error } = await supabase
                    .from('web_snapshots')
                    .select('*');

                if (error) throw error;

                const total = snapshots?.length || 0;
                const uniqueUrls = new Set(snapshots?.map(s => s.url) || []).size;
                const today = new Date().toDateString();
                const todayCount = snapshots?.filter(s =>
                    new Date(s.created_at).toDateString() === today
                ).length || 0;

                document.getElementById('totalSnapshots').textContent = total;
                document.getElementById('totalUrls').textContent = uniqueUrls;
                document.getElementById('todaySnapshots').textContent = todayCount;
            } catch (e) {
                console.error('Stats error:', e);
            }
        }

        async function loadRecentSnapshots() {
            try {
                const { data, error } = await supabase
                    .from('web_snapshots')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(12);

                if (error) throw error;

                const grid = document.getElementById('snapshotGrid');

                if (!data || data.length === 0) {
                    grid.innerHTML = '<div class="loading">No snapshots yet. Be the first to save one!</div>';
                    return;
                }

                grid.innerHTML = data.map(snapshot => `
                    <div class="snapshot-card" onclick="viewSnapshot('${snapshot.url}')">
                        <div class="snapshot-url">${truncateUrl(snapshot.url)}</div>
                        <div class="snapshot-date">${formatDate(snapshot.created_at)}</div>
                        <div class="snapshot-preview">${truncate(snapshot.title || 'Untitled', 80)}</div>
                    </div>
                `).join('');
            } catch (e) {
                console.error('Load snapshots error:', e);
                document.getElementById('snapshotGrid').innerHTML =
                    '<div class="loading">Unable to load snapshots</div>';
            }
        }

        window.searchArchive = async function() {
            const url = document.getElementById('searchInput').value.trim();
            if (!url) {
                alert('Please enter a URL');
                return;
            }

            try {
                const { data, error } = await supabase
                    .from('web_snapshots')
                    .select('*')
                    .eq('url', url)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                if (!data || data.length === 0) {
                    alert('No snapshots found for this URL. Try saving one!');
                    return;
                }

                displayTimeline(url, data);
            } catch (e) {
                console.error('Search error:', e);
                alert('Error searching archive');
            }
        };

        window.saveSnapshot = async function() {
            const url = document.getElementById('searchInput').value.trim();
            if (!url) {
                alert('Please enter a URL');
                return;
            }

            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                alert('Please enter a valid URL starting with http:// or https://');
                return;
            }

            try {
                const snapshot = {
                    url: url,
                    title: `Snapshot of ${url}`,
                    user_id: currentUser?.id || 'anonymous'
                };

                const { error } = await supabase
                    .from('web_snapshots')
                    .insert([snapshot]);

                if (error) throw error;

                alert('‚úÖ Snapshot saved successfully!');
                await loadStats();
                await loadRecentSnapshots();
                document.getElementById('searchInput').value = '';
            } catch (e) {
                console.error('Save error:', e);
                alert('Error saving snapshot');
            }
        };

        window.viewSnapshot = async function(url) {
            await window.searchArchive.call(null);
            document.getElementById('searchInput').value = url;
        };

        function displayTimeline(url, snapshots) {
            const timelineSection = document.getElementById('timeline');
            const timelineUrl = document.getElementById('timelineUrl');
            const timelineContent = document.getElementById('timelineContent');

            timelineUrl.textContent = truncateUrl(url);
            timelineContent.innerHTML = snapshots.map(snapshot => `
                <div class="timeline-item">
                    <div class="timeline-date">${formatDate(snapshot.created_at)}</div>
                    <div class="timeline-content">
                        <div class="timeline-title">${snapshot.title || 'Untitled'}</div>
                        <div class="timeline-description">Saved by archive</div>
                    </div>
                </div>
            `).join('');

            timelineSection.style.display = 'block';
            timelineSection.scrollIntoView({ behavior: 'smooth' });
        }

        function truncateUrl(url) {
            try {
                const urlObj = new URL(url);
                return urlObj.hostname + urlObj.pathname;
            } catch {
                return url.substring(0, 50) + '...';
            }
        }

        function truncate(str, length) {
            return str.length > length ? str.substring(0, length) + '...' : str;
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        init();
    </script>
<script src="/sloppy-header/sloppy-bar.js"></script>
</body>
</html>
