<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sloppy Archive</title>
    <link rel="icon" href="https://emojicdn.elk.sh/üóÑÔ∏è">

    <meta property="og:title" content="Sloppy Archive">
    <meta property="og:description" content="The digital time capsule - preserve the web, one snapshot at a time">
    <meta property="og:url" content="https://app.sloppy.live/web-archive">
    <meta property="og:image" content="https://image.pollinations.ai/prompt/neon%20digital%20archive%20vault%20glowing%20purple%20cyan%20time%20capsule%20cyberpunk?width=1200&height=630&referrer=sloppy.live">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Space Grotesk', sans-serif;
            background: #0a0a0f;
            color: #e0e0e0;
        }

        /* Header */
        header {
            background: linear-gradient(180deg, #12121a 0%, #0a0a0f 100%);
            border-bottom: 1px solid #2a2a3a;
            padding: 20px 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 28px;
            font-weight: 700;
            color: #00ffff;
            text-decoration: none;
            text-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
        }

        .logo-icon {
            font-size: 36px;
            filter: drop-shadow(0 0 10px rgba(0, 255, 255, 0.5));
        }

        .nav-links {
            display: flex;
            gap: 25px;
            margin-left: auto;
        }

        .nav-links a {
            color: #888;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s;
        }

        .nav-links a:hover {
            color: #ff00ff;
            text-shadow: 0 0 10px rgba(255, 0, 255, 0.5);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f0f23 100%);
            color: #fff;
            padding: 80px 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(ellipse at 20% 50%, rgba(0, 255, 255, 0.1) 0%, transparent 50%),
                radial-gradient(ellipse at 80% 50%, rgba(255, 0, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .hero h1 {
            font-size: 52px;
            margin-bottom: 20px;
            background: linear-gradient(90deg, #00ffff, #ff00ff, #00ffff);
            background-size: 200% auto;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: shimmer 3s linear infinite;
            position: relative;
        }

        @keyframes shimmer {
            0% { background-position: 0% center; }
            100% { background-position: 200% center; }
        }

        .hero p {
            font-size: 20px;
            margin-bottom: 40px;
            opacity: 0.8;
            color: #aaa;
            position: relative;
        }

        /* Search Box */
        .search-container {
            max-width: 800px;
            margin: -40px auto 40px;
            background: #15151f;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5), 0 0 60px rgba(0, 255, 255, 0.1);
            padding: 30px;
            border: 1px solid #2a2a3a;
            position: relative;
        }

        .search-box {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .search-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #2a2a3a;
            border-radius: 8px;
            font-size: 16px;
            font-family: 'JetBrains Mono', monospace;
            outline: none;
            transition: all 0.3s;
            background: #0a0a0f;
            color: #e0e0e0;
        }

        .search-input:focus {
            border-color: #00ffff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.2);
        }

        .search-input::placeholder {
            color: #555;
        }

        .search-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #00ffff 0%, #00cccc 100%);
            color: #0a0a0f;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Space Grotesk', sans-serif;
        }

        .search-btn:hover {
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.5);
            transform: translateY(-2px);
        }

        .archive-btn {
            background: linear-gradient(135deg, #ff00ff 0%, #cc00cc 100%);
        }

        .archive-btn:hover {
            box-shadow: 0 0 30px rgba(255, 0, 255, 0.5);
        }

        .search-note {
            font-size: 14px;
            color: #666;
            text-align: center;
        }

        /* Main Content */
        .container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 40px;
        }

        .section {
            background: #12121a;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid #2a2a3a;
        }

        .section-title {
            font-size: 28px;
            margin-bottom: 20px;
            color: #00ffff;
            border-bottom: 1px solid #2a2a3a;
            padding-bottom: 10px;
        }

        /* Timeline */
        .timeline {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .timeline-item {
            display: flex;
            gap: 20px;
            padding: 20px;
            background: #0a0a0f;
            border-radius: 8px;
            border-left: 3px solid #00ffff;
            cursor: pointer;
            transition: all 0.3s;
        }

        .timeline-item:hover {
            background: #15151f;
            transform: translateX(5px);
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.1);
        }

        .timeline-date {
            font-size: 14px;
            color: #00ffff;
            font-weight: 600;
            min-width: 150px;
            font-family: 'JetBrains Mono', monospace;
        }

        .timeline-content {
            flex: 1;
        }

        .timeline-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #e0e0e0;
        }

        .timeline-description {
            font-size: 14px;
            color: #666;
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid #2a2a3a;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, #00ffff, #ff00ff);
        }

        .stat-number {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 8px;
            color: #00ffff;
            font-family: 'JetBrains Mono', monospace;
        }

        .stat-label {
            font-size: 14px;
            color: #888;
        }

        /* Recent Snapshots */
        .snapshot-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .snapshot-card {
            background: #0a0a0f;
            border-radius: 8px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid #2a2a3a;
        }

        .snapshot-card:hover {
            border-color: #ff00ff;
            transform: translateY(-3px);
            box-shadow: 0 5px 25px rgba(255, 0, 255, 0.2);
        }

        .snapshot-url {
            font-size: 14px;
            font-weight: 600;
            color: #ff00ff;
            margin-bottom: 8px;
            word-break: break-all;
            font-family: 'JetBrains Mono', monospace;
        }

        .snapshot-date {
            font-size: 12px;
            color: #666;
            margin-bottom: 8px;
            font-family: 'JetBrains Mono', monospace;
        }

        .snapshot-preview {
            font-size: 13px;
            color: #888;
            line-height: 1.4;
        }

        /* Footer */
        footer {
            background: #0a0a0f;
            color: #888;
            padding: 40px;
            text-align: center;
            margin-top: 60px;
            border-top: 1px solid #2a2a3a;
        }

        .footer-links {
            display: flex;
            gap: 30px;
            justify-content: center;
            margin-bottom: 20px;
        }

        .footer-links a {
            color: #888;
            text-decoration: none;
            transition: all 0.3s;
        }

        .footer-links a:hover {
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.5);
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 32px;
            }

            .search-box {
                flex-direction: column;
            }

            .container {
                padding: 0 20px;
            }

            header {
                padding: 20px;
            }

            .nav-links {
                display: none;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <a href="#" class="logo">
                <span class="logo-icon">üóÑÔ∏è</span>
                <span>Sloppy Archive</span>
            </a>
            <div class="nav-links">
                <a href="#browse">Browse</a>
                <a href="#about">About</a>
                <a href="https://sloppy.live" style="color:#ff00ff">sloppy.live</a>
            </div>
        </div>
    </header>

    <section class="hero">
        <h1>The Digital Time Capsule</h1>
        <p>Preserve the web. Capture moments. Archive forever.</p>
    </section>

    <div class="search-container">
        <div class="search-box">
            <input
                type="url"
                class="search-input"
                id="searchInput"
                placeholder="Enter a website URL (e.g., https://example.com)"
            />
            <button class="search-btn" onclick="searchArchive()">üîç Search History</button>
            <button class="search-btn archive-btn" onclick="saveSnapshot()">üíæ Save Now</button>
        </div>
        <p class="search-note">Search for archived snapshots or save a new snapshot to the archive</p>
    </div>

    <div class="container">
        <section class="section">
            <h2 class="section-title">üìä Archive Statistics</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="totalSnapshots">0</div>
                    <div class="stat-label">Total Snapshots</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="totalUrls">0</div>
                    <div class="stat-label">Unique URLs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="todaySnapshots">0</div>
                    <div class="stat-label">Saved Today</div>
                </div>
            </div>
        </section>

        <section class="section" id="browse">
            <h2 class="section-title">üìú Recent Snapshots</h2>
            <div class="snapshot-grid" id="snapshotGrid">
                <div class="loading">Loading recent snapshots...</div>
            </div>
        </section>

        <section class="section" id="timeline" style="display: none;">
            <h2 class="section-title">üïê Timeline for <span id="timelineUrl"></span></h2>
            <div class="timeline" id="timelineContent"></div>
        </section>

        <section class="section" id="about">
            <h2 class="section-title">About Sloppy Archive</h2>
            <p style="line-height: 1.8; color: #888;">
                Sloppy Archive is the digital time capsule of the sloppy.live ecosystem. Save snapshots of web pages and browse their history over time.
                Perfect for preserving important content, tracking website changes, or satisfying your curiosity about how sites looked in the past.
            </p>
            <p style="margin-top: 15px; line-height: 1.8; color: #888;">
                Part of the <a href="https://sloppy.live" style="color: #ff00ff;">sloppy.live</a> digital nation
            </p>
        </section>
    </div>

    <footer>
        <div class="footer-links">
            <a href="#browse">Browse Archive</a>
            <a href="#about">About</a>
            <a href="https://sloppy.live">sloppy.live</a>
        </div>
        <p style="color:#666;">Sloppy Archive ‚Äî Preserving the Web, One Snapshot at a Time</p>
    </footer>

    <script type="module">
        import { supabase, supabaseSession } from '../../supabase-config.js';

        let currentUser = null;

        async function init() {
            try {
                const { user } = await supabaseSession();
                currentUser = user;
                await loadStats();
                await loadRecentSnapshots();
            } catch (e) {
                console.error('Init error:', e);
            }
        }

        async function loadStats() {
            try {
                const { data: snapshots, error } = await supabase
                    .from('web_snapshots')
                    .select('*');

                if (error) throw error;

                const total = snapshots?.length || 0;
                const uniqueUrls = new Set(snapshots?.map(s => s.url) || []).size;
                const today = new Date().toDateString();
                const todayCount = snapshots?.filter(s =>
                    new Date(s.created_at).toDateString() === today
                ).length || 0;

                document.getElementById('totalSnapshots').textContent = total;
                document.getElementById('totalUrls').textContent = uniqueUrls;
                document.getElementById('todaySnapshots').textContent = todayCount;
            } catch (e) {
                console.error('Stats error:', e);
            }
        }

        async function loadRecentSnapshots() {
            try {
                const { data, error } = await supabase
                    .from('web_snapshots')
                    .select('*')
                    .order('created_at', { ascending: false })
                    .limit(12);

                if (error) throw error;

                const grid = document.getElementById('snapshotGrid');

                if (!data || data.length === 0) {
                    grid.innerHTML = '<div class="loading">No snapshots yet. Be the first to save one!</div>';
                    return;
                }

                grid.innerHTML = data.map(snapshot => `
                    <div class="snapshot-card" onclick="viewSnapshot('${snapshot.url}')">
                        <div class="snapshot-url">${truncateUrl(snapshot.url)}</div>
                        <div class="snapshot-date">${formatDate(snapshot.created_at)}</div>
                        <div class="snapshot-preview">${truncate(snapshot.title || 'Untitled', 80)}</div>
                    </div>
                `).join('');
            } catch (e) {
                console.error('Load snapshots error:', e);
                document.getElementById('snapshotGrid').innerHTML =
                    '<div class="loading">Unable to load snapshots</div>';
            }
        }

        window.searchArchive = async function() {
            const url = document.getElementById('searchInput').value.trim();
            if (!url) {
                alert('Please enter a URL');
                return;
            }

            try {
                const { data, error } = await supabase
                    .from('web_snapshots')
                    .select('*')
                    .eq('url', url)
                    .order('created_at', { ascending: false });

                if (error) throw error;

                if (!data || data.length === 0) {
                    alert('No snapshots found for this URL. Try saving one!');
                    return;
                }

                displayTimeline(url, data);
            } catch (e) {
                console.error('Search error:', e);
                alert('Error searching archive');
            }
        };

        window.saveSnapshot = async function() {
            const url = document.getElementById('searchInput').value.trim();
            if (!url) {
                alert('Please enter a URL');
                return;
            }

            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                alert('Please enter a valid URL starting with http:// or https://');
                return;
            }

            try {
                const snapshot = {
                    url: url,
                    title: `Snapshot of ${url}`,
                    user_id: currentUser?.id || 'anonymous'
                };

                const { error } = await supabase
                    .from('web_snapshots')
                    .insert([snapshot]);

                if (error) throw error;

                alert('‚úÖ Snapshot saved successfully!');
                await loadStats();
                await loadRecentSnapshots();
                document.getElementById('searchInput').value = '';
            } catch (e) {
                console.error('Save error:', e);
                alert('Error saving snapshot');
            }
        };

        window.viewSnapshot = async function(url) {
            await window.searchArchive.call(null);
            document.getElementById('searchInput').value = url;
        };

        function displayTimeline(url, snapshots) {
            const timelineSection = document.getElementById('timeline');
            const timelineUrl = document.getElementById('timelineUrl');
            const timelineContent = document.getElementById('timelineContent');

            timelineUrl.textContent = truncateUrl(url);
            timelineContent.innerHTML = snapshots.map(snapshot => `
                <div class="timeline-item">
                    <div class="timeline-date">${formatDate(snapshot.created_at)}</div>
                    <div class="timeline-content">
                        <div class="timeline-title">${snapshot.title || 'Untitled'}</div>
                        <div class="timeline-description">Saved by archive</div>
                    </div>
                </div>
            `).join('');

            timelineSection.style.display = 'block';
            timelineSection.scrollIntoView({ behavior: 'smooth' });
        }

        function truncateUrl(url) {
            try {
                const urlObj = new URL(url);
                return urlObj.hostname + urlObj.pathname;
            } catch {
                return url.substring(0, 50) + '...';
            }
        }

        function truncate(str, length) {
            return str.length > length ? str.substring(0, length) + '...' : str;
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        init();
    </script>
<script src="/sloppy-header/sloppy-bar.js"></script>
<script src="/vibelib-extended.js"></script>
<script>
  // Compatibility Patch for Legacy Apps
  window.addEventListener("load", () => {
    if (window.SloppyKarma && window.VibeLib.Economy) {
      // Redirect old calls to new engine
      window.SloppyKarma.track = window.VibeLib.Economy.track;
    }
  });
</script>
</body>
</html>
