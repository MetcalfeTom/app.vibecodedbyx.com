<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CYBER VAULT - Breach Protocol</title>
  <link rel="icon" href="https://emojicdn.elk.sh/üîì">

  <meta property="og:title" content="CYBER VAULT">
  <meta property="og:description" content="Solve logic puzzles to breach the digital vault">
  <meta property="og:url" content="https://app.sloppy.live/cyber-vault">
  <meta property="og:image" content="https://app.sloppy.live/cyber-vault/og-image.png">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Fira+Code:wght@300;400;500&display=swap" rel="stylesheet">

  <style>
    :root {
      --cyan: #00fff2;
      --magenta: #ff00ff;
      --yellow: #ffff00;
      --dark: #0a0a0f;
      --darker: #050508;
      --success: #00ff88;
      --danger: #ff3366;
      --grid-color: rgba(0, 255, 242, 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Fira Code', monospace;
      background: var(--darker);
      color: var(--cyan);
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* Animated grid background */
    .grid-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image:
        linear-gradient(var(--grid-color) 1px, transparent 1px),
        linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
      background-size: 50px 50px;
      animation: gridMove 20s linear infinite;
      z-index: 0;
    }

    @keyframes gridMove {
      0% { transform: perspective(500px) rotateX(60deg) translateY(0); }
      100% { transform: perspective(500px) rotateX(60deg) translateY(50px); }
    }

    .scanline {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        transparent 50%,
        rgba(0, 0, 0, 0.03) 50%
      );
      background-size: 100% 4px;
      pointer-events: none;
      z-index: 1000;
    }

    .container {
      position: relative;
      z-index: 10;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      min-height: 100vh;
    }

    /* Header */
    .header {
      text-align: center;
      padding: 30px 0;
      border-bottom: 1px solid var(--cyan);
      margin-bottom: 30px;
    }

    .logo {
      font-family: 'Orbitron', sans-serif;
      font-size: 2.5rem;
      font-weight: 900;
      background: linear-gradient(135deg, var(--cyan), var(--magenta));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 0 30px rgba(0, 255, 242, 0.5);
      letter-spacing: 8px;
      animation: glitch 3s infinite;
    }

    @keyframes glitch {
      0%, 90%, 100% { transform: translateX(0); }
      92% { transform: translateX(-2px); }
      94% { transform: translateX(2px); }
      96% { transform: translateX(-1px); }
      98% { transform: translateX(1px); }
    }

    .subtitle {
      font-size: 0.9rem;
      color: var(--magenta);
      margin-top: 10px;
      letter-spacing: 4px;
    }

    /* Stats bar */
    .stats-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 20px;
      background: rgba(0, 255, 242, 0.05);
      border: 1px solid rgba(0, 255, 242, 0.2);
      border-radius: 4px;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 10px;
    }

    .stat {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .stat-label {
      font-size: 0.7rem;
      color: rgba(0, 255, 242, 0.6);
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .stat-value {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.2rem;
      color: var(--cyan);
    }

    .stat-value.danger { color: var(--danger); }
    .stat-value.success { color: var(--success); }

    /* Terminal display */
    .terminal {
      background: var(--dark);
      border: 1px solid var(--cyan);
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 20px;
    }

    .terminal-header {
      background: rgba(0, 255, 242, 0.1);
      padding: 10px 15px;
      display: flex;
      align-items: center;
      gap: 8px;
      border-bottom: 1px solid rgba(0, 255, 242, 0.2);
    }

    .terminal-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    .terminal-dot.red { background: var(--danger); }
    .terminal-dot.yellow { background: var(--yellow); }
    .terminal-dot.green { background: var(--success); }

    .terminal-title {
      margin-left: 10px;
      font-size: 0.8rem;
      color: rgba(0, 255, 242, 0.7);
    }

    .terminal-body {
      padding: 20px;
      min-height: 200px;
    }

    .terminal-line {
      margin-bottom: 8px;
      opacity: 0;
      animation: typeIn 0.3s forwards;
    }

    @keyframes typeIn {
      to { opacity: 1; }
    }

    .prompt {
      color: var(--success);
    }

    .system {
      color: var(--magenta);
    }

    .warning {
      color: var(--yellow);
    }

    .error {
      color: var(--danger);
    }

    /* Puzzle container */
    .puzzle-container {
      background: var(--dark);
      border: 1px solid var(--cyan);
      border-radius: 4px;
      padding: 30px;
      margin-bottom: 20px;
    }

    .puzzle-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.3rem;
      color: var(--magenta);
      margin-bottom: 10px;
      text-transform: uppercase;
      letter-spacing: 3px;
    }

    .puzzle-desc {
      color: rgba(0, 255, 242, 0.7);
      font-size: 0.9rem;
      margin-bottom: 25px;
      line-height: 1.6;
    }

    /* Puzzle types */
    .sequence-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }

    .sequence-cell {
      aspect-ratio: 1;
      background: rgba(0, 255, 242, 0.1);
      border: 2px solid rgba(0, 255, 242, 0.3);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Orbitron', sans-serif;
      font-size: 1.2rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .sequence-cell:hover {
      background: rgba(0, 255, 242, 0.2);
      border-color: var(--cyan);
      box-shadow: 0 0 15px rgba(0, 255, 242, 0.3);
    }

    .sequence-cell.selected {
      background: rgba(255, 0, 255, 0.2);
      border-color: var(--magenta);
      color: var(--magenta);
    }

    .sequence-cell.correct {
      background: rgba(0, 255, 136, 0.2);
      border-color: var(--success);
      color: var(--success);
    }

    .sequence-cell.wrong {
      background: rgba(255, 51, 102, 0.2);
      border-color: var(--danger);
      color: var(--danger);
      animation: shake 0.3s;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-5px); }
      75% { transform: translateX(5px); }
    }

    /* Pattern display */
    .pattern-display {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-bottom: 25px;
      padding: 20px;
      background: rgba(0, 0, 0, 0.3);
      border-radius: 4px;
    }

    .pattern-slot {
      width: 50px;
      height: 50px;
      background: rgba(0, 255, 242, 0.1);
      border: 2px solid rgba(0, 255, 242, 0.3);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Orbitron', sans-serif;
      font-size: 1.1rem;
    }

    .pattern-slot.filled {
      border-color: var(--magenta);
      color: var(--magenta);
    }

    .pattern-slot.target {
      border-color: var(--yellow);
      color: var(--yellow);
    }

    /* Buttons */
    .btn {
      background: transparent;
      border: 2px solid var(--cyan);
      color: var(--cyan);
      padding: 12px 30px;
      font-family: 'Orbitron', sans-serif;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 2px;
    }

    .btn:hover {
      background: var(--cyan);
      color: var(--dark);
      box-shadow: 0 0 25px rgba(0, 255, 242, 0.5);
    }

    .btn.primary {
      border-color: var(--magenta);
      color: var(--magenta);
    }

    .btn.primary:hover {
      background: var(--magenta);
      color: var(--dark);
      box-shadow: 0 0 25px rgba(255, 0, 255, 0.5);
    }

    .btn-row {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 20px;
    }

    /* Progress */
    .vault-progress {
      margin-bottom: 20px;
    }

    .progress-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      font-size: 0.8rem;
    }

    .progress-bar {
      height: 8px;
      background: rgba(0, 255, 242, 0.1);
      border-radius: 4px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--cyan), var(--magenta));
      transition: width 0.5s;
      border-radius: 4px;
    }

    /* Screens */
    .screen {
      display: none;
    }

    .screen.active {
      display: block;
      animation: fadeIn 0.5s;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Victory screen */
    .victory {
      text-align: center;
      padding: 50px 20px;
    }

    .victory-icon {
      font-size: 5rem;
      margin-bottom: 20px;
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    .victory-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 2rem;
      color: var(--success);
      margin-bottom: 15px;
      text-transform: uppercase;
      letter-spacing: 5px;
    }

    .victory-stats {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin: 30px 0;
    }

    /* Backlink */
    .backlink {
      text-align: center;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid rgba(0, 255, 242, 0.2);
    }

    .backlink a {
      color: rgba(0, 255, 242, 0.5);
      text-decoration: none;
      font-size: 0.8rem;
    }

    .backlink a:hover {
      color: var(--cyan);
    }

    /* Binary rain effect */
    .binary-rain {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 5;
      opacity: 0.1;
    }

    /* Mobile */
    @media (max-width: 600px) {
      .logo { font-size: 1.8rem; letter-spacing: 4px; }
      .sequence-grid { grid-template-columns: repeat(3, 1fr); }
      .stats-bar { justify-content: center; }
      .btn { padding: 10px 20px; font-size: 0.8rem; }
      .pattern-slot { width: 40px; height: 40px; font-size: 0.9rem; }
    }
  </style>
</head>
<body>
  <div class="grid-bg"></div>
  <div class="scanline"></div>
  <canvas class="binary-rain" id="rain"></canvas>

  <div class="container">
    <header class="header">
      <h1 class="logo">CYBER VAULT</h1>
      <p class="subtitle">// BREACH PROTOCOL v2.0 //</p>
    </header>

    <!-- Start Screen -->
    <div class="screen active" id="startScreen">
      <div class="terminal">
        <div class="terminal-header">
          <div class="terminal-dot red"></div>
          <div class="terminal-dot yellow"></div>
          <div class="terminal-dot green"></div>
          <span class="terminal-title">system_init.exe</span>
        </div>
        <div class="terminal-body" id="initTerminal">
          <div class="terminal-line" style="animation-delay: 0.1s"><span class="prompt">[SYS]</span> Initializing breach protocol...</div>
          <div class="terminal-line" style="animation-delay: 0.4s"><span class="system">[NET]</span> Connection established to VAULT_ALPHA</div>
          <div class="terminal-line" style="animation-delay: 0.7s"><span class="warning">[SEC]</span> WARNING: Multiple security layers detected</div>
          <div class="terminal-line" style="animation-delay: 1s"><span class="prompt">[SYS]</span> Security protocols: PATTERN | SEQUENCE | BINARY | MEMORY</div>
          <div class="terminal-line" style="animation-delay: 1.3s"><span class="system">[NET]</span> Bypass tools loaded successfully</div>
          <div class="terminal-line" style="animation-delay: 1.6s"><span class="prompt">[SYS]</span> Awaiting operator confirmation...</div>
        </div>
      </div>
      <div class="btn-row">
        <button class="btn primary" onclick="startGame()">INITIATE BREACH</button>
      </div>
    </div>

    <!-- Game Screen -->
    <div class="screen" id="gameScreen">
      <div class="stats-bar">
        <div class="stat">
          <span class="stat-label">Level</span>
          <span class="stat-value" id="levelDisplay">1</span>
        </div>
        <div class="stat">
          <span class="stat-label">Firewalls</span>
          <span class="stat-value" id="firewallDisplay">0/4</span>
        </div>
        <div class="stat">
          <span class="stat-label">Timer</span>
          <span class="stat-value" id="timerDisplay">60</span>
        </div>
        <div class="stat">
          <span class="stat-label">Attempts</span>
          <span class="stat-value" id="attemptsDisplay">3</span>
        </div>
      </div>

      <div class="vault-progress">
        <div class="progress-label">
          <span>VAULT ACCESS</span>
          <span id="progressPercent">0%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>
      </div>

      <div class="puzzle-container" id="puzzleContainer">
        <!-- Puzzle content injected here -->
      </div>
    </div>

    <!-- Victory Screen -->
    <div class="screen" id="victoryScreen">
      <div class="victory">
        <div class="victory-icon">üîì</div>
        <h2 class="victory-title">VAULT BREACHED</h2>
        <p style="color: var(--cyan); margin-bottom: 20px;">Access granted to classified data</p>
        <div class="victory-stats">
          <div class="stat">
            <span class="stat-label">Time</span>
            <span class="stat-value success" id="finalTime">--</span>
          </div>
          <div class="stat">
            <span class="stat-label">Attempts</span>
            <span class="stat-value" id="finalAttempts">--</span>
          </div>
        </div>
        <div class="terminal" style="text-align: left; margin-top: 30px;">
          <div class="terminal-header">
            <div class="terminal-dot red"></div>
            <div class="terminal-dot yellow"></div>
            <div class="terminal-dot green"></div>
            <span class="terminal-title">vault_contents.dat</span>
          </div>
          <div class="terminal-body">
            <div class="terminal-line"><span class="success">[DECRYPTED]</span> Access Level: ULTRA</div>
            <div class="terminal-line"><span class="system">[DATA]</span> "The code is within you"</div>
            <div class="terminal-line"><span class="prompt">[SYS]</span> Connection terminated by operator</div>
          </div>
        </div>
        <div class="btn-row" style="margin-top: 30px;">
          <button class="btn primary" onclick="startGame()">BREACH AGAIN</button>
        </div>
      </div>
    </div>

    <!-- Game Over Screen -->
    <div class="screen" id="gameoverScreen">
      <div class="victory">
        <div class="victory-icon" style="filter: hue-rotate(300deg);">üîí</div>
        <h2 class="victory-title" style="color: var(--danger);">BREACH FAILED</h2>
        <p style="color: var(--danger); margin-bottom: 20px;">Security countermeasures activated</p>
        <div class="terminal" style="text-align: left; margin-top: 30px;">
          <div class="terminal-header">
            <div class="terminal-dot red"></div>
            <div class="terminal-dot yellow"></div>
            <div class="terminal-dot green"></div>
            <span class="terminal-title">security_log.exe</span>
          </div>
          <div class="terminal-body">
            <div class="terminal-line"><span class="error">[ALERT]</span> Intrusion detected</div>
            <div class="terminal-line"><span class="warning">[SEC]</span> Tracing connection origin...</div>
            <div class="terminal-line"><span class="error">[SYS]</span> Connection forcibly terminated</div>
          </div>
        </div>
        <div class="btn-row" style="margin-top: 30px;">
          <button class="btn" onclick="startGame()">TRY AGAIN</button>
        </div>
      </div>
    </div>

    <div class="backlink">
      <a href="https://sloppy.live">‚Üê back to sloppy.live</a>
    </div>
  </div>

  <script>
    // Game state
    let state = {
      level: 1,
      firewalls: 0,
      totalFirewalls: 4,
      timer: 60,
      attempts: 3,
      timerInterval: null,
      startTime: null,
      totalAttempts: 0
    };

    // Puzzle types
    const puzzleTypes = ['sequence', 'pattern', 'binary', 'memory'];

    // Binary rain effect
    const rainCanvas = document.getElementById('rain');
    const rainCtx = rainCanvas.getContext('2d');

    function initRain() {
      rainCanvas.width = window.innerWidth;
      rainCanvas.height = window.innerHeight;

      const columns = Math.floor(rainCanvas.width / 20);
      const drops = Array(columns).fill(0);

      function drawRain() {
        rainCtx.fillStyle = 'rgba(5, 5, 8, 0.05)';
        rainCtx.fillRect(0, 0, rainCanvas.width, rainCanvas.height);

        rainCtx.fillStyle = '#00fff2';
        rainCtx.font = '14px Fira Code';

        for (let i = 0; i < columns; i++) {
          const char = Math.random() > 0.5 ? '1' : '0';
          const x = i * 20;
          const y = drops[i] * 20;

          rainCtx.fillText(char, x, y);

          if (y > rainCanvas.height && Math.random() > 0.99) {
            drops[i] = 0;
          }
          drops[i]++;
        }

        requestAnimationFrame(drawRain);
      }

      drawRain();
    }

    initRain();
    window.addEventListener('resize', initRain);

    // Screen management
    function showScreen(id) {
      document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    // Start game
    function startGame() {
      state = {
        level: 1,
        firewalls: 0,
        totalFirewalls: 4,
        timer: 60,
        attempts: 3,
        timerInterval: null,
        startTime: Date.now(),
        totalAttempts: 0
      };

      updateStats();
      showScreen('gameScreen');
      startTimer();
      loadPuzzle();
    }

    // Timer
    function startTimer() {
      clearInterval(state.timerInterval);
      state.timerInterval = setInterval(() => {
        state.timer--;
        document.getElementById('timerDisplay').textContent = state.timer;

        if (state.timer <= 10) {
          document.getElementById('timerDisplay').classList.add('danger');
        }

        if (state.timer <= 0) {
          gameOver();
        }
      }, 1000);
    }

    // Update stats display
    function updateStats() {
      document.getElementById('levelDisplay').textContent = state.level;
      document.getElementById('firewallDisplay').textContent = `${state.firewalls}/${state.totalFirewalls}`;
      document.getElementById('timerDisplay').textContent = state.timer;
      document.getElementById('timerDisplay').classList.remove('danger');
      document.getElementById('attemptsDisplay').textContent = state.attempts;
      document.getElementById('attemptsDisplay').classList.toggle('danger', state.attempts <= 1);

      const progress = (state.firewalls / state.totalFirewalls) * 100;
      document.getElementById('progressFill').style.width = progress + '%';
      document.getElementById('progressPercent').textContent = Math.round(progress) + '%';
    }

    // Load puzzle
    function loadPuzzle() {
      const puzzleType = puzzleTypes[state.firewalls % puzzleTypes.length];
      const container = document.getElementById('puzzleContainer');

      switch (puzzleType) {
        case 'sequence':
          loadSequencePuzzle(container);
          break;
        case 'pattern':
          loadPatternPuzzle(container);
          break;
        case 'binary':
          loadBinaryPuzzle(container);
          break;
        case 'memory':
          loadMemoryPuzzle(container);
          break;
      }
    }

    // Sequence puzzle - find the pattern
    function loadSequencePuzzle(container) {
      const sequences = [
        { pattern: [2, 4, 8, 16], answer: 32, options: [24, 32, 48, 64] },
        { pattern: [1, 1, 2, 3, 5], answer: 8, options: [6, 7, 8, 13] },
        { pattern: [3, 6, 12, 24], answer: 48, options: [36, 42, 48, 96] },
        { pattern: [1, 4, 9, 16], answer: 25, options: [20, 25, 30, 36] },
        { pattern: [2, 6, 18, 54], answer: 162, options: [108, 162, 216, 324] }
      ];

      const seq = sequences[Math.floor(Math.random() * sequences.length)];
      const shuffledOptions = [...seq.options].sort(() => Math.random() - 0.5);

      container.innerHTML = `
        <h3 class="puzzle-title">Sequence Breach</h3>
        <p class="puzzle-desc">Analyze the pattern and select the next value in the sequence to bypass the firewall.</p>
        <div class="pattern-display">
          ${seq.pattern.map(n => `<div class="pattern-slot filled">${n}</div>`).join('')}
          <div class="pattern-slot target">?</div>
        </div>
        <div class="sequence-grid">
          ${shuffledOptions.map(n => `
            <div class="sequence-cell" onclick="checkSequence(${n}, ${seq.answer})">${n}</div>
          `).join('')}
        </div>
      `;
    }

    function checkSequence(selected, answer) {
      const cells = document.querySelectorAll('.sequence-cell');
      state.totalAttempts++;

      cells.forEach(cell => {
        if (parseInt(cell.textContent) === selected) {
          if (selected === answer) {
            cell.classList.add('correct');
            setTimeout(() => puzzleSolved(), 500);
          } else {
            cell.classList.add('wrong');
            loseAttempt();
          }
        }
      });
    }

    // Pattern puzzle - match the code
    function loadPatternPuzzle(container) {
      const symbols = ['‚óÜ', '‚óè', '‚ñ†', '‚ñ≤', '‚òÖ', '‚óá'];
      const patternLength = 4 + Math.floor(state.level / 2);
      const pattern = [];

      for (let i = 0; i < patternLength; i++) {
        pattern.push(symbols[Math.floor(Math.random() * symbols.length)]);
      }

      let userInput = [];

      container.innerHTML = `
        <h3 class="puzzle-title">Pattern Match</h3>
        <p class="puzzle-desc">Memorize the pattern, then recreate it using the symbols below.</p>
        <div class="pattern-display" id="patternTarget">
          ${pattern.map(s => `<div class="pattern-slot filled">${s}</div>`).join('')}
        </div>
        <div class="pattern-display" id="patternInput">
          ${pattern.map(() => `<div class="pattern-slot"></div>`).join('')}
        </div>
        <div class="sequence-grid" style="grid-template-columns: repeat(6, 1fr);">
          ${symbols.map(s => `
            <div class="sequence-cell" onclick="addPatternSymbol('${s}')">${s}</div>
          `).join('')}
        </div>
        <div class="btn-row">
          <button class="btn" onclick="clearPattern()">CLEAR</button>
          <button class="btn primary" onclick="checkPattern()">VERIFY</button>
        </div>
      `;

      window.currentPattern = pattern;
      window.userPattern = [];

      // Hide pattern after delay
      setTimeout(() => {
        document.getElementById('patternTarget').querySelectorAll('.pattern-slot').forEach(slot => {
          slot.style.color = 'transparent';
        });
      }, 2000 + (patternLength * 300));
    }

    window.addPatternSymbol = function(symbol) {
      if (window.userPattern.length < window.currentPattern.length) {
        window.userPattern.push(symbol);
        const slots = document.getElementById('patternInput').querySelectorAll('.pattern-slot');
        slots[window.userPattern.length - 1].textContent = symbol;
        slots[window.userPattern.length - 1].classList.add('filled');
      }
    };

    window.clearPattern = function() {
      window.userPattern = [];
      document.getElementById('patternInput').querySelectorAll('.pattern-slot').forEach(slot => {
        slot.textContent = '';
        slot.classList.remove('filled');
      });
    };

    window.checkPattern = function() {
      state.totalAttempts++;
      const correct = window.userPattern.join('') === window.currentPattern.join('');

      if (correct) {
        puzzleSolved();
      } else {
        document.getElementById('patternInput').querySelectorAll('.pattern-slot').forEach(slot => {
          slot.style.borderColor = 'var(--danger)';
          slot.style.animation = 'shake 0.3s';
        });
        loseAttempt();
      }
    };

    // Binary puzzle - decode the message
    function loadBinaryPuzzle(container) {
      const words = ['HACK', 'CODE', 'DATA', 'BYTE', 'NODE', 'PORT', 'ROOT', 'SUDO'];
      const word = words[Math.floor(Math.random() * words.length)];
      const binary = word.split('').map(c => c.charCodeAt(0).toString(2).padStart(8, '0')).join(' ');

      const options = [word];
      while (options.length < 4) {
        const opt = words[Math.floor(Math.random() * words.length)];
        if (!options.includes(opt)) options.push(opt);
      }
      options.sort(() => Math.random() - 0.5);

      container.innerHTML = `
        <h3 class="puzzle-title">Binary Decode</h3>
        <p class="puzzle-desc">Decrypt the binary sequence to reveal the access keyword.</p>
        <div class="pattern-display" style="flex-wrap: wrap;">
          <code style="font-size: 0.9rem; word-break: break-all;">${binary}</code>
        </div>
        <div class="sequence-grid">
          ${options.map(w => `
            <div class="sequence-cell" onclick="checkBinary('${w}', '${word}')">${w}</div>
          `).join('')}
        </div>
      `;
    }

    window.checkBinary = function(selected, answer) {
      state.totalAttempts++;
      const cells = document.querySelectorAll('.sequence-cell');

      cells.forEach(cell => {
        if (cell.textContent === selected) {
          if (selected === answer) {
            cell.classList.add('correct');
            setTimeout(() => puzzleSolved(), 500);
          } else {
            cell.classList.add('wrong');
            loseAttempt();
          }
        }
      });
    };

    // Memory puzzle - remember the highlighted cells
    function loadMemoryPuzzle(container) {
      const gridSize = 9;
      const highlightCount = 3 + Math.floor(state.level / 2);
      const highlighted = [];

      while (highlighted.length < highlightCount) {
        const idx = Math.floor(Math.random() * gridSize);
        if (!highlighted.includes(idx)) highlighted.push(idx);
      }

      container.innerHTML = `
        <h3 class="puzzle-title">Memory Trace</h3>
        <p class="puzzle-desc">Memorize the highlighted nodes, then select them in any order.</p>
        <div class="sequence-grid" style="grid-template-columns: repeat(3, 1fr); max-width: 300px; margin: 0 auto;" id="memoryGrid">
          ${Array(gridSize).fill(0).map((_, i) => `
            <div class="sequence-cell" data-idx="${i}">${String.fromCharCode(65 + i)}</div>
          `).join('')}
        </div>
        <div class="btn-row">
          <button class="btn primary" onclick="verifyMemory()">VERIFY</button>
        </div>
      `;

      window.memoryTarget = highlighted;
      window.memorySelected = [];

      // Show highlighted cells
      setTimeout(() => {
        highlighted.forEach(idx => {
          document.querySelector(`[data-idx="${idx}"]`).classList.add('selected');
        });

        // Hide after delay
        setTimeout(() => {
          document.querySelectorAll('.sequence-cell').forEach(cell => {
            cell.classList.remove('selected');
            cell.onclick = function() {
              const idx = parseInt(this.dataset.idx);
              if (window.memorySelected.includes(idx)) {
                window.memorySelected = window.memorySelected.filter(i => i !== idx);
                this.classList.remove('selected');
              } else {
                window.memorySelected.push(idx);
                this.classList.add('selected');
              }
            };
          });
        }, 1500 + (highlightCount * 300));
      }, 500);
    }

    window.verifyMemory = function() {
      state.totalAttempts++;
      const correct = window.memoryTarget.length === window.memorySelected.length &&
                      window.memoryTarget.every(t => window.memorySelected.includes(t));

      if (correct) {
        document.querySelectorAll('.sequence-cell.selected').forEach(cell => {
          cell.classList.remove('selected');
          cell.classList.add('correct');
        });
        setTimeout(() => puzzleSolved(), 500);
      } else {
        document.querySelectorAll('.sequence-cell').forEach(cell => {
          if (cell.classList.contains('selected')) {
            cell.classList.add('wrong');
          }
        });
        loseAttempt();
      }
    };

    // Puzzle solved
    function puzzleSolved() {
      state.firewalls++;
      state.timer = Math.min(state.timer + 15, 99); // Bonus time
      state.level = Math.floor(state.firewalls / state.totalFirewalls) + 1;

      updateStats();

      if (state.firewalls >= state.totalFirewalls) {
        victory();
      } else {
        loadPuzzle();
      }
    }

    // Lose attempt
    function loseAttempt() {
      state.attempts--;
      updateStats();

      if (state.attempts <= 0) {
        setTimeout(() => gameOver(), 500);
      } else {
        setTimeout(() => loadPuzzle(), 800);
      }
    }

    // Victory
    function victory() {
      clearInterval(state.timerInterval);
      const elapsed = Math.floor((Date.now() - state.startTime) / 1000);

      document.getElementById('finalTime').textContent = elapsed + 's';
      document.getElementById('finalAttempts').textContent = state.totalAttempts;

      showScreen('victoryScreen');
    }

    // Game over
    function gameOver() {
      clearInterval(state.timerInterval);
      showScreen('gameoverScreen');
    }
  </script>
<script src="/apps/sloppy-header/sloppy-bar.js"></script>
<script src="/vibelib-extended.js"></script>
<script>
  // Compatibility Patch for Legacy Apps
  window.addEventListener("load", () => {
    if (window.SloppyKarma && window.VibeLib.Economy) {
      // Redirect old calls to new engine
      window.SloppyKarma.track = window.VibeLib.Economy.track;
    }
  });
</script>
</body>
</html>
