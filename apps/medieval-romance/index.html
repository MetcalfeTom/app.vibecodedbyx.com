<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="A medieval romance simulator set in England. Choose your path through noble courts, taverns, and castle intrigue." />
  <meta property="og:title" content="Medieval Romance Quest" />
  <meta property="og:description" content="Navigate love and politics in medieval England. A romantic adventure through noble courts and castle intrigue." />
  <meta property="og:url" content="https://app.vibecodedbyx.com/medieval-romance/" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://app.vibecodedbyx.com/medieval-romance/og.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Medieval Romance Quest" />
  <meta name="twitter:description" content="Navigate love and politics in medieval England. A romantic adventure through noble courts and castle intrigue." />
  <meta name="twitter:image" content="https://app.vibecodedbyx.com/medieval-romance/og.png" />
  <title>Medieval Romance Quest</title>
  <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAxMDAgMTAwJz48dGV4dCB5PScuOWVtJyBmb250LXNpemU9JzkwJz7wn5GRPC90ZXh0Pjwvc3ZnPg==" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            medieval: ['Cinzel', 'serif'],
          },
          colors: {
            parchment: '#f4f1e8',
            ink: '#2d1810',
            gold: '#d4af37',
            royal: '#1e3a8a',
            crimson: '#dc2626'
          }
        }
      }
    }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Crimson+Text:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
  <style>
    @keyframes cloudDrift {
      0% { transform: translateX(-100px) translateY(0px); opacity: 0.3; }
      50% { transform: translateX(0px) translateY(-10px); opacity: 0.6; }
      100% { transform: translateX(100px) translateY(0px); opacity: 0.3; }
    }

    @keyframes castleFlags {
      0% { transform: rotate(0deg) scaleX(1); }
      50% { transform: rotate(2deg) scaleX(1.05); }
      100% { transform: rotate(0deg) scaleX(1); }
    }

    @keyframes fireflicker {
      0%, 100% { opacity: 0.8; transform: scale(1) rotate(0deg); }
      25% { opacity: 1; transform: scale(1.1) rotate(1deg); }
      50% { opacity: 0.9; transform: scale(0.95) rotate(-1deg); }
      75% { opacity: 1; transform: scale(1.05) rotate(0.5deg); }
    }

    @keyframes starsSparkle {
      0%, 100% { opacity: 0.6; transform: scale(1); }
      50% { opacity: 1; transform: scale(1.2); }
    }

    @keyframes bannerWave {
      0% { transform: skew(0deg, 0deg); }
      25% { transform: skew(1deg, 0.5deg); }
      50% { transform: skew(0deg, 1deg); }
      75% { transform: skew(-1deg, 0.5deg); }
      100% { transform: skew(0deg, 0deg); }
    }

    body {
      background:
        /* Starry night sky */
        radial-gradient(2px 2px at 20px 30px, rgba(255,255,255,0.9), transparent),
        radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.8), transparent),
        radial-gradient(1px 1px at 90px 40px, rgba(255,255,255,0.7), transparent),
        radial-gradient(1px 1px at 130px 80px, rgba(255,255,255,0.6), transparent),
        radial-gradient(2px 2px at 160px 30px, rgba(255,255,255,0.8), transparent),
        radial-gradient(1px 1px at 200px 60px, rgba(255,255,255,0.7), transparent),
        radial-gradient(2px 2px at 240px 20px, rgba(255,255,255,0.9), transparent),
        radial-gradient(1px 1px at 280px 90px, rgba(255,255,255,0.6), transparent),

        /* Mountain silhouettes */
        linear-gradient(to bottom,
          transparent 60%,
          rgba(15, 23, 42, 0.8) 65%,
          rgba(30, 41, 59, 0.9) 70%,
          rgba(51, 65, 85, 0.95) 75%,
          transparent 80%
        ),

        /* Castle silhouette on hills */
        linear-gradient(to bottom,
          transparent 70%,
          rgba(15, 23, 42, 0.9) 72%,
          rgba(30, 41, 59, 0.95) 74%,
          rgba(51, 65, 85, 1) 76%,
          transparent 80%
        ),

        /* Atmospheric mist/fog */
        radial-gradient(ellipse at 30% 80%, rgba(148, 163, 184, 0.3) 0%, transparent 50%),
        radial-gradient(ellipse at 70% 85%, rgba(148, 163, 184, 0.2) 0%, transparent 60%),

        /* Dawn/dusk gradient sky */
        linear-gradient(to bottom,
          #1e293b 0%,     /* Dark night blue */
          #334155 20%,    /* Lighter blue */
          #475569 35%,    /* Blue-gray */
          #64748b 50%,    /* Light blue-gray */
          #e2e8f0 75%,    /* Light gray */
          #f1f5f9 100%    /* Almost white */
        );

      background-size:
        300px 200px,  /* Stars pattern 1 */
        350px 250px,  /* Stars pattern 2 */
        200px 150px,  /* Stars pattern 3 */
        400px 300px,  /* Stars pattern 4 */
        250px 180px,  /* Stars pattern 5 */
        320px 220px,  /* Stars pattern 6 */
        280px 200px,  /* Stars pattern 7 */
        360px 280px,  /* Stars pattern 8 */
        100% 100%,    /* Mountains */
        100% 100%,    /* Castle */
        100% 100%,    /* Mist 1 */
        100% 100%,    /* Mist 2 */
        100% 100%;    /* Sky gradient */

      background-repeat: repeat, repeat, repeat, repeat, repeat, repeat, repeat, repeat, no-repeat, no-repeat, no-repeat, no-repeat, no-repeat;
      background-attachment: fixed;
      position: relative;
      overflow-x: hidden;
    }

    /* Animated clouds */
    body::before {
      content: '';
      position: fixed;
      top: 10%;
      left: -200px;
      width: 100px;
      height: 40px;
      background: radial-gradient(ellipse, rgba(255,255,255,0.4) 0%, transparent 70%);
      border-radius: 50px;
      animation: cloudDrift 25s ease-in-out infinite;
      z-index: 1;
    }

    body::after {
      content: '';
      position: fixed;
      top: 20%;
      right: -150px;
      width: 120px;
      height: 50px;
      background: radial-gradient(ellipse, rgba(255,255,255,0.3) 0%, transparent 70%);
      border-radius: 60px;
      animation: cloudDrift 30s ease-in-out infinite reverse;
      z-index: 1;
    }

    /* Castle tower decorations */
    .castle-decoration::before {
      content: 'üè∞';
      position: fixed;
      bottom: 20%;
      left: 5%;
      font-size: 80px;
      opacity: 0.15;
      z-index: 1;
      filter: sepia(100%) hue-rotate(200deg) brightness(0.5);
      animation: castleFlags 8s ease-in-out infinite;
    }

    .castle-decoration::after {
      content: 'üè∞';
      position: fixed;
      bottom: 18%;
      right: 8%;
      font-size: 100px;
      opacity: 0.1;
      z-index: 1;
      filter: sepia(100%) hue-rotate(180deg) brightness(0.4);
      animation: castleFlags 12s ease-in-out infinite reverse;
    }

    /* Torch/fire effects */
    .torch-light {
      position: fixed;
      bottom: 25%;
      left: 10%;
      width: 20px;
      height: 30px;
      background: radial-gradient(ellipse, rgba(255, 165, 0, 0.6) 0%, rgba(255, 69, 0, 0.4) 50%, transparent 70%);
      border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
      animation: fireflicker 2s ease-in-out infinite;
      z-index: 1;
    }

    .torch-light:nth-child(2) {
      right: 15%;
      left: auto;
      animation-delay: 0.5s;
    }

    /* Floating sparkles */
    .sparkle {
      position: fixed;
      color: rgba(255, 215, 0, 0.8);
      font-size: 12px;
      animation: starsSparkle 3s ease-in-out infinite;
      z-index: 1;
    }

    .sparkle:nth-child(1) { top: 15%; left: 20%; animation-delay: 0s; }
    .sparkle:nth-child(2) { top: 25%; right: 25%; animation-delay: 1s; }
    .sparkle:nth-child(3) { top: 35%; left: 60%; animation-delay: 2s; }
    .sparkle:nth-child(4) { top: 45%; right: 40%; animation-delay: 0.5s; }

    /* Medieval banners */
    .banner {
      position: fixed;
      top: 10%;
      width: 60px;
      height: 120px;
      background: linear-gradient(135deg, #dc2626 0%, #7f1d1d 100%);
      clip-path: polygon(0 0, 100% 0, 100% 80%, 50% 100%, 0 80%);
      animation: bannerWave 4s ease-in-out infinite;
      z-index: 1;
      opacity: 0.7;
    }

    .banner:nth-child(1) { left: 3%; }
    .banner:nth-child(2) { right: 3%; background: linear-gradient(135deg, #1e3a8a 0%, #1e40af 100%); animation-delay: 1s; }

    /* Content overlay styling */
    .content-overlay {
      position: relative;
      z-index: 10;
      background: rgba(244, 241, 232, 0.85);
      backdrop-filter: blur(2px);
      border-radius: 20px;
      border: 2px solid rgba(212, 175, 55, 0.3);
      box-shadow:
        0 20px 60px rgba(0, 0, 0, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.3),
        0 0 0 1px rgba(212, 175, 55, 0.2);
    }

    .medieval-shadow {
      box-shadow:
        0 15px 35px rgba(0, 0, 0, 0.4),
        0 5px 15px rgba(0, 0, 0, 0.2),
        inset 0 1px 0 rgba(255, 255, 255, 0.2);
    }

    /* Parchment texture effect */
    .parchment-texture {
      background:
        radial-gradient(circle at 20% 30%, rgba(139, 69, 19, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 70%, rgba(160, 82, 45, 0.08) 0%, transparent 50%),
        radial-gradient(circle at 40% 80%, rgba(101, 67, 33, 0.05) 0%, transparent 50%),
        linear-gradient(45deg, rgba(244, 241, 232, 0.95) 0%, rgba(232, 226, 208, 0.98) 100%);
    }

    /* Atmospheric particles */
    @keyframes floatUp {
      0% { transform: translateY(100vh) translateX(0px) rotate(0deg); opacity: 0; }
      10% { opacity: 0.5; }
      90% { opacity: 0.3; }
      100% { transform: translateY(-100px) translateX(50px) rotate(360deg); opacity: 0; }
    }

    .floating-particle {
      position: fixed;
      color: rgba(212, 175, 55, 0.4);
      font-size: 8px;
      animation: floatUp 15s linear infinite;
      z-index: 2;
    }

    .floating-particle:nth-child(1) { left: 10%; animation-delay: 0s; }
    .floating-particle:nth-child(2) { left: 30%; animation-delay: 3s; }
    .floating-particle:nth-child(3) { left: 50%; animation-delay: 6s; }
    .floating-particle:nth-child(4) { left: 70%; animation-delay: 9s; }
    .floating-particle:nth-child(5) { left: 90%; animation-delay: 12s; }
  </style>
</head>
<body class="min-h-screen font-serif castle-decoration">
  <!-- Atmospheric Effects -->
  <div class="torch-light"></div>
  <div class="torch-light"></div>

  <div class="sparkle">‚ú®</div>
  <div class="sparkle">‚≠ê</div>
  <div class="sparkle">‚ú®</div>
  <div class="sparkle">‚≠ê</div>

  <div class="banner"></div>
  <div class="banner"></div>

  <div class="floating-particle">‚ú®</div>
  <div class="floating-particle">‚≠ê</div>
  <div class="floating-particle">‚ùÑÔ∏è</div>
  <div class="floating-particle">‚ú®</div>
  <div class="floating-particle">‚≠ê</div>

  <!-- Game Container -->
  <div class="container mx-auto px-4 py-8 max-w-4xl content-overlay">
    <!-- Header -->
    <header class="text-center mb-8">
      <h1 class="text-4xl md:text-6xl font-medieval font-bold text-ink mb-4">
        ‚öîÔ∏è Medieval Romance Quest üëë
      </h1>
      <p class="text-lg text-ink/80 italic">
        Navigate love and politics in medieval England
      </p>
    </header>

    <!-- Auth Section -->
    <div class="parchment-texture backdrop-blur-sm rounded-lg p-4 mb-6 medieval-shadow">
      <div class="flex items-center justify-between">
        <div id="auth-status" class="text-ink font-medium">Loading...</div>
        <div class="space-x-2">
          <button id="signin-btn" class="hidden bg-royal text-white px-4 py-2 rounded-lg hover:bg-royal/80 transition-colors">
            Sign in with Twitter
          </button>
          <button id="signout-btn" class="hidden bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors">
            Sign out
          </button>
        </div>
      </div>
    </div>

    <!-- Game Area -->
    <div class="grid gap-6 lg:grid-cols-3">
      <!-- Main Story Panel -->
      <div class="lg:col-span-2">
        <div class="parchment-texture backdrop-blur-sm rounded-lg p-6 medieval-shadow">
          <div id="story-content">
            <!-- Story Image -->
            <div class="text-center mb-6">
              <div id="story-image" class="text-8xl mb-4">üè∞</div>
              <h2 id="location-title" class="text-2xl font-medieval font-bold text-ink mb-2">
                The Royal Court
              </h2>
            </div>

            <!-- Story Text -->
            <div id="story-text" class="text-ink leading-relaxed mb-6 text-lg">
              <p class="mb-4">
                The year is 1347, and you are a young noble newly arrived at the court of King Edward III.
                The castle halls echo with whispers of romance, political intrigue, and the distant sounds of war.
              </p>
              <p>
                As you enter the great hall, you notice several intriguing figures...
              </p>
            </div>

            <!-- Choices -->
            <div id="choices" class="space-y-3">
              <button class="choice-btn w-full text-left p-4 bg-gradient-to-r from-royal to-royal/80 text-white rounded-lg hover:from-royal/90 hover:to-royal/70 transition-all duration-300 medieval-shadow"
                      data-choice="noble">
                üíé Approach the mysterious noble by the fireplace
              </button>
              <button class="choice-btn w-full text-left p-4 bg-gradient-to-r from-crimson to-crimson/80 text-white rounded-lg hover:from-crimson/90 hover:to-crimson/70 transition-all duration-300 medieval-shadow"
                      data-choice="knight">
                ‚öîÔ∏è Speak with the valiant knight in armor
              </button>
              <button class="choice-btn w-full text-left p-4 bg-gradient-to-r from-green-700 to-green-600 text-white rounded-lg hover:from-green-600 hover:to-green-500 transition-all duration-300 medieval-shadow"
                      data-choice="court">
                üëë Join the courtly dance and mingle
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Side Panel -->
      <div class="space-y-6">
        <!-- Stats -->
        <div class="parchment-texture backdrop-blur-sm rounded-lg p-4 medieval-shadow">
          <h3 class="font-medieval font-bold text-ink mb-4 text-xl">Your Standing</h3>
          <div class="space-y-3">
            <div class="flex justify-between items-center">
              <span class="text-ink">üí∞ Wealth</span>
              <div class="flex space-x-1">
                <span id="wealth-stars">‚≠ê‚≠ê‚≠ê‚òÜ‚òÜ</span>
              </div>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-ink">üëë Honor</span>
              <div class="flex space-x-1">
                <span id="honor-stars">‚≠ê‚≠ê‚≠ê‚òÜ‚òÜ</span>
              </div>
            </div>
            <div class="flex justify-between items-center">
              <span class="text-ink">üíï Romance</span>
              <div class="flex space-x-1">
                <span id="romance-stars">‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Current Romance Interests -->
        <div class="parchment-texture backdrop-blur-sm rounded-lg p-4 medieval-shadow">
          <h3 class="font-medieval font-bold text-ink mb-4 text-xl">Romance Interests</h3>
          <div id="romance-list" class="space-y-2 text-sm text-ink/80">
            <p class="italic">None yet discovered...</p>
          </div>
        </div>

        <!-- Game Progress -->
        <div class="parchment-texture backdrop-blur-sm rounded-lg p-4 medieval-shadow">
          <h3 class="font-medieval font-bold text-ink mb-4 text-xl">Your Journey</h3>
          <div class="text-sm text-ink">
            <p>Chapter: <span id="chapter" class="font-medium">I</span></p>
            <p>Choices Made: <span id="choices-count" class="font-medium">0</span></p>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="text-center mt-8 pt-6 border-t border-ink/20">
      <a href="https://www.vibecodedbyx.com" target="_blank" rel="noopener"
         class="text-royal hover:text-royal/80 transition-colors font-medium">
        ‚Üê Back to the livestream
      </a>
    </footer>
  </div>

  <script type="module">
    import supabase, { supabaseSession } from './supabase-config.js';

    // Game State
    let gameState = {
      user: null,
      currentScene: 'intro',
      stats: {
        wealth: 3,
        honor: 3,
        romance: 0
      },
      romanceInterests: [],
      chapter: 1,
      choicesCount: 0,
      gameProgress: {}
    };

    // Game Scenes
    const scenes = {
      intro: {
        image: 'üè∞',
        title: 'The Royal Court',
        text: `
          <p class="mb-4">
            The year is 1347, and you are a young noble newly arrived at the court of King Edward III.
            The castle halls echo with whispers of romance, political intrigue, and the distant sounds of war.
          </p>
          <p>
            As you enter the great hall, you notice several intriguing figures...
          </p>
        `,
        choices: [
          { id: 'noble', text: 'üíé Approach the mysterious noble by the fireplace', next: 'meet_noble' },
          { id: 'knight', text: '‚öîÔ∏è Speak with the valiant knight in armor', next: 'meet_knight' },
          { id: 'court', text: 'üëë Join the courtly dance and mingle', next: 'court_dance' }
        ]
      },
      meet_noble: {
        image: 'üíé',
        title: 'The Mysterious Noble',
        text: `
          <p class="mb-4">
            You approach a figure draped in rich velvet, their face partially hidden by shadows.
            As you draw near, they turn to reveal piercing green eyes and an enigmatic smile.
          </p>
          <p class="mb-4">
            "Ah, a new face at court," they say in a melodious voice. "I am Lady Evelyn of Ashford.
            And you are...?"
          </p>
          <p>
            How do you introduce yourself?
          </p>
        `,
        choices: [
          { id: 'humble', text: 'üôá Introduce yourself humbly', next: 'noble_humble', effects: { honor: 1 } },
          { id: 'bold', text: 'üòè Make a bold, flirtatious introduction', next: 'noble_bold', effects: { romance: 1 } },
          { id: 'mysterious', text: 'üé≠ Remain mysteriously vague', next: 'noble_mystery', effects: { wealth: 1 } }
        ]
      },
      meet_knight: {
        image: '‚öîÔ∏è',
        title: 'Sir Gareth the Brave',
        text: `
          <p class="mb-4">
            The knight removes their helm to reveal a noble face marked by battle scars and kind eyes.
            Sir Gareth of the Round Table stands before you, legend made flesh.
          </p>
          <p class="mb-4">
            "Well met, young noble. I hear you've just arrived from the countryside.
            The court can be treacherous for those unprepared."
          </p>
          <p>
            How do you respond to this warning?
          </p>
        `,
        choices: [
          { id: 'grateful', text: 'üôè Thank them for the warning', next: 'knight_grateful', effects: { honor: 1 } },
          { id: 'confident', text: 'üí™ Declare you can handle anything', next: 'knight_confident', effects: { romance: 1 } },
          { id: 'curious', text: 'ü§î Ask about the dangers', next: 'knight_curious', effects: { wealth: 1 } }
        ]
      },
      court_dance: {
        image: 'üíÉ',
        title: 'The Courtly Dance',
        text: `
          <p class="mb-4">
            You join the swirling dancers in the center of the hall. The music is lively,
            and you find yourself paired with different nobles as the dance progresses.
          </p>
          <p class="mb-4">
            During a particularly intricate turn, you catch the eye of a charming figure
            who seems to anticipate your every move perfectly.
          </p>
          <p>
            As the music reaches its crescendo, what do you do?
          </p>
        `,
        choices: [
          { id: 'dip', text: 'üíï Attempt a romantic dip', next: 'dance_romantic', effects: { romance: 2 } },
          { id: 'showcase', text: '‚ú® Show off with fancy footwork', next: 'dance_show', effects: { honor: 1, wealth: 1 } },
          { id: 'graceful', text: 'üåπ End with a graceful bow', next: 'dance_graceful', effects: { honor: 2 } }
        ]
      },
      noble_humble: {
        image: 'üíé',
        title: 'A Humble Beginning',
        text: `
          <p class="mb-4">
            Lady Evelyn nods approvingly at your modest introduction. "Humility is rare at court,
            and all the more precious for it. You shall go far here."
          </p>
          <p class="mb-4">
            She leans closer, her voice dropping to a whisper. "The King seeks new advisors
            for his council. Perhaps someone with your... discretion... would be valued."
          </p>
          <p>
            A romance interest has been discovered! Lady Evelyn seems intrigued by your character.
          </p>
        `,
        choices: [
          { id: 'continue', text: '‚û°Ô∏è Continue your evening at court', next: 'court_evening' }
        ]
      }
    };

    // DOM Elements
    const elements = {
      authStatus: document.getElementById('auth-status'),
      signinBtn: document.getElementById('signin-btn'),
      signoutBtn: document.getElementById('signout-btn'),
      storyImage: document.getElementById('story-image'),
      locationTitle: document.getElementById('location-title'),
      storyText: document.getElementById('story-text'),
      choices: document.getElementById('choices'),
      wealthStars: document.getElementById('wealth-stars'),
      honorStars: document.getElementById('honor-stars'),
      romanceStars: document.getElementById('romance-stars'),
      romanceList: document.getElementById('romance-list'),
      chapter: document.getElementById('chapter'),
      choicesCount: document.getElementById('choices-count')
    };

    // Initialize auth
    async function initAuth() {
      try {
        const { session, user } = await supabaseSession();
        gameState.user = user;

        if (user) {
          elements.authStatus.textContent = `Signed in: ...${user.id.slice(-6)}`;
          elements.signoutBtn.classList.remove('hidden');
          elements.signinBtn.classList.add('hidden');

          elements.signoutBtn.onclick = async () => {
            await supabase.auth.signOut();
            location.reload();
          };

          await loadGameProgress();
        } else {
          elements.authStatus.textContent = 'Not signed in';
          elements.signinBtn.classList.remove('hidden');
          elements.signoutBtn.classList.add('hidden');
        }
      } catch (error) {
        console.error('Auth error:', error);
        elements.authStatus.textContent = 'Auth error';
      }
    }

    // Save game progress
    async function saveProgress() {
      if (!gameState.user) return;

      try {
        const { error } = await supabase
          .from('medieval_romance_progress')
          .upsert({
            user_id: gameState.user.id,
            current_scene: gameState.currentScene,
            stats: gameState.stats,
            romance_interests: gameState.romanceInterests,
            chapter: gameState.chapter,
            choices_count: gameState.choicesCount,
            game_progress: gameState.gameProgress
          });

        if (error) console.error('Save error:', error);
      } catch (error) {
        console.error('Save error:', error);
      }
    }

    // Load game progress
    async function loadGameProgress() {
      if (!gameState.user) return;

      try {
        const { data, error } = await supabase
          .from('medieval_romance_progress')
          .select('*')
          .eq('user_id', gameState.user.id)
          .single();

        if (data && !error) {
          gameState.currentScene = data.current_scene || 'intro';
          gameState.stats = data.stats || { wealth: 3, honor: 3, romance: 0 };
          gameState.romanceInterests = data.romance_interests || [];
          gameState.chapter = data.chapter || 1;
          gameState.choicesCount = data.choices_count || 0;
          gameState.gameProgress = data.game_progress || {};
        }
      } catch (error) {
        console.error('Load error:', error);
      }
    }

    // Render stars
    function renderStars(value, max = 5) {
      const filled = '‚≠ê'.repeat(Math.min(value, max));
      const empty = '‚òÜ'.repeat(Math.max(0, max - value));
      return filled + empty;
    }

    // Update UI
    function updateUI() {
      const scene = scenes[gameState.currentScene];
      if (!scene) return;

      elements.storyImage.textContent = scene.image;
      elements.locationTitle.textContent = scene.title;
      elements.storyText.innerHTML = scene.text;

      // Update stats
      elements.wealthStars.textContent = renderStars(gameState.stats.wealth);
      elements.honorStars.textContent = renderStars(gameState.stats.honor);
      elements.romanceStars.textContent = renderStars(gameState.stats.romance);

      // Update romance interests
      if (gameState.romanceInterests.length > 0) {
        elements.romanceList.innerHTML = gameState.romanceInterests
          .map(interest => `<div class="flex items-center space-x-2"><span>${interest.emoji}</span><span>${interest.name}</span></div>`)
          .join('');
      } else {
        elements.romanceList.innerHTML = '<p class="italic">None yet discovered...</p>';
      }

      // Update progress
      elements.chapter.textContent = romanNumeral(gameState.chapter);
      elements.choicesCount.textContent = gameState.choicesCount;

      // Render choices
      elements.choices.innerHTML = '';
      if (scene.choices) {
        scene.choices.forEach(choice => {
          const button = document.createElement('button');
          button.className = 'choice-btn w-full text-left p-4 bg-gradient-to-r from-royal to-royal/80 text-white rounded-lg hover:from-royal/90 hover:to-royal/70 transition-all duration-300 medieval-shadow';
          button.innerHTML = choice.text;
          button.onclick = () => makeChoice(choice);
          elements.choices.appendChild(button);
        });
      }
    }

    // Make choice
    function makeChoice(choice) {
      gameState.choicesCount++;

      // Apply effects
      if (choice.effects) {
        Object.keys(choice.effects).forEach(stat => {
          gameState.stats[stat] = Math.max(0, Math.min(5, gameState.stats[stat] + choice.effects[stat]));
        });
      }

      // Add romance interests based on scene
      if (gameState.currentScene === 'noble_humble' && !gameState.romanceInterests.find(r => r.name === 'Lady Evelyn')) {
        gameState.romanceInterests.push({ name: 'Lady Evelyn', emoji: 'üíé' });
      }

      // Move to next scene
      if (choice.next) {
        gameState.currentScene = choice.next;
      }

      // Save and update
      saveProgress();
      updateUI();
    }

    // Roman numeral converter
    function romanNumeral(num) {
      const values = [1000, 900, 500, 400, 100, 90, 50, 40, 10, 9, 5, 4, 1];
      const symbols = ['M', 'CM', 'D', 'CD', 'C', 'XC', 'L', 'XL', 'X', 'IX', 'V', 'IV', 'I'];
      let result = '';
      for (let i = 0; i < values.length; i++) {
        while (num >= values[i]) {
          result += symbols[i];
          num -= values[i];
        }
      }
      return result;
    }

    // Initialize game
    async function init() {
      await initAuth();
      updateUI();
    }

    init().catch(console.error);
  </script>
</body>
</html>