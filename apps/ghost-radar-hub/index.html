<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghost Radar Hub</title>
    <link rel="icon" href="https://emojicdn.elk.sh/%F0%9F%91%BB">
    <meta property="og:title" content="Ghost Radar Hub">
    <meta property="og:description" content="See who's lurking in the shadows. Real-time presence radar for the sloppy network.">
    <meta property="og:url" content="https://sloppy.live/ghost-radar-hub">
    <meta property="og:image" content="https://emojicdn.elk.sh/%F0%9F%91%BB?style=apple&size=512">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=VT323&family=IBM+Plex+Mono:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --green: #00ff41;
            --green-dim: #00aa2a;
            --green-dark: #004d15;
            --green-glow: rgba(0, 255, 65, 0.3);
            --bg: #020a02;
            --panel: #0a160a;
            --border: #0d2e0d;
        }

        body {
            background: var(--bg);
            color: var(--green);
            font-family: 'IBM Plex Mono', monospace;
            min-height: 100vh;
            overflow: hidden;
        }

        /* Scanline overlay */
        body::after {
            content: '';
            position: fixed;
            inset: 0;
            background: repeating-linear-gradient(
                0deg,
                transparent,
                transparent 2px,
                rgba(0, 255, 65, 0.015) 2px,
                rgba(0, 255, 65, 0.015) 4px
            );
            pointer-events: none;
            z-index: 9999;
        }

        .container {
            display: grid;
            grid-template-columns: 1fr 320px;
            grid-template-rows: auto 1fr;
            height: 100vh;
            gap: 0;
        }

        /* Header */
        .header {
            grid-column: 1 / -1;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 24px;
            border-bottom: 1px solid var(--border);
            background: var(--panel);
        }

        .header h1 {
            font-family: 'VT323', monospace;
            font-size: 28px;
            font-weight: 400;
            letter-spacing: 3px;
            text-transform: uppercase;
            text-shadow: 0 0 10px var(--green-glow);
        }

        .header-status {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 12px;
            color: var(--green-dim);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--green-dark);
            display: inline-block;
            margin-right: 6px;
        }

        .status-dot.connected {
            background: var(--green);
            box-shadow: 0 0 8px var(--green);
            animation: dotPulse 2s ease-in-out infinite;
        }

        @keyframes dotPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.4; }
        }

        .backlink {
            color: var(--green-dark);
            text-decoration: none;
            font-size: 11px;
            letter-spacing: 1px;
            transition: color 0.3s;
        }
        .backlink:hover { color: var(--green); }

        /* Radar panel */
        .radar-panel {
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            background: radial-gradient(circle at center, #0a1a0a 0%, var(--bg) 70%);
        }

        .radar-wrapper {
            position: relative;
            width: min(70vmin, 500px);
            height: min(70vmin, 500px);
        }

        canvas#radarCanvas {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid var(--green-dark);
            box-shadow:
                0 0 30px rgba(0, 255, 65, 0.1),
                inset 0 0 60px rgba(0, 255, 65, 0.05);
        }

        .radar-label {
            position: absolute;
            bottom: -32px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'VT323', monospace;
            font-size: 18px;
            letter-spacing: 4px;
            text-transform: uppercase;
            color: var(--green-dim);
            text-shadow: 0 0 8px var(--green-glow);
        }

        .radar-count {
            position: absolute;
            top: -32px;
            left: 50%;
            transform: translateX(-50%);
            font-family: 'VT323', monospace;
            font-size: 22px;
            letter-spacing: 2px;
            color: var(--green);
            text-shadow: 0 0 12px var(--green-glow);
        }

        /* Side panel */
        .side-panel {
            border-left: 1px solid var(--border);
            background: var(--panel);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .side-panel-header {
            padding: 16px 20px;
            border-bottom: 1px solid var(--border);
            font-family: 'VT323', monospace;
            font-size: 18px;
            letter-spacing: 2px;
            text-transform: uppercase;
            color: var(--green-dim);
        }

        .ghost-list {
            flex: 1;
            overflow-y: auto;
            padding: 8px 0;
        }

        .ghost-list::-webkit-scrollbar { width: 4px; }
        .ghost-list::-webkit-scrollbar-track { background: var(--bg); }
        .ghost-list::-webkit-scrollbar-thumb { background: var(--green-dark); border-radius: 2px; }

        .ghost-entry {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 20px;
            border-bottom: 1px solid rgba(0, 255, 65, 0.04);
            animation: ghostIn 0.4s ease-out;
        }

        @keyframes ghostIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .ghost-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            border: 1px solid var(--green-dark);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            background: var(--bg);
            flex-shrink: 0;
            overflow: hidden;
        }

        .ghost-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
        }

        .ghost-info {
            flex: 1;
            min-width: 0;
        }

        .ghost-name {
            font-size: 13px;
            font-weight: 600;
            color: var(--green);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .ghost-status {
            font-size: 10px;
            color: var(--green-dark);
            margin-top: 2px;
        }

        .ghost-signal {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--green);
            box-shadow: 0 0 6px var(--green);
            animation: blinkSignal 2s ease-in-out infinite;
            flex-shrink: 0;
        }

        @keyframes blinkSignal {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.2; }
        }

        /* Activity log */
        .activity-log {
            border-top: 1px solid var(--border);
            padding: 12px 20px;
            max-height: 160px;
            overflow-y: auto;
        }

        .activity-log-title {
            font-family: 'VT323', monospace;
            font-size: 14px;
            letter-spacing: 2px;
            color: var(--green-dark);
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .activity-entry {
            font-size: 11px;
            color: var(--green-dim);
            padding: 3px 0;
            opacity: 0.7;
        }

        .activity-entry .timestamp {
            color: var(--green-dark);
            margin-right: 6px;
        }

        /* Ping button */
        .ping-btn {
            margin: 16px 20px;
            padding: 10px;
            background: transparent;
            border: 1px solid var(--green-dark);
            color: var(--green);
            font-family: 'VT323', monospace;
            font-size: 16px;
            letter-spacing: 3px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 2px;
        }

        .ping-btn:hover {
            background: rgba(0, 255, 65, 0.08);
            border-color: var(--green);
            box-shadow: 0 0 12px var(--green-glow);
        }

        .ping-btn:active {
            background: rgba(0, 255, 65, 0.15);
        }

        .ping-btn.pinging {
            animation: pingFlash 0.6s ease-out;
        }

        @keyframes pingFlash {
            0% { background: rgba(0, 255, 65, 0.3); box-shadow: 0 0 20px var(--green); }
            100% { background: transparent; box-shadow: none; }
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--green-dark);
            font-size: 13px;
            line-height: 1.6;
        }

        .empty-state .ghost-icon {
            font-size: 40px;
            margin-bottom: 12px;
            opacity: 0.4;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            background: var(--panel);
            border: 1px solid var(--green-dark);
            color: var(--green);
            padding: 10px 24px;
            font-family: 'VT323', monospace;
            font-size: 16px;
            letter-spacing: 2px;
            border-radius: 2px;
            opacity: 0;
            transition: all 0.3s;
            z-index: 1000;
            pointer-events: none;
        }

        .toast.visible {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }

        /* Mobile */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto;
            }

            .header h1 { font-size: 20px; letter-spacing: 2px; }

            .radar-panel {
                min-height: 50vh;
            }

            .radar-wrapper {
                width: min(65vmin, 300px);
                height: min(65vmin, 300px);
            }

            .side-panel {
                border-left: none;
                border-top: 1px solid var(--border);
                max-height: 40vh;
            }

            .activity-log { max-height: 100px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Ghost Radar Hub</h1>
            <div class="header-status">
                <span><span class="status-dot" id="statusDot"></span><span id="statusText">Connecting...</span></span>
                <a href="https://sloppy.live" class="backlink">sloppy.live</a>
            </div>
        </div>

        <div class="radar-panel">
            <div class="radar-wrapper">
                <span class="radar-count" id="radarCount">-- signals</span>
                <canvas id="radarCanvas" width="500" height="500"></canvas>
                <span class="radar-label">Presence Pulse</span>
            </div>
        </div>

        <div class="side-panel">
            <div class="side-panel-header">Detected Ghosts</div>
            <div class="ghost-list" id="ghostList">
                <div class="empty-state">
                    <div class="ghost-icon">&#128123;</div>
                    Scanning for presence...<br>
                    <span style="font-size:11px;color:var(--green-dark)">Ghosts appear when users are on the sloppy network</span>
                </div>
            </div>
            <div class="activity-log" id="activityLog">
                <div class="activity-log-title">Activity Feed</div>
            </div>
            <button class="ping-btn" id="pingBtn" onclick="sendPing()">Send Ping</button>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script type="module">
        import { createBrowserClient } from "https://cdn.jsdelivr.net/npm/@supabase/ssr@0.7.0/+esm";

        const SUPABASE_URL = 'https://yjyxteqzhhmtrgcaekgz.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlqeXh0ZXF6aGhtdHJnY2Fla2d6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTczNTg3NDIsImV4cCI6MjA3MjkzNDc0Mn0.G8SRde7IN2QFW1EnASM8IS32IUYR2eenCCjdDdioiBU';

        const getCookieDomain = () => {
            const h = window.location.hostname;
            if (h.includes('sloppy.live')) return '.sloppy.live';
            if (h.includes('vibecodedbyx.com')) return '.vibecodedbyx.com';
            return '.youreabsolutelyright.xyz';
        };

        const supabase = createBrowserClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
            cookieOptions: { name: 'sb-auth-token', domain: getCookieDomain(), path: '/', sameSite: 'lax' }
        });

        // State
        let ghostUsers = [];
        let activityEntries = [];
        let sweepAngle = 0;
        let blips = []; // { x, y, age, username }
        let connected = false;
        let pingRings = []; // { age, maxAge }

        const canvas = document.getElementById('radarCanvas');
        const ctx = canvas.getContext('2d');
        const SIZE = 500;
        const CX = SIZE / 2;
        const CY = SIZE / 2;
        const RADIUS = SIZE / 2 - 10;

        // Toast
        let toastTimer = null;
        function showToast(msg) {
            const t = document.getElementById('toast');
            t.textContent = msg;
            t.classList.add('visible');
            clearTimeout(toastTimer);
            toastTimer = setTimeout(() => t.classList.remove('visible'), 2500);
        }
        window.showToast = showToast;

        // Activity feed
        function addActivity(text) {
            const now = new Date();
            const ts = now.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
            activityEntries.unshift({ ts, text });
            if (activityEntries.length > 20) activityEntries.length = 20;
            renderActivity();
        }

        function renderActivity() {
            const el = document.getElementById('activityLog');
            let html = '<div class="activity-log-title">Activity Feed</div>';
            for (const e of activityEntries) {
                html += `<div class="activity-entry"><span class="timestamp">[${e.ts}]</span>${e.text}</div>`;
            }
            el.innerHTML = html;
        }

        // Ghost list
        function renderGhostList() {
            const el = document.getElementById('ghostList');
            if (ghostUsers.length === 0) {
                el.innerHTML = `<div class="empty-state"><div class="ghost-icon">&#128123;</div>No ghosts detected<br><span style="font-size:11px;color:var(--green-dark)">The radar is empty... for now</span></div>`;
                return;
            }

            let html = '';
            for (const u of ghostUsers) {
                const avatarContent = u.avatarUrl
                    ? `<img src="${u.avatarUrl}" alt="">`
                    : (u.avatar || '&#128123;');
                const status = u.status || 'lurking';
                const nameColor = u.color || 'var(--green)';
                html += `<div class="ghost-entry">
                    <div class="ghost-avatar" style="border-color:${nameColor}">${avatarContent}</div>
                    <div class="ghost-info">
                        <div class="ghost-name" style="color:${nameColor}">${escapeHtml(u.username || 'Unknown')}</div>
                        <div class="ghost-status">${escapeHtml(status)}</div>
                    </div>
                    <div class="ghost-signal"></div>
                </div>`;
            }
            el.innerHTML = html;
        }

        function escapeHtml(str) {
            const d = document.createElement('div');
            d.textContent = str;
            return d.innerHTML;
        }

        // Radar count
        function updateCount() {
            const n = ghostUsers.length;
            document.getElementById('radarCount').textContent = n === 0 ? '-- signals' : n + (n === 1 ? ' signal' : ' signals');
        }

        // Connection status
        function setConnected(val) {
            connected = val;
            const dot = document.getElementById('statusDot');
            const text = document.getElementById('statusText');
            if (val) {
                dot.classList.add('connected');
                text.textContent = 'Online';
            } else {
                dot.classList.remove('connected');
                text.textContent = 'Disconnected';
            }
        }

        // Ping
        window.sendPing = function() {
            const btn = document.getElementById('pingBtn');
            btn.classList.remove('pinging');
            void btn.offsetWidth;
            btn.classList.add('pinging');

            pingRings.push({ age: 0, maxAge: 60 });

            const n = ghostUsers.length;
            if (n === 0) showToast('No ghosts detected...');
            else if (n === 1) showToast('1 silent lurker detected!');
            else showToast(n + ' ghosts in the shadows!');

            addActivity('Ping sent - ' + n + ' ghost' + (n !== 1 ? 's' : '') + ' detected');
        };

        // Update ghosts from presence state
        function updateFromPresence(presenceState) {
            const prev = new Set(ghostUsers.map(u => u.username));
            const users = [];
            const seen = {};
            Object.values(presenceState).forEach(presences => {
                presences.forEach(p => {
                    if (!seen[p.username]) {
                        seen[p.username] = true;
                        users.push(p);
                    }
                });
            });

            // Detect joins and leaves
            const curr = new Set(users.map(u => u.username));
            for (const u of users) {
                if (!prev.has(u.username)) {
                    addActivity((u.username || 'Unknown') + ' materialized');
                    // Add blip at random position
                    const angle = Math.random() * Math.PI * 2;
                    const r = 0.2 + Math.random() * 0.6;
                    blips.push({
                        x: CX + Math.cos(angle) * r * RADIUS,
                        y: CY + Math.sin(angle) * r * RADIUS,
                        age: 0,
                        username: u.username
                    });
                }
            }
            for (const u of ghostUsers) {
                if (!curr.has(u.username)) {
                    addActivity((u.username || 'Unknown') + ' faded away');
                }
            }

            ghostUsers = users;

            // Rebuild blips for current users
            rebuildBlips();
            renderGhostList();
            updateCount();
        }

        function rebuildBlips() {
            // Keep stable positions for known users via seeded placement
            const newBlips = [];
            ghostUsers.forEach((u, i) => {
                const existing = blips.find(b => b.username === u.username);
                if (existing) {
                    newBlips.push(existing);
                } else {
                    // Deterministic-ish angle from name hash
                    let hash = 0;
                    const name = u.username || 'x';
                    for (let c = 0; c < name.length; c++) hash = ((hash << 5) - hash) + name.charCodeAt(c);
                    const angle = (Math.abs(hash) % 360) * (Math.PI / 180);
                    const r = 0.25 + (Math.abs(hash >> 8) % 50) / 100 * 0.55;
                    newBlips.push({
                        x: CX + Math.cos(angle) * r * RADIUS,
                        y: CY + Math.sin(angle) * r * RADIUS,
                        age: 0,
                        username: u.username
                    });
                }
            });
            blips = newBlips;
        }

        // === RADAR RENDERING ===
        function drawRadar() {
            ctx.clearRect(0, 0, SIZE, SIZE);

            // Background
            const bgGrad = ctx.createRadialGradient(CX, CY, 0, CX, CY, RADIUS);
            bgGrad.addColorStop(0, '#0a1a0a');
            bgGrad.addColorStop(0.7, '#041004');
            bgGrad.addColorStop(1, '#020802');
            ctx.fillStyle = bgGrad;
            ctx.beginPath();
            ctx.arc(CX, CY, RADIUS, 0, Math.PI * 2);
            ctx.fill();

            // Grid rings
            ctx.strokeStyle = 'rgba(0, 255, 65, 0.08)';
            ctx.lineWidth = 1;
            for (let i = 1; i <= 4; i++) {
                ctx.beginPath();
                ctx.arc(CX, CY, RADIUS * (i / 4), 0, Math.PI * 2);
                ctx.stroke();
            }

            // Cross lines
            ctx.strokeStyle = 'rgba(0, 255, 65, 0.06)';
            ctx.beginPath();
            ctx.moveTo(CX - RADIUS, CY);
            ctx.lineTo(CX + RADIUS, CY);
            ctx.moveTo(CX, CY - RADIUS);
            ctx.lineTo(CX, CY + RADIUS);
            ctx.stroke();

            // Sweep line
            sweepAngle += 0.015;
            const sweepX = CX + Math.cos(sweepAngle) * RADIUS;
            const sweepY = CY + Math.sin(sweepAngle) * RADIUS;

            // Sweep trail (gradient arc)
            const trailAngle = 0.5; // radians of trail
            const trailGrad = ctx.createConicGradient(sweepAngle - trailAngle, CX, CY);
            const norm = (sweepAngle - trailAngle) / (Math.PI * 2);
            // Conic gradient from transparent to green
            trailGrad.addColorStop(0, 'rgba(0, 255, 65, 0)');
            trailGrad.addColorStop(trailAngle / (Math.PI * 2), 'rgba(0, 255, 65, 0.12)');
            trailGrad.addColorStop(trailAngle / (Math.PI * 2) + 0.001, 'rgba(0, 255, 65, 0)');
            trailGrad.addColorStop(1, 'rgba(0, 255, 65, 0)');

            ctx.fillStyle = trailGrad;
            ctx.beginPath();
            ctx.moveTo(CX, CY);
            ctx.arc(CX, CY, RADIUS, sweepAngle - trailAngle, sweepAngle);
            ctx.closePath();
            ctx.fill();

            // Sweep line itself
            ctx.strokeStyle = 'rgba(0, 255, 65, 0.5)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(CX, CY);
            ctx.lineTo(sweepX, sweepY);
            ctx.stroke();

            // Ping rings
            for (let i = pingRings.length - 1; i >= 0; i--) {
                const ring = pingRings[i];
                ring.age++;
                const progress = ring.age / ring.maxAge;
                if (progress >= 1) { pingRings.splice(i, 1); continue; }
                const r = progress * RADIUS;
                const alpha = (1 - progress) * 0.4;
                ctx.strokeStyle = `rgba(0, 255, 65, ${alpha})`;
                ctx.lineWidth = 2 * (1 - progress);
                ctx.beginPath();
                ctx.arc(CX, CY, r, 0, Math.PI * 2);
                ctx.stroke();
            }

            // Blips
            for (const b of blips) {
                b.age++;
                // Pulsing glow
                const pulse = 0.5 + 0.5 * Math.sin(b.age * 0.05 + (b.x * 0.1));
                const size = 4 + pulse * 2;

                // Check if sweep is near this blip (brighten)
                const blipAngle = Math.atan2(b.y - CY, b.x - CX);
                let angleDiff = sweepAngle - blipAngle;
                // Normalize
                while (angleDiff > Math.PI) angleDiff -= Math.PI * 2;
                while (angleDiff < -Math.PI) angleDiff += Math.PI * 2;

                const sweepProx = Math.abs(angleDiff) < 0.3 ? 1 - Math.abs(angleDiff) / 0.3 : 0;
                const alpha = 0.4 + pulse * 0.3 + sweepProx * 0.3;

                // Glow
                ctx.fillStyle = `rgba(0, 255, 65, ${alpha * 0.3})`;
                ctx.beginPath();
                ctx.arc(b.x, b.y, size * 3, 0, Math.PI * 2);
                ctx.fill();

                // Core
                ctx.fillStyle = `rgba(0, 255, 65, ${alpha})`;
                ctx.beginPath();
                ctx.arc(b.x, b.y, size, 0, Math.PI * 2);
                ctx.fill();

                // Bright center
                ctx.fillStyle = `rgba(200, 255, 200, ${alpha * 0.8})`;
                ctx.beginPath();
                ctx.arc(b.x, b.y, size * 0.4, 0, Math.PI * 2);
                ctx.fill();
            }

            // Center dot
            const centerPulse = 0.6 + 0.4 * Math.sin(Date.now() * 0.003);
            ctx.fillStyle = `rgba(0, 255, 65, ${centerPulse})`;
            ctx.beginPath();
            ctx.arc(CX, CY, 4, 0, Math.PI * 2);
            ctx.fill();

            ctx.fillStyle = `rgba(0, 255, 65, ${centerPulse * 0.2})`;
            ctx.beginPath();
            ctx.arc(CX, CY, 12, 0, Math.PI * 2);
            ctx.fill();

            // Outer ring glow
            ctx.strokeStyle = 'rgba(0, 255, 65, 0.15)';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.arc(CX, CY, RADIUS, 0, Math.PI * 2);
            ctx.stroke();

            requestAnimationFrame(drawRadar);
        }

        // === INIT ===
        async function init() {
            addActivity('Ghost Radar Hub initializing...');

            // Get or create session
            const sessRes = await supabase.auth.getSession();
            let session = sessRes.data?.session;
            if (!session) {
                const signRes = await supabase.auth.signInAnonymously();
                session = signRes.data?.session;
            }

            const userId = session?.user?.id || 'anon_' + Math.random().toString(36).slice(2);

            addActivity('Session established');

            // Connect to same presence channel as Sloppygram
            const channel = supabase.channel('sloppygram_presence', {
                config: {
                    presence: { key: userId }
                }
            });

            channel
                .on('presence', { event: 'sync' }, () => {
                    const state = channel.presenceState();
                    updateFromPresence(state);
                })
                .on('presence', { event: 'join' }, ({ newPresences }) => {
                    // Handled by sync
                })
                .on('presence', { event: 'leave' }, ({ leftPresences }) => {
                    // Handled by sync
                });

            channel.subscribe(async (status) => {
                if (status === 'SUBSCRIBED') {
                    setConnected(true);
                    addActivity('Connected to presence network');

                    await channel.track({
                        username: 'Ghost Observer',
                        avatar: '&#128123;',
                        color: '#00ff41',
                        status: 'watching from radar hub',
                        online_at: new Date().toISOString()
                    });
                } else if (status === 'CHANNEL_ERROR' || status === 'TIMED_OUT') {
                    setConnected(false);
                    addActivity('Connection lost - retrying...');
                }
            });

            // Start radar animation
            drawRadar();
        }

        init().catch(err => {
            console.error('Ghost Radar Hub init error:', err);
            addActivity('Error: ' + err.message);
        });
    </script>

    <script>
        // Load sloppy header
        (function() {
            var s = document.createElement('script');
            s.src = '/sloppy-header/sloppy-bar.js';
            s.defer = true;
            document.head.appendChild(s);
        })();
    </script>
</body>
</html>
