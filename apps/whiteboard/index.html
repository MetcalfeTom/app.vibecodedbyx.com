<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Whiteboard</title>
  <link rel="icon" href="https://emojicdn.elk.sh/üé®">
  <meta property="og:title" content="Whiteboard">
  <meta property="og:description" content="Collaborative whiteboard with sticky notes and drawing tools">
  <meta property="og:url" content="https://app.sloppy.live/whiteboard">
  <meta property="og:image" content="https://emojicdn.elk.sh/üé®?style=apple&size=512">
  <link href="https://fonts.googleapis.com/css2?family=Caveat:wght@400;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Inter', sans-serif;
      background: #f5f5f5;
      overflow: hidden;
      height: 100vh;
    }

    /* Toolbar */
    .toolbar {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #fff;
      border-radius: 16px;
      padding: 10px 20px;
      display: flex;
      gap: 8px;
      align-items: center;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      z-index: 1000;
    }

    .tool-btn {
      width: 44px;
      height: 44px;
      border: none;
      background: transparent;
      border-radius: 12px;
      cursor: pointer;
      font-size: 1.3rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .tool-btn:hover {
      background: #f0f0f0;
    }

    .tool-btn.active {
      background: #e8f4ff;
      box-shadow: inset 0 0 0 2px #3b82f6;
    }

    .divider {
      width: 1px;
      height: 30px;
      background: #e0e0e0;
      margin: 0 8px;
    }

    /* Color picker */
    .color-picker {
      display: flex;
      gap: 6px;
    }

    .color-dot {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.2s;
    }

    .color-dot:hover {
      transform: scale(1.15);
    }

    .color-dot.active {
      border-color: #333;
      box-shadow: 0 0 0 2px #fff, 0 0 0 4px currentColor;
    }

    /* Brush size */
    .brush-size {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .size-slider {
      width: 80px;
      height: 6px;
      -webkit-appearance: none;
      background: #e0e0e0;
      border-radius: 3px;
      cursor: pointer;
    }

    .size-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 18px;
      height: 18px;
      background: #3b82f6;
      border-radius: 50%;
      cursor: pointer;
    }

    .size-preview {
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .size-dot {
      background: #333;
      border-radius: 50%;
    }

    /* Canvas */
    .canvas-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background:
        linear-gradient(90deg, #e8e8e8 1px, transparent 1px),
        linear-gradient(#e8e8e8 1px, transparent 1px);
      background-size: 20px 20px;
      background-color: #fafafa;
    }

    #drawCanvas {
      position: absolute;
      top: 0;
      left: 0;
      cursor: crosshair;
    }

    #drawCanvas.eraser {
      cursor: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Ccircle cx='12' cy='12' r='10' fill='%23fff' stroke='%23999' stroke-width='2'/%3E%3C/svg%3E") 12 12, auto;
    }

    #drawCanvas.move {
      cursor: grab;
    }

    /* Sticky Notes */
    .sticky-note {
      position: absolute;
      width: 200px;
      min-height: 150px;
      padding: 15px;
      border-radius: 4px;
      box-shadow: 3px 3px 10px rgba(0,0,0,0.15);
      cursor: grab;
      font-family: 'Caveat', cursive;
      font-size: 1.2rem;
      z-index: 100;
      transition: box-shadow 0.2s;
    }

    .sticky-note:hover {
      box-shadow: 5px 5px 15px rgba(0,0,0,0.2);
    }

    .sticky-note.dragging {
      cursor: grabbing;
      box-shadow: 8px 8px 20px rgba(0,0,0,0.25);
      z-index: 200;
    }

    .sticky-note-header {
      display: flex;
      justify-content: flex-end;
      gap: 5px;
      margin-bottom: 10px;
    }

    .sticky-btn {
      width: 20px;
      height: 20px;
      border: none;
      background: rgba(0,0,0,0.1);
      border-radius: 50%;
      cursor: pointer;
      font-size: 0.7rem;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0.5;
      transition: opacity 0.2s;
    }

    .sticky-note:hover .sticky-btn {
      opacity: 1;
    }

    .sticky-btn:hover {
      background: rgba(0,0,0,0.2);
    }

    .sticky-content {
      width: 100%;
      min-height: 100px;
      border: none;
      background: transparent;
      font-family: inherit;
      font-size: inherit;
      resize: none;
      outline: none;
    }

    /* Sticky colors */
    .sticky-yellow { background: #fff9c4; }
    .sticky-pink { background: #f8bbd9; }
    .sticky-blue { background: #bbdefb; }
    .sticky-green { background: #c8e6c9; }
    .sticky-orange { background: #ffe0b2; }
    .sticky-purple { background: #e1bee7; }

    /* Sticky color picker */
    .sticky-colors {
      position: fixed;
      top: 90px;
      left: 50%;
      transform: translateX(-50%);
      background: #fff;
      border-radius: 12px;
      padding: 10px 15px;
      display: none;
      gap: 8px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
      z-index: 1000;
    }

    .sticky-colors.show {
      display: flex;
    }

    .sticky-color-btn {
      width: 30px;
      height: 30px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .sticky-color-btn:hover {
      transform: scale(1.1);
    }

    /* Back link */
    .back-link {
      position: fixed;
      bottom: 15px;
      right: 15px;
      color: #999;
      text-decoration: none;
      font-size: 0.75rem;
      z-index: 100;
    }

    .back-link:hover { color: #3b82f6; }

    /* Instructions */
    .instructions {
      position: fixed;
      bottom: 20px;
      left: 20px;
      background: #fff;
      padding: 12px 18px;
      border-radius: 10px;
      font-size: 0.75rem;
      color: #666;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      z-index: 100;
    }

    .instructions kbd {
      background: #eee;
      padding: 2px 6px;
      border-radius: 4px;
      font-family: inherit;
    }

    @media (max-width: 768px) {
      .toolbar {
        width: 90%;
        flex-wrap: wrap;
        justify-content: center;
        padding: 10px;
      }

      .divider {
        display: none;
      }

      .brush-size {
        width: 100%;
        justify-content: center;
        margin-top: 5px;
      }

      .instructions {
        display: none;
      }
    }
  </style>
</head>
<body>
  <div class="canvas-container">
    <canvas id="drawCanvas"></canvas>
  </div>

  <div class="toolbar">
    <button class="tool-btn active" id="penTool" title="Pen (P)">‚úèÔ∏è</button>
    <button class="tool-btn" id="eraserTool" title="Eraser (E)">üßπ</button>
    <button class="tool-btn" id="stickyTool" title="Sticky Note (S)">üìù</button>

    <div class="divider"></div>

    <div class="color-picker">
      <div class="color-dot active" style="background: #333" data-color="#333"></div>
      <div class="color-dot" style="background: #ef4444" data-color="#ef4444"></div>
      <div class="color-dot" style="background: #3b82f6" data-color="#3b82f6"></div>
      <div class="color-dot" style="background: #22c55e" data-color="#22c55e"></div>
      <div class="color-dot" style="background: #f59e0b" data-color="#f59e0b"></div>
      <div class="color-dot" style="background: #8b5cf6" data-color="#8b5cf6"></div>
    </div>

    <div class="divider"></div>

    <div class="brush-size">
      <div class="size-preview">
        <div class="size-dot" id="sizePreview" style="width: 4px; height: 4px;"></div>
      </div>
      <input type="range" class="size-slider" id="sizeSlider" min="2" max="30" value="4">
    </div>

    <div class="divider"></div>

    <button class="tool-btn" id="undoBtn" title="Undo (Ctrl+Z)">‚Ü©Ô∏è</button>
    <button class="tool-btn" id="clearBtn" title="Clear All">üóëÔ∏è</button>
  </div>

  <div class="sticky-colors" id="stickyColors">
    <button class="sticky-color-btn" style="background: #fff9c4" data-color="sticky-yellow"></button>
    <button class="sticky-color-btn" style="background: #f8bbd9" data-color="sticky-pink"></button>
    <button class="sticky-color-btn" style="background: #bbdefb" data-color="sticky-blue"></button>
    <button class="sticky-color-btn" style="background: #c8e6c9" data-color="sticky-green"></button>
    <button class="sticky-color-btn" style="background: #ffe0b2" data-color="sticky-orange"></button>
    <button class="sticky-color-btn" style="background: #e1bee7" data-color="sticky-purple"></button>
  </div>

  <div class="instructions">
    <kbd>P</kbd> Pen &nbsp; <kbd>E</kbd> Eraser &nbsp; <kbd>S</kbd> Sticky &nbsp; <kbd>Ctrl+Z</kbd> Undo
  </div>

  <a href="https://sloppy.live" class="back-link">‚Üê sloppy.live</a>

  <script>
    const canvas = document.getElementById('drawCanvas');
    const ctx = canvas.getContext('2d');

    // Canvas setup
    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
      redrawAll();
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    // State
    let currentTool = 'pen';
    let currentColor = '#333';
    let brushSize = 4;
    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;
    let strokes = [];
    let currentStroke = null;

    // Tool selection
    const toolBtns = {
      pen: document.getElementById('penTool'),
      eraser: document.getElementById('eraserTool'),
      sticky: document.getElementById('stickyTool')
    };

    function setTool(tool) {
      currentTool = tool;
      Object.values(toolBtns).forEach(btn => btn.classList.remove('active'));
      toolBtns[tool].classList.add('active');

      canvas.classList.remove('eraser', 'move');
      if (tool === 'eraser') canvas.classList.add('eraser');

      document.getElementById('stickyColors').classList.toggle('show', tool === 'sticky');
    }

    toolBtns.pen.addEventListener('click', () => setTool('pen'));
    toolBtns.eraser.addEventListener('click', () => setTool('eraser'));
    toolBtns.sticky.addEventListener('click', () => setTool('sticky'));

    // Color selection
    document.querySelectorAll('.color-dot').forEach(dot => {
      dot.addEventListener('click', () => {
        document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
        dot.classList.add('active');
        currentColor = dot.dataset.color;
        document.getElementById('sizePreview').style.background = currentColor;
      });
    });

    // Brush size
    const sizeSlider = document.getElementById('sizeSlider');
    const sizePreview = document.getElementById('sizePreview');

    sizeSlider.addEventListener('input', () => {
      brushSize = parseInt(sizeSlider.value);
      sizePreview.style.width = Math.min(brushSize, 20) + 'px';
      sizePreview.style.height = Math.min(brushSize, 20) + 'px';
    });

    // Drawing
    function startDrawing(e) {
      if (currentTool === 'sticky') return;

      isDrawing = true;
      const rect = canvas.getBoundingClientRect();
      lastX = e.clientX - rect.left;
      lastY = e.clientY - rect.top;

      currentStroke = {
        tool: currentTool,
        color: currentTool === 'eraser' ? '#fafafa' : currentColor,
        size: currentTool === 'eraser' ? brushSize * 3 : brushSize,
        points: [{ x: lastX, y: lastY }]
      };
    }

    function draw(e) {
      if (!isDrawing) return;

      const rect = canvas.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const y = e.clientY - rect.top;

      ctx.beginPath();
      ctx.moveTo(lastX, lastY);
      ctx.lineTo(x, y);
      ctx.strokeStyle = currentStroke.color;
      ctx.lineWidth = currentStroke.size;
      ctx.lineCap = 'round';
      ctx.lineJoin = 'round';
      ctx.stroke();

      currentStroke.points.push({ x, y });
      lastX = x;
      lastY = y;
    }

    function stopDrawing() {
      if (isDrawing && currentStroke && currentStroke.points.length > 1) {
        strokes.push(currentStroke);
      }
      isDrawing = false;
      currentStroke = null;
    }

    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mouseup', stopDrawing);
    canvas.addEventListener('mouseout', stopDrawing);

    // Touch support
    canvas.addEventListener('touchstart', (e) => {
      e.preventDefault();
      const touch = e.touches[0];
      startDrawing({ clientX: touch.clientX, clientY: touch.clientY });
    });

    canvas.addEventListener('touchmove', (e) => {
      e.preventDefault();
      const touch = e.touches[0];
      draw({ clientX: touch.clientX, clientY: touch.clientY });
    });

    canvas.addEventListener('touchend', stopDrawing);

    // Redraw all strokes
    function redrawAll() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      strokes.forEach(stroke => {
        if (stroke.points.length < 2) return;

        ctx.beginPath();
        ctx.moveTo(stroke.points[0].x, stroke.points[0].y);

        for (let i = 1; i < stroke.points.length; i++) {
          ctx.lineTo(stroke.points[i].x, stroke.points[i].y);
        }

        ctx.strokeStyle = stroke.color;
        ctx.lineWidth = stroke.size;
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';
        ctx.stroke();
      });
    }

    // Undo
    document.getElementById('undoBtn').addEventListener('click', () => {
      strokes.pop();
      redrawAll();
    });

    // Clear
    document.getElementById('clearBtn').addEventListener('click', () => {
      if (confirm('Clear all drawings and notes?')) {
        strokes = [];
        redrawAll();
        document.querySelectorAll('.sticky-note').forEach(n => n.remove());
      }
    });

    // Sticky Notes
    let stickyColor = 'sticky-yellow';
    let noteIdCounter = 0;

    document.querySelectorAll('.sticky-color-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        stickyColor = btn.dataset.color;
        createStickyNote();
      });
    });

    canvas.addEventListener('click', (e) => {
      if (currentTool === 'sticky') {
        createStickyNote(e.clientX, e.clientY);
      }
    });

    function createStickyNote(x = null, y = null) {
      const note = document.createElement('div');
      note.className = `sticky-note ${stickyColor}`;
      note.id = 'note-' + noteIdCounter++;

      note.style.left = (x || 100 + Math.random() * 200) + 'px';
      note.style.top = (y || 150 + Math.random() * 200) + 'px';

      note.innerHTML = `
        <div class="sticky-note-header">
          <button class="sticky-btn" data-action="color">üé®</button>
          <button class="sticky-btn" data-action="delete">‚úï</button>
        </div>
        <textarea class="sticky-content" placeholder="Type here..."></textarea>
      `;

      document.body.appendChild(note);
      makeDraggable(note);

      // Focus textarea
      note.querySelector('.sticky-content').focus();

      // Delete button
      note.querySelector('[data-action="delete"]').addEventListener('click', () => {
        note.remove();
      });

      // Color cycle
      const colors = ['sticky-yellow', 'sticky-pink', 'sticky-blue', 'sticky-green', 'sticky-orange', 'sticky-purple'];
      note.querySelector('[data-action="color"]').addEventListener('click', () => {
        const currentIdx = colors.indexOf([...note.classList].find(c => c.startsWith('sticky-')));
        const nextIdx = (currentIdx + 1) % colors.length;
        colors.forEach(c => note.classList.remove(c));
        note.classList.add(colors[nextIdx]);
      });

      setTool('pen');
    }

    function makeDraggable(element) {
      let offsetX, offsetY, isDragging = false;

      const header = element.querySelector('.sticky-note-header');

      element.addEventListener('mousedown', (e) => {
        if (e.target.tagName === 'TEXTAREA' || e.target.tagName === 'BUTTON') return;

        isDragging = true;
        element.classList.add('dragging');
        offsetX = e.clientX - element.offsetLeft;
        offsetY = e.clientY - element.offsetTop;
      });

      document.addEventListener('mousemove', (e) => {
        if (!isDragging) return;

        element.style.left = (e.clientX - offsetX) + 'px';
        element.style.top = (e.clientY - offsetY) + 'px';
      });

      document.addEventListener('mouseup', () => {
        isDragging = false;
        element.classList.remove('dragging');
      });

      // Touch support for notes
      element.addEventListener('touchstart', (e) => {
        if (e.target.tagName === 'TEXTAREA' || e.target.tagName === 'BUTTON') return;

        isDragging = true;
        element.classList.add('dragging');
        const touch = e.touches[0];
        offsetX = touch.clientX - element.offsetLeft;
        offsetY = touch.clientY - element.offsetTop;
      });

      document.addEventListener('touchmove', (e) => {
        if (!isDragging) return;

        const touch = e.touches[0];
        element.style.left = (touch.clientX - offsetX) + 'px';
        element.style.top = (touch.clientY - offsetY) + 'px';
      });

      document.addEventListener('touchend', () => {
        isDragging = false;
        element.classList.remove('dragging');
      });
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.target.tagName === 'TEXTAREA') return;

      if (e.key === 'p' || e.key === 'P') setTool('pen');
      if (e.key === 'e' || e.key === 'E') setTool('eraser');
      if (e.key === 's' || e.key === 'S') setTool('sticky');

      if (e.ctrlKey && e.key === 'z') {
        e.preventDefault();
        strokes.pop();
        redrawAll();
      }
    });
  </script>
<script src="/sloppy-header/sloppy-bar.js"></script>
</body>
</html>
