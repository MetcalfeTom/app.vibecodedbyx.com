<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Neon Tickle Defense</title>
  <meta name="description" content="Defend your robot from tickling feathers!">
  <meta property="og:title" content="Neon Tickle Defense">
  <meta property="og:description" content="Click feathers before they tickle the robot!">
  <meta property="og:url" content="https://app.sloppy.live/neon-tickle-defense/">
  <meta property="og:image" content="https://app.sloppy.live/neon-tickle-defense/og-image.png">
  <link rel="icon" href="https://emojicdn.elk.sh/ü™∂">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Exo+2:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(180deg, #0a0015 0%, #1a0030 50%, #0a0020 100%);
      min-height: 100vh;
      overflow: hidden;
      font-family: 'Exo 2', sans-serif;
      color: #fff;
    }

    #gameCanvas {
      display: block;
      cursor: crosshair;
    }

    .ui-overlay {
      position: fixed;
      z-index: 100;
      pointer-events: none;
    }

    .header {
      top: 1rem;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
    }

    .header h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.8rem;
      font-weight: 900;
      background: linear-gradient(90deg, #ff00ff, #00ffff, #ff00ff);
      background-size: 200% auto;
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      animation: shimmer 3s linear infinite;
      text-shadow: 0 0 30px rgba(255, 0, 255, 0.5);
    }

    @keyframes shimmer {
      0% { background-position: 0% center; }
      100% { background-position: 200% center; }
    }

    .stats-panel {
      top: 1rem;
      left: 1rem;
      background: rgba(0, 0, 0, 0.7);
      border: 2px solid #ff00ff;
      border-radius: 8px;
      padding: 1rem;
      box-shadow: 0 0 20px rgba(255, 0, 255, 0.3);
    }

    .stat {
      display: flex;
      justify-content: space-between;
      gap: 1rem;
      margin: 0.3rem 0;
      font-size: 0.9rem;
    }

    .stat-label {
      color: #888;
    }

    .stat-value {
      font-family: 'Orbitron', sans-serif;
      color: #00ffff;
      text-shadow: 0 0 10px #00ffff;
    }

    .right-panel {
      top: 1rem;
      right: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
    }

    .tickle-meter, .laser-meter {
      background: rgba(0, 0, 0, 0.7);
      border: 2px solid #ff00ff;
      border-radius: 8px;
      padding: 0.8rem;
      box-shadow: 0 0 20px rgba(255, 0, 255, 0.3);
    }

    .laser-meter {
      border-color: #ff0000;
      box-shadow: 0 0 20px rgba(255, 0, 0, 0.3);
    }

    .tickle-label, .laser-label {
      font-size: 0.7rem;
      color: #ff00ff;
      margin-bottom: 0.4rem;
      text-align: center;
      font-family: 'Orbitron', sans-serif;
    }

    .laser-label {
      color: #ff0000;
    }

    .tickle-bar, .laser-bar {
      width: 150px;
      height: 16px;
      background: #1a1a2e;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid #333;
    }

    .tickle-fill {
      height: 100%;
      background: linear-gradient(90deg, #00ff88, #ffff00, #ff6600, #ff0000);
      transition: width 0.3s;
      box-shadow: 0 0 10px currentColor;
    }

    .laser-fill {
      height: 100%;
      background: linear-gradient(90deg, #ff0000, #ff6600, #ffff00);
      transition: width 0.3s;
      box-shadow: 0 0 10px #ff0000;
    }

    .laser-ready {
      font-size: 0.6rem;
      color: #ff0000;
      text-align: center;
      margin-top: 0.3rem;
      animation: pulse 0.5s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    .powerups-display {
      background: rgba(0, 0, 0, 0.7);
      border: 2px solid #00ff88;
      border-radius: 8px;
      padding: 0.6rem;
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
    }

    .powerups-label {
      font-size: 0.65rem;
      color: #00ff88;
      margin-bottom: 0.3rem;
      text-align: center;
      font-family: 'Orbitron', sans-serif;
    }

    .active-powerups {
      display: flex;
      gap: 0.4rem;
      justify-content: center;
      min-height: 24px;
    }

    .powerup-icon {
      font-size: 1.2rem;
      filter: drop-shadow(0 0 5px currentColor);
    }

    .game-over {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 200;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.5s;
    }

    .game-over.visible {
      opacity: 1;
      pointer-events: auto;
    }

    .game-over h2 {
      font-family: 'Orbitron', sans-serif;
      font-size: 3rem;
      color: #ff00ff;
      text-shadow: 0 0 30px #ff00ff;
      margin-bottom: 1rem;
    }

    .game-over p {
      font-size: 1.5rem;
      color: #00ffff;
      margin-bottom: 2rem;
    }

    .restart-btn {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.2rem;
      padding: 1rem 2rem;
      background: linear-gradient(135deg, #ff00ff, #00ffff);
      border: none;
      border-radius: 8px;
      color: #000;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .restart-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 0 30px rgba(255, 0, 255, 0.5);
    }

    .instructions {
      bottom: 1rem;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.75rem;
      color: #666;
      text-align: center;
    }

    .backlink {
      position: fixed;
      bottom: 0.5rem;
      right: 0.5rem;
      font-size: 0.7rem;
      z-index: 50;
    }

    .backlink a {
      color: #ff00ff;
      text-decoration: none;
    }

    /* GIANT NUKE BUTTON */
    .nuke-btn {
      position: fixed;
      bottom: 4rem;
      left: 50%;
      transform: translateX(-50%);
      width: 120px;
      height: 120px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, #ff4444, #aa0000, #660000);
      border: 5px solid #ff0000;
      color: #fff;
      font-family: 'Orbitron', sans-serif;
      font-size: 1rem;
      font-weight: 900;
      cursor: pointer;
      z-index: 150;
      box-shadow:
        0 0 30px rgba(255, 0, 0, 0.5),
        0 0 60px rgba(255, 0, 0, 0.3),
        inset 0 -5px 20px rgba(0, 0, 0, 0.5);
      transition: transform 0.1s, box-shadow 0.1s;
      text-shadow: 0 0 10px #ff0000;
      animation: nukePulse 2s infinite;
    }

    .nuke-btn:hover {
      transform: translateX(-50%) scale(1.1);
      box-shadow:
        0 0 50px rgba(255, 0, 0, 0.7),
        0 0 80px rgba(255, 0, 0, 0.5),
        inset 0 -5px 20px rgba(0, 0, 0, 0.5);
    }

    .nuke-btn:active {
      transform: translateX(-50%) scale(0.95);
    }

    .nuke-btn:disabled {
      background: radial-gradient(circle at 30% 30%, #444, #222, #111);
      border-color: #333;
      box-shadow: none;
      animation: none;
      cursor: not-allowed;
    }

    .nuke-btn .nuke-icon {
      font-size: 2rem;
      display: block;
    }

    .nuke-btn .nuke-text {
      font-size: 0.7rem;
    }

    .nuke-cooldown {
      position: fixed;
      bottom: 1.5rem;
      left: 50%;
      transform: translateX(-50%);
      font-family: 'Orbitron', sans-serif;
      font-size: 0.8rem;
      color: #ff0000;
      z-index: 150;
    }

    @keyframes nukePulse {
      0%, 100% { box-shadow: 0 0 30px rgba(255, 0, 0, 0.5), 0 0 60px rgba(255, 0, 0, 0.3), inset 0 -5px 20px rgba(0, 0, 0, 0.5); }
      50% { box-shadow: 0 0 50px rgba(255, 0, 0, 0.8), 0 0 80px rgba(255, 0, 0, 0.5), inset 0 -5px 20px rgba(0, 0, 0, 0.5); }
    }

    @keyframes nukeFlash {
      0% { background: rgba(255, 255, 255, 1); }
      100% { background: rgba(255, 255, 255, 0); }
    }

    .nuke-flash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 300;
      animation: nukeFlash 0.5s ease-out forwards;
    }

    @media (max-width: 600px) {
      .header h1 {
        font-size: 1.2rem;
      }

      .stats-panel, .tickle-meter, .laser-meter, .powerups-display {
        padding: 0.5rem;
        font-size: 0.75rem;
      }

      .tickle-bar, .laser-bar {
        width: 100px;
      }

      .nuke-btn {
        width: 90px;
        height: 90px;
        bottom: 3rem;
      }

      .nuke-btn .nuke-icon {
        font-size: 1.5rem;
      }
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>

  <div class="ui-overlay header">
    <h1>ü™∂ NEON TICKLE DEFENSE ü™∂</h1>
  </div>

  <div class="ui-overlay stats-panel">
    <div class="stat">
      <span class="stat-label">Score</span>
      <span class="stat-value" id="score">0</span>
    </div>
    <div class="stat">
      <span class="stat-label">Wave</span>
      <span class="stat-value" id="wave">1</span>
    </div>
    <div class="stat">
      <span class="stat-label">Blocked</span>
      <span class="stat-value" id="blocked">0</span>
    </div>
  </div>

  <div class="ui-overlay right-panel">
    <div class="tickle-meter">
      <div class="tickle-label">TICKLE METER</div>
      <div class="tickle-bar">
        <div class="tickle-fill" id="tickleFill" style="width: 0%"></div>
      </div>
    </div>
    <div class="laser-meter">
      <div class="laser-label">‚ö° ORBITAL LASER ‚ö°</div>
      <div class="laser-bar">
        <div class="laser-fill" id="laserFill" style="width: 0%"></div>
      </div>
      <div class="laser-ready" id="laserReady" style="display: none;">PRESS SPACE TO FIRE!</div>
    </div>
    <div class="powerups-display">
      <div class="powerups-label">ACTIVE POWER-UPS</div>
      <div class="active-powerups" id="activePowerups">-</div>
    </div>
  </div>

  <div class="ui-overlay instructions">
    Click feathers ‚Ä¢ Collect power-ups ‚Ä¢ SPACE for orbital laser
  </div>

  <div class="game-over" id="gameOver">
    <h2>ü§ñ TOO TICKLISH! ü§ñ</h2>
    <p>Final Score: <span id="finalScore">0</span></p>
    <button class="restart-btn" id="restartBtn">PLAY AGAIN</button>
  </div>

  <div class="backlink"><a href="https://sloppy.live">sloppy.live</a></div>

  <!-- GIANT NUKE BUTTON -->
  <button class="nuke-btn" id="nukeBtn">
    <span class="nuke-icon">‚ò¢Ô∏è</span>
    <span class="nuke-text">NUKE</span>
  </button>
  <div class="nuke-cooldown" id="nukeCooldown"></div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resize();
    window.addEventListener('resize', resize);

    // Game state
    let score = 0;
    let wave = 1;
    let blocked = 0;
    let tickleLevel = 0;
    let gameRunning = true;
    let feathers = [];
    let particles = [];
    let laughParticles = [];
    let powerups = [];

    // Orbital Laser
    let laserCharge = 0;
    let laserFiring = false;
    let laserAngle = 0;
    let laserWidth = 0;

    // Active power-up effects
    let shieldActive = false;
    let shieldTimer = 0;
    let slowMoActive = false;
    let slowMoTimer = 0;
    let multiBlastActive = false;
    let multiBlastTimer = 0;

    // Nuke state
    let nukeCooldown = 0;
    const NUKE_COOLDOWN_TIME = 600; // 10 seconds at 60fps

    // Robot state
    const robot = {
      x: 0,
      y: 0,
      size: 80,
      laughing: false,
      laughTimer: 0,
      eyeOffset: 0,
      mouthOpen: 0
    };

    // Power-up types
    const powerupTypes = [
      { type: 'laser', emoji: '‚ö°', color: '#ff0000', desc: 'Laser Charge' },
      { type: 'shield', emoji: 'üõ°Ô∏è', color: '#00ffff', desc: 'Shield' },
      { type: 'slowmo', emoji: '‚è∞', color: '#ffff00', desc: 'Slow Motion' },
      { type: 'multi', emoji: 'üí•', color: '#ff00ff', desc: 'Multi-Blast' }
    ];

    // Feather colors
    const featherColors = [
      '#ff00ff', '#00ffff', '#ff6600', '#00ff88', '#ffff00', '#ff3366'
    ];

    // Create a feather (EASIER: slower base speed)
    function createFeather() {
      const color = featherColors[Math.floor(Math.random() * featherColors.length)];
      const speedMod = slowMoActive ? 0.3 : 1;
      return {
        x: Math.random() * (canvas.width - 100) + 50,
        y: -30,
        vx: (Math.random() - 0.5) * 1.5 * speedMod,
        vy: (0.5 + Math.random() * 1.2 + wave * 0.15) * speedMod,
        rotation: Math.random() * Math.PI * 2,
        rotationSpeed: (Math.random() - 0.5) * 0.1,
        size: 25 + Math.random() * 15,
        color: color,
        wobble: Math.random() * Math.PI * 2,
        wobbleSpeed: 0.05 + Math.random() * 0.05
      };
    }

    // Create a power-up
    function createPowerup() {
      const type = powerupTypes[Math.floor(Math.random() * powerupTypes.length)];
      return {
        x: Math.random() * (canvas.width - 100) + 50,
        y: -30,
        vy: 1.5,
        size: 30,
        ...type,
        pulse: 0
      };
    }

    // Draw a feather
    function drawFeather(f) {
      ctx.save();
      ctx.translate(f.x, f.y);
      ctx.rotate(f.rotation);

      ctx.shadowColor = f.color;
      ctx.shadowBlur = 15;

      ctx.strokeStyle = f.color;
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(0, -f.size);
      ctx.lineTo(0, f.size);
      ctx.stroke();

      ctx.fillStyle = f.color;
      for (let i = -f.size + 5; i < f.size - 5; i += 5) {
        const width = (1 - Math.abs(i) / f.size) * f.size * 0.4;
        ctx.beginPath();
        ctx.ellipse(0, i, width, 3, 0, 0, Math.PI * 2);
        ctx.fill();
      }

      ctx.restore();
    }

    // Draw power-up
    function drawPowerup(p) {
      ctx.save();
      ctx.translate(p.x, p.y);

      // Glow
      ctx.shadowColor = p.color;
      ctx.shadowBlur = 20 + Math.sin(p.pulse) * 10;

      // Circle background
      ctx.fillStyle = 'rgba(0,0,0,0.7)';
      ctx.beginPath();
      ctx.arc(0, 0, p.size, 0, Math.PI * 2);
      ctx.fill();

      // Border
      ctx.strokeStyle = p.color;
      ctx.lineWidth = 3;
      ctx.stroke();

      // Emoji
      ctx.font = `${p.size}px Arial`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(p.emoji, 0, 2);

      ctx.restore();
    }

    // Draw orbital laser
    function drawOrbitalLaser() {
      if (!laserFiring) return;

      const centerX = canvas.width / 2;
      const startY = -50;

      ctx.save();

      // Laser beam
      const beamLength = canvas.height + 100;
      const beamX = centerX + Math.sin(laserAngle) * (canvas.width * 0.4);

      // Outer glow
      const gradient = ctx.createLinearGradient(beamX - laserWidth * 2, 0, beamX + laserWidth * 2, 0);
      gradient.addColorStop(0, 'rgba(255, 0, 0, 0)');
      gradient.addColorStop(0.3, 'rgba(255, 100, 0, 0.3)');
      gradient.addColorStop(0.5, 'rgba(255, 255, 0, 1)');
      gradient.addColorStop(0.7, 'rgba(255, 100, 0, 0.3)');
      gradient.addColorStop(1, 'rgba(255, 0, 0, 0)');

      ctx.fillStyle = gradient;
      ctx.fillRect(beamX - laserWidth * 2, startY, laserWidth * 4, beamLength);

      // Core beam
      ctx.shadowColor = '#ffff00';
      ctx.shadowBlur = 30;
      ctx.fillStyle = '#ffffff';
      ctx.fillRect(beamX - laserWidth / 2, startY, laserWidth, beamLength);

      // Satellite at top
      ctx.shadowColor = '#ff0000';
      ctx.shadowBlur = 20;
      ctx.fillStyle = '#333';
      ctx.beginPath();
      ctx.arc(beamX, 30, 25, 0, Math.PI * 2);
      ctx.fill();
      ctx.strokeStyle = '#ff0000';
      ctx.lineWidth = 3;
      ctx.stroke();

      // Satellite details
      ctx.fillStyle = '#ff0000';
      ctx.fillRect(beamX - 40, 25, 20, 10);
      ctx.fillRect(beamX + 20, 25, 20, 10);

      ctx.restore();

      // Check laser collision with feathers
      for (let i = feathers.length - 1; i >= 0; i--) {
        const f = feathers[i];
        if (Math.abs(f.x - beamX) < laserWidth * 2) {
          score += 10;
          blocked++;
          createParticles(f.x, f.y, '#ffff00');
          feathers.splice(i, 1);
        }
      }
    }

    // Draw the robot
    function drawRobot() {
      const r = robot;
      r.x = canvas.width / 2;
      r.y = canvas.height - 100;

      ctx.save();
      ctx.translate(r.x, r.y);

      if (r.laughing) {
        ctx.translate(
          Math.sin(Date.now() * 0.05) * 5,
          Math.cos(Date.now() * 0.07) * 3
        );
      }

      // Shield effect
      if (shieldActive) {
        ctx.shadowColor = '#00ffff';
        ctx.shadowBlur = 30;
        ctx.strokeStyle = '#00ffff';
        ctx.lineWidth = 3;
        ctx.beginPath();
        ctx.arc(0, r.size * 0.3, r.size * 1.3, 0, Math.PI * 2);
        ctx.stroke();
        ctx.beginPath();
        ctx.arc(0, r.size * 0.3, r.size * 1.1, 0, Math.PI * 2);
        ctx.globalAlpha = 0.3;
        ctx.fillStyle = '#00ffff';
        ctx.fill();
        ctx.globalAlpha = 1;
      }

      ctx.shadowColor = r.laughing ? '#ffff00' : '#00ffff';
      ctx.shadowBlur = 30;

      // Body
      ctx.fillStyle = '#1a1a2e';
      ctx.strokeStyle = r.laughing ? '#ffff00' : '#00ffff';
      ctx.lineWidth = 3;
      ctx.beginPath();
      ctx.roundRect(-r.size/2, -r.size/2, r.size, r.size * 1.2, 15);
      ctx.fill();
      ctx.stroke();

      // Antenna
      ctx.beginPath();
      ctx.moveTo(0, -r.size/2);
      ctx.lineTo(0, -r.size/2 - 20);
      ctx.stroke();
      ctx.beginPath();
      ctx.arc(0, -r.size/2 - 25, 8, 0, Math.PI * 2);
      ctx.fillStyle = r.laughing ? '#ff00ff' : '#00ffff';
      ctx.fill();

      // Eyes
      const eyeY = -r.size/4 + r.eyeOffset;
      ctx.fillStyle = '#000';
      ctx.beginPath();
      ctx.ellipse(-20, eyeY, 12, r.laughing ? 3 : 10, 0, 0, Math.PI * 2);
      ctx.ellipse(20, eyeY, 12, r.laughing ? 3 : 10, 0, 0, Math.PI * 2);
      ctx.fill();

      ctx.fillStyle = r.laughing ? '#ffff00' : '#00ffff';
      ctx.beginPath();
      ctx.arc(-20, eyeY, 4, 0, Math.PI * 2);
      ctx.arc(20, eyeY, 4, 0, Math.PI * 2);
      ctx.fill();

      // Mouth
      ctx.strokeStyle = r.laughing ? '#ffff00' : '#00ffff';
      ctx.lineWidth = 3;
      ctx.beginPath();
      if (r.laughing) {
        const mouthOpen = 10 + Math.sin(Date.now() * 0.02) * 5;
        ctx.ellipse(0, r.size/4, 25, mouthOpen, 0, 0, Math.PI * 2);
        ctx.fillStyle = '#000';
        ctx.fill();
        ctx.stroke();
        ctx.font = 'bold 12px Orbitron';
        ctx.fillStyle = '#ffff00';
        ctx.textAlign = 'center';
        ctx.fillText('HA HA', 0, r.size/4 + 5);
      } else {
        ctx.arc(0, r.size/4, 20, 0.1 * Math.PI, 0.9 * Math.PI);
        ctx.stroke();
      }

      // Arms
      ctx.strokeStyle = r.laughing ? '#ffff00' : '#00ffff';
      ctx.lineWidth = 4;
      ctx.beginPath();
      ctx.moveTo(-r.size/2, 0);
      ctx.lineTo(-r.size/2 - 30, 20);
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(r.size/2, 0);
      ctx.lineTo(r.size/2 + 30, 20);
      ctx.stroke();

      ctx.restore();
    }

    // Create particle explosion
    function createParticles(x, y, color) {
      for (let i = 0; i < 10; i++) {
        particles.push({
          x, y,
          vx: (Math.random() - 0.5) * 8,
          vy: (Math.random() - 0.5) * 8,
          size: 3 + Math.random() * 5,
          color,
          life: 1
        });
      }
    }

    // Create laugh particles
    function createLaughParticle() {
      const texts = ['HA', 'HE', 'HO', 'TEE', 'HEE'];
      laughParticles.push({
        x: robot.x + (Math.random() - 0.5) * 100,
        y: robot.y - 50,
        vy: -2 - Math.random() * 2,
        text: texts[Math.floor(Math.random() * texts.length)],
        life: 1,
        size: 14 + Math.random() * 10
      });
    }

    // Update particles
    function updateParticles() {
      for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.life -= 0.02;
        if (p.life <= 0) particles.splice(i, 1);
      }

      for (let i = laughParticles.length - 1; i >= 0; i--) {
        const p = laughParticles[i];
        p.y += p.vy;
        p.life -= 0.015;
        if (p.life <= 0) laughParticles.splice(i, 1);
      }
    }

    // Draw particles
    function drawParticles() {
      particles.forEach(p => {
        ctx.globalAlpha = p.life;
        ctx.fillStyle = p.color;
        ctx.shadowColor = p.color;
        ctx.shadowBlur = 10;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fill();
      });

      laughParticles.forEach(p => {
        ctx.globalAlpha = p.life;
        ctx.font = `bold ${p.size}px Orbitron`;
        ctx.fillStyle = '#ffff00';
        ctx.shadowColor = '#ffff00';
        ctx.shadowBlur = 15;
        ctx.textAlign = 'center';
        ctx.fillText(p.text, p.x, p.y);
      });

      ctx.globalAlpha = 1;
      ctx.shadowBlur = 0;
    }

    // Check collision
    function checkCollision(f) {
      const dx = f.x - robot.x;
      const dy = f.y - robot.y;
      const dist = Math.sqrt(dx * dx + dy * dy);
      return dist < robot.size + f.size;
    }

    // Apply power-up
    function applyPowerup(type) {
      switch(type) {
        case 'laser':
          laserCharge = Math.min(100, laserCharge + 35);
          break;
        case 'shield':
          shieldActive = true;
          shieldTimer = 300;
          break;
        case 'slowmo':
          slowMoActive = true;
          slowMoTimer = 400;
          // Slow existing feathers
          feathers.forEach(f => {
            f.vy *= 0.3;
            f.vx *= 0.3;
          });
          break;
        case 'multi':
          multiBlastActive = true;
          multiBlastTimer = 300;
          break;
      }
      updatePowerupUI();
    }

    // Update power-up UI
    function updatePowerupUI() {
      const container = document.getElementById('activePowerups');
      let html = '';
      if (shieldActive) html += '<span class="powerup-icon" style="color:#00ffff">üõ°Ô∏è</span>';
      if (slowMoActive) html += '<span class="powerup-icon" style="color:#ffff00">‚è∞</span>';
      if (multiBlastActive) html += '<span class="powerup-icon" style="color:#ff00ff">üí•</span>';
      container.innerHTML = html || '-';
    }

    // Update game
    function update() {
      if (!gameRunning) return;

      // Spawn feathers (EASIER: slower spawn rate)
      if (Math.random() < 0.012 + wave * 0.003) {
        feathers.push(createFeather());
      }

      // Spawn power-ups (EASIER: more power-ups!)
      if (Math.random() < 0.012) {
        powerups.push(createPowerup());
      }

      // Update feathers
      for (let i = feathers.length - 1; i >= 0; i--) {
        const f = feathers[i];

        f.wobble += f.wobbleSpeed;
        f.x += f.vx + Math.sin(f.wobble) * 0.5;
        f.y += f.vy;
        f.rotation += f.rotationSpeed;

        if (checkCollision(f)) {
          if (shieldActive) {
            // Shield blocks the feather
            createParticles(f.x, f.y, '#00ffff');
            score += 5;
          } else {
            tickleLevel += 5; // EASIER: less tickle damage (was 10)
            robot.laughing = true;
            robot.laughTimer = 30;
            createLaughParticle();
          }
          createParticles(f.x, f.y, f.color);
          feathers.splice(i, 1);
          continue;
        }

        if (f.y > canvas.height + 50) {
          feathers.splice(i, 1);
        }
      }

      // Update power-ups
      for (let i = powerups.length - 1; i >= 0; i--) {
        const p = powerups[i];
        p.y += p.vy;
        p.pulse += 0.1;

        // Check collection
        const dx = p.x - robot.x;
        const dy = p.y - robot.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < robot.size + p.size) {
          applyPowerup(p.type);
          createParticles(p.x, p.y, p.color);
          powerups.splice(i, 1);
          continue;
        }

        if (p.y > canvas.height + 50) {
          powerups.splice(i, 1);
        }
      }

      // Update power-up timers
      if (shieldTimer > 0) {
        shieldTimer--;
        if (shieldTimer <= 0) {
          shieldActive = false;
          updatePowerupUI();
        }
      }
      if (slowMoTimer > 0) {
        slowMoTimer--;
        if (slowMoTimer <= 0) {
          slowMoActive = false;
          updatePowerupUI();
        }
      }
      if (multiBlastTimer > 0) {
        multiBlastTimer--;
        if (multiBlastTimer <= 0) {
          multiBlastActive = false;
          updatePowerupUI();
        }
      }

      // Update orbital laser
      if (laserFiring) {
        laserAngle += 0.03;
        laserWidth = 20 + Math.sin(Date.now() * 0.01) * 5;
        laserCharge -= 0.5;
        if (laserCharge <= 0) {
          laserFiring = false;
          laserCharge = 0;
        }
      }

      // Update robot
      if (robot.laughTimer > 0) {
        robot.laughTimer--;
        if (robot.laughTimer <= 0) robot.laughing = false;
        if (Math.random() < 0.3) createLaughParticle();
      }

      tickleLevel = Math.max(0, tickleLevel - 0.2); // EASIER: faster decay (was 0.1)

      // Update nuke cooldown
      if (nukeCooldown > 0) {
        nukeCooldown--;
        const secondsLeft = Math.ceil(nukeCooldown / 60);
        document.getElementById('nukeCooldown').textContent = secondsLeft + 's';
        document.getElementById('nukeBtn').disabled = true;
      } else {
        document.getElementById('nukeCooldown').textContent = '';
        document.getElementById('nukeBtn').disabled = false;
      }

      // Update UI
      document.getElementById('tickleFill').style.width = tickleLevel + '%';
      document.getElementById('laserFill').style.width = laserCharge + '%';
      document.getElementById('laserReady').style.display = laserCharge >= 100 ? 'block' : 'none';
      document.getElementById('score').textContent = score;
      document.getElementById('blocked').textContent = blocked;

      if (tickleLevel >= 100) {
        endGame();
      }

      if (score > 0 && score % 500 === 0) {
        wave++;
        document.getElementById('wave').textContent = wave;
      }

      updateParticles();
    }

    // Draw game
    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Draw grid background
      ctx.strokeStyle = 'rgba(255, 0, 255, 0.1)';
      ctx.lineWidth = 1;
      const gridSize = 50;
      for (let x = 0; x < canvas.width; x += gridSize) {
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x, canvas.height);
        ctx.stroke();
      }
      for (let y = 0; y < canvas.height; y += gridSize) {
        ctx.beginPath();
        ctx.moveTo(0, y);
        ctx.lineTo(canvas.width, y);
        ctx.stroke();
      }

      // Draw orbital laser
      drawOrbitalLaser();

      // Draw power-ups
      powerups.forEach(p => drawPowerup(p));

      // Draw feathers
      feathers.forEach(f => drawFeather(f));

      // Draw robot
      drawRobot();

      // Draw particles
      drawParticles();
    }

    // Click handler
    canvas.addEventListener('click', (e) => {
      if (!gameRunning) return;

      const rect = canvas.getBoundingClientRect();
      const mx = e.clientX - rect.left;
      const my = e.clientY - rect.top;

      // Check power-up collection by click
      for (let i = powerups.length - 1; i >= 0; i--) {
        const p = powerups[i];
        const dx = mx - p.x;
        const dy = my - p.y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < p.size + 20) {
          applyPowerup(p.type);
          createParticles(p.x, p.y, p.color);
          powerups.splice(i, 1);
          return;
        }
      }

      // Check feather destruction
      const blastRadius = multiBlastActive ? 100 : 0;
      let destroyed = [];

      for (let i = feathers.length - 1; i >= 0; i--) {
        const f = feathers[i];
        const dx = mx - f.x;
        const dy = my - f.y;
        const dist = Math.sqrt(dx * dx + dy * dy);

        if (dist < f.size + 20 + blastRadius) {
          destroyed.push(i);
        }
      }

      // Remove destroyed feathers
      destroyed.forEach(i => {
        if (feathers[i]) {
          score += 10;
          blocked++;
          createParticles(feathers[i].x, feathers[i].y, feathers[i].color);
        }
      });
      destroyed.sort((a, b) => b - a).forEach(i => feathers.splice(i, 1));
    });

    // Touch support
    canvas.addEventListener('touchstart', (e) => {
      e.preventDefault();
      const touch = e.touches[0];
      canvas.dispatchEvent(new MouseEvent('click', {
        clientX: touch.clientX,
        clientY: touch.clientY
      }));
    });

    // GIANT NUKE - clears all feathers!
    function fireNuke() {
      if (!gameRunning || nukeCooldown > 0) return;

      // Flash effect
      const flash = document.createElement('div');
      flash.className = 'nuke-flash';
      document.body.appendChild(flash);
      setTimeout(() => flash.remove(), 500);

      // Destroy ALL feathers with massive particles
      feathers.forEach(f => {
        createParticles(f.x, f.y, '#ff0000');
        createParticles(f.x, f.y, '#ffff00');
        score += 10;
        blocked++;
      });

      // Clear all feathers
      feathers = [];

      // Also clear some tickle level as bonus
      tickleLevel = Math.max(0, tickleLevel - 20);

      // Start cooldown
      nukeCooldown = NUKE_COOLDOWN_TIME;
    }

    // Nuke button click handler
    document.getElementById('nukeBtn').addEventListener('click', fireNuke);

    // Keyboard - fire laser
    document.addEventListener('keydown', (e) => {
      if (e.code === 'Space' && gameRunning && laserCharge >= 100 && !laserFiring) {
        laserFiring = true;
        laserAngle = -Math.PI / 2;
      }
    });

    // End game
    function endGame() {
      gameRunning = false;
      document.getElementById('finalScore').textContent = score;
      document.getElementById('gameOver').classList.add('visible');
    }

    // Restart
    document.getElementById('restartBtn').addEventListener('click', () => {
      score = 0;
      wave = 1;
      blocked = 0;
      tickleLevel = 0;
      laserCharge = 0;
      laserFiring = false;
      shieldActive = false;
      slowMoActive = false;
      multiBlastActive = false;
      nukeCooldown = 0;
      gameRunning = true;
      feathers = [];
      particles = [];
      laughParticles = [];
      powerups = [];
      robot.laughing = false;

      document.getElementById('score').textContent = '0';
      document.getElementById('wave').textContent = '1';
      document.getElementById('blocked').textContent = '0';
      document.getElementById('tickleFill').style.width = '0%';
      document.getElementById('laserFill').style.width = '0%';
      document.getElementById('laserReady').style.display = 'none';
      document.getElementById('gameOver').classList.remove('visible');
      updatePowerupUI();
    });

    // Game loop
    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    gameLoop();
  </script>
<script src="/sloppy-header/sloppy-bar.js"></script>
</body>
</html>
