<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Diamond Drill Escape - Break Through the Iron</title>
  <link rel="icon" href="https://emojicdn.elk.sh/üíé">
  <meta property="og:title" content="Diamond Drill Escape">
  <meta property="og:description" content="Drill through crumbling iron walls to escape the mine!">
  <meta property="og:url" content="https://sloppy.live/diamond-drill">
  <meta property="og:image" content="https://emojicdn.elk.sh/üíé?style=apple&size=512">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Rajdhani:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --diamond: #00ffff;
      --diamond-dark: #0088aa;
      --iron: #4a4a4a;
      --iron-light: #6a6a6a;
      --rust: #8b4513;
      --gold: #ffd700;
      --danger: #ff4444;
      --bg-dark: #1a1a2e;
      --bg-darker: #0f0f1a;
    }

    body {
      font-family: 'Rajdhani', sans-serif;
      background: var(--bg-darker);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #fff;
      overflow: hidden;
    }

    header {
      text-align: center;
      padding: 15px;
      position: relative;
      z-index: 10;
    }

    h1 {
      font-family: 'Orbitron', sans-serif;
      font-size: 2rem;
      color: var(--diamond);
      text-shadow: 0 0 20px var(--diamond), 0 0 40px var(--diamond-dark);
      letter-spacing: 3px;
    }

    .subtitle {
      font-size: 0.9rem;
      opacity: 0.7;
      margin-top: 5px;
    }

    .game-container {
      position: relative;
      border: 4px solid var(--iron);
      box-shadow: 0 0 30px rgba(0, 255, 255, 0.2), inset 0 0 50px rgba(0,0,0,0.5);
      background: var(--bg-dark);
    }

    canvas {
      display: block;
    }

    .hud {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 20px;
      background: rgba(0,0,0,0.5);
      border-bottom: 2px solid var(--iron);
    }

    .hud-item {
      text-align: center;
    }

    .hud-label {
      font-size: 0.7rem;
      text-transform: uppercase;
      opacity: 0.6;
    }

    .hud-value {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.3rem;
      color: var(--diamond);
    }

    .drill-power {
      width: 150px;
      height: 12px;
      background: var(--iron);
      border-radius: 6px;
      overflow: hidden;
      margin-top: 5px;
    }

    .drill-power-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--diamond-dark) 0%, var(--diamond) 100%);
      transition: width 0.1s;
      box-shadow: 0 0 10px var(--diamond);
    }

    .game-over, .game-win {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      background: rgba(0, 0, 0, 0.9);
      padding: 40px;
      border: 3px solid var(--diamond);
      border-radius: 10px;
      display: none;
      z-index: 100;
    }

    .game-over.show, .game-win.show { display: block; }

    .game-over h2 { color: var(--danger); }
    .game-win h2 { color: var(--gold); }

    .game-over h2, .game-win h2 {
      font-family: 'Orbitron', sans-serif;
      font-size: 2rem;
      margin-bottom: 20px;
    }

    .restart-btn {
      font-family: 'Orbitron', sans-serif;
      font-size: 1rem;
      padding: 12px 30px;
      background: linear-gradient(180deg, var(--diamond) 0%, var(--diamond-dark) 100%);
      border: none;
      color: var(--bg-darker);
      cursor: pointer;
      margin-top: 15px;
      transition: all 0.3s;
    }

    .restart-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px var(--diamond);
    }

    .controls-hint {
      font-size: 0.8rem;
      opacity: 0.6;
      margin-top: 15px;
    }

    .backlink {
      margin-top: 15px;
      opacity: 0.6;
    }

    .backlink a {
      color: var(--diamond);
      text-decoration: none;
    }

    @media (max-width: 700px) {
      h1 { font-size: 1.4rem; }
      .hud { padding: 8px 10px; }
      .hud-value { font-size: 1rem; }
      .drill-power { width: 100px; }
    }
  </style>
</head>
<body>
  <header>
    <h1>DIAMOND DRILL ESCAPE</h1>
    <p class="subtitle">Break through the iron walls to freedom</p>
  </header>

  <div class="game-container">
    <div class="hud">
      <div class="hud-item">
        <div class="hud-label">Depth</div>
        <div class="hud-value" id="depth">0m</div>
      </div>
      <div class="hud-item">
        <div class="hud-label">Drill Power</div>
        <div class="drill-power">
          <div class="drill-power-fill" id="power-fill" style="width: 100%"></div>
        </div>
      </div>
      <div class="hud-item">
        <div class="hud-label">Score</div>
        <div class="hud-value" id="score">0</div>
      </div>
    </div>
    <canvas id="game"></canvas>

    <div class="game-over" id="game-over">
      <h2>DRILL OVERHEATED</h2>
      <p>Your drill couldn't take the pressure!</p>
      <p>Final Depth: <span id="final-depth">0</span>m</p>
      <button class="restart-btn" id="restart">TRY AGAIN</button>
    </div>

    <div class="game-win" id="game-win">
      <h2>ESCAPED!</h2>
      <p>You broke through to freedom!</p>
      <p>Final Score: <span id="final-score">0</span></p>
      <button class="restart-btn" id="restart-win">DRILL DEEPER</button>
    </div>
  </div>

  <p class="controls-hint">WASD or Arrow Keys to move ‚Ä¢ Hold to drill through walls</p>
  <div class="backlink">
    <a href="https://sloppy.live">‚¨ÜÔ∏è Back to sloppy.live</a>
  </div>

  <script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');

    // Responsive canvas
    const isMobile = window.innerWidth < 700;
    const COLS = isMobile ? 12 : 20;
    const ROWS = isMobile ? 18 : 15;
    const TILE = isMobile ? 28 : 40;

    canvas.width = COLS * TILE;
    canvas.height = ROWS * TILE;

    // Game state
    let gameRunning = true;
    let score = 0;
    let depth = 0;

    // Drill
    const drill = {
      x: Math.floor(COLS / 2),
      y: 1,
      power: 100,
      maxPower: 100,
      drilling: false,
      drillDir: { x: 0, y: 0 },
      sparkTimer: 0,
      angle: 0
    };

    // Wall types
    const EMPTY = 0;
    const IRON = 1;
    const IRON_CRACKED = 2;
    const IRON_BREAKING = 3;
    const GOLD = 4;
    const EXIT = 5;

    // Grid
    let grid = [];
    let debris = [];
    let sparks = [];

    function initGrid() {
      grid = [];
      for (let y = 0; y < ROWS; y++) {
        const row = [];
        for (let x = 0; x < COLS; x++) {
          if (y === 0) {
            row.push(EMPTY); // Top row empty (start)
          } else if (y === ROWS - 1) {
            row.push(EXIT); // Bottom row is exit
          } else {
            // Random wall generation with paths
            if (Math.random() < 0.15) {
              row.push(EMPTY);
            } else if (Math.random() < 0.1) {
              row.push(GOLD);
            } else {
              row.push(IRON);
            }
          }
        }
        grid.push(row);
      }

      // Ensure starting area is clear
      grid[0][drill.x] = EMPTY;
      grid[1][drill.x] = EMPTY;

      // Ensure there's always a path (carve one)
      let pathX = drill.x;
      for (let y = 2; y < ROWS - 1; y++) {
        if (Math.random() < 0.3) {
          pathX += Math.random() < 0.5 ? -1 : 1;
          pathX = Math.max(1, Math.min(COLS - 2, pathX));
        }
        grid[y][pathX] = EMPTY;
      }
    }

    // Physics for debris
    class Debris {
      constructor(x, y, color) {
        this.x = x;
        this.y = y;
        this.vx = (Math.random() - 0.5) * 4;
        this.vy = -Math.random() * 3 - 1;
        this.size = Math.random() * 8 + 4;
        this.rotation = Math.random() * Math.PI * 2;
        this.rotSpeed = (Math.random() - 0.5) * 0.3;
        this.color = color;
        this.life = 1;
        this.gravity = 0.15;
      }

      update() {
        this.vy += this.gravity;
        this.x += this.vx;
        this.y += this.vy;
        this.rotation += this.rotSpeed;
        this.life -= 0.02;

        // Bounce off floor
        if (this.y > canvas.height - this.size) {
          this.y = canvas.height - this.size;
          this.vy *= -0.5;
          this.vx *= 0.8;
        }

        // Bounce off walls
        if (this.x < 0 || this.x > canvas.width) {
          this.vx *= -0.7;
        }
      }

      draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rotation);
        ctx.globalAlpha = this.life;
        ctx.fillStyle = this.color;
        ctx.fillRect(-this.size/2, -this.size/2, this.size, this.size);
        ctx.restore();
      }
    }

    // Sparks
    class Spark {
      constructor(x, y) {
        this.x = x;
        this.y = y;
        this.vx = (Math.random() - 0.5) * 8;
        this.vy = (Math.random() - 0.5) * 8;
        this.life = 1;
        this.size = Math.random() * 3 + 1;
      }

      update() {
        this.x += this.vx;
        this.y += this.vy;
        this.vx *= 0.95;
        this.vy *= 0.95;
        this.life -= 0.05;
      }

      draw() {
        ctx.globalAlpha = this.life;
        ctx.fillStyle = `hsl(${180 + Math.random() * 30}, 100%, ${50 + this.life * 50}%)`;
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalAlpha = 1;
      }
    }

    function spawnDebris(x, y, type) {
      const colors = type === GOLD ? ['#ffd700', '#ffb700', '#cc9900'] : ['#4a4a4a', '#5a5a5a', '#3a3a3a', '#8b4513'];
      for (let i = 0; i < 8; i++) {
        const color = colors[Math.floor(Math.random() * colors.length)];
        debris.push(new Debris(x + TILE/2, y + TILE/2, color));
      }
    }

    function spawnSparks(x, y, count = 5) {
      for (let i = 0; i < count; i++) {
        sparks.push(new Spark(x, y));
      }
    }

    // Drawing functions
    function drawTile(x, y, type) {
      const px = x * TILE;
      const py = y * TILE;

      if (type === EMPTY) {
        // Dark background
        ctx.fillStyle = '#0a0a15';
        ctx.fillRect(px, py, TILE, TILE);
      } else if (type === IRON || type === IRON_CRACKED || type === IRON_BREAKING) {
        // Iron wall
        const gradient = ctx.createLinearGradient(px, py, px + TILE, py + TILE);
        gradient.addColorStop(0, '#5a5a5a');
        gradient.addColorStop(0.5, '#4a4a4a');
        gradient.addColorStop(1, '#3a3a3a');
        ctx.fillStyle = gradient;
        ctx.fillRect(px, py, TILE, TILE);

        // Rivets
        ctx.fillStyle = '#6a6a6a';
        ctx.beginPath();
        ctx.arc(px + 6, py + 6, 3, 0, Math.PI * 2);
        ctx.arc(px + TILE - 6, py + 6, 3, 0, Math.PI * 2);
        ctx.arc(px + 6, py + TILE - 6, 3, 0, Math.PI * 2);
        ctx.arc(px + TILE - 6, py + TILE - 6, 3, 0, Math.PI * 2);
        ctx.fill();

        // Cracks
        if (type === IRON_CRACKED || type === IRON_BREAKING) {
          ctx.strokeStyle = type === IRON_BREAKING ? '#8b4513' : '#2a2a2a';
          ctx.lineWidth = type === IRON_BREAKING ? 3 : 2;
          ctx.beginPath();
          ctx.moveTo(px + TILE * 0.3, py);
          ctx.lineTo(px + TILE * 0.5, py + TILE * 0.5);
          ctx.lineTo(px + TILE * 0.7, py + TILE);
          ctx.moveTo(px, py + TILE * 0.4);
          ctx.lineTo(px + TILE * 0.5, py + TILE * 0.5);
          ctx.lineTo(px + TILE, py + TILE * 0.6);
          ctx.stroke();
        }

        // Rust spots
        ctx.fillStyle = 'rgba(139, 69, 19, 0.3)';
        ctx.beginPath();
        ctx.arc(px + TILE * 0.7, py + TILE * 0.3, 4, 0, Math.PI * 2);
        ctx.arc(px + TILE * 0.2, py + TILE * 0.8, 3, 0, Math.PI * 2);
        ctx.fill();

        // Border
        ctx.strokeStyle = '#2a2a2a';
        ctx.lineWidth = 1;
        ctx.strokeRect(px, py, TILE, TILE);
      } else if (type === GOLD) {
        // Gold ore
        const gradient = ctx.createRadialGradient(px + TILE/2, py + TILE/2, 0, px + TILE/2, py + TILE/2, TILE);
        gradient.addColorStop(0, '#ffd700');
        gradient.addColorStop(0.7, '#cc9900');
        gradient.addColorStop(1, '#996600');
        ctx.fillStyle = gradient;
        ctx.fillRect(px, py, TILE, TILE);

        // Sparkle
        ctx.fillStyle = '#fff';
        ctx.globalAlpha = 0.5 + Math.sin(Date.now() / 200) * 0.3;
        ctx.beginPath();
        ctx.arc(px + TILE * 0.3, py + TILE * 0.3, 3, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalAlpha = 1;

        ctx.strokeStyle = '#664400';
        ctx.lineWidth = 2;
        ctx.strokeRect(px, py, TILE, TILE);
      } else if (type === EXIT) {
        // Exit zone
        ctx.fillStyle = '#001a00';
        ctx.fillRect(px, py, TILE, TILE);

        // Glow
        const glow = ctx.createRadialGradient(px + TILE/2, py + TILE/2, 0, px + TILE/2, py + TILE/2, TILE);
        glow.addColorStop(0, 'rgba(0, 255, 100, 0.3)');
        glow.addColorStop(1, 'rgba(0, 255, 100, 0)');
        ctx.fillStyle = glow;
        ctx.fillRect(px, py, TILE, TILE);

        // Arrow
        ctx.fillStyle = '#00ff66';
        ctx.globalAlpha = 0.5 + Math.sin(Date.now() / 300) * 0.3;
        ctx.beginPath();
        ctx.moveTo(px + TILE/2, py + 5);
        ctx.lineTo(px + TILE - 5, py + TILE/2);
        ctx.lineTo(px + TILE/2, py + TILE - 5);
        ctx.lineTo(px + 5, py + TILE/2);
        ctx.closePath();
        ctx.fill();
        ctx.globalAlpha = 1;
      }
    }

    function drawDrill() {
      const px = drill.x * TILE + TILE / 2;
      const py = drill.y * TILE + TILE / 2;

      // Glow
      const glow = ctx.createRadialGradient(px, py, 0, px, py, TILE);
      glow.addColorStop(0, 'rgba(0, 255, 255, 0.4)');
      glow.addColorStop(1, 'rgba(0, 255, 255, 0)');
      ctx.fillStyle = glow;
      ctx.beginPath();
      ctx.arc(px, py, TILE, 0, Math.PI * 2);
      ctx.fill();

      ctx.save();
      ctx.translate(px, py);

      // Rotate drill based on movement
      if (drill.drilling) {
        drill.angle += 0.3;
      }
      ctx.rotate(drill.angle);

      // Diamond drill head
      const size = TILE * 0.4;

      // Drill body
      ctx.fillStyle = '#333';
      ctx.beginPath();
      ctx.arc(0, 0, size * 0.7, 0, Math.PI * 2);
      ctx.fill();

      // Diamond tip (rotating triangles)
      for (let i = 0; i < 4; i++) {
        ctx.save();
        ctx.rotate((i / 4) * Math.PI * 2);

        const gradient = ctx.createLinearGradient(0, -size, 0, 0);
        gradient.addColorStop(0, '#00ffff');
        gradient.addColorStop(0.5, '#00aaaa');
        gradient.addColorStop(1, '#006666');
        ctx.fillStyle = gradient;

        ctx.beginPath();
        ctx.moveTo(0, -size);
        ctx.lineTo(-size * 0.3, 0);
        ctx.lineTo(size * 0.3, 0);
        ctx.closePath();
        ctx.fill();

        ctx.strokeStyle = '#00ffff';
        ctx.lineWidth = 1;
        ctx.stroke();

        ctx.restore();
      }

      // Center gem
      ctx.fillStyle = '#00ffff';
      ctx.beginPath();
      ctx.arc(0, 0, size * 0.25, 0, Math.PI * 2);
      ctx.fill();

      ctx.restore();

      // Drilling sparks
      if (drill.drilling) {
        drill.sparkTimer++;
        if (drill.sparkTimer % 3 === 0) {
          const sparkX = px + drill.drillDir.x * TILE * 0.5;
          const sparkY = py + drill.drillDir.y * TILE * 0.5;
          spawnSparks(sparkX, sparkY, 2);
        }
      }
    }

    // Input
    const keys = {};
    document.addEventListener('keydown', e => {
      keys[e.code] = true;
      if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'Space'].includes(e.code)) {
        e.preventDefault();
      }
    });
    document.addEventListener('keyup', e => keys[e.code] = false);

    // Touch controls
    let touchStart = null;
    canvas.addEventListener('touchstart', e => {
      e.preventDefault();
      touchStart = { x: e.touches[0].clientX, y: e.touches[0].clientY };
    });
    canvas.addEventListener('touchmove', e => {
      e.preventDefault();
      if (!touchStart) return;
      const dx = e.touches[0].clientX - touchStart.x;
      const dy = e.touches[0].clientY - touchStart.y;
      keys['ArrowLeft'] = dx < -20;
      keys['ArrowRight'] = dx > 20;
      keys['ArrowUp'] = dy < -20;
      keys['ArrowDown'] = dy > 20;
    });
    canvas.addEventListener('touchend', () => {
      touchStart = null;
      keys['ArrowLeft'] = keys['ArrowRight'] = keys['ArrowUp'] = keys['ArrowDown'] = false;
    });

    function tryMove(dx, dy) {
      const newX = drill.x + dx;
      const newY = drill.y + dy;

      if (newX < 0 || newX >= COLS || newY < 0 || newY >= ROWS) return;

      const tile = grid[newY][newX];

      drill.drillDir = { x: dx, y: dy };

      if (tile === EMPTY) {
        drill.x = newX;
        drill.y = newY;
        drill.drilling = false;
      } else if (tile === EXIT) {
        drill.x = newX;
        drill.y = newY;
        winGame();
      } else if (tile === GOLD) {
        drill.drilling = true;
        drill.power -= 0.5;
        score += 50;
        spawnDebris(newX * TILE, newY * TILE, GOLD);
        grid[newY][newX] = EMPTY;
        drill.x = newX;
        drill.y = newY;
      } else if (tile === IRON) {
        drill.drilling = true;
        drill.power -= 1;
        grid[newY][newX] = IRON_CRACKED;
        spawnSparks(newX * TILE + TILE/2, newY * TILE + TILE/2, 8);
      } else if (tile === IRON_CRACKED) {
        drill.drilling = true;
        drill.power -= 1;
        grid[newY][newX] = IRON_BREAKING;
        spawnSparks(newX * TILE + TILE/2, newY * TILE + TILE/2, 10);
      } else if (tile === IRON_BREAKING) {
        drill.drilling = true;
        drill.power -= 0.5;
        spawnDebris(newX * TILE, newY * TILE, IRON);
        grid[newY][newX] = EMPTY;
        score += 10;
        drill.x = newX;
        drill.y = newY;
      }

      // Update depth
      depth = Math.max(depth, drill.y);

      // Check power
      if (drill.power <= 0) {
        gameOver();
      }
    }

    let moveTimer = 0;
    function update() {
      if (!gameRunning) return;

      moveTimer++;
      if (moveTimer >= 8) {
        moveTimer = 0;

        let dx = 0, dy = 0;
        if (keys['ArrowLeft'] || keys['KeyA']) dx = -1;
        if (keys['ArrowRight'] || keys['KeyD']) dx = 1;
        if (keys['ArrowUp'] || keys['KeyW']) dy = -1;
        if (keys['ArrowDown'] || keys['KeyS']) dy = 1;

        if (dx !== 0 || dy !== 0) {
          tryMove(dx, dy);
        } else {
          drill.drilling = false;
        }
      }

      // Regenerate power slowly when not drilling
      if (!drill.drilling && drill.power < drill.maxPower) {
        drill.power += 0.1;
      }

      // Update debris
      debris = debris.filter(d => {
        d.update();
        return d.life > 0;
      });

      // Update sparks
      sparks = sparks.filter(s => {
        s.update();
        return s.life > 0;
      });
    }

    function draw() {
      // Clear
      ctx.fillStyle = '#0a0a15';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Draw grid
      for (let y = 0; y < ROWS; y++) {
        for (let x = 0; x < COLS; x++) {
          drawTile(x, y, grid[y][x]);
        }
      }

      // Draw debris
      debris.forEach(d => d.draw());

      // Draw sparks
      sparks.forEach(s => s.draw());

      // Draw drill
      drawDrill();

      // Update HUD
      document.getElementById('depth').textContent = depth + 'm';
      document.getElementById('score').textContent = score;
      document.getElementById('power-fill').style.width = (drill.power / drill.maxPower * 100) + '%';

      // Power warning
      if (drill.power < 30) {
        document.getElementById('power-fill').style.background =
          `linear-gradient(90deg, #ff4444 0%, #ff6666 100%)`;
      } else {
        document.getElementById('power-fill').style.background =
          `linear-gradient(90deg, #0088aa 0%, #00ffff 100%)`;
      }
    }

    function gameOver() {
      gameRunning = false;
      document.getElementById('final-depth').textContent = depth;
      document.getElementById('game-over').classList.add('show');
    }

    function winGame() {
      gameRunning = false;
      score += depth * 10 + Math.floor(drill.power) * 5;
      document.getElementById('final-score').textContent = score;
      document.getElementById('game-win').classList.add('show');
    }

    function restart() {
      drill.x = Math.floor(COLS / 2);
      drill.y = 1;
      drill.power = 100;
      drill.drilling = false;
      drill.angle = 0;
      score = 0;
      depth = 0;
      debris = [];
      sparks = [];
      gameRunning = true;
      initGrid();
      document.getElementById('game-over').classList.remove('show');
      document.getElementById('game-win').classList.remove('show');
    }

    document.getElementById('restart').addEventListener('click', restart);
    document.getElementById('restart-win').addEventListener('click', restart);

    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    initGrid();
    gameLoop();
  </script>
</body>
</html>
