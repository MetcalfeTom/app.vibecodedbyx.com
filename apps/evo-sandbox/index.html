<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Evo Sandbox</title>
  <link rel="icon" href="https://emojicdn.elk.sh/ðŸ§¬">
  <meta property="og:title" content="Evo Sandbox">
  <meta property="og:description" content="Watch creatures evolve and hunt in real-time!">
  <meta property="og:url" content="https://sloppy.live/evo-sandbox">
  <meta property="og:image" content="https://sloppy.live/evo-sandbox/og-image.png">
  <link href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #0d1117;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: 'Space Mono', monospace;
      color: #c9d1d9;
      padding: 15px;
    }

    h1 {
      font-family: 'Syne', sans-serif;
      font-size: 1.8rem;
      margin-bottom: 10px;
      background: linear-gradient(90deg, #58a6ff, #a371f7, #f778ba);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .container {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      justify-content: center;
      align-items: flex-start;
    }

    canvas {
      border: 2px solid #30363d;
      border-radius: 8px;
      background: #010409;
    }

    .panel {
      background: #161b22;
      border: 1px solid #30363d;
      border-radius: 8px;
      padding: 15px;
      width: 220px;
      font-size: 0.75rem;
    }

    .panel h2 {
      font-family: 'Syne', sans-serif;
      font-size: 1rem;
      margin-bottom: 12px;
      color: #58a6ff;
    }

    .stat {
      display: flex;
      justify-content: space-between;
      padding: 6px 0;
      border-bottom: 1px solid #21262d;
    }

    .stat:last-child {
      border-bottom: none;
    }

    .stat-label {
      color: #8b949e;
    }

    .stat-value {
      color: #f0f6fc;
      font-weight: 700;
    }

    .dna-display {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #30363d;
    }

    .dna-display h3 {
      font-size: 0.8rem;
      color: #a371f7;
      margin-bottom: 10px;
    }

    .gene {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }

    .gene-label {
      width: 70px;
      color: #8b949e;
      font-size: 0.65rem;
    }

    .gene-bar {
      flex: 1;
      height: 8px;
      background: #21262d;
      border-radius: 4px;
      overflow: hidden;
    }

    .gene-fill {
      height: 100%;
      border-radius: 4px;
      transition: width 0.3s;
    }

    .controls {
      margin-top: 15px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    button {
      background: #21262d;
      border: 1px solid #30363d;
      color: #c9d1d9;
      padding: 8px 12px;
      border-radius: 6px;
      font-family: 'Space Mono', monospace;
      font-size: 0.7rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    button:hover {
      background: #30363d;
      border-color: #58a6ff;
    }

    .legend {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #30363d;
      font-size: 0.65rem;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .legend-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
    }

    .back-link {
      margin-top: 20px;
      color: #484f58;
      text-decoration: none;
      font-size: 0.7rem;
      transition: color 0.3s;
    }

    .back-link:hover {
      color: #58a6ff;
    }

    @media (max-width: 700px) {
      .panel {
        width: 100%;
        max-width: 400px;
      }
      h1 {
        font-size: 1.4rem;
      }
    }
  </style>
</head>
<body>
  <h1>EVO SANDBOX</h1>
  <div class="container">
    <canvas id="world"></canvas>
    <div class="panel">
      <h2>Population Stats</h2>
      <div class="stat">
        <span class="stat-label">Creatures</span>
        <span class="stat-value" id="creatureCount">50</span>
      </div>
      <div class="stat">
        <span class="stat-label">Food</span>
        <span class="stat-value" id="foodCount">0</span>
      </div>
      <div class="stat">
        <span class="stat-label">Generation</span>
        <span class="stat-value" id="generation">1</span>
      </div>
      <div class="stat">
        <span class="stat-label">Births</span>
        <span class="stat-value" id="births">0</span>
      </div>
      <div class="stat">
        <span class="stat-label">Deaths</span>
        <span class="stat-value" id="deaths">0</span>
      </div>

      <div class="dna-display">
        <h3>Average DNA</h3>
        <div class="gene">
          <span class="gene-label">Speed</span>
          <div class="gene-bar"><div class="gene-fill" id="avgSpeed" style="background:#58a6ff;width:50%"></div></div>
        </div>
        <div class="gene">
          <span class="gene-label">Size</span>
          <div class="gene-bar"><div class="gene-fill" id="avgSize" style="background:#a371f7;width:50%"></div></div>
        </div>
        <div class="gene">
          <span class="gene-label">Sense</span>
          <div class="gene-bar"><div class="gene-fill" id="avgSense" style="background:#f778ba;width:50%"></div></div>
        </div>
        <div class="gene">
          <span class="gene-label">Efficiency</span>
          <div class="gene-bar"><div class="gene-fill" id="avgEfficiency" style="background:#3fb950;width:50%"></div></div>
        </div>
      </div>

      <div class="controls">
        <button id="resetBtn">Reset Simulation</button>
        <button id="feedBtn">Drop Food Burst</button>
      </div>

      <div class="legend">
        <div class="legend-item">
          <div class="legend-dot" style="background:#7ee787"></div>
          <span>Food particle</span>
        </div>
        <div class="legend-item">
          <div class="legend-dot" style="background:#58a6ff"></div>
          <span>Creature (color = DNA)</span>
        </div>
      </div>
    </div>
  </div>
  <a href="https://sloppy.live" class="back-link">sloppy.live</a>

  <script>
    const canvas = document.getElementById('world');
    const ctx = canvas.getContext('2d');

    // Responsive sizing
    const baseSize = Math.min(600, window.innerWidth - 280, window.innerHeight - 150);
    canvas.width = baseSize;
    canvas.height = baseSize;

    // Stats elements
    const creatureCountEl = document.getElementById('creatureCount');
    const foodCountEl = document.getElementById('foodCount');
    const generationEl = document.getElementById('generation');
    const birthsEl = document.getElementById('births');
    const deathsEl = document.getElementById('deaths');
    const avgSpeedEl = document.getElementById('avgSpeed');
    const avgSizeEl = document.getElementById('avgSize');
    const avgSenseEl = document.getElementById('avgSense');
    const avgEfficiencyEl = document.getElementById('avgEfficiency');

    // Simulation state
    let creatures = [];
    let food = [];
    let totalBirths = 0;
    let totalDeaths = 0;
    let maxGeneration = 1;

    // DNA structure: speed, size, senseRange, efficiency, hue
    class DNA {
      constructor(genes = null) {
        if (genes) {
          this.speed = genes.speed;
          this.size = genes.size;
          this.senseRange = genes.senseRange;
          this.efficiency = genes.efficiency;
          this.hue = genes.hue;
        } else {
          this.speed = 0.3 + Math.random() * 0.7; // 0.3-1.0
          this.size = 0.3 + Math.random() * 0.7;  // 0.3-1.0
          this.senseRange = 0.3 + Math.random() * 0.7;
          this.efficiency = 0.3 + Math.random() * 0.7;
          this.hue = Math.random() * 360;
        }
      }

      mutate() {
        const mutationRate = 0.15;
        const mutationAmount = 0.2;

        const mutate = (val) => {
          if (Math.random() < mutationRate) {
            val += (Math.random() - 0.5) * mutationAmount;
            return Math.max(0.1, Math.min(1.0, val));
          }
          return val;
        };

        return new DNA({
          speed: mutate(this.speed),
          size: mutate(this.size),
          senseRange: mutate(this.senseRange),
          efficiency: mutate(this.efficiency),
          hue: (this.hue + (Math.random() - 0.5) * 30 + 360) % 360
        });
      }

      crossover(other) {
        return new DNA({
          speed: Math.random() > 0.5 ? this.speed : other.speed,
          size: Math.random() > 0.5 ? this.size : other.size,
          senseRange: Math.random() > 0.5 ? this.senseRange : other.senseRange,
          efficiency: Math.random() > 0.5 ? this.efficiency : other.efficiency,
          hue: (this.hue + other.hue) / 2
        });
      }
    }

    class Creature {
      constructor(x, y, dna = null, generation = 1) {
        this.x = x;
        this.y = y;
        this.dna = dna || new DNA();
        this.generation = generation;

        // Derived stats from DNA
        this.maxSpeed = 1 + this.dna.speed * 3;
        this.radius = 4 + this.dna.size * 8;
        this.senseRadius = 30 + this.dna.senseRange * 100;
        this.metabolismRate = 0.02 + (1 - this.dna.efficiency) * 0.03;

        // State
        this.energy = 50 + this.dna.size * 50;
        this.maxEnergy = 100 + this.dna.size * 100;
        this.vx = (Math.random() - 0.5) * 2;
        this.vy = (Math.random() - 0.5) * 2;
        this.age = 0;
      }

      update() {
        this.age++;

        // Find nearest food
        let nearestFood = null;
        let nearestDist = this.senseRadius;

        for (const f of food) {
          const dist = Math.hypot(f.x - this.x, f.y - this.y);
          if (dist < nearestDist) {
            nearestDist = dist;
            nearestFood = f;
          }
        }

        // Move towards food or wander
        if (nearestFood) {
          const angle = Math.atan2(nearestFood.y - this.y, nearestFood.x - this.x);
          this.vx += Math.cos(angle) * 0.3;
          this.vy += Math.sin(angle) * 0.3;
        } else {
          // Random wander
          this.vx += (Math.random() - 0.5) * 0.2;
          this.vy += (Math.random() - 0.5) * 0.2;
        }

        // Limit speed
        const speed = Math.hypot(this.vx, this.vy);
        if (speed > this.maxSpeed) {
          this.vx = (this.vx / speed) * this.maxSpeed;
          this.vy = (this.vy / speed) * this.maxSpeed;
        }

        // Move
        this.x += this.vx;
        this.y += this.vy;

        // Wrap around edges
        if (this.x < 0) this.x = canvas.width;
        if (this.x > canvas.width) this.x = 0;
        if (this.y < 0) this.y = canvas.height;
        if (this.y > canvas.height) this.y = 0;

        // Energy cost (bigger + faster = more energy)
        const moveCost = speed * this.metabolismRate * (0.5 + this.dna.size * 0.5);
        this.energy -= moveCost;

        // Eat food
        for (let i = food.length - 1; i >= 0; i--) {
          const f = food[i];
          const dist = Math.hypot(f.x - this.x, f.y - this.y);
          if (dist < this.radius + f.radius) {
            this.energy = Math.min(this.maxEnergy, this.energy + f.energy);
            food.splice(i, 1);
          }
        }

        // Reproduce if enough energy
        if (this.energy > this.maxEnergy * 0.8 && creatures.length < 150) {
          this.reproduce();
        }
      }

      reproduce() {
        const childDNA = this.dna.mutate();
        const childGen = this.generation + 1;
        const offset = this.radius * 2;
        const angle = Math.random() * Math.PI * 2;

        const child = new Creature(
          this.x + Math.cos(angle) * offset,
          this.y + Math.sin(angle) * offset,
          childDNA,
          childGen
        );

        this.energy *= 0.5;
        child.energy = this.energy;

        creatures.push(child);
        totalBirths++;
        maxGeneration = Math.max(maxGeneration, childGen);
      }

      draw() {
        // Sense range (faint)
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.senseRadius, 0, Math.PI * 2);
        ctx.fillStyle = `hsla(${this.dna.hue}, 70%, 50%, 0.03)`;
        ctx.fill();

        // Body
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        const saturation = 60 + this.dna.efficiency * 30;
        const lightness = 40 + (this.energy / this.maxEnergy) * 30;
        ctx.fillStyle = `hsl(${this.dna.hue}, ${saturation}%, ${lightness}%)`;
        ctx.fill();

        // Direction indicator
        const angle = Math.atan2(this.vy, this.vx);
        ctx.beginPath();
        ctx.moveTo(
          this.x + Math.cos(angle) * this.radius,
          this.y + Math.sin(angle) * this.radius
        );
        ctx.lineTo(
          this.x + Math.cos(angle) * (this.radius + 4),
          this.y + Math.sin(angle) * (this.radius + 4)
        );
        ctx.strokeStyle = `hsl(${this.dna.hue}, 80%, 70%)`;
        ctx.lineWidth = 2;
        ctx.stroke();
      }

      isDead() {
        return this.energy <= 0;
      }
    }

    class Food {
      constructor(x, y) {
        this.x = x || Math.random() * canvas.width;
        this.y = y || Math.random() * canvas.height;
        this.radius = 3;
        this.energy = 20 + Math.random() * 15;
      }

      draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
        ctx.fillStyle = '#7ee787';
        ctx.shadowColor = '#7ee787';
        ctx.shadowBlur = 6;
        ctx.fill();
        ctx.shadowBlur = 0;
      }
    }

    function spawnFood(count = 1) {
      for (let i = 0; i < count; i++) {
        food.push(new Food());
      }
    }

    function init() {
      creatures = [];
      food = [];
      totalBirths = 0;
      totalDeaths = 0;
      maxGeneration = 1;

      // Spawn initial creatures
      for (let i = 0; i < 50; i++) {
        creatures.push(new Creature(
          Math.random() * canvas.width,
          Math.random() * canvas.height
        ));
      }

      // Initial food
      spawnFood(80);
    }

    function updateStats() {
      creatureCountEl.textContent = creatures.length;
      foodCountEl.textContent = food.length;
      generationEl.textContent = maxGeneration;
      birthsEl.textContent = totalBirths;
      deathsEl.textContent = totalDeaths;

      if (creatures.length > 0) {
        let avgSpeed = 0, avgSize = 0, avgSense = 0, avgEff = 0;
        creatures.forEach(c => {
          avgSpeed += c.dna.speed;
          avgSize += c.dna.size;
          avgSense += c.dna.senseRange;
          avgEff += c.dna.efficiency;
        });
        avgSpeed /= creatures.length;
        avgSize /= creatures.length;
        avgSense /= creatures.length;
        avgEff /= creatures.length;

        avgSpeedEl.style.width = `${avgSpeed * 100}%`;
        avgSizeEl.style.width = `${avgSize * 100}%`;
        avgSenseEl.style.width = `${avgSense * 100}%`;
        avgEfficiencyEl.style.width = `${avgEff * 100}%`;
      }
    }

    function gameLoop() {
      // Clear
      ctx.fillStyle = '#010409';
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Spawn food periodically
      if (Math.random() < 0.1) {
        spawnFood(1);
      }

      // Update and draw food
      food.forEach(f => f.draw());

      // Update creatures
      creatures.forEach(c => c.update());

      // Remove dead creatures
      for (let i = creatures.length - 1; i >= 0; i--) {
        if (creatures[i].isDead()) {
          creatures.splice(i, 1);
          totalDeaths++;
        }
      }

      // Prevent extinction
      if (creatures.length < 5) {
        for (let i = 0; i < 10; i++) {
          creatures.push(new Creature(
            Math.random() * canvas.width,
            Math.random() * canvas.height
          ));
        }
        spawnFood(30);
      }

      // Draw creatures
      creatures.forEach(c => c.draw());

      // Update stats every 30 frames
      if (Math.random() < 0.03) updateStats();

      requestAnimationFrame(gameLoop);
    }

    // Controls
    document.getElementById('resetBtn').addEventListener('click', init);
    document.getElementById('feedBtn').addEventListener('click', () => spawnFood(40));

    // Start
    init();
    gameLoop();
    updateStats();
  </script>
<script src="/sloppy-header/sloppy-bar.js"></script>
</body>
</html>
