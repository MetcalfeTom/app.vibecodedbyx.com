<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Who Is Gary?</title>
    <link rel="icon" href="https://emojicdn.elk.sh/üëÅÔ∏è">

    <meta property="og:title" content="Who Is Gary?">
    <meta property="og:description" content="Some questions are better left unanswered.">
    <meta property="og:url" content="https://app.vibecodedbyx.com/who-is-gary">
    <meta property="og:image" content="https://image.pollinations.ai/prompt/dark%20noir%20silhouette%20mysterious%20figure%20rain%20shadows%20paranoid%20thriller%20film%20grain?width=1200&height=630&nologo=true&referrer=vibecodedbyx.com">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Special+Elite&family=EB+Garamond:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --void: #0a0a0a;
            --smoke: #1a1a1a;
            --ash: #2a2a2a;
            --fog: #3a3a3a;
            --mist: #888;
            --bone: #c4c4b4;
            --blood: #6b0f1a;
            --amber: #d4a84b;
        }

        body {
            font-family: 'EB Garamond', serif;
            background: var(--void);
            min-height: 100vh;
            color: var(--bone);
            overflow-x: hidden;
            cursor: default;
        }

        .static-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: url('data:image/svg+xml,<svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="4" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23n)" opacity="0.03"/></svg>');
            pointer-events: none;
            z-index: 1000;
            animation: flicker 0.15s infinite;
        }

        @keyframes flicker {
            0%, 100% { opacity: 0.03; }
            50% { opacity: 0.05; }
        }

        .vignette {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(ellipse at center, transparent 0%, var(--void) 90%);
            pointer-events: none;
            z-index: 999;
        }

        .rain {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            pointer-events: none;
            z-index: 998;
            opacity: 0.1;
            background: repeating-linear-gradient(
                transparent 0px,
                transparent 3px,
                rgba(200,200,200,0.03) 3px,
                rgba(200,200,200,0.03) 4px
            );
            animation: rain 0.3s linear infinite;
        }

        @keyframes rain {
            to { background-position: 0 40px; }
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
            z-index: 1;
        }

        .header {
            text-align: center;
            margin-bottom: 60px;
            opacity: 0;
            animation: fadeIn 3s 0.5s forwards;
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }

        .title {
            font-family: 'Special Elite', monospace;
            font-size: clamp(2.5rem, 10vw, 5rem);
            letter-spacing: 8px;
            color: var(--bone);
            text-shadow: 0 0 60px rgba(107,15,26,0.5);
            margin-bottom: 20px;
        }

        .subtitle {
            font-style: italic;
            color: var(--mist);
            font-size: 1.1rem;
            letter-spacing: 3px;
        }

        .dossier {
            background: linear-gradient(180deg, var(--smoke) 0%, var(--void) 100%);
            border: 1px solid var(--fog);
            padding: 40px;
            margin-bottom: 40px;
            position: relative;
        }

        .dossier::before {
            content: '';
            position: absolute;
            top: 0; left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--blood), transparent);
        }

        .intro-text {
            font-size: 1.15rem;
            line-height: 2;
            color: var(--mist);
            max-width: 650px;
        }

        .intro-text em {
            color: var(--amber);
            font-style: normal;
        }

        .redacted {
            background: var(--bone);
            color: var(--bone);
            cursor: pointer;
            transition: all 0.3s;
            padding: 0 4px;
        }

        .redacted:hover, .redacted.revealed {
            background: transparent;
            color: var(--blood);
        }

        .evidence-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 2px;
            background: var(--fog);
            margin: 40px 0;
        }

        .evidence-cell {
            aspect-ratio: 1;
            background: var(--smoke);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            transition: all 0.3s;
        }

        .evidence-cell::before {
            content: '';
            position: absolute;
            inset: 0;
            background: radial-gradient(circle at center, transparent 30%, var(--void) 100%);
            opacity: 0.7;
        }

        .evidence-cell:hover {
            background: var(--ash);
        }

        .evidence-cell.unlocked {
            background: var(--ash);
        }

        .evidence-cell.unlocked::after {
            content: '';
            position: absolute;
            bottom: 5px;
            right: 5px;
            width: 8px;
            height: 8px;
            background: var(--amber);
            border-radius: 50%;
        }

        .cell-icon {
            font-size: 2rem;
            position: relative;
            z-index: 1;
            filter: grayscale(80%);
            transition: all 0.3s;
        }

        .evidence-cell:hover .cell-icon,
        .evidence-cell.unlocked .cell-icon {
            filter: grayscale(0%);
        }

        .evidence-cell.locked .cell-icon {
            opacity: 0.2;
        }

        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.95);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.open {
            display: flex;
        }

        .modal-content {
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            background: var(--smoke);
            border: 1px solid var(--fog);
            padding: 40px;
            position: relative;
            animation: modalIn 0.3s ease;
        }

        @keyframes modalIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--mist);
            transition: color 0.2s;
        }

        .modal-close:hover {
            color: var(--blood);
        }

        .modal-title {
            font-family: 'Special Elite', monospace;
            font-size: 1.4rem;
            color: var(--amber);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--fog);
        }

        .modal-text {
            line-height: 1.9;
            color: var(--mist);
        }

        .modal-text .secret-word {
            color: var(--bone);
            cursor: help;
            border-bottom: 1px dotted var(--fog);
        }

        .modal-hint {
            margin-top: 20px;
            padding: 15px;
            background: var(--void);
            font-style: italic;
            font-size: 0.9rem;
            color: var(--fog);
            border-left: 2px solid var(--blood);
        }

        .secret-input {
            margin-top: 30px;
            display: flex;
            gap: 10px;
        }

        .secret-input input {
            flex: 1;
            background: var(--void);
            border: 1px solid var(--fog);
            padding: 12px 15px;
            color: var(--bone);
            font-family: 'Special Elite', monospace;
            font-size: 0.9rem;
        }

        .secret-input input::placeholder {
            color: var(--fog);
        }

        .secret-input button {
            background: var(--blood);
            border: none;
            padding: 12px 20px;
            color: var(--bone);
            cursor: pointer;
            font-family: 'Special Elite', monospace;
            transition: background 0.2s;
        }

        .secret-input button:hover {
            background: #8b1a27;
        }

        .timeline {
            position: relative;
            margin: 60px 0;
            padding-left: 40px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 1px;
            background: linear-gradient(to bottom, transparent, var(--fog), transparent);
        }

        .timeline-entry {
            position: relative;
            margin-bottom: 30px;
            opacity: 0;
            transform: translateX(-20px);
            transition: all 0.5s;
        }

        .timeline-entry.visible {
            opacity: 1;
            transform: translateX(0);
        }

        .timeline-entry::before {
            content: '';
            position: absolute;
            left: -29px;
            top: 8px;
            width: 8px;
            height: 8px;
            background: var(--blood);
            border-radius: 50%;
        }

        .timeline-date {
            font-family: 'Special Elite', monospace;
            font-size: 0.85rem;
            color: var(--fog);
            margin-bottom: 5px;
        }

        .timeline-text {
            color: var(--mist);
            line-height: 1.7;
        }

        .hidden-section {
            display: none;
            margin-top: 40px;
            padding: 30px;
            background: linear-gradient(135deg, var(--blood) 0%, var(--void) 100%);
            border: 1px solid var(--blood);
            animation: pulseGlow 3s infinite;
        }

        .hidden-section.revealed {
            display: block;
        }

        @keyframes pulseGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(107,15,26,0.3); }
            50% { box-shadow: 0 0 40px rgba(107,15,26,0.5); }
        }

        .hidden-section h3 {
            font-family: 'Special Elite', monospace;
            color: var(--amber);
            margin-bottom: 20px;
        }

        .cipher {
            font-family: 'Special Elite', monospace;
            letter-spacing: 4px;
            color: var(--fog);
            word-break: break-all;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            padding: 20px 0;
            border-top: 1px solid var(--fog);
            border-bottom: 1px solid var(--fog);
            margin: 40px 0;
            font-family: 'Special Elite', monospace;
            font-size: 0.85rem;
            color: var(--mist);
        }

        .stat-value {
            color: var(--amber);
        }

        .whisper {
            position: fixed;
            bottom: 30px;
            left: 30px;
            font-style: italic;
            color: var(--fog);
            font-size: 0.9rem;
            opacity: 0;
            animation: whisperIn 10s 5s forwards;
            cursor: pointer;
        }

        @keyframes whisperIn {
            0% { opacity: 0; }
            10% { opacity: 0.5; }
            90% { opacity: 0.5; }
            100% { opacity: 0; }
        }

        .backlink {
            position: fixed;
            bottom: 20px;
            right: 20px;
            font-family: 'Special Elite', monospace;
            font-size: 11px;
            color: var(--fog);
            text-decoration: none;
            opacity: 0.5;
        }

        .ending {
            display: none;
            text-align: center;
            padding: 60px 20px;
        }

        .ending.show {
            display: block;
            animation: fadeIn 2s forwards;
        }

        .ending h2 {
            font-family: 'Special Elite', monospace;
            font-size: 2rem;
            color: var(--blood);
            margin-bottom: 30px;
        }

        .ending p {
            max-width: 500px;
            margin: 0 auto 20px;
            line-height: 1.9;
            color: var(--mist);
        }

        .ending.dark h2 { color: var(--blood); }
        .ending.truth h2 { color: var(--amber); }
        .ending.void h2 { color: var(--fog); }

        .photo-wall {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 40px 0;
            opacity: 0.7;
        }

        .photo-wall img {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
            filter: grayscale(100%) contrast(1.2);
            transition: all 0.3s;
        }

        .photo-wall img:hover {
            filter: grayscale(50%) contrast(1.1);
            transform: scale(1.05);
            z-index: 10;
            position: relative;
        }

        @media (max-width: 600px) {
            .evidence-grid { grid-template-columns: repeat(3, 1fr); }
            .photo-wall { grid-template-columns: repeat(2, 1fr); }
            .modal-content { padding: 25px; }
        }
    </style>
</head>
<body>
    <div class="static-overlay"></div>
    <div class="vignette"></div>
    <div class="rain"></div>

    <div class="container">
        <header class="header">
            <h1 class="title">WHO IS GARY?</h1>
            <p class="subtitle">Case File #G-4827 ‚Ä¢ Status: UNSOLVED</p>
        </header>

        <div class="dossier">
            <p class="intro-text">
                Subject identified only as <em>"Gary"</em> first appeared in municipal records
                on <span class="redacted" data-reveal="March 17, 1987">‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà</span>.
                Multiple witnesses report sightings across <span class="redacted" data-reveal="12 states">‚ñà‚ñà ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà</span>
                during the same timeframe. Fingerprints on file match
                <span class="redacted" data-reveal="no known individual">‚ñà‚ñà ‚ñà‚ñà‚ñà‚ñà‚ñà ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà</span>.
                <br><br>
                This dossier contains recovered fragments. Some pieces are missing.
                Some were never meant to be found.
            </p>
        </div>

        <div class="evidence-grid" id="evidenceGrid">
            <!-- Generated by JS -->
        </div>

        <div class="stats">
            <span>Evidence Collected: <span class="stat-value" id="evidenceCount">0</span>/9</span>
            <span>Secrets Found: <span class="stat-value" id="secretCount">0</span>/3</span>
            <span>Truth Level: <span class="stat-value" id="truthLevel">0%</span></span>
        </div>

        <div class="timeline" id="timeline">
            <!-- Generated by JS -->
        </div>

        <div class="photo-wall" id="photoWall">
            <!-- Generated by JS -->
        </div>

        <div class="hidden-section" id="secretSection">
            <h3>[ RECOVERED TRANSMISSION ]</h3>
            <p class="cipher" id="cipherText"></p>
            <div class="secret-input">
                <input type="text" id="codeInput" placeholder="Enter decryption key...">
                <button onclick="attemptDecode()">DECODE</button>
            </div>
        </div>

        <div class="ending" id="ending">
            <h2 id="endingTitle"></h2>
            <p id="endingText"></p>
            <p style="margin-top: 40px; color: var(--fog); font-size: 0.9rem;">
                <span style="cursor: pointer;" onclick="resetAll()">[ Begin new investigation ]</span>
            </p>
        </div>
    </div>

    <div class="whisper" id="whisper" onclick="findWhisper()">
        "Gary knows you're looking..."
    </div>

    <a href="https://www.vibecodedbyx.com" class="backlink" target="_blank">üì∫ VCBX</a>

    <div class="modal" id="modal">
        <div class="modal-content">
            <span class="modal-close" onclick="closeModal()">√ó</span>
            <h3 class="modal-title" id="modalTitle"></h3>
            <div class="modal-text" id="modalText"></div>
            <div class="modal-hint" id="modalHint"></div>
        </div>
    </div>

    <script>
        const state = {
            evidence: new Set(),
            secrets: new Set(),
            whisperFound: false,
            codeAttempts: 0,
            truthPath: null
        };

        const evidence = [
            {
                id: 'cassette',
                icon: 'üìº',
                title: 'Audio Recording #7',
                text: `A distorted voice, barely audible over static: "...Gary isn't his real name. None of the names are real. He changes them like <span class="secret-word" data-secret="skins">seasons</span>. I've been tracking him since Cincinnati, or maybe it was Portland. The cities blur together when you're chasing a ghost..."<br><br>The tape ends abruptly. The label reads "DO NOT COPY."`,
                hint: 'The word that stands out... it means something.',
                locked: false
            },
            {
                id: 'photo',
                icon: 'üì∑',
                title: 'Photograph (Damaged)',
                text: `A polaroid, water-stained and faded. A man stands in front of a diner, but his face is obscured by light damage. On the back, handwritten: "G. ‚Äî Last confirmed sighting. <span class="secret-word" data-secret="1994">He smiled at the camera like he knew.</span>"<br><br>The diner was demolished in 1996. No one remembers who took the photo.`,
                hint: 'The year matters. Look closer at patterns.',
                locked: false
            },
            {
                id: 'letter',
                icon: '‚úâÔ∏è',
                title: 'Unsent Letter',
                text: `"Dear Gary,<br><br>I know what you did at the lake house. I know why you had to leave. What I don't understand is why you came back‚Äîwhy you're <em>always</em> coming back, wearing different faces but the same <span class="secret-word" data-secret="eyes">tired expression</span>.<br><br>Stop looking for absolution. There is none for men like us."<br><br>‚Äî Unsigned. Found in a library book returned 23 years late.`,
                hint: 'What feature remains constant across identities?',
                locked: false
            },
            {
                id: 'map',
                icon: 'üó∫Ô∏è',
                title: 'Annotated Map',
                text: `A road map from 1989, covered in red circles and connecting lines. The pattern forms what appears to be a constellation‚Äîor a message.<br><br>Cities marked: <em>Gary, Indiana. Port Gary, AK. Garyville, LA. Mount Gary, CO.</em><br><br>A note in the margin: "He's not running <em>from</em> something. He's running <em>toward</em> it."`,
                hint: 'The name appears in the places themselves.',
                locked: false
            },
            {
                id: 'badge',
                icon: 'ü™™',
                title: 'Employee Badge',
                text: `A laminated ID card, name partially scratched off: "G‚ñà‚ñà‚ñà ‚ñà‚ñà‚ñà‚ñàner"<br>Position: Night Security<br>Facility: [REDACTED] Research Institute<br>Access Level: 7<br><br>The photo shows a middle-aged man, unremarkable in every way. The kind of face you'd forget immediately. Perhaps that was the point.`,
                hint: 'Access Level 7 requires special clearance. What clears?',
                locked: false
            },
            {
                id: 'diary',
                icon: 'üìì',
                title: 'Journal Fragment',
                text: `"...they keep asking who Gary is. The wrong question. Gary isn't a who‚ÄîGary is a <em>what</em>. A role. A position that must be filled. When one Gary ends, another begins. I've been Gary for eleven years now. Soon it will be someone else's turn.<br><br>I wonder if they'll find this. I wonder if it matters."`,
                hint: 'Gary is a role... who fills it next?',
                locked: true,
                requires: ['cassette', 'photo']
            },
            {
                id: 'key',
                icon: 'üîë',
                title: 'Safe Deposit Key',
                text: `A brass key, heavily worn. The attached tag reads: "First National Bank, Box 1947."<br><br>The bank burned down in 1952. No records survived. But three witnesses claim to have seen a man matching Gary's description leaving the building moments before the fire started.<br><br>He was carrying a manila envelope. He was smiling.`,
                hint: '1947... 1952... the numbers form a sequence.',
                locked: true,
                requires: ['map', 'badge']
            },
            {
                id: 'mirror',
                icon: 'ü™û',
                title: 'Shattered Mirror',
                text: `Seven fragments of a mirror, arranged in an evidence bag. Lab notes indicate the glass is over 200 years old.<br><br>One fragment still holds a reflection‚Äîbut not of the viewer. An indistinct figure, always glimpsed in peripheral vision, never directly.<br><br>Researchers who studied the mirror too long reported hearing whispers. Three resigned. One disappeared.`,
                hint: 'The reflection shows what we refuse to see.',
                locked: true,
                requires: ['letter', 'diary']
            },
            {
                id: 'final',
                icon: 'üëÅÔ∏è',
                title: '[ CLASSIFIED ]',
                text: `<em>This file requires maximum clearance.</em><br><br>You've gathered enough. The truth awaits‚Äîbut truth has many faces.<br><br>Enter what you've learned. The password is not a word. It's a understanding.`,
                hint: 'Combine the secrets. Gary is...',
                locked: true,
                requires: ['key', 'mirror']
            }
        ];

        const timeline = [
            { date: '1947', text: 'First known reference to "Gary" in federal documents.' },
            { date: '1963', text: 'Subject photographed in Dallas. Investigation inconclusive.' },
            { date: '1971', text: 'Multiple Garys reported simultaneously across seven states.' },
            { date: '1987', text: 'Gary enters municipal employment. Unremarkable tenure.' },
            { date: '1994', text: 'Last confirmed sighting. Trail goes cold.' },
            { date: '2003', text: 'Case reopened. New evidence suggests Gary never left.' },
            { date: 'NOW', text: 'You are reading this. Gary knows.' }
        ];

        const endings = {
            dark: {
                title: 'THE DARK ENDING',
                text: 'Gary was never a person. Gary was a pattern‚Äîa recurring glitch in reality, a name that surfaces whenever something needs to be forgotten. You\'ve seen too much now. Welcome to the pattern. Welcome to becoming Gary.'
            },
            truth: {
                title: 'THE TRUTH',
                text: 'Gary was everyone and no one. Every unremarkable person you\'ve ever forgotten. Every face that blurred in your memory. Gary is the sum of all the people we fail to notice. And now that you\'ve noticed... Gary has noticed you.'
            },
            void: {
                title: 'THE VOID',
                text: 'There is no Gary. There never was. The files are fake. The evidence is planted. This was a test‚Äîand you failed. Or succeeded. The distinction no longer matters. Close the tab. Forget you were here. Forget Gary. Forget. Forget. Forget.'
            }
        };

        const secretCodes = {
            'skins': 'First fragment recovered.',
            '1994': 'Timeline marker identified.',
            'eyes': 'Constant feature catalogued.',
            'gary': 'Identity loop detected.',
            'pattern': 'Deep truth accessed.',
            'forget': 'Void path opened.'
        };

        function init() {
            renderEvidence();
            renderTimeline();
            renderPhotos();
            generateCipher();
            loadState();
        }

        function renderEvidence() {
            const grid = document.getElementById('evidenceGrid');
            grid.innerHTML = evidence.map(e => {
                const isLocked = e.locked && (!e.requires || !e.requires.every(r => state.evidence.has(r)));
                const isUnlocked = state.evidence.has(e.id);
                return `
                    <div class="evidence-cell ${isLocked ? 'locked' : ''} ${isUnlocked ? 'unlocked' : ''}"
                         onclick="openEvidence('${e.id}')"
                         title="${isLocked ? 'Requires more evidence' : e.title}">
                        <span class="cell-icon">${e.icon}</span>
                    </div>
                `;
            }).join('');
        }

        function renderTimeline() {
            const el = document.getElementById('timeline');
            el.innerHTML = timeline.map((t, i) => `
                <div class="timeline-entry" style="animation-delay: ${i * 0.2}s">
                    <div class="timeline-date">${t.date}</div>
                    <div class="timeline-text">${t.text}</div>
                </div>
            `).join('');

            setTimeout(() => {
                document.querySelectorAll('.timeline-entry').forEach((el, i) => {
                    setTimeout(() => el.classList.add('visible'), i * 200);
                });
            }, 1000);
        }

        function renderPhotos() {
            const wall = document.getElementById('photoWall');
            const prompts = [
                'blurry figure in fog noir',
                'empty chair dark room mystery',
                'old photograph burned edges',
                'shadowy hallway noir film',
                'rain on window night city',
                'abandoned building dark',
                'mysterious silhouette doorway',
                'old typewriter noir detective'
            ];
            wall.innerHTML = prompts.map(p =>
                `<img src="https://image.pollinations.ai/prompt/${encodeURIComponent(p)}?width=200&height=200&nologo=true&seed=${Math.random()}&referrer=vibecodedbyx.com" alt="Evidence photo">`
            ).join('');
        }

        function generateCipher() {
            const message = "GARY IS WATCHING GARY IS WAITING GARY IS YOU";
            const cipher = message.split('').map(c =>
                c === ' ' ? ' ' : String.fromCharCode(c.charCodeAt(0) + 3)
            ).join('');
            document.getElementById('cipherText').textContent = cipher;
        }

        function openEvidence(id) {
            const e = evidence.find(x => x.id === id);
            if (!e) return;

            const isLocked = e.locked && (!e.requires || !e.requires.every(r => state.evidence.has(r)));
            if (isLocked) {
                showModal('üîí LOCKED', 'This evidence requires additional materials to access. Continue your investigation.', 'Gather more evidence to unlock.');
                return;
            }

            state.evidence.add(id);
            showModal(e.title, e.text, e.hint);
            updateStats();
            renderEvidence();
            saveState();
            checkEnding();
        }

        function showModal(title, text, hint) {
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalText').innerHTML = text;
            document.getElementById('modalHint').textContent = hint;
            document.getElementById('modal').classList.add('open');

            // Add secret word listeners
            setTimeout(() => {
                document.querySelectorAll('.secret-word').forEach(el => {
                    el.onclick = () => discoverSecret(el.dataset.secret);
                });
            }, 100);
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('open');
        }

        function discoverSecret(secret) {
            if (secretCodes[secret] && !state.secrets.has(secret)) {
                state.secrets.add(secret);
                updateStats();
                saveState();

                if (state.secrets.size >= 2) {
                    document.getElementById('secretSection').classList.add('revealed');
                }
            }
        }

        function attemptDecode() {
            const input = document.getElementById('codeInput').value.toLowerCase().trim();
            state.codeAttempts++;

            if (input === 'gary' || input === 'pattern' || input === 'watching') {
                state.truthPath = 'truth';
                triggerEnding('truth');
            } else if (input === 'forget' || input === 'nothing' || input === 'void') {
                state.truthPath = 'void';
                triggerEnding('void');
            } else if (state.codeAttempts >= 3) {
                state.truthPath = 'dark';
                triggerEnding('dark');
            } else {
                document.getElementById('codeInput').value = '';
                document.getElementById('codeInput').placeholder = `Incorrect. ${3 - state.codeAttempts} attempts remain...`;
            }
        }

        function findWhisper() {
            state.whisperFound = true;
            state.secrets.add('whisper');
            updateStats();
            document.getElementById('whisper').style.display = 'none';
            document.getElementById('secretSection').classList.add('revealed');
        }

        function updateStats() {
            document.getElementById('evidenceCount').textContent = state.evidence.size;
            document.getElementById('secretCount').textContent = state.secrets.size;
            const truth = Math.round((state.evidence.size / 9) * 50 + (state.secrets.size / 3) * 50);
            document.getElementById('truthLevel').textContent = truth + '%';
        }

        function checkEnding() {
            if (state.evidence.size === 9) {
                setTimeout(() => triggerEnding('dark'), 2000);
            }
        }

        function triggerEnding(type) {
            const ending = endings[type];
            const el = document.getElementById('ending');
            el.className = 'ending show ' + type;
            document.getElementById('endingTitle').textContent = ending.title;
            document.getElementById('endingText').textContent = ending.text;
            el.scrollIntoView({ behavior: 'smooth' });
        }

        function resetAll() {
            state.evidence.clear();
            state.secrets.clear();
            state.whisperFound = false;
            state.codeAttempts = 0;
            state.truthPath = null;
            localStorage.removeItem('gary-state');
            document.getElementById('ending').className = 'ending';
            document.getElementById('secretSection').classList.remove('revealed');
            updateStats();
            renderEvidence();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function saveState() {
            localStorage.setItem('gary-state', JSON.stringify({
                evidence: [...state.evidence],
                secrets: [...state.secrets],
                whisperFound: state.whisperFound
            }));
        }

        function loadState() {
            const saved = localStorage.getItem('gary-state');
            if (saved) {
                const data = JSON.parse(saved);
                data.evidence.forEach(e => state.evidence.add(e));
                data.secrets.forEach(s => state.secrets.add(s));
                state.whisperFound = data.whisperFound;
                updateStats();
                renderEvidence();
                if (state.secrets.size >= 2) {
                    document.getElementById('secretSection').classList.add('revealed');
                }
            }
        }

        // Redacted text reveal
        document.querySelectorAll('.redacted').forEach(el => {
            el.onclick = () => {
                el.classList.add('revealed');
                el.textContent = el.dataset.reveal;
            };
        });

        // Close modal on background click
        document.getElementById('modal').onclick = (e) => {
            if (e.target.id === 'modal') closeModal();
        };

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
            if (e.key === 'g' && e.ctrlKey) {
                e.preventDefault();
                discoverSecret('gary');
            }
        });

        init();
    </script>
</body>
</html>
