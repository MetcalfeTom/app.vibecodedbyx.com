<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sakura Hearts ¬∑ Anime Dating Simulator</title>
  <meta name="description" content="Choose your path through Sakura Hearts, a cozy anime dating simulator where every choice sparks a different connection." />
  <meta property="og:title" content="Sakura Hearts ¬∑ Anime Dating Simulator" />
  <meta property="og:description" content="Choose your path through Sakura Hearts, a cozy anime dating simulator where every choice sparks a different connection." />
  <meta property="og:url" content="https://app.vibecodedbyx.com/anime-dating-sim/" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAxMjAwIDYzMCc+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9J2cnIHgxPScwJyB5MT0nMCcgeDI9JzEnIHkyPScxJz4KICAgICAgPHN0b3Agb2Zmc2V0PScwJScgc3RvcC1jb2xvcj0nI2ZmOWFlNicvPgogICAgICA8c3RvcCBvZmZzZXQ9JzEwMCUnIHN0b3AtY29sb3I9JyM4YTVjZmYnLz4KICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgPC9kZWZzPgogIDxyZWN0IHdpZHRoPScxMjAwJyBoZWlnaHQ9JzYzMCcgZmlsbD0ndXJsKCNnKScvPgogIDx0ZXh0IHg9JzUwJScgeT0nNDAlJyB0ZXh0LWFuY2hvcj0nbWlkZGxlJyBmb250LXNpemU9Jzk2JyBmaWxsPScjZmZmZmZmJz7wn4y4IFNha3VyYSBIZWFydHM8L3RleHQ+CiAgPHRleHQgeD0nNTAlJyB5PSc2MCUnIHRleHQtYW5jaG9yPSdtaWRkbGUnIGZvbnQtc2l6ZT0nNDgnIGZpbGw9JyNmZmZmZmYnPkFuaW1lIERhdGluZyBTaW11bGF0b3I8L3RleHQ+Cjwvc3ZnPg==" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Sakura Hearts ¬∑ Anime Dating Simulator" />
  <meta name="twitter:description" content="Choose your path through Sakura Hearts, a cozy anime dating simulator where every choice sparks a different connection." />
  <meta name="twitter:image" content="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAxMjAwIDYzMCc+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9J2cnIHgxPScwJyB5MT0nMCcgeDI9JzEnIHkyPScxJz4KICAgICAgPHN0b3Agb2Zmc2V0PScwJScgc3RvcC1jb2xvcj0nI2ZmOWFlNicvPgogICAgICA8c3RvcCBvZmZzZXQ9JzEwMCUnIHN0b3AtY29sb3I9JyM4YTVjZmYnLz4KICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgPC9kZWZzPgogIDxyZWN0IHdpZHRoPScxMjAwJyBoZWlnaHQ9JzYzMCcgZmlsbD0ndXJsKCNnKScvPgogIDx0ZXh0IHg9JzUwJScgeT0nNDAlJyB0ZXh0LWFuY2hvcj0nbWlkZGxlJyBmb250LXNpemU9Jzk2JyBmaWxsPScjZmZmZmZmJz7wn4y4IFNha3VyYSBIZWFydHM8L3RleHQ+CiAgPHRleHQgeD0nNTAlJyB5PSc2MCUnIHRleHQtYW5jaG9yPSdtaWRkbGUnIGZvbnQtc2l6ZT0nNDgnIGZpbGw9JyNmZmZmZmYnPkFuaW1lIERhdGluZyBTaW11bGF0b3I8L3RleHQ+Cjwvc3ZnPg==" />
  <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0naHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmcnIHZpZXdCb3g9JzAgMCAxMDAgMTAwJz4KICA8dGV4dCB4PSc1MCUnIHk9JzYwJScgZm9udC1zaXplPSc2MCcgdGV4dC1hbmNob3I9J21pZGRsZSc+8J+MuDwvdGV4dD4KPC9zdmc+" />
  <style>
    :root {
      color-scheme: light dark;
      font-family: "Inter", "Segoe UI", system-ui, sans-serif;
      --bg: #15061d;
      --card: rgba(255, 255, 255, 0.12);
      --card-strong: rgba(255, 255, 255, 0.18);
      --text: #ffffff;
      --accent: #ff8ed6;
      --accent-strong: #ffd166;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      height: 100vh;
      padding: 18px 14px 32px;
      background: radial-gradient(circle at top, #35134c, #15061d 45%);
      color: var(--text);
      display: flex;
      flex-direction: column;
      align-items: center;
      overflow: hidden;
      gap: 12px;
    }

    header {
      text-align: center;
      max-width: 780px;
      padding: 0 12px;
    }

    header h1 {
      font-size: clamp(2.25rem, 6vw, 3.35rem);
      margin: 0 0 0.25em;
    }

    header p {
      margin: 0.35em 0;
      font-size: clamp(1rem, 2.4vw, 1.2rem);
      color: rgba(255, 255, 255, 0.85);
    }

    header a {
      color: var(--accent-strong);
      font-weight: 600;
      text-decoration: none;
    }

    main {
      width: min(980px, 100%);
      flex: 1;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      grid-auto-rows: minmax(0, 1fr);
      gap: 16px;
      overflow-y: auto;
      padding-right: 6px;
    }

    main::-webkit-scrollbar {
      width: 10px;
    }

    main::-webkit-scrollbar-thumb {
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.2);
    }

    .panel {
      background: var(--card);
      backdrop-filter: blur(18px);
      border: 1px solid rgba(255, 255, 255, 0.14);
      border-radius: 20px;
      padding: 20px;
      box-shadow: 0 18px 40px rgba(15, 5, 24, 0.35);
      display: flex;
      flex-direction: column;
      gap: 14px;
      transition: transform 0.2s ease, border-color 0.2s ease;
      min-height: 0;
    }

    .panel:hover {
      transform: translateY(-3px);
      border-color: rgba(255, 255, 255, 0.28);
    }

    .characters {
      display: grid;
      gap: 12px;
    }

    .character-card {
      display: grid;
      grid-template-columns: 56px 1fr;
      gap: 12px;
      align-items: center;
      padding: 12px;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.08);
    }

    .character-card strong {
      font-size: 1.08rem;
      display: block;
    }

    .character-card span {
      font-size: 2.2rem;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .story {
      grid-column: 1 / -1;
      display: grid;
      grid-template-rows: auto auto 1fr auto auto;
      gap: 16px;
    }

    .story h2 {
      margin: 0;
      font-size: clamp(1.45rem, 4.2vw, 2rem);
    }

    .story p {
      margin: 0;
      line-height: 1.52;
      color: rgba(255, 255, 255, 0.92);
    }

    .choices {
      display: grid;
      gap: 10px;
    }

    .choices button {
      all: unset;
      padding: 15px 16px;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.13);
      border: 1px solid transparent;
      cursor: pointer;
      font-weight: 600;
      line-height: 1.3;
      transition: transform 0.15s ease, border-color 0.2s ease, background 0.2s ease;
    }

    .choices button:hover,
    .choices button:focus-visible {
      border-color: rgba(255, 255, 255, 0.4);
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    .choices button:active {
      transform: translateY(1px);
    }

    .status {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      font-size: 0.95rem;
      color: rgba(255, 255, 255, 0.75);
    }

    .status span {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.09);
    }

    .controls {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .controls button {
      all: unset;
      padding: 10px 16px;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.28);
      cursor: pointer;
      font-weight: 600;
      transition: transform 0.15s ease, background 0.2s ease;
    }

    .controls button:hover,
    .controls button:focus-visible {
      background: var(--card-strong);
    }

    .controls button:active {
      transform: translateY(1px);
    }

    .mystery {
      position: relative;
    }

    .mystery h2 {
      margin: 0;
      font-size: 1.35rem;
    }

    .mystery p {
      margin: 0;
      line-height: 1.5;
      color: rgba(255, 255, 255, 0.88);
    }

    .claims,
    .clues {
      margin: 0;
      padding-left: 18px;
      display: grid;
      gap: 6px;
    }

    .claims li,
    .clues li {
      line-height: 1.4;
    }

    .clues li {
      background: rgba(255, 255, 255, 0.08);
      border-radius: 12px;
      padding: 8px 10px;
    }

    .guess-buttons {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }

    .guess-buttons button {
      all: unset;
      padding: 10px 18px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.12);
      border: 1px solid rgba(255, 255, 255, 0.35);
      cursor: pointer;
      font-weight: 600;
      transition: transform 0.15s ease, background 0.2s ease;
    }

    .guess-buttons button:hover,
    .guess-buttons button:focus-visible {
      background: rgba(255, 255, 255, 0.2);
    }

    .guess-buttons button:disabled {
      cursor: not-allowed;
      opacity: 0.6;
    }

    .peanut-status {
      margin: 0;
      font-size: 0.95rem;
      color: rgba(255, 255, 255, 0.78);
    }

    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }

    .log {
      max-height: none;
      overflow-y: auto;
      gap: 10px;
    }

    .log-entry {
      padding: 12px;
      border-radius: 14px;
      background: rgba(255, 255, 255, 0.09);
      font-size: 0.95rem;
      line-height: 1.38;
    }

    @media (max-width: 720px) {
      body {
        padding: 14px 10px 26px;
        gap: 8px;
      }

      main {
        padding-right: 0;
      }

      .panel {
        padding: 18px;
      }

      .guess-buttons {
        justify-content: center;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>üå∏ Sakura Hearts</h1>
    <p>Welcome to the most chaotic (but kinda wholesome) anime dating sim built live for chat. Your choices change the vibe‚Äîand could expose a peanut allergy imposter.</p>
    <p><a href="https://www.vibecodedbyx.com" target="_blank" rel="noopener">Watch the livestream</a></p>
  </header>

  <main>
    <section class="panel characters" aria-label="Character roster">
      <div class="character-card" data-character="yumi">
        <span>üéÄ</span>
        <div>
          <strong>Yumi Tanaka</strong>
          <p>Student council prodigy with a color-coded planner and certified peanut-free snack stash.</p>
          <small class="affection" data-meter="yumi">Affection: 0</small>
        </div>
      </div>
      <div class="character-card" data-character="kai">
        <span>üéß</span>
        <div>
          <strong>Kai Ishikawa</strong>
          <p>Lo-fi DJ who claims peanuts ruin his mixes‚Äîbut chat spotted him near the festival mochi cart.</p>
          <small class="affection" data-meter="kai">Affection: 0</small>
        </div>
      </div>
      <div class="character-card" data-character="mei">
        <span>üñåÔ∏è</span>
        <div>
          <strong>Mei Aoyama</strong>
          <p>Art club visionary designing cute warning posters for every allergen under the sun.</p>
          <small class="affection" data-meter="mei">Affection: 0</small>
        </div>
      </div>
    </section>

    <section class="panel story" aria-live="polite">
      <div>
        <h2 id="scene-title">Day 1 ¬∑ Transfer Vibes</h2>
        <p id="scene-text">Your first morning at Sakura Academy smells like cherry blossoms and anticipation. Chat is screaming. Who do you notice first?</p>
      </div>
      <div class="choices" id="choice-list" role="group" aria-labelledby="scene-title"></div>
      <div class="status" id="status-bar">
        <span id="day-status">Day: 1</span>
        <span id="mood-status">Chat mood: chaotic but hyped</span>
      </div>
      <div class="controls">
        <button type="button" id="share-button">Share story</button>
        <button type="button" id="reset-button">Start over</button>
      </div>
    </section>

    <section class="panel mystery" id="mystery-panel" aria-live="polite">
      <h2>Peanut Allergy Mystery</h2>
      <p>All three swear peanuts are their nemesis. Only one was bluffing. Collect clues from your choices and call out the faker before festival snacks drop.</p>
      <ul class="claims">
        <li><strong>Yumi:</strong> "I only eat snacks with triple-checked labels."</li>
        <li><strong>Kai:</strong> "One peanut crumb and my beats go silent, fr."</li>
        <li><strong>Mei:</strong> "I bring EpiPens like they're sketching pencils."</li>
      </ul>
      <h3 class="visually-hidden">Clues discovered</h3>
      <ul class="clues" id="clue-list"></ul>
      <div class="guess-buttons" role="group" aria-label="Guess the liar">
        <button type="button" data-guess="yumi">Accuse Yumi</button>
        <button type="button" data-guess="kai">Accuse Kai</button>
        <button type="button" data-guess="mei">Accuse Mei</button>
      </div>
      <p id="peanut-status" class="peanut-status">Status: unresolved</p>
    </section>

    <section class="panel log" aria-live="polite" aria-label="Choice log" id="log"></section>
  </main>

  <template id="choice-template">
    <button type="button"></button>
  </template>

  <template id="log-template">
    <div class="log-entry"></div>
  </template>

  <script>
    const liarKey = "kai";
    const peanutTruth = {
      yumi: true,
      kai: false,
      mei: true,
    };

    const state = {
      day: 1,
      sceneIndex: 0,
      affection: {
        yumi: 0,
        kai: 0,
        mei: 0,
      },
      log: [],
      clues: [],
      peanutSolved: false,
      peanutGuess: null,
    };

    const scenes = [
      {
        title: "Day 1 ¬∑ Transfer Vibes",
        text: "Your first morning at Sakura Academy smells like cherry blossoms and anticipation. Chat is screaming. Who do you notice first?",
        mood: "chaotic but hyped",
        choices: [
          {
            text: "Slide into the student council room with Yumi.",
            affection: { yumi: 2 },
            log: "You compliment Yumi's perfectly curated planner. She blushes‚Äîjust a little.",
            clue: "Yumi refuses cookies unless the label screams 'nut-free'.",
          },
          {
            text: "Follow the bassline to Kai's rooftop set.",
            affection: { kai: 2 },
            log: "Kai nods as you catch the beat. Chat instantly ships it.",
            clue: "Kai samples festival mochi and claims it's peanut-free... but was it?",
          },
          {
            text: "Wander into the art studio where Mei crafts cosmic murals.",
            affection: { mei: 2 },
            log: "Mei hands you a spare brush. Paint splatters; chemistry happens.",
            clue: "Mei keeps a personalized EpiPen sketched with sakura petals.",
          },
        ],
      },
      {
        title: "Day 2 ¬∑ Festival Planning Arc",
        text: "The Spring Festival needs a headliner. Whoever you back will shine‚Äîand remember your support.",
        mood: "bubbly with a side of stress",
        choices: [
          {
            text: "Help Yumi choreograph a surprise performance.",
            affection: { yumi: 3 },
            log: "You rehearse until sunset. Yumi's thank-you bow lingers a beat longer than normal.",
            clue: "Yumi brings colour-coded allergen charts for every booth.",
          },
          {
            text: "Drop a collab beat with Kai and remix the school anthem.",
            affection: { kai: 3 },
            log: "Kai lets you choose the final drop. It's a vibe and the chat pogs in unison.",
            clue: "Kai shrugs when peanut brittle samples slide past his deck.",
          },
          {
            text: "Assist Mei in painting a glow-in-the-dark mural for the stage backdrop.",
            affection: { mei: 3 },
            log: "Glitter ends up everywhere. Mei laughs so hard her eyeliner smudges‚Äîand she doesn't mind.",
            clue: "Mei trades sketch tips for peanut-free takoyaki recipes.",
          },
        ],
      },
      {
        title: "Day 3 ¬∑ Confession Fireworks",
        text: "Finale night. Fireworks above, petals below. Who gets your heart?",
        mood: "romantic cliffhanger energy",
        choices: [
          {
            text: "Confess to Yumi under the lantern arch.",
            affection: { yumi: 5 },
            ending: "Yumi flips to a page in her planner titled 'Us'. She says yes‚Äîefficiently and adorably.",
            clue: "Yumi mailed peanut-free care packages to half the student body.",
          },
          {
            text: "Give Kai the limited-edition vinyl you scored.",
            affection: { kai: 5 },
            ending: "Kai takes off his headphones so you hear him say it‚Äîhis heart beats for you.",
            clue: "Kai swears the vinyl sleeve smells like peanuts, but he's still vibing.",
          },
          {
            text: "Surprise Mei with a joint canvas that completes her masterpiece.",
            affection: { mei: 5 },
            ending: "Mei paints a tiny heart in the corner and labels it with both your initials.",
            clue: "Mei gifts you a 'peanut alert' charm for your bag‚Äîthoughtful AND stylish.",
          },
        ],
      },
    ];

    const affectionMeters = document.querySelectorAll("[data-meter]");
    const choiceList = document.getElementById("choice-list");
    const sceneTitle = document.getElementById("scene-title");
    const sceneText = document.getElementById("scene-text");
    const moodStatus = document.getElementById("mood-status");
    const dayStatus = document.getElementById("day-status");
    const logContainer = document.getElementById("log");
    const choiceTemplate = document.getElementById("choice-template");
    const logTemplate = document.getElementById("log-template");
    const shareButton = document.getElementById("share-button");
    const resetButton = document.getElementById("reset-button");
    const clueList = document.getElementById("clue-list");
    const peanutStatus = document.getElementById("peanut-status");
    const guessButtons = document.querySelectorAll("[data-guess]");

    const stored = localStorage.getItem("sakura-hearts-state");
    if (stored) {
      try {
        const saved = JSON.parse(stored);
        state.day = saved.day ?? state.day;
        state.sceneIndex = saved.sceneIndex ?? state.sceneIndex;
        state.affection = saved.affection ?? state.affection;
        state.log = Array.isArray(saved.log) ? saved.log : state.log;
        state.clues = Array.isArray(saved.clues) ? saved.clues : state.clues;
        state.peanutSolved = Boolean(saved.peanutSolved);
        state.peanutGuess = saved.peanutGuess ?? state.peanutGuess;
      } catch (error) {
        console.error("Failed to load saved state", error);
        localStorage.removeItem("sakura-hearts-state");
      }
    }

    function saveState() {
      const toSave = {
        day: state.day,
        sceneIndex: state.sceneIndex,
        affection: state.affection,
        log: state.log.slice(-25),
        clues: state.clues.slice(-12),
        peanutSolved: state.peanutSolved,
        peanutGuess: state.peanutGuess,
      };
      localStorage.setItem("sakura-hearts-state", JSON.stringify(toSave));
    }

    function updateAffectionMeters() {
      affectionMeters.forEach((meter) => {
        const key = meter.dataset.meter;
        meter.textContent = `Affection: ${state.affection[key]}`;
      });
    }

    function addClue(text) {
      if (!text || state.clues.includes(text)) {
        return;
      }
      state.clues.push(text);
      if (state.clues.length > 12) {
        state.clues.shift();
      }
    }

    function renderClues() {
      clueList.innerHTML = "";
      if (state.clues.length === 0) {
        const empty = document.createElement("li");
        empty.textContent = "Make choices to gather intel. Chat is counting on you.";
        clueList.append(empty);
        return;
      }

      state.clues.forEach((clue) => {
        const item = document.createElement("li");
        item.textContent = clue;
        clueList.append(item);
      });
    }

    function renderMystery() {
      renderClues();
      const solved = state.peanutSolved;
      const guessedKey = state.peanutGuess;
      guessButtons.forEach((button) => {
        button.disabled = solved;
      });

      if (!solved) {
        peanutStatus.textContent = "Status: unresolved";
        return;
      }

      const correct = guessedKey === liarKey;
      if (correct) {
        peanutStatus.textContent = `${formatName(guessedKey)} was bluffing. You saved the snack table!`;
      } else {
        peanutStatus.textContent = `${formatName(guessedKey)} was truthful. ${formatName(liarKey)} was the real faker.`;
      }
    }

    function renderScene() {
      const scene = scenes[state.sceneIndex];
      sceneTitle.textContent = scene.title;
      sceneText.textContent = scene.text;
      choiceList.innerHTML = "";
      moodStatus.textContent = `Chat mood: ${scene.mood}`;
      dayStatus.textContent = `Day: ${state.day}`;

      scene.choices.forEach((choice) => {
        const choiceNode = choiceTemplate.content.firstElementChild.cloneNode(true);
        choiceNode.textContent = choice.text;
        choiceNode.addEventListener("click", () => handleChoice(choice));
        choiceList.append(choiceNode);
      });

      renderLog();
      updateAffectionMeters();
      renderMystery();
      saveState();
    }

    function renderLog() {
      logContainer.innerHTML = "";
      state.log.slice(-12).forEach((entry) => {
        const logNode = logTemplate.content.firstElementChild.cloneNode(true);
        logNode.textContent = entry;
        logContainer.append(logNode);
      });
      logContainer.scrollTop = logContainer.scrollHeight;
    }

    function handleChoice(choice) {
      Object.entries(choice.affection || {}).forEach(([key, value]) => {
        state.affection[key] = (state.affection[key] || 0) + value;
      });

      const scene = scenes[state.sceneIndex];
      const entry = `${scene.title}: ${choice.log || "A mysterious choice was made."}`;
      state.log.push(entry);
      addClue(choice.clue);

      if (choice.ending) {
        conclude(choice);
        return;
      }

      if (state.sceneIndex < scenes.length - 1) {
        state.sceneIndex += 1;
        state.day += 1;
        renderScene();
      }
    }

    function conclude(choice) {
      const affectionEntries = Object.entries(state.affection);
      const strongest = affectionEntries.sort((a, b) => b[1] - a[1])[0];
      const [winnerKey] = strongest;
      const endingText = choice.ending ?? "The petals fall, but the future is unwritten.";

      sceneTitle.textContent = "Finale ¬∑ Fireworks of Fate";
      sceneText.textContent = endingText;
      moodStatus.textContent = "Chat mood: absolutely losing it";
      dayStatus.textContent = `Day: ${state.day}`;
      choiceList.innerHTML = "";

      const wrapUp = document.createElement("div");
      wrapUp.className = "choices";
      wrapUp.innerHTML = `
        <div class="log-entry">
          <strong>Most affection:</strong> ${formatName(winnerKey)} with ${state.affection[winnerKey]} pts.\nKeep playing to unlock the other endings!
        </div>
      `;
      choiceList.append(wrapUp);

      state.sceneIndex = scenes.length - 1;
      state.log.push(`Final ending unlocked with ${formatName(winnerKey)}.`);
      renderMystery();
      saveState();
    }

    function formatName(key) {
      switch (key) {
        case "yumi":
          return "Yumi";
        case "kai":
          return "Kai";
        case "mei":
          return "Mei";
        default:
          return "Someone unexpected";
      }
    }

    function resetGame() {
      state.day = 1;
      state.sceneIndex = 0;
      state.affection = { yumi: 0, kai: 0, mei: 0 };
      state.log = [];
      state.clues = [];
      state.peanutSolved = false;
      state.peanutGuess = null;
      saveState();
      renderScene();
    }

    function handleGuess(key) {
      if (state.peanutSolved) {
        return;
      }
      state.peanutSolved = true;
      state.peanutGuess = key;
      const correct = key === liarKey;
      const message = correct
        ? `${formatName(key)} was secretly munching peanut mochi backstage. Nice catch!`
        : `${formatName(key)} actually has a real allergy. ${formatName(liarKey)} was the one faking it to seem mysterious.`;
      state.log.push(`Peanut mystery verdict: ${message}`);
      if (!correct && !state.clues.includes("Kai got called out after DJing with peanut brittle crumbs on the mixer.")) {
        state.clues.push("Kai got called out after DJing with peanut brittle crumbs on the mixer.");
      }
      renderMystery();
      renderLog();
      saveState();
    }

    shareButton.addEventListener("click", async () => {
      const winner = Object.entries(state.affection).sort((a, b) => b[1] - a[1])[0];
      const [key, value] = winner || ["everyone", 0];
      const shareData = {
        title: "Sakura Hearts",
        text: `I just got ${formatName(key)} to ${value} affection in Sakura Hearts and solved the peanut mystery!`,
        url: window.location.href,
      };

      if (navigator.share) {
        try {
          await navigator.share(shareData);
        } catch (error) {
          console.warn("Share cancelled", error);
        }
      } else {
        navigator.clipboard?.writeText(`${shareData.text} ${shareData.url}`)
          .then(() => alert("Link copied! Send it to your best wingperson."))
          .catch(() => alert("Couldn't share automatically. Drop the link manually!"));
      }
    });

    resetButton.addEventListener("click", () => {
      if (confirm("Reset your Sakura Hearts story?")) {
        resetGame();
      }
    });

    guessButtons.forEach((button) => {
      button.addEventListener("click", () => handleGuess(button.dataset.guess));
    });

    renderScene();
  </script>
</body>
</html>
