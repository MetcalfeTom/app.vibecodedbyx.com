<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Snowball Fight</title>
  <link rel="icon" href="https://emojicdn.elk.sh/‚ùÑÔ∏è">

  <meta property="og:title" content="Snowball Fight">
  <meta property="og:description" content="Survive waves of enemies in this festive snowball battle!">
  <meta property="og:url" content="https://app.sloppy.live/snowball-fight">
  <meta property="og:image" content="https://app.sloppy.live/snowball-fight/og-image.png">
  <meta property="og:type" content="website">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;700&family=Fira+Code:wght@400;600&display=swap" rel="stylesheet">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Crimson Pro', serif;
      overflow: hidden;
      background: linear-gradient(180deg, #1a2a4a 0%, #2d4a6d 40%, #4a6d8a 100%);
      min-height: 100vh;
      position: relative;
    }

    #game-container {
      width: 100vw;
      height: 100vh;
      position: relative;
      overflow: hidden;
      cursor: crosshair;
    }

    /* Snow ground */
    .ground {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 25%;
      background: linear-gradient(180deg, #e8f4f8 0%, #d0e8f0 100%);
      border-top: 4px solid #fff;
      box-shadow: 0 -10px 30px rgba(255,255,255,0.5);
    }

    .ground::before {
      content: '';
      position: absolute;
      top: -20px;
      left: 0;
      width: 100%;
      height: 40px;
      background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 20'%3E%3Cellipse cx='10' cy='15' rx='12' ry='8' fill='%23fff'/%3E%3Cellipse cx='35' cy='12' rx='15' ry='10' fill='%23fff'/%3E%3Cellipse cx='60' cy='14' rx='10' ry='7' fill='%23fff'/%3E%3Cellipse cx='85' cy='13' rx='14' ry='9' fill='%23fff'/%3E%3C/svg%3E") repeat-x;
      background-size: 200px 40px;
    }

    /* Trees in background */
    .trees {
      position: absolute;
      bottom: 20%;
      width: 100%;
      height: 200px;
      pointer-events: none;
    }

    .tree {
      position: absolute;
      bottom: 0;
      width: 0;
      height: 0;
      border-left: 30px solid transparent;
      border-right: 30px solid transparent;
      border-bottom: 80px solid #1a4a2a;
      filter: brightness(0.7);
    }

    .tree::before {
      content: '';
      position: absolute;
      top: 30px;
      left: -25px;
      width: 0;
      height: 0;
      border-left: 25px solid transparent;
      border-right: 25px solid transparent;
      border-bottom: 70px solid #1a4a2a;
    }

    .tree::after {
      content: '';
      position: absolute;
      top: 55px;
      left: -20px;
      width: 0;
      height: 0;
      border-left: 20px solid transparent;
      border-right: 20px solid transparent;
      border-bottom: 60px solid #1a4a2a;
    }

    /* Enemy container */
    .enemy {
      position: absolute;
      bottom: 25%;
      cursor: default;
      transition: transform 0.1s ease-out;
      z-index: 10;
      pointer-events: none;
    }

    .enemy-inner {
      position: relative;
      animation: wobble 3s ease-in-out infinite;
    }

    @keyframes wobble {
      0%, 100% { transform: rotate(-2deg); }
      50% { transform: rotate(2deg); }
    }

    /* Evil Snowman */
    .evil-snowman .snowman-body {
      width: 70px;
      height: 70px;
      background: radial-gradient(circle at 30% 30%, #e8e8e8 0%, #b0b8bc 100%);
      border-radius: 50%;
      position: relative;
      box-shadow: inset -10px -10px 20px rgba(0,0,0,0.2), 0 5px 15px rgba(0,0,0,0.3);
    }

    .evil-snowman .snowman-middle {
      width: 50px;
      height: 50px;
      background: radial-gradient(circle at 30% 30%, #e8e8e8 0%, #b0b8bc 100%);
      border-radius: 50%;
      position: absolute;
      bottom: 55px;
      left: 10px;
      box-shadow: inset -8px -8px 15px rgba(0,0,0,0.2), 0 5px 15px rgba(0,0,0,0.3);
    }

    .evil-snowman .snowman-head {
      width: 40px;
      height: 40px;
      background: radial-gradient(circle at 30% 30%, #e8e8e8 0%, #b0b8bc 100%);
      border-radius: 50%;
      position: absolute;
      bottom: 98px;
      left: 15px;
      box-shadow: inset -6px -6px 12px rgba(0,0,0,0.2), 0 5px 15px rgba(0,0,0,0.3);
    }

    .evil-snowman .snowman-head::before {
      content: 'üò†';
      position: absolute;
      top: 6px;
      left: 6px;
      font-size: 20px;
    }

    .evil-snowman .carrot {
      position: absolute;
      top: 18px;
      left: 35px;
      width: 0;
      height: 0;
      border-top: 4px solid transparent;
      border-bottom: 4px solid transparent;
      border-left: 18px solid #ff6b35;
    }

    /* Elf enemy */
    .elf {
      font-size: 50px;
      line-height: 1;
    }

    /* Grinch enemy */
    .grinch {
      font-size: 60px;
      line-height: 1;
    }

    /* Hit effect */
    .enemy.hit .enemy-inner {
      animation: shake 0.3s ease-in-out;
    }

    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      25% { transform: translateX(-10px) rotate(-5deg); }
      75% { transform: translateX(10px) rotate(5deg); }
    }

    /* Red splatter effect */
    .splatter {
      position: absolute;
      pointer-events: none;
      z-index: 150;
    }

    .splatter-particle {
      position: absolute;
      background: radial-gradient(circle, #c41e3a 0%, #8b0000 100%);
      border-radius: 50%;
      animation: splatterFade 0.6s ease-out forwards;
    }

    @keyframes splatterFade {
      0% {
        opacity: 1;
        transform: scale(1);
      }
      100% {
        opacity: 0;
        transform: scale(0.3);
      }
    }

    /* Snowballs */
    .snowball {
      position: absolute;
      width: 20px;
      height: 20px;
      background: radial-gradient(circle at 30% 30%, #fff 0%, #d0e0e8 100%);
      border-radius: 50%;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      z-index: 100;
      pointer-events: none;
    }

    .snowball.splat {
      animation: splat 0.4s ease-out forwards;
    }

    @keyframes splat {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(2, 0.5); opacity: 0.8; }
      100% { transform: scale(3, 0.2); opacity: 0; }
    }

    /* Snow particles */
    .snowflake {
      position: absolute;
      color: #fff;
      font-size: 10px;
      opacity: 0.8;
      pointer-events: none;
      animation: fall linear infinite;
      text-shadow: 0 0 5px rgba(255,255,255,0.5);
    }

    @keyframes fall {
      0% {
        transform: translateY(-10px) rotate(0deg);
        opacity: 0;
      }
      10% { opacity: 0.8; }
      90% { opacity: 0.8; }
      100% {
        transform: translateY(100vh) rotate(360deg);
        opacity: 0;
      }
    }

    /* Reindeer */
    .reindeer {
      position: absolute;
      z-index: 200;
      pointer-events: none;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .reindeer-emoji {
      font-size: 60px;
      filter: drop-shadow(2px 2px 4px rgba(0,0,0,0.3));
    }

    .reindeer.running-left {
      animation: dashLeft 3.5s linear forwards;
    }

    .reindeer.running-left .reindeer-emoji {
      transform: scaleX(1);
    }

    .reindeer.running-right {
      animation: dashRight 3.5s linear forwards;
    }

    .reindeer.running-right .reindeer-emoji {
      transform: scaleX(-1);
    }

    @keyframes dashLeft {
      0% { left: 105%; }
      100% { left: -20%; }
    }

    @keyframes dashRight {
      0% { left: -20%; }
      100% { left: 105%; }
    }

    /* Gaslighting speech bubble */
    .reindeer-speech {
      position: absolute;
      bottom: 70px;
      background: rgba(255,255,255,0.95);
      color: #333;
      padding: 8px 14px;
      border-radius: 12px;
      font-family: 'Crimson Pro', serif;
      font-size: 14px;
      font-style: italic;
      white-space: nowrap;
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
      animation: speechPop 0.3s ease-out;
    }

    .reindeer-speech::after {
      content: '';
      position: absolute;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
      border-left: 8px solid transparent;
      border-right: 8px solid transparent;
      border-top: 8px solid rgba(255,255,255,0.95);
    }

    @keyframes speechPop {
      0% { opacity: 0; transform: scale(0.5); }
      100% { opacity: 1; transform: scale(1); }
    }

    /* UI Elements */
    #ui-panel {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(255,255,255,0.15);
      backdrop-filter: blur(10px);
      padding: 15px 25px;
      border-radius: 15px;
      border: 1px solid rgba(255,255,255,0.3);
      color: #fff;
      font-family: 'Fira Code', monospace;
      font-size: 16px;
      z-index: 1000;
      text-align: right;
    }

    #ui-panel .wave {
      color: #ff6b6b;
      font-weight: 600;
      font-size: 20px;
    }

    #ui-panel .score {
      color: #ffd700;
      font-weight: 600;
      font-size: 20px;
    }

    #ui-panel .enemies {
      color: #7fdbff;
      font-size: 14px;
      margin-top: 5px;
    }

    /* Hit counter popup */
    .hit-popup {
      position: absolute;
      color: #ffd700;
      font-family: 'Fira Code', monospace;
      font-size: 28px;
      font-weight: 700;
      text-shadow: 0 2px 10px rgba(0,0,0,0.5);
      animation: popUp 0.8s ease-out forwards;
      pointer-events: none;
      z-index: 200;
    }

    @keyframes popUp {
      0% {
        opacity: 1;
        transform: translateY(0) scale(0.5);
      }
      50% {
        transform: translateY(-30px) scale(1.2);
      }
      100% {
        opacity: 0;
        transform: translateY(-60px) scale(1);
      }
    }

    /* Title */
    #title {
      position: fixed;
      top: 20px;
      left: 20px;
      color: #fff;
      font-size: 28px;
      font-weight: 700;
      text-shadow: 0 2px 10px rgba(0,0,0,0.3);
      z-index: 1000;
    }

    #title span {
      font-size: 32px;
    }

    /* Wave announcement */
    #wave-announce {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #fff;
      font-size: 48px;
      font-weight: 700;
      text-shadow: 0 4px 20px rgba(0,0,0,0.5);
      z-index: 600;
      opacity: 0;
      pointer-events: none;
      font-family: 'Fira Code', monospace;
    }

    #wave-announce.show {
      animation: waveAnnounce 2s ease-out forwards;
    }

    @keyframes waveAnnounce {
      0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
      20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
      80% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
      100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
    }

    /* Instructions */
    #instructions {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #fff;
      font-size: 22px;
      text-align: center;
      background: rgba(0,0,0,0.4);
      backdrop-filter: blur(10px);
      padding: 30px 40px;
      border-radius: 20px;
      z-index: 500;
      transition: opacity 0.5s ease;
      max-width: 400px;
    }

    #instructions.hidden {
      opacity: 0;
      pointer-events: none;
    }

    #instructions h2 {
      margin-bottom: 15px;
      font-size: 28px;
    }

    #instructions p {
      opacity: 0.9;
      line-height: 1.5;
    }

    /* Backlink */
    #backlink {
      position: fixed;
      bottom: 20px;
      left: 20px;
      color: rgba(255,255,255,0.6);
      font-size: 14px;
      text-decoration: none;
      font-family: 'Fira Code', monospace;
      z-index: 1000;
      transition: color 0.2s;
    }

    #backlink:hover {
      color: rgba(255,255,255,0.9);
    }

    /* Moon */
    .moon {
      position: absolute;
      top: 60px;
      right: 15%;
      width: 60px;
      height: 60px;
      background: radial-gradient(circle at 30% 30%, #fffde7 0%, #ffd54f 100%);
      border-radius: 50%;
      box-shadow: 0 0 40px rgba(255,213,79,0.5), 0 0 80px rgba(255,213,79,0.3);
    }

    /* Game Over */
    #game-over {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #fff;
      text-align: center;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(10px);
      padding: 40px 50px;
      border-radius: 20px;
      z-index: 700;
      display: none;
    }

    #game-over h2 {
      font-size: 42px;
      margin-bottom: 15px;
      color: #ff6b6b;
    }

    #game-over .final-score {
      font-size: 28px;
      margin-bottom: 20px;
    }

    #game-over .final-score span {
      color: #ffd700;
      font-weight: 700;
    }

    #restart-btn {
      padding: 15px 30px;
      font-size: 20px;
      font-family: 'Fira Code', monospace;
      background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
      color: #fff;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    #restart-btn:hover {
      transform: scale(1.05);
    }

    /* Responsive */
    @media (max-width: 600px) {
      #title {
        font-size: 20px;
        top: 15px;
        left: 15px;
      }

      #title span {
        font-size: 24px;
      }

      #ui-panel {
        top: 15px;
        right: 15px;
        padding: 10px 15px;
        font-size: 12px;
      }

      #ui-panel .wave,
      #ui-panel .score {
        font-size: 16px;
      }

      #instructions {
        font-size: 18px;
        padding: 20px 25px;
      }

      #wave-announce {
        font-size: 32px;
      }

      .evil-snowman .snowman-body {
        width: 50px;
        height: 50px;
      }

      .evil-snowman .snowman-middle {
        width: 35px;
        height: 35px;
        bottom: 40px;
        left: 7px;
      }

      .evil-snowman .snowman-head {
        width: 30px;
        height: 30px;
        bottom: 70px;
        left: 10px;
      }

      .elf, .grinch {
        font-size: 40px;
      }
    }
  </style>
</head>
<body>
  <div id="game-container">
    <div class="moon"></div>

    <div class="trees">
      <div class="tree" style="left: 5%;"></div>
      <div class="tree" style="left: 15%; transform: scale(0.8);"></div>
      <div class="tree" style="left: 75%; transform: scale(1.1);"></div>
      <div class="tree" style="left: 88%; transform: scale(0.7);"></div>
    </div>

    <div class="ground"></div>
  </div>

  <div id="title"><span>‚ùÑÔ∏è</span> Snowball Fight</div>

  <div id="ui-panel">
    <div>Wave: <span class="wave" id="wave-num">1</span></div>
    <div>Score: <span class="score" id="score">0</span></div>
    <div class="enemies">Enemies: <span id="enemies-left">0</span></div>
  </div>

  <div id="wave-announce"></div>

  <div id="instructions">
    <h2>üéØ Campaign Mode</h2>
    <p>Click to throw snowballs! Defeat all enemies to advance. Watch out - they get tougher each wave!</p>
  </div>

  <div id="game-over">
    <h2>Game Over!</h2>
    <div class="final-score">Final Score: <span id="final-score">0</span></div>
    <button id="restart-btn">Play Again</button>
  </div>

  <a href="https://sloppy.live" id="backlink">‚Üê sloppy.live</a>

  <script>
    // Snowball Fight v3 - Campaign Mode
    const container = document.getElementById('game-container');
    const scoreDisplay = document.getElementById('score');
    const waveDisplay = document.getElementById('wave-num');
    const enemiesDisplay = document.getElementById('enemies-left');
    const waveAnnounce = document.getElementById('wave-announce');
    const instructions = document.getElementById('instructions');
    const gameOverScreen = document.getElementById('game-over');
    const finalScoreDisplay = document.getElementById('final-score');
    const restartBtn = document.getElementById('restart-btn');

    // Game state
    let score = 0;
    let wave = 0;
    let enemies = [];
    let gameStarted = false;
    let gameOver = false;

    // Enemy types
    const enemyTypes = [
      { type: 'snowman', hp: 1, speed: 1.5, points: 10 },
      { type: 'elf', hp: 2, speed: 2.5, points: 25 },
      { type: 'grinch', hp: 3, speed: 1, points: 50 }
    ];

    // Create falling snow
    function createSnowflake() {
      const snowflake = document.createElement('div');
      snowflake.className = 'snowflake';
      snowflake.textContent = ['‚ùÑ', '‚ùÖ', '‚ùÜ', '‚Ä¢'][Math.floor(Math.random() * 4)];
      snowflake.style.left = Math.random() * 100 + 'vw';
      snowflake.style.fontSize = (8 + Math.random() * 12) + 'px';
      snowflake.style.animationDuration = (5 + Math.random() * 10) + 's';
      snowflake.style.opacity = 0.4 + Math.random() * 0.6;
      container.appendChild(snowflake);
      setTimeout(() => snowflake.remove(), 15000);
    }

    setInterval(createSnowflake, 200);
    for (let i = 0; i < 30; i++) {
      setTimeout(createSnowflake, i * 100);
    }

    // Gaslighting messages for the reindeer
    const gaslightMessages = [
      "You're not even trying...",
      "I never said that.",
      "Are you sure you clicked there?",
      "That wasn't a miss, you imagined it.",
      "You used to be better at this.",
      "Everyone else is on wave 10 by now.",
      "I'm not even here right now.",
      "Did you even see me? Weird.",
      "You're overreacting to my presence.",
      "I've always been supportive of you.",
      "That's not how I remember it.",
      "You're too sensitive about snowballs.",
      "I think you need to calm down.",
      "Nobody else is struggling this much.",
      "Are you feeling okay? You seem off.",
      "I'm just trying to help you improve.",
    ];

    // Spawn reindeer occasionally
    function spawnReindeer() {
      if (Math.random() > 0.3) return; // 30% chance

      const reindeer = document.createElement('div');
      reindeer.className = 'reindeer';

      const emoji = document.createElement('div');
      emoji.className = 'reindeer-emoji';
      emoji.textContent = 'ü¶å';

      const speech = document.createElement('div');
      speech.className = 'reindeer-speech';
      speech.textContent = gaslightMessages[Math.floor(Math.random() * gaslightMessages.length)];

      reindeer.appendChild(speech);
      reindeer.appendChild(emoji);

      const goingLeft = Math.random() > 0.5;
      reindeer.classList.add(goingLeft ? 'running-left' : 'running-right');
      reindeer.style.bottom = (28 + Math.random() * 15) + '%';

      container.appendChild(reindeer);
      setTimeout(() => reindeer.remove(), 4000);
    }

    setInterval(spawnReindeer, 8000);
    // Spawn one early so players see it
    setTimeout(spawnReindeer, 5000);

    // Create enemy element
    function createEnemyElement(enemyData) {
      const enemy = document.createElement('div');
      enemy.className = 'enemy';
      enemy.dataset.id = enemyData.id;

      const inner = document.createElement('div');
      inner.className = 'enemy-inner';

      if (enemyData.type === 'snowman') {
        inner.classList.add('evil-snowman');
        inner.innerHTML = `
          <div class="snowman-head"><div class="carrot"></div></div>
          <div class="snowman-middle"></div>
          <div class="snowman-body"></div>
        `;
      } else if (enemyData.type === 'elf') {
        inner.classList.add('elf');
        inner.textContent = 'üßù';
      } else if (enemyData.type === 'grinch') {
        inner.classList.add('grinch');
        inner.textContent = 'üëπ';
      }

      enemy.appendChild(inner);
      enemy.style.left = enemyData.x + 'px';
      enemy.style.transform = 'translateX(-50%)';
      container.appendChild(enemy);

      return enemy;
    }

    // Create red splatter effect
    function createSplatter(x, y) {
      const splatter = document.createElement('div');
      splatter.className = 'splatter';
      splatter.style.left = x + 'px';
      splatter.style.top = y + 'px';

      for (let i = 0; i < 8; i++) {
        const particle = document.createElement('div');
        particle.className = 'splatter-particle';
        const size = 8 + Math.random() * 12;
        particle.style.width = size + 'px';
        particle.style.height = size + 'px';
        const angle = (i / 8) * Math.PI * 2;
        const dist = 15 + Math.random() * 25;
        particle.style.left = Math.cos(angle) * dist + 'px';
        particle.style.top = Math.sin(angle) * dist + 'px';
        splatter.appendChild(particle);
      }

      container.appendChild(splatter);
      setTimeout(() => splatter.remove(), 600);
    }

    // Spawn wave of enemies
    function spawnWave() {
      wave++;
      waveDisplay.textContent = wave;

      // Announce wave
      waveAnnounce.textContent = `Wave ${wave}`;
      waveAnnounce.classList.add('show');
      setTimeout(() => waveAnnounce.classList.remove('show'), 2000);

      // Calculate enemy count (increases with wave)
      const baseCount = 2 + wave;
      const enemyCount = Math.min(baseCount, 10);

      // Spawn enemies
      for (let i = 0; i < enemyCount; i++) {
        setTimeout(() => {
          // Pick enemy type based on wave
          let typeIndex = 0;
          if (wave >= 3 && Math.random() > 0.6) typeIndex = 1;
          if (wave >= 5 && Math.random() > 0.8) typeIndex = 2;

          const template = enemyTypes[typeIndex];
          const enemyData = {
            id: Date.now() + i,
            type: template.type,
            hp: template.hp + Math.floor(wave / 3), // HP scales with wave
            maxHp: template.hp + Math.floor(wave / 3),
            speed: template.speed * (1 + wave * 0.1), // Speed scales
            points: template.points,
            x: 100 + Math.random() * (window.innerWidth - 200),
            direction: Math.random() > 0.5 ? 1 : -1,
            element: null
          };

          enemyData.element = createEnemyElement(enemyData);
          enemies.push(enemyData);
          updateEnemyCount();
        }, i * 500);
      }
    }

    // Update enemy positions
    function updateEnemies() {
      if (gameOver) return;

      enemies.forEach(enemy => {
        enemy.x += enemy.speed * enemy.direction;

        // Bounce off edges
        if (enemy.x < 80 || enemy.x > window.innerWidth - 80) {
          enemy.direction *= -1;
        }

        enemy.element.style.left = enemy.x + 'px';
        enemy.element.style.transform = `translateX(-50%) scaleX(${enemy.direction})`;
      });

      requestAnimationFrame(updateEnemies);
    }

    // Update enemy count display
    function updateEnemyCount() {
      enemiesDisplay.textContent = enemies.length;
    }

    // Check if wave is complete
    function checkWaveComplete() {
      if (enemies.length === 0 && gameStarted && !gameOver) {
        setTimeout(spawnWave, 2000);
      }
    }

    // Throw snowball
    function throwSnowball(clickX, clickY) {
      if (gameOver) return;

      if (!gameStarted) {
        gameStarted = true;
        instructions.classList.add('hidden');
        spawnWave();
        updateEnemies();
      }

      const snowball = document.createElement('div');
      snowball.className = 'snowball';

      const startX = window.innerWidth / 2;
      const startY = window.innerHeight - 80;

      snowball.style.left = startX + 'px';
      snowball.style.top = startY + 'px';
      container.appendChild(snowball);

      const endX = clickX;
      const endY = clickY;

      const distance = Math.sqrt(Math.pow(endX - startX, 2) + Math.pow(endY - startY, 2));
      const arcHeight = Math.min(distance * 0.4, 250);
      const duration = 500 + distance * 0.3;
      const startTime = performance.now();

      function animateSnowball(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);

        const easeProgress = 1 - Math.pow(1 - progress, 2);
        const arc = -arcHeight * Math.sin(progress * Math.PI);

        const currentX = startX + (endX - startX) * easeProgress;
        const currentY = startY + (endY - startY) * easeProgress + arc;

        snowball.style.left = currentX + 'px';
        snowball.style.top = currentY + 'px';
        snowball.style.transform = `rotate(${progress * 720}deg)`;

        if (progress < 1) {
          requestAnimationFrame(animateSnowball);
        } else {
          // Check hits on all enemies
          let hitEnemy = null;

          for (const enemy of enemies) {
            const rect = enemy.element.getBoundingClientRect();
            const padding = 25;

            if (currentX > rect.left - padding &&
                currentX < rect.right + padding &&
                currentY > rect.top - padding &&
                currentY < rect.bottom + padding) {
              hitEnemy = enemy;
              break;
            }
          }

          if (hitEnemy) {
            hitEnemy.hp--;

            // Red splatter effect
            createSplatter(currentX, currentY);

            // Hit animation
            hitEnemy.element.classList.add('hit');
            setTimeout(() => hitEnemy.element.classList.remove('hit'), 300);

            if (hitEnemy.hp <= 0) {
              // Enemy defeated
              score += hitEnemy.points;
              scoreDisplay.textContent = score;

              // Hit popup
              const popup = document.createElement('div');
              popup.className = 'hit-popup';
              popup.textContent = '+' + hitEnemy.points;
              popup.style.left = currentX + 'px';
              popup.style.top = currentY + 'px';
              container.appendChild(popup);
              setTimeout(() => popup.remove(), 800);

              // Remove enemy
              hitEnemy.element.remove();
              enemies = enemies.filter(e => e.id !== hitEnemy.id);
              updateEnemyCount();
              checkWaveComplete();
            } else {
              // Show damage
              const popup = document.createElement('div');
              popup.className = 'hit-popup';
              popup.textContent = 'HIT!';
              popup.style.left = currentX + 'px';
              popup.style.top = currentY + 'px';
              container.appendChild(popup);
              setTimeout(() => popup.remove(), 800);
            }
          }

          snowball.classList.add('splat');
          setTimeout(() => snowball.remove(), 400);
        }
      }

      requestAnimationFrame(animateSnowball);
    }

    // Event listeners
    container.addEventListener('click', (e) => {
      if (e.target.closest('#backlink') || e.target.closest('#instructions') || e.target.closest('#game-over')) return;
      throwSnowball(e.clientX, e.clientY);
    });

    container.addEventListener('touchstart', (e) => {
      if (e.target.closest('#backlink') || e.target.closest('#instructions') || e.target.closest('#game-over')) return;
      const touch = e.touches[0];
      throwSnowball(touch.clientX, touch.clientY);
      e.preventDefault();
    }, { passive: false });

    // Restart game
    restartBtn.addEventListener('click', () => {
      score = 0;
      wave = 0;
      enemies.forEach(e => e.element.remove());
      enemies = [];
      gameOver = false;
      gameStarted = false;

      scoreDisplay.textContent = '0';
      waveDisplay.textContent = '1';
      enemiesDisplay.textContent = '0';

      gameOverScreen.style.display = 'none';
      instructions.classList.remove('hidden');
    });

    // Handle resize
    window.addEventListener('resize', () => {
      enemies.forEach(enemy => {
        enemy.x = Math.min(enemy.x, window.innerWidth - 100);
      });
    });
  </script>
<script src="/sloppy-header/sloppy-bar.js"></script>
<script src="/vibelib-extended.js"></script>
<script>
  // Compatibility Patch for Legacy Apps
  window.addEventListener("load", () => {
    if (window.SloppyKarma && window.VibeLib.Economy) {
      // Redirect old calls to new engine
      window.SloppyKarma.track = window.VibeLib.Economy.track;
    }
  });
</script>
</body>
</html>
