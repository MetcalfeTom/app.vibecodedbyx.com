<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asteroids - Classic Space Shooter</title>
    <link rel="icon" href="https://emojicdn.elk.sh/üöÄ">

    <meta property="og:title" content="Asteroids - Space Shooter Game">
    <meta property="og:description" content="Classic asteroids arcade game with modern graphics and smooth gameplay">
    <meta property="og:url" content="https://app.vibecodedbyx.com/asteroids">
    <meta property="og:image" content="https://image.pollinations.ai/prompt/retro%20neon%20asteroids%20arcade%20game%20space%20shooter%20glowing%20spaceship?width=1200&height=630&referrer=vibecodedbyx.com">

    <script src="/vibelib.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #0ff;
            overflow: hidden;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #gameCanvas {
            border: 2px solid #0ff;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            background: #000;
        }

        .ui {
            position: fixed;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            pointer-events: none;
            z-index: 100;
        }

        .stat-panel {
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #0ff;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.5);
            min-width: 150px;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.7;
            text-transform: uppercase;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            margin-top: 5px;
            text-shadow: 0 0 10px #0ff;
        }

        .lives {
            display: flex;
            gap: 5px;
            margin-top: 5px;
        }

        .life-icon {
            width: 20px;
            height: 20px;
            border: 2px solid #0ff;
            clip-path: polygon(50% 0%, 100% 100%, 0% 100%);
            background: #0ff;
            box-shadow: 0 0 5px #0ff;
        }

        .game-over-screen {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.95);
            border: 3px solid #0ff;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            display: none;
            z-index: 200;
            box-shadow: 0 0 30px rgba(0, 255, 255, 0.8);
            min-width: 400px;
        }

        .game-over-screen.show {
            display: block;
            animation: slideIn 0.5s;
        }

        @keyframes slideIn {
            from {
                transform: translate(-50%, -60%);
                opacity: 0;
            }
            to {
                transform: translate(-50%, -50%);
                opacity: 1;
            }
        }

        .game-over-screen h1 {
            font-size: 48px;
            margin-bottom: 20px;
            text-shadow: 0 0 20px #0ff;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .final-stats {
            margin: 30px 0;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .stat-row {
            display: flex;
            justify-content: space-between;
            font-size: 18px;
        }

        .btn {
            background: transparent;
            border: 2px solid #0ff;
            color: #0ff;
            padding: 15px 40px;
            font-size: 18px;
            font-family: 'Courier New', monospace;
            cursor: pointer;
            margin: 10px;
            border-radius: 5px;
            transition: all 0.3s;
            pointer-events: all;
        }

        .btn:hover {
            background: #0ff;
            color: #000;
            box-shadow: 0 0 20px #0ff;
            transform: scale(1.05);
        }

        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #0ff;
            padding: 15px 25px;
            border-radius: 10px;
            text-align: center;
            font-size: 14px;
            box-shadow: 0 0 15px rgba(0, 255, 255, 0.3);
        }

        .level-up {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 64px;
            font-weight: bold;
            color: #0ff;
            text-shadow: 0 0 30px #0ff;
            pointer-events: none;
            z-index: 150;
            display: none;
        }

        .level-up.show {
            display: block;
            animation: levelUpAnim 2s;
        }

        @keyframes levelUpAnim {
            0% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.5);
            }
            20% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.2);
            }
            80% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1);
            }
            100% {
                opacity: 0;
                transform: translate(-50%, -50%) scale(0.8);
            }
        }

        @media (max-width: 768px) {
            .controls {
                font-size: 12px;
                padding: 10px 15px;
            }

            .stat-panel {
                padding: 10px;
                min-width: 100px;
            }

            .stat-value {
                font-size: 18px;
            }

            .game-over-screen {
                min-width: 300px;
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <div class="ui">
        <div class="stat-panel">
            <div class="stat-label">Score</div>
            <div class="stat-value" id="score">0</div>
        </div>
        <div class="stat-panel">
            <div class="stat-label">Level</div>
            <div class="stat-value" id="level">1</div>
        </div>
        <div class="stat-panel">
            <div class="stat-label">Lives</div>
            <div class="lives" id="lives">
                <div class="life-icon"></div>
                <div class="life-icon"></div>
                <div class="life-icon"></div>
            </div>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div class="level-up" id="levelUp">LEVEL UP!</div>

    <div class="game-over-screen" id="gameOverScreen">
        <h1>GAME OVER</h1>
        <div class="final-stats">
            <div class="stat-row">
                <span>Final Score:</span>
                <span id="finalScore">0</span>
            </div>
            <div class="stat-row">
                <span>Level Reached:</span>
                <span id="finalLevel">1</span>
            </div>
            <div class="stat-row">
                <span>Asteroids Destroyed:</span>
                <span id="asteroidsDestroyed">0</span>
            </div>
        </div>
        <button class="btn" onclick="startGame()">PLAY AGAIN</button>
        <div style="margin-top: 20px; font-size: 12px; opacity: 0.7;">
            <a href="https://www.vibecodedbyx.com" style="color: #0ff; text-decoration: none;">‚Üê Back to VibeCodedByX</a>
        </div>
    </div>

    <div class="controls">
        <strong>CONTROLS:</strong> ARROW KEYS to rotate & thrust | SPACE to fire | P to pause
    </div>

    <script>
        // Use VibeLib for canvas setup
        const { canvas, ctx } = VibeLib.game.setupCanvas('gameCanvas');

        // Game state
        let gameRunning = false;
        let paused = false;
        let score = 0;
        let level = 1;
        let lives = 3;
        let asteroidsDestroyed = 0;

        // Game objects
        let ship = null;
        let bullets = [];
        let asteroids = [];
        let particles = [];
        let stars = [];

        // Use VibeLib for keyboard input
        const { keys } = VibeLib.game.createKeyboardInput();

        // Classes
        class Ship {
            constructor() {
                this.x = canvas.width / 2;
                this.y = canvas.height / 2;
                this.angle = -Math.PI / 2;
                this.velocity = { x: 0, y: 0 };
                this.size = 15;
                this.rotationSpeed = 0.1;
                this.thrust = 0.15;
                this.friction = 0.99;
                this.invincible = false;
                this.invincibleTime = 0;
            }

            update() {
                // Rotation
                if (keys['ArrowLeft']) this.angle -= this.rotationSpeed;
                if (keys['ArrowRight']) this.angle += this.rotationSpeed;

                // Thrust
                if (keys['ArrowUp']) {
                    this.velocity.x += Math.cos(this.angle) * this.thrust;
                    this.velocity.y += Math.sin(this.angle) * this.thrust;

                    // Thrust particles using VibeLib
                    for (let i = 0; i < 2; i++) {
                        particles.push(VibeLib.game.createParticle(
                            this.x - Math.cos(this.angle) * this.size,
                            this.y - Math.sin(this.angle) * this.size,
                            { color: '#f80', size: 2, vx: -Math.cos(this.angle) * 2, vy: -Math.sin(this.angle) * 2 }
                        ));
                    }
                }

                // Apply friction
                this.velocity.x *= this.friction;
                this.velocity.y *= this.friction;

                // Update position
                this.x += this.velocity.x;
                this.y += this.velocity.y;

                // Wrap around screen
                if (this.x < 0) this.x = canvas.width;
                if (this.x > canvas.width) this.x = 0;
                if (this.y < 0) this.y = canvas.height;
                if (this.y > canvas.height) this.y = 0;

                // Update invincibility
                if (this.invincible) {
                    this.invincibleTime--;
                    if (this.invincibleTime <= 0) {
                        this.invincible = false;
                    }
                }
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.angle);

                // Draw ship with glow
                if (!this.invincible || Math.floor(Date.now() / 100) % 2 === 0) {
                    ctx.strokeStyle = '#0ff';
                    ctx.lineWidth = 2;
                    ctx.shadowBlur = 15;
                    ctx.shadowColor = '#0ff';

                    ctx.beginPath();
                    ctx.moveTo(this.size, 0);
                    ctx.lineTo(-this.size, -this.size / 2);
                    ctx.lineTo(-this.size / 2, 0);
                    ctx.lineTo(-this.size, this.size / 2);
                    ctx.closePath();
                    ctx.stroke();
                }

                ctx.restore();
            }

            makeInvincible() {
                this.invincible = true;
                this.invincibleTime = 120; // 2 seconds at 60fps
            }
        }

        class Bullet {
            constructor(x, y, angle) {
                this.x = x;
                this.y = y;
                this.velocity = {
                    x: Math.cos(angle) * 8,
                    y: Math.sin(angle) * 8
                };
                this.life = 60; // 1 second
                this.size = 3;
            }

            update() {
                this.x += this.velocity.x;
                this.y += this.velocity.y;
                this.life--;

                // Wrap around
                if (this.x < 0) this.x = canvas.width;
                if (this.x > canvas.width) this.x = 0;
                if (this.y < 0) this.y = canvas.height;
                if (this.y > canvas.height) this.y = 0;
            }

            draw() {
                ctx.fillStyle = '#0ff';
                ctx.shadowBlur = 10;
                ctx.shadowColor = '#0ff';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }

            isDead() {
                return this.life <= 0;
            }
        }

        class Asteroid {
            constructor(x, y, size) {
                this.x = x || Math.random() * canvas.width;
                this.y = y || Math.random() * canvas.height;
                this.size = size || 50;

                const speed = 1 + Math.random() * 2;
                const angle = Math.random() * Math.PI * 2;
                this.velocity = {
                    x: Math.cos(angle) * speed,
                    y: Math.sin(angle) * speed
                };

                this.rotation = Math.random() * Math.PI * 2;
                this.rotationSpeed = (Math.random() - 0.5) * 0.05;

                // Generate random asteroid shape
                this.points = [];
                const numPoints = 8 + Math.floor(Math.random() * 4);
                for (let i = 0; i < numPoints; i++) {
                    const angle = (i / numPoints) * Math.PI * 2;
                    const radius = this.size * (0.7 + Math.random() * 0.3);
                    this.points.push({ x: Math.cos(angle) * radius, y: Math.sin(angle) * radius });
                }
            }

            update() {
                this.x += this.velocity.x;
                this.y += this.velocity.y;
                this.rotation += this.rotationSpeed;

                // Wrap around
                if (this.x < -this.size) this.x = canvas.width + this.size;
                if (this.x > canvas.width + this.size) this.x = -this.size;
                if (this.y < -this.size) this.y = canvas.height + this.size;
                if (this.y > canvas.height + this.size) this.y = -this.size;
            }

            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.rotation);

                ctx.strokeStyle = '#f80';
                ctx.lineWidth = 2;
                ctx.shadowBlur = 10;
                ctx.shadowColor = '#f80';

                ctx.beginPath();
                ctx.moveTo(this.points[0].x, this.points[0].y);
                for (let i = 1; i < this.points.length; i++) {
                    ctx.lineTo(this.points[i].x, this.points[i].y);
                }
                ctx.closePath();
                ctx.stroke();

                ctx.restore();
            }

            collidesWith(obj) {
                const dx = this.x - obj.x;
                const dy = this.y - obj.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                return distance < this.size + (obj.size || 0);
            }
        }

        // Use VibeLib particle system - no need for custom Particle class

        class Star {
            constructor() {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.size = Math.random() * 2;
                this.brightness = Math.random();
            }

            draw() {
                ctx.fillStyle = `rgba(255, 255, 255, ${this.brightness})`;
                ctx.fillRect(this.x, this.y, this.size, this.size);
            }
        }

        // Initialize stars
        function initStars() {
            stars = [];
            for (let i = 0; i < 100; i++) {
                stars.push(new Star());
            }
        }

        // Spawn asteroids
        function spawnAsteroids(count) {
            for (let i = 0; i < count; i++) {
                let x, y;
                do {
                    x = Math.random() * canvas.width;
                    y = Math.random() * canvas.height;
                } while (ship && Math.hypot(x - ship.x, y - ship.y) < 150);

                asteroids.push(new Asteroid(x, y, 50));
            }
        }

        // Break asteroid
        function breakAsteroid(asteroid) {
            asteroidsDestroyed++;

            if (asteroid.size > 15) {
                const newSize = asteroid.size / 2;
                for (let i = 0; i < 2; i++) {
                    asteroids.push(new Asteroid(asteroid.x, asteroid.y, newSize));
                }
                score += 50;
            } else {
                score += 100;
            }

            // Create explosion particles using VibeLib
            for (let i = 0; i < 20; i++) {
                particles.push(VibeLib.game.createParticle(asteroid.x, asteroid.y, { color: '#f80', size: 3 }));
            }

            // Screen shake effect could be added here
        }

        // Fire bullet
        let lastShot = 0;
        function shoot() {
            const now = Date.now();
            if (now - lastShot > 250) { // Fire rate limit
                bullets.push(new Bullet(
                    ship.x + Math.cos(ship.angle) * ship.size,
                    ship.y + Math.sin(ship.angle) * ship.size,
                    ship.angle
                ));
                lastShot = now;
            }
        }

        // Update game
        function update() {
            if (!gameRunning || paused) return;

            // Update ship
            ship.update();

            // Update bullets
            bullets = bullets.filter(bullet => {
                bullet.update();
                return !bullet.isDead();
            });

            // Update asteroids
            asteroids.forEach(asteroid => asteroid.update());

            // Update particles
            particles = particles.filter(particle => {
                particle.update();
                return !particle.isDead();
            });

            // Check bullet-asteroid collisions
            for (let i = bullets.length - 1; i >= 0; i--) {
                for (let j = asteroids.length - 1; j >= 0; j--) {
                    if (asteroids[j].collidesWith(bullets[i])) {
                        breakAsteroid(asteroids[j]);
                        asteroids.splice(j, 1);
                        bullets.splice(i, 1);
                        break;
                    }
                }
            }

            // Check ship-asteroid collisions
            if (!ship.invincible) {
                for (let i = asteroids.length - 1; i >= 0; i--) {
                    if (asteroids[i].collidesWith(ship)) {
                        breakAsteroid(asteroids[i]);
                        asteroids.splice(i, 1);
                        lives--;
                        ship.makeInvincible();

                        // Create ship explosion using VibeLib
                        for (let j = 0; j < 30; j++) {
                            particles.push(VibeLib.game.createParticle(ship.x, ship.y, { color: '#0ff', size: 3 }));
                        }

                        if (lives <= 0) {
                            endGame();
                        }
                        updateUI();
                        break;
                    }
                }
            }

            // Level up when all asteroids destroyed
            if (asteroids.length === 0) {
                level++;
                showLevelUp();
                spawnAsteroids(3 + level);
                updateUI();
            }

            updateUI();
        }

        // Draw game
        function draw() {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.shadowBlur = 0;

            // Draw stars
            stars.forEach(star => star.draw());

            // Draw particles
            particles.forEach(particle => particle.draw());

            // Draw asteroids
            asteroids.forEach(asteroid => asteroid.draw());

            // Draw bullets
            bullets.forEach(bullet => bullet.draw());

            // Draw ship
            if (ship) ship.draw();

            // Draw pause text
            if (paused) {
                ctx.fillStyle = '#0ff';
                ctx.font = '48px Courier New';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.shadowBlur = 20;
                ctx.shadowColor = '#0ff';
                ctx.fillText('PAUSED', canvas.width / 2, canvas.height / 2);
            }
        }

        // Use VibeLib game loop
        const gameLoop = VibeLib.game.createGameLoop(
            (deltaTime) => update(),
            () => draw()
        );

        // Start game
        function startGame() {
            gameRunning = true;
            paused = false;
            score = 0;
            level = 1;
            lives = 3;
            asteroidsDestroyed = 0;

            ship = new Ship();
            bullets = [];
            asteroids = [];
            particles = [];

            initStars();
            spawnAsteroids(3);

            document.getElementById('gameOverScreen').classList.remove('show');
            updateUI();
            gameLoop.start();
        }

        // End game
        function endGame() {
            gameRunning = false;
            gameLoop.stop();
            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalLevel').textContent = level;
            document.getElementById('asteroidsDestroyed').textContent = asteroidsDestroyed;
            document.getElementById('gameOverScreen').classList.add('show');
        }

        // Update UI
        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('level').textContent = level;

            const livesContainer = document.getElementById('lives');
            livesContainer.innerHTML = '';
            for (let i = 0; i < lives; i++) {
                const lifeIcon = document.createElement('div');
                lifeIcon.className = 'life-icon';
                livesContainer.appendChild(lifeIcon);
            }
        }

        // Show level up
        function showLevelUp() {
            const levelUpEl = document.getElementById('levelUp');
            levelUpEl.textContent = `LEVEL ${level}`;
            levelUpEl.classList.add('show');
            setTimeout(() => {
                levelUpEl.classList.remove('show');
            }, 2000);
        }

        // Keyboard input - space and pause handling
        document.addEventListener('keydown', (e) => {
            if (e.key === ' ' && gameRunning && !paused) {
                e.preventDefault();
                shoot();
            }

            if (e.key === 'p' || e.key === 'P') {
                e.preventDefault();
                if (gameRunning) {
                    paused = !paused;
                    if (paused) {
                        gameLoop.pause();
                    } else {
                        gameLoop.resume();
                    }
                }
            }
        });

        // Start game on load
        startGame();
    </script>
</body>
</html>
