<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Dancing Whales</title>
  <link rel="icon" href="https://emojicdn.elk.sh/üêã">
  <meta name="description" content="Neon whales dance to ocean beats in the deep">
  <meta property="og:title" content="Dancing Whales">
  <meta property="og:description" content="Neon whales dance to ocean beats in the deep">
  <meta property="og:image" content="https://emojicdn.elk.sh/üêã?style=google">
  <meta property="og:url" content="https://sloppy.live/dancing-whales">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Comfortaa:wght@400;700&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #000510;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: 'Comfortaa', cursive;
      overflow: hidden;
      touch-action: none;
    }

    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      padding: 15px;
      text-align: center;
      z-index: 100;
      background: linear-gradient(180deg, rgba(0,5,20,0.9) 0%, transparent 100%);
    }

    h1 {
      font-size: 2rem;
      color: #00ddff;
      text-shadow: 0 0 30px #00aaff, 0 0 60px #0066ff;
      letter-spacing: 4px;
    }

    .beat-indicator {
      margin-top: 8px;
      height: 6px;
      width: 200px;
      margin-left: auto;
      margin-right: auto;
      background: #001122;
      border-radius: 3px;
      overflow: hidden;
    }

    .beat-bar {
      height: 100%;
      width: 0%;
      background: linear-gradient(90deg, #00ffff, #ff00ff);
      transition: width 0.05s;
    }

    #gameCanvas {
      display: block;
    }

    .instructions {
      position: fixed;
      bottom: 15px;
      left: 50%;
      transform: translateX(-50%);
      color: #0088aa;
      font-size: 0.9rem;
      text-align: center;
      text-shadow: 0 0 10px #006688;
    }

    .back-link {
      position: fixed;
      top: 10px;
      left: 10px;
      color: #00aacc;
      text-decoration: none;
      font-size: 0.9rem;
      opacity: 0.7;
      z-index: 101;
    }

    .start-screen {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 5, 20, 0.95);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 200;
      cursor: pointer;
    }

    .start-screen h2 {
      color: #00ddff;
      font-size: 2.5rem;
      text-shadow: 0 0 40px #00aaff;
      margin-bottom: 20px;
    }

    .start-text {
      color: #0088aa;
      font-size: 1.1rem;
      animation: pulse 2s ease-in-out infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 0.5; }
      50% { opacity: 1; }
    }
  </style>
</head>
<body>
  <a href="https://sloppy.live" class="back-link">‚Üê sloppy.live</a>

  <div class="start-screen" id="startScreen">
    <h2>üêã DANCING WHALES üêã</h2>
    <p class="start-text">Click to start the ocean beats</p>
  </div>

  <header>
    <h1>üêã DANCING WHALES üêã</h1>
    <div class="beat-indicator">
      <div class="beat-bar" id="beatBar"></div>
    </div>
  </header>

  <canvas id="gameCanvas"></canvas>

  <div class="instructions">Click/tap to make whales jump ‚Ä¢ They dance to the beat!</div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resize();
    window.addEventListener('resize', resize);

    // Audio
    let audioCtx = null;
    let isPlaying = false;
    let beatTime = 0;
    const BPM = 80;
    const BEAT_INTERVAL = 60 / BPM;

    // Whales
    const whales = [];
    const NUM_WHALES = 5;

    // Bubbles
    const bubbles = [];

    // Ocean particles
    const particles = [];

    class Whale {
      constructor(x, y, size, color, glowColor) {
        this.x = x;
        this.y = y;
        this.baseY = y;
        this.size = size;
        this.color = color;
        this.glowColor = glowColor;
        this.phase = Math.random() * Math.PI * 2;
        this.swimSpeed = 0.02 + Math.random() * 0.01;
        this.bobAmount = 20 + Math.random() * 15;
        this.tailAngle = 0;
        this.flipperAngle = 0;
        this.dancing = false;
        this.danceIntensity = 0;
        this.vx = (Math.random() - 0.5) * 0.5;
        this.vy = 0;
        this.rotation = 0;
      }

      update(beat) {
        this.phase += this.swimSpeed;

        // Base swimming motion
        this.y = this.baseY + Math.sin(this.phase) * this.bobAmount;
        this.x += this.vx;

        // Wrap around screen
        if (this.x < -this.size * 2) this.x = canvas.width + this.size * 2;
        if (this.x > canvas.width + this.size * 2) this.x = -this.size * 2;

        // Tail and flipper animation
        this.tailAngle = Math.sin(this.phase * 2) * 0.3;
        this.flipperAngle = Math.sin(this.phase * 1.5) * 0.2;

        // Dancing on beat
        if (beat) {
          this.dancing = true;
          this.danceIntensity = 1;
          this.vy = -8 - Math.random() * 4;
          this.rotation = (Math.random() - 0.5) * 0.3;

          // Spawn bubbles
          for (let i = 0; i < 5; i++) {
            bubbles.push({
              x: this.x + (Math.random() - 0.5) * this.size,
              y: this.y,
              size: 3 + Math.random() * 8,
              vy: -1 - Math.random() * 2,
              life: 1
            });
          }
        }

        // Apply dance physics
        if (this.dancing) {
          this.vy += 0.3;
          this.baseY += this.vy;

          // Return to base position
          if (this.baseY > this.y + this.bobAmount) {
            this.baseY = this.y + this.bobAmount;
            this.vy = 0;
            this.dancing = false;
          }

          this.danceIntensity *= 0.95;
          this.rotation *= 0.95;
        }
      }

      draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rotation);

        const scale = 1 + this.danceIntensity * 0.1;
        ctx.scale(scale, scale);

        // Glow
        ctx.shadowColor = this.glowColor;
        ctx.shadowBlur = 30 + this.danceIntensity * 20;

        // Body
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.ellipse(0, 0, this.size, this.size * 0.5, 0, 0, Math.PI * 2);
        ctx.fill();

        // Head
        ctx.beginPath();
        ctx.ellipse(this.size * 0.7, 0, this.size * 0.4, this.size * 0.35, 0, 0, Math.PI * 2);
        ctx.fill();

        // Tail
        ctx.save();
        ctx.translate(-this.size * 0.9, 0);
        ctx.rotate(this.tailAngle);
        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.quadraticCurveTo(-this.size * 0.5, -this.size * 0.4, -this.size * 0.7, -this.size * 0.3);
        ctx.quadraticCurveTo(-this.size * 0.4, 0, -this.size * 0.7, this.size * 0.3);
        ctx.quadraticCurveTo(-this.size * 0.5, this.size * 0.4, 0, 0);
        ctx.fill();
        ctx.restore();

        // Dorsal fin
        ctx.beginPath();
        ctx.moveTo(0, -this.size * 0.4);
        ctx.quadraticCurveTo(this.size * 0.1, -this.size * 0.8, this.size * 0.3, -this.size * 0.5);
        ctx.quadraticCurveTo(this.size * 0.2, -this.size * 0.4, 0, -this.size * 0.4);
        ctx.fill();

        // Flippers
        ctx.save();
        ctx.translate(this.size * 0.2, this.size * 0.3);
        ctx.rotate(this.flipperAngle);
        ctx.beginPath();
        ctx.ellipse(0, this.size * 0.2, this.size * 0.15, this.size * 0.35, 0.3, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();

        // Eye
        ctx.fillStyle = '#ffffff';
        ctx.shadowBlur = 10;
        ctx.beginPath();
        ctx.arc(this.size * 0.8, -this.size * 0.1, this.size * 0.08, 0, Math.PI * 2);
        ctx.fill();

        ctx.fillStyle = '#000';
        ctx.shadowBlur = 0;
        ctx.beginPath();
        ctx.arc(this.size * 0.82, -this.size * 0.1, this.size * 0.04, 0, Math.PI * 2);
        ctx.fill();

        // Belly stripe
        ctx.fillStyle = this.glowColor;
        ctx.globalAlpha = 0.3;
        ctx.beginPath();
        ctx.ellipse(this.size * 0.1, this.size * 0.2, this.size * 0.6, this.size * 0.15, 0, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalAlpha = 1;

        ctx.restore();
      }
    }

    // Initialize whales
    const whaleColors = [
      { body: '#0066ff', glow: '#00aaff' },
      { body: '#ff00aa', glow: '#ff66cc' },
      { body: '#00ffaa', glow: '#66ffcc' },
      { body: '#ffaa00', glow: '#ffcc66' },
      { body: '#aa00ff', glow: '#cc66ff' }
    ];

    function initWhales() {
      whales.length = 0;
      for (let i = 0; i < NUM_WHALES; i++) {
        const colors = whaleColors[i % whaleColors.length];
        whales.push(new Whale(
          100 + (canvas.width - 200) * (i / (NUM_WHALES - 1)),
          canvas.height * 0.3 + Math.random() * canvas.height * 0.4,
          50 + Math.random() * 30,
          colors.body,
          colors.glow
        ));
      }
    }

    // Ocean beat sounds
    function playBeat(intensity) {
      if (!audioCtx) return;

      // Deep bass drum
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();

      osc.type = 'sine';
      osc.frequency.setValueAtTime(60, audioCtx.currentTime);
      osc.frequency.exponentialRampToValueAtTime(30, audioCtx.currentTime + 0.2);

      gain.gain.setValueAtTime(0.5 * intensity, audioCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);

      osc.connect(gain);
      gain.connect(audioCtx.destination);

      osc.start();
      osc.stop(audioCtx.currentTime + 0.3);

      // Watery texture
      const noise = audioCtx.createOscillator();
      const noiseGain = audioCtx.createGain();
      const filter = audioCtx.createBiquadFilter();

      noise.type = 'triangle';
      noise.frequency.value = 200 + Math.random() * 100;

      filter.type = 'bandpass';
      filter.frequency.value = 400;
      filter.Q.value = 5;

      noiseGain.gain.setValueAtTime(0.15 * intensity, audioCtx.currentTime);
      noiseGain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.15);

      noise.connect(filter);
      filter.connect(noiseGain);
      noiseGain.connect(audioCtx.destination);

      noise.start();
      noise.stop(audioCtx.currentTime + 0.15);
    }

    function playMelody(note) {
      if (!audioCtx) return;

      const frequencies = [130.81, 164.81, 196, 220, 261.63, 329.63]; // C3 to E4
      const freq = frequencies[note % frequencies.length];

      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      const filter = audioCtx.createBiquadFilter();

      osc.type = 'sine';
      osc.frequency.value = freq;

      filter.type = 'lowpass';
      filter.frequency.value = 800;

      gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.8);

      osc.connect(filter);
      filter.connect(gain);
      gain.connect(audioCtx.destination);

      osc.start();
      osc.stop(audioCtx.currentTime + 0.8);
    }

    function playAmbientBubble() {
      if (!audioCtx) return;

      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();

      osc.type = 'sine';
      osc.frequency.setValueAtTime(800 + Math.random() * 400, audioCtx.currentTime);
      osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);

      gain.gain.setValueAtTime(0.05, audioCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);

      osc.connect(gain);
      gain.connect(audioCtx.destination);

      osc.start();
      osc.stop(audioCtx.currentTime + 0.1);
    }

    // Spawn ocean particles
    function spawnParticles() {
      if (particles.length < 100 && Math.random() < 0.1) {
        particles.push({
          x: Math.random() * canvas.width,
          y: canvas.height + 10,
          size: 1 + Math.random() * 3,
          speed: 0.5 + Math.random() * 1,
          wobble: Math.random() * Math.PI * 2,
          color: `hsl(${180 + Math.random() * 40}, 80%, ${50 + Math.random() * 30}%)`
        });
      }
    }

    function updateParticles() {
      for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        p.y -= p.speed;
        p.wobble += 0.05;
        p.x += Math.sin(p.wobble) * 0.5;

        if (p.y < -10) {
          particles.splice(i, 1);
        }
      }
    }

    function drawParticles() {
      particles.forEach(p => {
        ctx.fillStyle = p.color;
        ctx.globalAlpha = 0.6;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fill();
      });
      ctx.globalAlpha = 1;
    }

    function updateBubbles() {
      for (let i = bubbles.length - 1; i >= 0; i--) {
        const b = bubbles[i];
        b.y += b.vy;
        b.x += Math.sin(b.y * 0.05) * 0.5;
        b.life -= 0.015;

        if (b.life <= 0) {
          bubbles.splice(i, 1);
        }
      }
    }

    function drawBubbles() {
      bubbles.forEach(b => {
        ctx.save();
        ctx.globalAlpha = b.life * 0.6;
        ctx.strokeStyle = '#66ffff';
        ctx.lineWidth = 2;
        ctx.shadowColor = '#00ffff';
        ctx.shadowBlur = 10;
        ctx.beginPath();
        ctx.arc(b.x, b.y, b.size, 0, Math.PI * 2);
        ctx.stroke();

        // Highlight
        ctx.fillStyle = '#ffffff';
        ctx.beginPath();
        ctx.arc(b.x - b.size * 0.3, b.y - b.size * 0.3, b.size * 0.2, 0, Math.PI * 2);
        ctx.fill();
        ctx.restore();
      });
    }

    function drawBackground() {
      // Deep ocean gradient
      const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
      gradient.addColorStop(0, '#000520');
      gradient.addColorStop(0.5, '#001030');
      gradient.addColorStop(1, '#002040');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // Light rays from above
      ctx.save();
      for (let i = 0; i < 5; i++) {
        const x = canvas.width * (0.2 + i * 0.15);
        const gradient2 = ctx.createLinearGradient(x, 0, x + 100, canvas.height);
        gradient2.addColorStop(0, 'rgba(100, 200, 255, 0.1)');
        gradient2.addColorStop(1, 'rgba(100, 200, 255, 0)');
        ctx.fillStyle = gradient2;
        ctx.beginPath();
        ctx.moveTo(x, 0);
        ctx.lineTo(x + 150, canvas.height);
        ctx.lineTo(x + 50, canvas.height);
        ctx.lineTo(x - 50, 0);
        ctx.closePath();
        ctx.fill();
      }
      ctx.restore();
    }

    // Beat tracking
    let lastBeatTime = 0;
    let beatCount = 0;

    function checkBeat() {
      if (!isPlaying) return false;

      const currentTime = audioCtx.currentTime;
      const timeSinceLastBeat = currentTime - lastBeatTime;

      // Update beat bar
      const beatProgress = (timeSinceLastBeat / BEAT_INTERVAL) * 100;
      document.getElementById('beatBar').style.width = `${Math.min(beatProgress, 100)}%`;

      if (timeSinceLastBeat >= BEAT_INTERVAL) {
        lastBeatTime = currentTime;
        beatCount++;

        // Play sounds
        playBeat(1);

        // Play melody on every 4th beat
        if (beatCount % 4 === 0) {
          playMelody(Math.floor(beatCount / 4));
        }

        // Random ambient bubble
        if (Math.random() < 0.3) {
          playAmbientBubble();
        }

        return true;
      }
      return false;
    }

    // User interaction
    function onUserInteraction() {
      whales.forEach(whale => {
        whale.dancing = true;
        whale.danceIntensity = 1;
        whale.vy = -10 - Math.random() * 5;
        whale.rotation = (Math.random() - 0.5) * 0.4;

        // Extra bubbles
        for (let i = 0; i < 8; i++) {
          bubbles.push({
            x: whale.x + (Math.random() - 0.5) * whale.size,
            y: whale.y,
            size: 5 + Math.random() * 10,
            vy: -2 - Math.random() * 3,
            life: 1
          });
        }
      });

      playBeat(1.5);
    }

    canvas.addEventListener('click', onUserInteraction);
    canvas.addEventListener('touchstart', (e) => {
      e.preventDefault();
      onUserInteraction();
    });

    // Start screen
    document.getElementById('startScreen').addEventListener('click', () => {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      isPlaying = true;
      lastBeatTime = audioCtx.currentTime;
      document.getElementById('startScreen').style.display = 'none';
      initWhales();
    });

    // Game loop
    function gameLoop() {
      drawBackground();

      spawnParticles();
      updateParticles();
      drawParticles();

      const beat = checkBeat();

      // Update whales
      whales.forEach(whale => {
        whale.update(beat);
      });

      // Draw whales (sorted by Y for depth)
      whales.sort((a, b) => a.y - b.y);
      whales.forEach(whale => whale.draw());

      updateBubbles();
      drawBubbles();

      requestAnimationFrame(gameLoop);
    }

    initWhales();
    gameLoop();
  </script>
</body>
</html>
