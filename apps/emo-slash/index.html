<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EMO SLASH</title>
  <link rel="icon" href="https://emojicdn.elk.sh/ðŸ–¤">
  <meta name="description" content="Slash through dramatic emo lyrics in this rhythm game">
  <meta property="og:title" content="EMO SLASH">
  <meta property="og:description" content="Slash the pain away. A rhythm game for your dark soul.">
  <meta property="og:url" content="https://app.sloppy.live/emo-slash">
  <meta property="og:image" content="https://app.sloppy.live/emo-slash/og-image.png">
  <link href="https://fonts.googleapis.com/css2?family=Permanent+Marker&family=Rock+Salt&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      user-select: none;
    }

    body {
      min-height: 100vh;
      background: #0a0a0a;
      overflow: hidden;
      font-family: 'Permanent Marker', cursive;
      cursor: crosshair;
    }

    .vignette {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(ellipse at center, transparent 40%, rgba(0,0,0,0.8) 100%);
      pointer-events: none;
      z-index: 100;
    }

    .scanlines {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: repeating-linear-gradient(
        0deg,
        transparent,
        transparent 2px,
        rgba(0,0,0,0.1) 2px,
        rgba(0,0,0,0.1) 4px
      );
      pointer-events: none;
      z-index: 101;
    }

    #gameCanvas {
      display: block;
      width: 100vw;
      height: 100vh;
    }

    .ui-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      z-index: 50;
      pointer-events: none;
    }

    .score-panel {
      text-align: left;
    }

    .score {
      font-size: 48px;
      color: #ff1493;
      text-shadow: 0 0 20px #ff1493, 0 0 40px #ff1493;
    }

    .combo {
      font-size: 24px;
      color: #00ffff;
      text-shadow: 0 0 10px #00ffff;
    }

    .combo.fire {
      animation: comboPulse 0.2s ease;
    }

    @keyframes comboPulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.3); }
    }

    .stats-panel {
      text-align: right;
    }

    .accuracy {
      font-size: 20px;
      color: #888;
    }

    .multiplier {
      font-size: 28px;
      color: #ff6b00;
      text-shadow: 0 0 15px #ff6b00;
    }

    .start-screen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(180deg, #0a0a0a 0%, #1a0a1a 50%, #0a0a0a 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 200;
    }

    .start-screen h1 {
      font-family: 'Rock Salt', cursive;
      font-size: 72px;
      color: #ff1493;
      text-shadow:
        0 0 20px #ff1493,
        0 0 40px #ff1493,
        4px 4px 0 #000;
      margin-bottom: 10px;
      letter-spacing: 5px;
    }

    .start-screen .subtitle {
      font-size: 18px;
      color: #666;
      margin-bottom: 50px;
      letter-spacing: 3px;
    }

    .start-btn {
      padding: 20px 60px;
      font-family: 'Permanent Marker', cursive;
      font-size: 28px;
      background: transparent;
      border: 3px solid #ff1493;
      color: #ff1493;
      cursor: pointer;
      transition: all 0.2s;
      text-shadow: 0 0 10px #ff1493;
      box-shadow: 0 0 20px rgba(255, 20, 147, 0.3);
    }

    .start-btn:hover {
      background: #ff1493;
      color: #000;
      box-shadow: 0 0 40px rgba(255, 20, 147, 0.6);
    }

    .instructions {
      margin-top: 40px;
      text-align: center;
      color: #555;
      font-size: 14px;
      line-height: 2;
    }

    .instructions span {
      color: #00ffff;
    }

    .game-over {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.95);
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 200;
    }

    .game-over.show {
      display: flex;
    }

    .game-over h2 {
      font-family: 'Rock Salt', cursive;
      font-size: 48px;
      color: #ff1493;
      text-shadow: 0 0 30px #ff1493;
      margin-bottom: 30px;
    }

    .final-score {
      font-size: 72px;
      color: #fff;
      text-shadow: 0 0 20px #fff;
      margin-bottom: 10px;
    }

    .final-stats {
      color: #888;
      font-size: 18px;
      margin-bottom: 40px;
    }

    .rating {
      font-size: 36px;
      margin-bottom: 30px;
    }

    .slash-effect {
      position: fixed;
      pointer-events: none;
      z-index: 90;
    }

    .hit-text {
      position: fixed;
      font-size: 24px;
      pointer-events: none;
      z-index: 90;
      animation: hitFloat 0.6s ease forwards;
    }

    .hit-text.perfect {
      color: #ff1493;
      text-shadow: 0 0 20px #ff1493;
    }

    .hit-text.good {
      color: #00ffff;
      text-shadow: 0 0 15px #00ffff;
    }

    .hit-text.miss {
      color: #ff0000;
      text-shadow: 0 0 10px #ff0000;
    }

    @keyframes hitFloat {
      0% { transform: translateY(0) scale(1); opacity: 1; }
      100% { transform: translateY(-50px) scale(1.5); opacity: 0; }
    }

    .backlink {
      position: fixed;
      bottom: 15px;
      right: 15px;
      color: #333;
      text-decoration: none;
      font-size: 12px;
      z-index: 300;
      font-family: sans-serif;
    }

    .backlink:hover {
      color: #ff1493;
    }

    @media (max-width: 600px) {
      .start-screen h1 { font-size: 42px; }
      .score { font-size: 32px; }
      .combo { font-size: 18px; }
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>

  <div class="vignette"></div>
  <div class="scanlines"></div>

  <div class="ui-overlay" id="gameUI" style="display: none;">
    <div class="score-panel">
      <div class="score" id="score">0</div>
      <div class="combo" id="combo"></div>
    </div>
    <div class="stats-panel">
      <div class="multiplier" id="multiplier">x1</div>
      <div class="accuracy" id="accuracy">100%</div>
    </div>
  </div>

  <div class="start-screen" id="startScreen">
    <h1>EMO SLASH</h1>
    <p class="subtitle">slash the pain away</p>
    <button class="start-btn" onclick="startGame()">BEGIN SUFFERING</button>
    <div class="instructions">
      <span>Click/Tap</span> lyrics as they cross the line<br>
      <span>Perfect</span> timing = more points<br>
      Build combos. Embrace the darkness.
    </div>
  </div>

  <div class="game-over" id="gameOver">
    <h2>SILENCE...</h2>
    <div class="final-score" id="finalScore">0</div>
    <div class="final-stats" id="finalStats">0 perfect | 0 good | 0 missed</div>
    <div class="rating" id="rating"></div>
    <button class="start-btn" onclick="startGame()">SUFFER AGAIN</button>
  </div>

  <a href="https://sloppy.live" class="backlink">sloppy.live</a>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    // Resize canvas
    function resize() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    resize();
    window.addEventListener('resize', resize);

    // Original parody emo lyrics - intentionally over-the-top
    const lyrics = [
      "my heart is a void",
      "tears of mascara",
      "nobody understands",
      "darkness is my friend",
      "screaming into nothing",
      "my soul bleeds poetry",
      "rain on my window pain",
      "black is my happy color",
      "feelings are overrated",
      "drowning in emotions",
      "my diary knows all",
      "razor sharp memories",
      "broken like my playlist",
      "suffering aesthetically",
      "crying in the bathroom",
      "too deep for this world",
      "my tears are vintage",
      "pain is art",
      "emotionally unavailable",
      "dead inside but caffeinated",
      "sadness is a lifestyle",
      "born to suffer",
      "feelings dot exe crashed",
      "my vibe is despair",
      "existential crisis mode",
      "chaos in eyeliner",
      "dramatic sigh",
      "spiraling gracefully",
      "melancholy aesthetic",
      "brooding intensifies",
      "inner demons on shuffle",
      "tragedy is my brand",
      "poetically damaged",
      "too sad to function",
      "vibing with the void"
    ];

    let gameState = 'menu';
    let score = 0;
    let combo = 0;
    let maxCombo = 0;
    let perfectHits = 0;
    let goodHits = 0;
    let misses = 0;
    let multiplier = 1;
    let fallingLyrics = [];
    let lastSpawn = 0;
    let spawnInterval = 1200;
    let hitLineY = 0;
    let gameStartTime = 0;
    let gameDuration = 60000; // 60 seconds

    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function playSlashSound(perfect) {
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.connect(gain);
      gain.connect(audioCtx.destination);

      if (perfect) {
        osc.type = 'sawtooth';
        osc.frequency.setValueAtTime(800, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(200, audioCtx.currentTime + 0.1);
      } else {
        osc.type = 'square';
        osc.frequency.setValueAtTime(400, audioCtx.currentTime);
        osc.frequency.exponentialRampToValueAtTime(150, audioCtx.currentTime + 0.08);
      }

      gain.gain.setValueAtTime(0.15, audioCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.12);
      osc.start();
      osc.stop(audioCtx.currentTime + 0.12);
    }

    function playMissSound() {
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      osc.type = 'sine';
      osc.frequency.setValueAtTime(150, audioCtx.currentTime);
      osc.frequency.exponentialRampToValueAtTime(50, audioCtx.currentTime + 0.2);
      gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.2);
      osc.start();
      osc.stop(audioCtx.currentTime + 0.2);
    }

    function spawnLyric() {
      const text = lyrics[Math.floor(Math.random() * lyrics.length)];
      const lyric = {
        text: text,
        x: 100 + Math.random() * (canvas.width - 200),
        y: -50,
        speed: 2 + Math.random() * 1.5,
        width: 0,
        height: 40,
        hit: false,
        missed: false,
        opacity: 1
      };

      // Measure text width
      ctx.font = '28px "Permanent Marker"';
      lyric.width = ctx.measureText(text).width + 40;

      fallingLyrics.push(lyric);
    }

    function showHitText(x, y, type) {
      const div = document.createElement('div');
      div.className = 'hit-text ' + type;
      div.textContent = type === 'perfect' ? 'PERFECT' : type === 'good' ? 'GOOD' : 'MISS';
      div.style.left = x + 'px';
      div.style.top = y + 'px';
      document.body.appendChild(div);
      setTimeout(() => div.remove(), 600);
    }

    function createSlashEffect(x, y) {
      const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
      svg.setAttribute('class', 'slash-effect');
      svg.setAttribute('width', '100');
      svg.setAttribute('height', '100');
      svg.style.left = (x - 50) + 'px';
      svg.style.top = (y - 50) + 'px';

      const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
      const angle = Math.random() * 60 - 30;
      line.setAttribute('x1', '10');
      line.setAttribute('y1', '90');
      line.setAttribute('x2', '90');
      line.setAttribute('y2', '10');
      line.setAttribute('stroke', '#ff1493');
      line.setAttribute('stroke-width', '4');
      line.setAttribute('stroke-linecap', 'round');
      line.style.filter = 'drop-shadow(0 0 10px #ff1493)';
      line.style.transform = `rotate(${angle}deg)`;
      line.style.transformOrigin = 'center';

      svg.appendChild(line);
      document.body.appendChild(svg);

      svg.animate([
        { opacity: 1, transform: 'scale(1)' },
        { opacity: 0, transform: 'scale(1.5)' }
      ], { duration: 300 }).onfinish = () => svg.remove();
    }

    function handleClick(e) {
      if (gameState !== 'playing') return;

      const rect = canvas.getBoundingClientRect();
      const clickX = e.clientX || e.touches[0].clientX;
      const clickY = e.clientY || e.touches[0].clientY;

      // Check if clicked on a lyric near the hit line
      for (let lyric of fallingLyrics) {
        if (lyric.hit || lyric.missed) continue;

        const lyricCenterY = lyric.y + lyric.height / 2;
        const distanceFromLine = Math.abs(lyricCenterY - hitLineY);

        // Check if click is on the lyric
        if (clickX >= lyric.x - lyric.width/2 &&
            clickX <= lyric.x + lyric.width/2 &&
            clickY >= lyric.y &&
            clickY <= lyric.y + lyric.height) {

          lyric.hit = true;
          createSlashEffect(clickX, clickY);

          if (distanceFromLine < 30) {
            // Perfect
            perfectHits++;
            score += 100 * multiplier;
            combo++;
            playSlashSound(true);
            showHitText(clickX, clickY, 'perfect');
          } else if (distanceFromLine < 80) {
            // Good
            goodHits++;
            score += 50 * multiplier;
            combo++;
            playSlashSound(false);
            showHitText(clickX, clickY, 'good');
          } else {
            // Too early/late
            misses++;
            combo = 0;
            playMissSound();
            showHitText(clickX, clickY, 'miss');
          }

          if (combo > maxCombo) maxCombo = combo;
          multiplier = Math.floor(combo / 10) + 1;
          if (multiplier > 4) multiplier = 4;

          updateUI();
          return;
        }
      }
    }

    canvas.addEventListener('click', handleClick);
    canvas.addEventListener('touchstart', (e) => {
      e.preventDefault();
      handleClick(e);
    });

    function updateUI() {
      document.getElementById('score').textContent = score;
      const comboEl = document.getElementById('combo');
      if (combo > 2) {
        comboEl.textContent = combo + ' COMBO';
        comboEl.classList.add('fire');
        setTimeout(() => comboEl.classList.remove('fire'), 200);
      } else {
        comboEl.textContent = '';
      }
      document.getElementById('multiplier').textContent = 'x' + multiplier;

      const total = perfectHits + goodHits + misses;
      const acc = total > 0 ? Math.round(((perfectHits + goodHits) / total) * 100) : 100;
      document.getElementById('accuracy').textContent = acc + '%';
    }

    function update() {
      if (gameState !== 'playing') return;

      const now = Date.now();
      const elapsed = now - gameStartTime;

      // Check game over
      if (elapsed >= gameDuration) {
        endGame();
        return;
      }

      // Speed up over time
      spawnInterval = Math.max(600, 1200 - elapsed / 100);

      // Spawn new lyrics
      if (now - lastSpawn > spawnInterval) {
        spawnLyric();
        lastSpawn = now;
      }

      // Update lyrics
      for (let i = fallingLyrics.length - 1; i >= 0; i--) {
        const lyric = fallingLyrics[i];

        if (lyric.hit) {
          lyric.opacity -= 0.15;
          if (lyric.opacity <= 0) {
            fallingLyrics.splice(i, 1);
          }
        } else {
          lyric.y += lyric.speed;

          // Check if missed
          if (lyric.y > hitLineY + 100 && !lyric.missed) {
            lyric.missed = true;
            misses++;
            combo = 0;
            multiplier = 1;
            playMissSound();
            showHitText(lyric.x, hitLineY, 'miss');
            updateUI();
          }

          // Remove if off screen
          if (lyric.y > canvas.height + 50) {
            fallingLyrics.splice(i, 1);
          }
        }
      }
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Background gradient
      const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
      gradient.addColorStop(0, '#0a0a0a');
      gradient.addColorStop(0.5, '#150515');
      gradient.addColorStop(1, '#0a0a0a');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      if (gameState !== 'playing') return;

      // Hit line
      hitLineY = canvas.height * 0.75;
      ctx.strokeStyle = 'rgba(255, 20, 147, 0.5)';
      ctx.lineWidth = 2;
      ctx.setLineDash([20, 10]);
      ctx.beginPath();
      ctx.moveTo(0, hitLineY);
      ctx.lineTo(canvas.width, hitLineY);
      ctx.stroke();
      ctx.setLineDash([]);

      // Perfect zone indicator
      ctx.fillStyle = 'rgba(255, 20, 147, 0.1)';
      ctx.fillRect(0, hitLineY - 30, canvas.width, 60);

      // Draw lyrics
      for (const lyric of fallingLyrics) {
        ctx.save();
        ctx.globalAlpha = lyric.opacity;

        // Glow
        ctx.shadowColor = lyric.hit ? '#ff1493' : '#00ffff';
        ctx.shadowBlur = lyric.hit ? 30 : 15;

        // Background
        ctx.fillStyle = lyric.hit ? 'rgba(255, 20, 147, 0.3)' : 'rgba(0, 255, 255, 0.1)';
        ctx.fillRect(lyric.x - lyric.width/2, lyric.y, lyric.width, lyric.height);

        // Border
        ctx.strokeStyle = lyric.hit ? '#ff1493' : '#00ffff';
        ctx.lineWidth = lyric.hit ? 3 : 1;
        ctx.strokeRect(lyric.x - lyric.width/2, lyric.y, lyric.width, lyric.height);

        // Text
        ctx.font = '28px "Permanent Marker"';
        ctx.fillStyle = '#fff';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        ctx.fillText(lyric.text, lyric.x, lyric.y + lyric.height/2);

        ctx.restore();
      }

      // Timer bar
      const elapsed = Date.now() - gameStartTime;
      const remaining = Math.max(0, 1 - elapsed / gameDuration);
      ctx.fillStyle = '#333';
      ctx.fillRect(50, 20, canvas.width - 100, 8);
      ctx.fillStyle = '#ff1493';
      ctx.fillRect(50, 20, (canvas.width - 100) * remaining, 8);
    }

    function gameLoop() {
      update();
      draw();
      requestAnimationFrame(gameLoop);
    }

    function startGame() {
      document.getElementById('startScreen').style.display = 'none';
      document.getElementById('gameOver').classList.remove('show');
      document.getElementById('gameUI').style.display = 'flex';

      gameState = 'playing';
      score = 0;
      combo = 0;
      maxCombo = 0;
      perfectHits = 0;
      goodHits = 0;
      misses = 0;
      multiplier = 1;
      fallingLyrics = [];
      gameStartTime = Date.now();
      lastSpawn = 0;

      updateUI();

      if (audioCtx.state === 'suspended') {
        audioCtx.resume();
      }
    }

    function endGame() {
      gameState = 'gameover';
      document.getElementById('gameUI').style.display = 'none';

      document.getElementById('finalScore').textContent = score;
      document.getElementById('finalStats').textContent =
        `${perfectHits} perfect | ${goodHits} good | ${misses} missed | ${maxCombo} max combo`;

      // Rating
      const total = perfectHits + goodHits + misses;
      const accuracy = total > 0 ? (perfectHits + goodHits) / total : 0;
      let rating = '';
      if (accuracy >= 0.95 && perfectHits > goodHits) rating = 'ðŸ–¤ðŸ–¤ðŸ–¤ TRUE EMO';
      else if (accuracy >= 0.85) rating = 'ðŸ–¤ðŸ–¤ SCENE KID';
      else if (accuracy >= 0.7) rating = 'ðŸ–¤ POSER';
      else rating = 'ðŸ’” NORMIE';
      document.getElementById('rating').textContent = rating;

      document.getElementById('gameOver').classList.add('show');
    }

    gameLoop();
  </script>
<script src="/apps/sloppy-header/sloppy-bar.js"></script>
<script src="/vibelib-extended.js"></script>
<script>
  // Compatibility Patch for Legacy Apps
  window.addEventListener("load", () => {
    if (window.SloppyKarma && window.VibeLib.Economy) {
      // Redirect old calls to new engine
      window.SloppyKarma.track = window.VibeLib.Economy.track;
    }
  });
</script>
</body>
</html>
