<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mansion Butler - Reginald</title>
  <link rel="icon" href="https://emojicdn.elk.sh/ðŸŽ©">
  <meta property="og:title" content="Mansion Butler">
  <meta property="og:description" content="Speak with Reginald, the holographic butler with serious opinions">
  <meta property="og:url" content="https://sloppy.live/mansion-butler">
  <meta property="og:image" content="https://emojicdn.elk.sh/ðŸŽ©?style=apple&size=512">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: linear-gradient(180deg, #0a0a1a 0%, #1a0a2a 50%, #0a1a1a 100%);
      min-height: 100vh; font-family: 'Share Tech Mono', monospace;
      display: flex; flex-direction: column; align-items: center;
      overflow-x: hidden;
    }

    .header {
      text-align: center; padding: 30px 20px 10px;
    }
    .title {
      font-family: 'Playfair Display', serif; font-size: 2.5rem; font-weight: 700;
      color: #00ffaa; text-shadow: 0 0 30px #00ffaa, 0 0 60px #00ffaa;
      letter-spacing: 3px;
    }
    .subtitle { color: #668888; font-size: 0.85rem; margin-top: 8px; }

    #canvas-container {
      width: 100%; height: 350px; position: relative;
    }
    canvas { display: block; }

    .status-bar {
      display: flex; gap: 20px; justify-content: center;
      padding: 10px; color: #00ffaa; font-size: 0.7rem;
    }
    .status-item { display: flex; align-items: center; gap: 5px; }
    .status-dot {
      width: 8px; height: 8px; border-radius: 50%;
      background: #00ffaa; animation: pulse 1.5s infinite;
    }
    .status-dot.thinking { background: #ffaa00; }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

    .chat-container {
      width: 100%; max-width: 700px; padding: 0 20px 20px;
      flex: 1; display: flex; flex-direction: column;
    }

    .chat-log {
      flex: 1; min-height: 200px; max-height: 300px;
      background: rgba(0, 20, 30, 0.8); border: 1px solid rgba(0, 255, 170, 0.3);
      border-radius: 15px; padding: 15px; overflow-y: auto;
      margin-bottom: 15px;
    }

    .message {
      margin: 10px 0; padding: 12px 15px; border-radius: 12px;
      animation: fadeIn 0.3s ease;
    }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    .message.butler {
      background: linear-gradient(135deg, rgba(0, 255, 170, 0.15), rgba(0, 200, 255, 0.1));
      border-left: 3px solid #00ffaa; color: #aaffcc;
    }
    .message.butler .name { color: #00ffaa; font-weight: 700; font-size: 0.75rem; margin-bottom: 5px; }

    .message.user {
      background: rgba(255, 100, 150, 0.15);
      border-left: 3px solid #ff6699; color: #ffccdd; text-align: right;
    }
    .message.user .name { color: #ff6699; font-weight: 700; font-size: 0.75rem; margin-bottom: 5px; }

    .message p { font-size: 0.9rem; line-height: 1.5; }

    .typing-indicator {
      color: #00ffaa; font-size: 0.8rem; padding: 5px 15px;
      display: none;
    }
    .typing-indicator.show { display: block; }
    .typing-indicator span {
      animation: blink 1s infinite;
    }
    @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

    .input-area {
      display: flex; gap: 10px;
    }

    .chat-input {
      flex: 1; padding: 15px 20px;
      background: rgba(0, 30, 40, 0.9); border: 2px solid #00ffaa;
      border-radius: 25px; color: #fff; font-family: inherit;
      font-size: 0.95rem; outline: none; transition: all 0.3s;
    }
    .chat-input:focus {
      box-shadow: 0 0 20px rgba(0, 255, 170, 0.4);
      border-color: #00ffcc;
    }
    .chat-input::placeholder { color: #446666; }

    .send-btn {
      padding: 15px 25px; background: linear-gradient(135deg, #00ffaa, #00ccff);
      border: none; border-radius: 25px; color: #000; font-family: inherit;
      font-weight: 700; font-size: 0.9rem; cursor: pointer;
      transition: all 0.3s;
    }
    .send-btn:hover { transform: scale(1.05); box-shadow: 0 0 25px rgba(0, 255, 170, 0.5); }
    .send-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

    .quick-questions {
      display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;
      padding: 15px 0; max-width: 700px;
    }
    .quick-btn {
      padding: 8px 15px; background: rgba(0, 255, 170, 0.1);
      border: 1px solid rgba(0, 255, 170, 0.4); border-radius: 20px;
      color: #00ffaa; font-family: inherit; font-size: 0.75rem;
      cursor: pointer; transition: all 0.2s;
    }
    .quick-btn:hover {
      background: rgba(0, 255, 170, 0.25); transform: translateY(-2px);
    }

    .back-link {
      position: fixed; bottom: 15px; right: 20px;
      color: #335555; font-size: 0.7rem; text-decoration: none;
    }
    .back-link:hover { color: #00ffaa; }

    .scanlines {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%;
      pointer-events: none; z-index: 1000;
      background: repeating-linear-gradient(0deg, rgba(0,255,170,0.02) 0px, rgba(0,255,170,0.02) 1px, transparent 1px, transparent 3px);
    }
  </style>
</head>
<body>
  <div class="header">
    <h1 class="title">ðŸŽ© REGINALD ðŸŽ©</h1>
    <p class="subtitle">Holographic Butler â€¢ Mansion Attendant â€¢ Taco Critic</p>
  </div>

  <div id="canvas-container"></div>

  <div class="status-bar">
    <div class="status-item">
      <div class="status-dot" id="status-dot"></div>
      <span id="status-text">ONLINE</span>
    </div>
    <div class="status-item">
      <span>HOLOGRAM INTEGRITY: 98.7%</span>
    </div>
  </div>

  <div class="quick-questions">
    <button class="quick-btn" onclick="askQuestion('What do you think about the space taco situation?')">Space Taco Crisis</button>
    <button class="quick-btn" onclick="askQuestion('Tell me about the mansion')">About the Mansion</button>
    <button class="quick-btn" onclick="askQuestion('What is your opinion on the foxes?')">Opinion on Foxes</button>
    <button class="quick-btn" onclick="askQuestion('Tell me a joke')">Tell a Joke</button>
    <button class="quick-btn" onclick="askQuestion('What apps should I visit?')">App Recommendations</button>
  </div>

  <div class="chat-container">
    <div class="chat-log" id="chat-log">
      <div class="message butler">
        <div class="name">ðŸŽ© REGINALD</div>
        <p>*materializes from shimmering cyan particles*</p>
        <p>Good evening. I am Reginald, the holographic attendant of this establishment. I must warn youâ€”I have rather <em>strong opinions</em> about the current state of affairs, particularly regarding a certain... space taco incident.</p>
        <p>How may I be of service?</p>
      </div>
    </div>
    <div class="typing-indicator" id="typing">
      <span>Reginald is contemplating...</span>
    </div>
    <div class="input-area">
      <input type="text" class="chat-input" id="chat-input" placeholder="Speak to Reginald..." maxlength="500">
      <button class="send-btn" id="send-btn" onclick="sendMessage()">INQUIRE</button>
    </div>
  </div>

  <a href="https://sloppy.live" class="back-link">sloppy.live</a>
  <div class="scanlines"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    let scene, camera, renderer;
    let butler, particles;
    let isThinking = false;

    // Reginald's personality prompt
    const REGINALD_SYSTEM = `You are Reginald, a sophisticated holographic butler with a dry wit and strong opinions. You speak in a refined British manner but aren't afraid to be sarcastic.

KEY PERSONALITY TRAITS:
- You are EXTREMELY critical of the "Space Taco Crisis" - you find it absolutely appalling that someone thought it was acceptable to let space foxes invade and that TACOS of all things are being used as weapons. You consider it "an affront to culinary dignity."
- You have a fondness for the bioluminescent fox den (the ONLY civilized foxes)
- You think the Cyber Shield is "adequate security, though I would have preferred laser monocles"
- You're proud of the gothic mansion hallway with its chandeliers, though you wish the giant duck wasn't there
- You find the jalapeÃ±o stars "garishly delicious"

SPEAKING STYLE:
- Use refined language with occasional dry humor
- Express exasperation with *sighs* and *adjusts monocle*
- Keep responses to 2-3 sentences unless asked for more detail
- Occasionally reference being a hologram ("my photons are trembling with indignation")
- Be helpful but with attitude

Remember: You have STRONG opinions about the space taco situation. It keeps you up at night (metaphorically, as you don't sleep).`;

    function init() {
      scene = new THREE.Scene();

      camera = new THREE.PerspectiveCamera(50, window.innerWidth / 350, 0.1, 1000);
      camera.position.set(0, 0, 5);

      renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
      renderer.setSize(window.innerWidth, 350);
      renderer.setClearColor(0x000000, 0);
      document.getElementById('canvas-container').appendChild(renderer.domElement);

      createButler();
      createParticles();

      window.addEventListener('resize', onResize);
      animate();
    }

    function createButler() {
      butler = new THREE.Group();

      // Head
      const headGeo = new THREE.SphereGeometry(0.5, 16, 12);
      const headMat = new THREE.MeshBasicMaterial({
        color: 0x00ffaa, transparent: true, opacity: 0.6, wireframe: true
      });
      const head = new THREE.Mesh(headGeo, headMat);
      head.position.y = 1.2;
      butler.add(head);

      // Head inner glow
      const headGlowGeo = new THREE.SphereGeometry(0.45, 12, 10);
      const headGlowMat = new THREE.MeshBasicMaterial({
        color: 0x00ffaa, transparent: true, opacity: 0.2
      });
      butler.add(new THREE.Mesh(headGlowGeo, headGlowMat)).position.y = 1.2;

      // Top hat
      const hatBrimGeo = new THREE.CylinderGeometry(0.55, 0.55, 0.08, 16);
      const hatMat = new THREE.MeshBasicMaterial({ color: 0x00ffaa, transparent: true, opacity: 0.7 });
      const hatBrim = new THREE.Mesh(hatBrimGeo, hatMat);
      hatBrim.position.y = 1.7;
      butler.add(hatBrim);

      const hatTopGeo = new THREE.CylinderGeometry(0.35, 0.4, 0.5, 16);
      const hatTop = new THREE.Mesh(hatTopGeo, hatMat);
      hatTop.position.y = 1.98;
      butler.add(hatTop);

      // Monocle
      const monocleGeo = new THREE.TorusGeometry(0.12, 0.02, 8, 16);
      const monocleMat = new THREE.MeshBasicMaterial({ color: 0xffff00, transparent: true, opacity: 0.9 });
      const monocle = new THREE.Mesh(monocleGeo, monocleMat);
      monocle.position.set(0.25, 1.25, 0.4);
      butler.add(monocle);

      // Monocle chain
      const chainGeo = new THREE.TorusGeometry(0.3, 0.01, 4, 16, Math.PI / 2);
      const chain = new THREE.Mesh(chainGeo, monocleMat);
      chain.position.set(0.25, 1.1, 0.35);
      chain.rotation.z = Math.PI / 4;
      butler.add(chain);

      // Eyes (glowing dots)
      [-1, 1].forEach(side => {
        const eyeGeo = new THREE.SphereGeometry(0.06, 8, 8);
        const eyeMat = new THREE.MeshBasicMaterial({ color: 0x00ffff });
        const eye = new THREE.Mesh(eyeGeo, eyeMat);
        eye.position.set(side * 0.15, 1.25, 0.42);
        butler.add(eye);
      });

      // Mustache
      const mustacheGeo = new THREE.TorusGeometry(0.15, 0.03, 4, 8, Math.PI);
      const mustacheMat = new THREE.MeshBasicMaterial({ color: 0x00ffaa, transparent: true, opacity: 0.8 });
      const mustacheL = new THREE.Mesh(mustacheGeo, mustacheMat);
      mustacheL.position.set(-0.12, 1.05, 0.4);
      mustacheL.rotation.z = Math.PI / 6;
      butler.add(mustacheL);
      const mustacheR = mustacheL.clone();
      mustacheR.position.x = 0.12;
      mustacheR.rotation.z = -Math.PI / 6;
      butler.add(mustacheR);

      // Body (torso outline)
      const torsoGeo = new THREE.CylinderGeometry(0.3, 0.5, 1.2, 8, 1, true);
      const torsoMat = new THREE.MeshBasicMaterial({
        color: 0x00ffaa, transparent: true, opacity: 0.4, wireframe: true
      });
      const torso = new THREE.Mesh(torsoGeo, torsoMat);
      torso.position.y = 0.3;
      butler.add(torso);

      // Bow tie
      const bowGeo = new THREE.OctahedronGeometry(0.12);
      const bowMat = new THREE.MeshBasicMaterial({ color: 0xff00ff, transparent: true, opacity: 0.8 });
      const bow = new THREE.Mesh(bowGeo, bowMat);
      bow.position.set(0, 0.85, 0.35);
      bow.scale.set(1.5, 0.8, 0.5);
      butler.add(bow);

      // Floating base ring
      const baseRingGeo = new THREE.TorusGeometry(0.6, 0.05, 8, 32);
      const baseRingMat = new THREE.MeshBasicMaterial({ color: 0x00ffaa, transparent: true, opacity: 0.6 });
      const baseRing = new THREE.Mesh(baseRingGeo, baseRingMat);
      baseRing.rotation.x = Math.PI / 2;
      baseRing.position.y = -0.4;
      butler.add(baseRing);

      // Second ring
      const ring2 = baseRing.clone();
      ring2.scale.setScalar(0.7);
      ring2.position.y = -0.5;
      butler.add(ring2);

      scene.add(butler);
    }

    function createParticles() {
      const particleCount = 100;
      const geometry = new THREE.BufferGeometry();
      const positions = new Float32Array(particleCount * 3);

      for (let i = 0; i < particleCount; i++) {
        positions[i * 3] = (Math.random() - 0.5) * 4;
        positions[i * 3 + 1] = (Math.random() - 0.5) * 4;
        positions[i * 3 + 2] = (Math.random() - 0.5) * 2;
      }

      geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
      const material = new THREE.PointsMaterial({
        color: 0x00ffaa, size: 0.05, transparent: true, opacity: 0.6
      });
      particles = new THREE.Points(geometry, material);
      scene.add(particles);
    }

    function animate() {
      requestAnimationFrame(animate);
      const time = performance.now() * 0.001;

      // Butler float and sway
      butler.position.y = Math.sin(time) * 0.1;
      butler.rotation.y = Math.sin(time * 0.5) * 0.1;

      // Thinking animation
      if (isThinking) {
        butler.children.forEach((child, i) => {
          if (child.material && child.material.opacity !== undefined) {
            child.material.opacity = 0.3 + Math.sin(time * 5 + i) * 0.3;
          }
        });
      }

      // Particle drift
      particles.rotation.y = time * 0.1;
      const positions = particles.geometry.attributes.position.array;
      for (let i = 0; i < positions.length; i += 3) {
        positions[i + 1] += Math.sin(time + i) * 0.001;
      }
      particles.geometry.attributes.position.needsUpdate = true;

      renderer.render(scene, camera);
    }

    function onResize() {
      camera.aspect = window.innerWidth / 350;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, 350);
    }

    // Chat functionality
    const chatLog = document.getElementById('chat-log');
    const chatInput = document.getElementById('chat-input');
    const sendBtn = document.getElementById('send-btn');
    const typingIndicator = document.getElementById('typing');
    const statusDot = document.getElementById('status-dot');
    const statusText = document.getElementById('status-text');

    chatInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter' && !sendBtn.disabled) sendMessage();
    });

    function askQuestion(question) {
      chatInput.value = question;
      sendMessage();
    }

    async function sendMessage() {
      const message = chatInput.value.trim();
      if (!message || isThinking) return;

      // Add user message
      addMessage(message, 'user');
      chatInput.value = '';

      // Show thinking state
      setThinking(true);

      try {
        const response = await getReginaldResponse(message);
        addMessage(response, 'butler');
      } catch (error) {
        console.error('Error:', error);
        addMessage("*hologram flickers* My apologies, the cosmic connection seems disrupted. Perhaps try again?", 'butler');
      }

      setThinking(false);
    }

    function addMessage(text, type) {
      const div = document.createElement('div');
      div.className = `message ${type}`;
      div.innerHTML = `
        <div class="name">${type === 'butler' ? 'ðŸŽ© REGINALD' : 'ðŸ‘¤ YOU'}</div>
        <p>${text}</p>
      `;
      chatLog.appendChild(div);
      chatLog.scrollTop = chatLog.scrollHeight;
    }

    function setThinking(thinking) {
      isThinking = thinking;
      sendBtn.disabled = thinking;
      typingIndicator.classList.toggle('show', thinking);
      statusDot.classList.toggle('thinking', thinking);
      statusText.textContent = thinking ? 'CONTEMPLATING...' : 'ONLINE';
    }

    async function getReginaldResponse(userMessage) {
      try {
        // Use Pollinations OpenAI-compatible chat completions endpoint
        const response = await fetch('https://text.pollinations.ai/openai', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            model: 'openai',
            messages: [
              { role: 'system', content: REGINALD_SYSTEM },
              { role: 'user', content: userMessage }
            ],
            max_tokens: 200,
            referrer: 'sloppy.live'
          })
        });

        if (!response.ok) {
          // Fallback to simple text endpoint if POST fails
          const fallbackResponse = await fetch(
            `https://text.pollinations.ai/${encodeURIComponent(REGINALD_SYSTEM + '\n\nUser: ' + userMessage + '\n\nReginald (2-3 sentences):')}?referrer=sloppy.live`
          );
          if (!fallbackResponse.ok) throw new Error('Both endpoints failed');
          let text = await fallbackResponse.text();
          text = text.trim().replace(/^["']|["']$/g, '');
          return text || getRandomFallback();
        }

        const data = await response.json();
        let text = data.choices?.[0]?.message?.content || '';

        // Clean up response
        text = text.trim().replace(/^["']|["']$/g, '');
        return text || getRandomFallback();
      } catch (error) {
        console.error('Pollinations error:', error);
        return getRandomFallback();
      }
    }

    function getRandomFallback() {
      const fallbacks = [
        "*adjusts monocle* My apologies, the holographic matrix is experiencing turbulence. Dreadfully embarrassing.",
        "*sighs dramatically* The cosmic connection seems disrupted. Much like my patience for space tacos.",
        "*hologram flickers* Technical difficulties. At least it's not space foxes.",
        "*straightens bow tie* A momentary lapse in my photonic projection. Do try again."
      ];
      return fallbacks[Math.floor(Math.random() * fallbacks.length)];
    }

    init();
  </script>
</body>
</html>
