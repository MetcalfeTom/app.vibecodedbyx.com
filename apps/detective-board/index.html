<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Detective Evidence Board</title>
  <link rel="icon" href="https://emojicdn.elk.sh/üîç">
  <meta name="description" content="Connect the dots. Find the truth. Red string included.">
  <meta property="og:title" content="Detective Evidence Board">
  <meta property="og:description" content="Connect the dots. Find the truth. Red string included.">
  <meta property="og:image" content="https://emojicdn.elk.sh/üîç?style=google">
  <meta property="og:url" content="https://sloppy.live/detective-board">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Special+Elite&family=Permanent+Marker&display=swap');

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      min-height: 100vh;
      background: #2a2018;
      font-family: 'Special Elite', monospace;
      overflow: hidden;
    }

    .back-link {
      position: fixed;
      top: 10px;
      left: 15px;
      color: rgba(255,255,255,0.3);
      text-decoration: none;
      font-size: 0.7rem;
      z-index: 1000;
    }

    .board {
      width: 100vw;
      height: 100vh;
      background:
        repeating-linear-gradient(
          0deg,
          transparent,
          transparent 20px,
          rgba(0,0,0,0.1) 20px,
          rgba(0,0,0,0.1) 21px
        ),
        repeating-linear-gradient(
          90deg,
          transparent,
          transparent 20px,
          rgba(0,0,0,0.1) 20px,
          rgba(0,0,0,0.1) 21px
        ),
        #4a3728;
      position: relative;
    }

    /* Cork texture */
    .board::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
      opacity: 0.15;
      pointer-events: none;
    }

    svg#strings {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 5;
    }

    .string-line {
      stroke: #c41e3a;
      stroke-width: 2;
      fill: none;
      filter: drop-shadow(0 1px 2px rgba(0,0,0,0.5));
    }

    .evidence {
      position: absolute;
      cursor: grab;
      z-index: 10;
      transition: transform 0.1s, box-shadow 0.2s;
    }

    .evidence:hover {
      z-index: 100;
      transform: scale(1.05) rotate(0deg) !important;
    }

    .evidence.dragging {
      cursor: grabbing;
      z-index: 200;
      box-shadow: 0 15px 40px rgba(0,0,0,0.5);
    }

    .photo {
      width: 140px;
      background: #fff;
      padding: 8px 8px 25px 8px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.4);
    }

    .photo-inner {
      width: 100%;
      height: 100px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem;
      background: linear-gradient(135deg, #f5f5f5 0%, #e0e0e0 100%);
    }

    .photo-label {
      font-family: 'Permanent Marker', cursive;
      font-size: 0.7rem;
      color: #333;
      margin-top: 8px;
      text-align: center;
    }

    .pin {
      position: absolute;
      top: -8px;
      left: 50%;
      transform: translateX(-50%);
      width: 20px;
      height: 20px;
      background: radial-gradient(circle at 30% 30%, #ff6b6b, #c41e3a);
      border-radius: 50%;
      box-shadow: 0 2px 5px rgba(0,0,0,0.4);
      z-index: 15;
    }

    .note {
      width: 120px;
      min-height: 100px;
      padding: 15px;
      background: #ffffa5;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      font-size: 0.75rem;
      line-height: 1.4;
      color: #333;
    }

    .note.pink { background: #ffb5c5; }
    .note.blue { background: #b5d4ff; }
    .note.green { background: #b5ffb5; }

    .clipping {
      width: 160px;
      background: #f8f4e8;
      padding: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      border: 1px solid #ccc;
    }

    .clipping-header {
      font-family: 'Times New Roman', serif;
      font-size: 0.65rem;
      font-weight: bold;
      border-bottom: 1px solid #999;
      padding-bottom: 5px;
      margin-bottom: 8px;
      text-transform: uppercase;
    }

    .clipping-text {
      font-family: 'Times New Roman', serif;
      font-size: 0.6rem;
      line-height: 1.3;
      color: #333;
    }

    .toolbar {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      padding: 12px 20px;
      background: rgba(0,0,0,0.8);
      border-radius: 30px;
      z-index: 500;
    }

    .tool-btn {
      padding: 10px 18px;
      background: transparent;
      border: 1px solid #c41e3a;
      border-radius: 20px;
      color: #c41e3a;
      font-family: 'Special Elite', monospace;
      font-size: 0.75rem;
      cursor: pointer;
      transition: all 0.2s;
    }

    .tool-btn:hover {
      background: #c41e3a;
      color: #fff;
    }

    .tool-btn.active {
      background: #c41e3a;
      color: #fff;
    }

    .title-banner {
      position: fixed;
      top: 15px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.7);
      padding: 10px 30px;
      border-radius: 5px;
      z-index: 500;
    }

    .title-text {
      font-family: 'Permanent Marker', cursive;
      font-size: 1.2rem;
      color: #c41e3a;
      text-transform: uppercase;
      letter-spacing: 3px;
    }

    .question-mark {
      position: fixed;
      font-size: 15rem;
      color: rgba(196,30,58,0.1);
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-family: 'Permanent Marker', cursive;
      pointer-events: none;
      z-index: 1;
    }

    .connect-hint {
      position: fixed;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      color: rgba(255,255,255,0.5);
      font-size: 0.7rem;
      z-index: 500;
      display: none;
    }

    .connect-hint.visible {
      display: block;
    }
  </style>
</head>
<body>
  <a href="https://sloppy.live" class="back-link">‚Üê close case</a>

  <div class="title-banner">
    <div class="title-text">üîç Case File #2026</div>
  </div>

  <div class="connect-hint" id="connectHint">Click two items to connect them with red string</div>

  <div class="board" id="board">
    <div class="question-mark">?</div>
    <svg id="strings"></svg>
  </div>

  <div class="toolbar">
    <button class="tool-btn" onclick="toggleConnectMode()">üßµ Connect</button>
    <button class="tool-btn" onclick="addPhoto()">üì∑ Photo</button>
    <button class="tool-btn" onclick="addNote()">üìù Note</button>
    <button class="tool-btn" onclick="clearStrings()">‚úÇÔ∏è Cut All</button>
    <button class="tool-btn" onclick="resetBoard()">üóëÔ∏è Reset</button>
  </div>

  <script>
    const board = document.getElementById('board');
    const stringSvg = document.getElementById('strings');
    let evidence = [];
    let connections = [];
    let connectMode = false;
    let connectStart = null;
    let dragTarget = null;
    let dragOffset = { x: 0, y: 0 };
    let idCounter = 0;

    const initialEvidence = [
      { type: 'photo', emoji: 'üéâ', label: 'Class Reunion 2015', x: 100, y: 120, rotate: -3 },
      { type: 'photo', emoji: 'üç∏', label: 'Cocktail Party', x: 300, y: 100, rotate: 2 },
      { type: 'photo', emoji: 'üë∂', label: 'The Nursery', x: 550, y: 130, rotate: -2 },
      { type: 'photo', emoji: 'üíç', label: 'The Ring', x: 180, y: 320, rotate: 4 },
      { type: 'photo', emoji: 'ü•Ç', label: 'Champagne Toast', x: 420, y: 350, rotate: -1 },
      { type: 'photo', emoji: 'üè†', label: 'New House Keys', x: 650, y: 300, rotate: 3 },
      { type: 'note', text: 'Timeline doesn\'t add up... 9 months before the nursery reveal?', color: 'yellow', x: 750, y: 120, rotate: 2 },
      { type: 'note', text: 'WHO was at both events?!', color: 'pink', x: 80, y: 480, rotate: -2 },
      { type: 'note', text: 'Check guest list from reunion', color: 'blue', x: 300, y: 500, rotate: 1 },
      { type: 'clipping', header: 'Society Pages', text: 'Local couple announces surprise pregnancy at intimate gathering. Friends "shocked but delighted."', x: 520, y: 480, rotate: -1 },
      { type: 'photo', emoji: 'ü§î', label: 'Suspicious Glance', x: 800, y: 400, rotate: -3 },
      { type: 'photo', emoji: 'üì±', label: 'The Text Messages', x: 150, y: 180, rotate: 1 },
    ];

    const initialConnections = [
      [0, 1], // Reunion to Cocktails
      [1, 2], // Cocktails to Nursery
      [0, 3], // Reunion to Ring
      [3, 4], // Ring to Champagne
      [4, 5], // Champagne to House
      [2, 5], // Nursery to House
      [1, 4], // Cocktails to Champagne
    ];

    function createEvidence(data) {
      const id = idCounter++;
      const el = document.createElement('div');
      el.className = 'evidence';
      el.dataset.id = id;
      el.style.left = data.x + 'px';
      el.style.top = data.y + 'px';
      el.style.transform = `rotate(${data.rotate || 0}deg)`;

      if (data.type === 'photo') {
        el.innerHTML = `
          <div class="pin"></div>
          <div class="photo">
            <div class="photo-inner">${data.emoji}</div>
            <div class="photo-label">${data.label}</div>
          </div>
        `;
      } else if (data.type === 'note') {
        const colorClass = data.color === 'pink' ? 'pink' : data.color === 'blue' ? 'blue' : data.color === 'green' ? 'green' : '';
        el.innerHTML = `
          <div class="pin"></div>
          <div class="note ${colorClass}">${data.text}</div>
        `;
      } else if (data.type === 'clipping') {
        el.innerHTML = `
          <div class="pin"></div>
          <div class="clipping">
            <div class="clipping-header">${data.header}</div>
            <div class="clipping-text">${data.text}</div>
          </div>
        `;
      }

      el.addEventListener('mousedown', startDrag);
      el.addEventListener('touchstart', startDrag, { passive: false });
      el.addEventListener('click', handleClick);

      board.appendChild(el);
      evidence.push({ id, el, data });
      return id;
    }

    function startDrag(e) {
      if (connectMode) return;

      e.preventDefault();
      const el = e.currentTarget;
      dragTarget = el;
      el.classList.add('dragging');

      const rect = el.getBoundingClientRect();
      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;

      dragOffset.x = clientX - rect.left;
      dragOffset.y = clientY - rect.top;
    }

    function doDrag(e) {
      if (!dragTarget) return;

      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;

      dragTarget.style.left = (clientX - dragOffset.x) + 'px';
      dragTarget.style.top = (clientY - dragOffset.y) + 'px';

      updateStrings();
    }

    function endDrag() {
      if (dragTarget) {
        dragTarget.classList.remove('dragging');
        dragTarget = null;
      }
    }

    function handleClick(e) {
      if (!connectMode) return;

      const el = e.currentTarget;
      const id = parseInt(el.dataset.id);

      if (connectStart === null) {
        connectStart = id;
        el.style.outline = '3px solid #c41e3a';
      } else {
        if (connectStart !== id) {
          addConnection(connectStart, id);
        }
        document.querySelectorAll('.evidence').forEach(e => e.style.outline = '');
        connectStart = null;
      }
    }

    function addConnection(id1, id2) {
      // Check if connection exists
      const exists = connections.some(c =>
        (c[0] === id1 && c[1] === id2) || (c[0] === id2 && c[1] === id1)
      );
      if (!exists) {
        connections.push([id1, id2]);
        updateStrings();
      }
    }

    function updateStrings() {
      stringSvg.innerHTML = '';

      connections.forEach(([id1, id2]) => {
        const ev1 = evidence.find(e => e.id === id1);
        const ev2 = evidence.find(e => e.id === id2);
        if (!ev1 || !ev2) return;

        const rect1 = ev1.el.getBoundingClientRect();
        const rect2 = ev2.el.getBoundingClientRect();

        const x1 = rect1.left + rect1.width / 2;
        const y1 = rect1.top + 10; // Pin position
        const x2 = rect2.left + rect2.width / 2;
        const y2 = rect2.top + 10;

        // Create slightly curved line
        const midX = (x1 + x2) / 2;
        const midY = (y1 + y2) / 2 - 20;

        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
        path.setAttribute('d', `M ${x1} ${y1} Q ${midX} ${midY} ${x2} ${y2}`);
        path.setAttribute('class', 'string-line');
        stringSvg.appendChild(path);
      });
    }

    function toggleConnectMode() {
      connectMode = !connectMode;
      document.querySelector('.tool-btn').classList.toggle('active', connectMode);
      document.getElementById('connectHint').classList.toggle('visible', connectMode);
      connectStart = null;
      document.querySelectorAll('.evidence').forEach(e => e.style.outline = '');
    }

    function addPhoto() {
      const emojis = ['üì∏', 'üïµÔ∏è', 'üöó', '‚úàÔ∏è', 'üè®', 'üíã', 'üåπ', 'üìß', '‚òéÔ∏è', 'üîë'];
      const labels = ['Unknown Subject', 'Evidence #' + (evidence.length + 1), 'Need ID', 'Location TBD', 'Suspicious'];

      createEvidence({
        type: 'photo',
        emoji: emojis[Math.floor(Math.random() * emojis.length)],
        label: labels[Math.floor(Math.random() * labels.length)],
        x: 100 + Math.random() * 600,
        y: 100 + Math.random() * 400,
        rotate: (Math.random() - 0.5) * 10
      });
    }

    function addNote() {
      const colors = ['yellow', 'pink', 'blue', 'green'];
      const texts = [
        'Need to verify this...',
        'IMPORTANT!!!',
        'Follow up on this lead',
        'Something doesn\'t add up',
        'Who benefits?',
        'Check alibis'
      ];

      createEvidence({
        type: 'note',
        text: texts[Math.floor(Math.random() * texts.length)],
        color: colors[Math.floor(Math.random() * colors.length)],
        x: 100 + Math.random() * 600,
        y: 100 + Math.random() * 400,
        rotate: (Math.random() - 0.5) * 10
      });
    }

    function clearStrings() {
      connections = [];
      updateStrings();
    }

    function resetBoard() {
      evidence.forEach(e => e.el.remove());
      evidence = [];
      connections = [];
      idCounter = 0;
      stringSvg.innerHTML = '';
      initBoard();
    }

    function initBoard() {
      const ids = initialEvidence.map(data => createEvidence(data));
      initialConnections.forEach(([i, j]) => {
        connections.push([ids[i], ids[j]]);
      });
      setTimeout(updateStrings, 100);
    }

    // Event listeners
    document.addEventListener('mousemove', doDrag);
    document.addEventListener('mouseup', endDrag);
    document.addEventListener('touchmove', doDrag, { passive: false });
    document.addEventListener('touchend', endDrag);
    window.addEventListener('resize', updateStrings);

    // Initialize
    initBoard();
  </script>
<script src="/sloppy-header/sloppy-bar.js"></script>
</body>
</html>
