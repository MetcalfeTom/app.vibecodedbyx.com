<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>RAPTOR & GASSY</title>
  <link rel="icon" href="https://emojicdn.elk.sh/ðŸ¦–">
  <meta property="og:title" content="RAPTOR & GASSY">
  <meta property="og:description" content="Feed your utahraptor peanut butter and defend with toxic gas clouds!">
  <meta property="og:image" content="https://app.sloppy.live/raptor-pet/og-image.png">
  <meta property="og:url" content="https://app.sloppy.live/raptor-pet">
  <link href="https://fonts.googleapis.com/css2?family=Bangers&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: linear-gradient(180deg, #1a0a2e 0%, #0d1b0d 100%);
      min-height: 100vh;
      font-family: 'Bangers', cursive;
      color: #fff;
      overflow: hidden;
      user-select: none;
    }

    #gameCanvas {
      display: block;
      margin: 0 auto;
    }

    .ui {
      position: fixed;
      top: 15px;
      left: 50%;
      transform: translateX(-50%);
      text-align: center;
      z-index: 100;
    }

    h1 {
      font-size: 2.2em;
      letter-spacing: 4px;
      background: linear-gradient(90deg, #0f0, #0ff, #f0f);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      text-shadow: 0 0 30px rgba(0, 255, 0, 0.5);
      margin-bottom: 10px;
    }

    .stats {
      display: flex;
      gap: 30px;
      justify-content: center;
      font-size: 1.1em;
      letter-spacing: 2px;
    }

    .stat {
      padding: 8px 15px;
      background: rgba(0, 0, 0, 0.5);
      border-radius: 20px;
      border: 2px solid;
    }

    .stat.size { border-color: #f80; color: #f80; }
    .stat.peanuts { border-color: #c90; color: #c90; }
    .stat.gas { border-color: #0f0; color: #0f0; }
    .stat.score { border-color: #0ff; color: #0ff; }
    .stat.bombs { border-color: #f44; color: #f44; }
    .stat.invincible { border-color: #f0f; color: #f0f; animation: invinciblePulse 0.5s infinite; display: none; }
    @keyframes invinciblePulse { 0%, 100% { box-shadow: 0 0 10px #f0f; } 50% { box-shadow: 0 0 25px #f0f; } }

    .controls {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 15px;
      z-index: 100;
    }

    .btn {
      padding: 15px 25px;
      font-family: inherit;
      font-size: 1.1em;
      letter-spacing: 2px;
      border: 3px solid;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.2s;
      background: rgba(0, 0, 0, 0.6);
    }

    .btn.feed {
      border-color: #c90;
      color: #c90;
    }

    .btn.feed:hover:not(:disabled) {
      background: #c90;
      color: #000;
      box-shadow: 0 0 30px #c90;
    }

    .btn.gas {
      border-color: #0f0;
      color: #0f0;
    }

    .btn.gas:hover:not(:disabled) {
      background: #0f0;
      color: #000;
      box-shadow: 0 0 30px #0f0;
    }

    .btn.bomb {
      border-color: #f44;
      color: #f44;
    }

    .btn.bomb:hover:not(:disabled) {
      background: #f44;
      color: #000;
      box-shadow: 0 0 30px #f44;
    }

    .btn:disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }

    .instructions {
      position: fixed;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 0.9em;
      color: #666;
      letter-spacing: 1px;
      text-align: center;
    }

    .game-over {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      z-index: 200;
    }

    .game-over h2 {
      font-size: 3em;
      color: #f00;
      margin-bottom: 20px;
      text-shadow: 0 0 30px #f00;
    }

    .game-over .final-score {
      font-size: 1.5em;
      color: #0ff;
      margin-bottom: 30px;
    }

    .game-over button {
      padding: 15px 40px;
      font-family: inherit;
      font-size: 1.2em;
      background: #0f0;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      color: #000;
    }

    .backlink {
      position: fixed;
      bottom: 5px;
      right: 10px;
      color: #333;
      text-decoration: none;
      font-size: 0.7em;
      z-index: 100;
    }

    @media (max-width: 600px) {
      h1 { font-size: 1.5em; }
      .stats { font-size: 0.8em; gap: 10px; }
      .btn { padding: 12px 18px; font-size: 0.9em; }
    }
  </style>
</head>
<body>
  <div class="ui">
    <h1>RAPTOR & GASSY</h1>
    <div class="stats">
      <div class="stat size">SIZE: <span id="sizeVal">1.0</span>x</div>
      <div class="stat peanuts">PEANUTS: <span id="peanutsVal">5</span></div>
      <div class="stat gas">GAS: <span id="gasVal">100</span>%</div>
      <div class="stat bombs">BOMBS: <span id="bombsVal">0</span></div>
      <div class="stat score">SCORE: <span id="scoreVal">0</span></div>
      <div class="stat invincible" id="invincibleStat">SLOPPY'S DRIP! <span id="invincibleTime">0</span>s</div>
    </div>
  </div>

  <canvas id="gameCanvas"></canvas>

  <div class="instructions">CLICK = peanut butter | SPACE = gas | B = sail bomb | Collect SLOPPY'S CLOTHES for invincibility!</div>

  <div class="controls">
    <button class="btn feed" id="feedBtn" onclick="dropPeanutButter()">ðŸ¥œ PEANUT BUTTER</button>
    <button class="btn gas" id="gasBtn" onclick="sprayGas()">ðŸ’¨ GAS CLOUD</button>
    <button class="btn bomb" id="bombBtn" onclick="throwBomb()">â›µðŸ’£ SAIL BOMB</button>
  </div>

  <div class="game-over" id="gameOver">
    <h2>RAPTOR DOWN!</h2>
    <div class="final-score">Final Size: <span id="finalSize">1.0</span>x | Score: <span id="finalScore">0</span></div>
    <button onclick="restartGame()">TRY AGAIN</button>
  </div>

  <a href="https://sloppy.live" class="backlink">sloppy.live</a>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    let width, height;
    let gameRunning = true;
    let score = 0;
    let peanutCount = 5;
    let gasLevel = 100;
    let bombCount = 0;
    let invincibleTime = 0;
    let hasSloppyClothes = false;

    // Raptor state
    const raptor = {
      x: 0,
      y: 0,
      size: 1.0,
      targetX: 0,
      targetY: 0,
      frame: 0,
      eating: false,
      eatTimer: 0,
      stunned: false,
      stunTimer: 0
    };

    // Gassy ally
    const gassy = {
      x: 0,
      y: 0,
      frame: 0,
      spraying: false,
      sprayTimer: 0
    };

    // Game objects
    let peanutButters = [];
    let bullets = [];
    let gasClouds = [];
    let particles = [];
    let sailBombs = [];
    let sloppyClothesItems = [];
    let moleRats = [];
    let featherClouds = [];
    let giraffes = [];
    let giraffeFarts = [];

    function resize() {
      width = canvas.width = window.innerWidth;
      height = canvas.height = window.innerHeight;
      raptor.x = width * 0.5;
      raptor.y = height * 0.6;
      raptor.targetX = raptor.x;
      raptor.targetY = raptor.y;
      gassy.x = width * 0.25;
      gassy.y = height * 0.65;
    }

    function dropPeanutButter() {
      if (peanutCount <= 0 || !gameRunning) return;
      peanutCount--;

      // Drop at random position near raptor
      const pb = {
        x: raptor.x + (Math.random() - 0.5) * 200,
        y: 100,
        vy: 2,
        size: 30,
        eaten: false
      };
      peanutButters.push(pb);
      updateUI();
    }

    function sprayGas() {
      if (gasLevel < 20 || !gameRunning) return;
      gasLevel -= 20;
      gassy.spraying = true;
      gassy.sprayTimer = 60;

      // Create gas cloud
      const cloud = {
        x: gassy.x + 80,
        y: gassy.y,
        radius: 60,
        life: 180,
        maxLife: 180
      };
      gasClouds.push(cloud);

      // Particles
      for (let i = 0; i < 20; i++) {
        particles.push({
          x: gassy.x + 60,
          y: gassy.y + Math.random() * 40 - 20,
          vx: Math.random() * 4 + 2,
          vy: (Math.random() - 0.5) * 3,
          size: Math.random() * 15 + 5,
          life: 60,
          color: `hsl(${100 + Math.random() * 40}, 100%, 50%)`
        });
      }
      updateUI();
    }

    function throwBomb() {
      if (bombCount <= 0 || !gameRunning) return;
      bombCount--;

      const bomb = {
        x: raptor.x,
        y: raptor.y - 30,
        vx: 8,
        vy: -5,
        rotation: 0,
        exploded: false
      };
      sailBombs.push(bomb);
      updateUI();
    }

    function spawnSloppyClothes() {
      if (Math.random() < 0.003 && gameRunning && !hasSloppyClothes) {
        const clothes = {
          x: width + 30,
          y: Math.random() * (height - 300) + 150,
          vx: -2,
          bob: Math.random() * Math.PI * 2
        };
        sloppyClothesItems.push(clothes);
      }
    }

    function spawnBombPickup() {
      if (Math.random() < 0.008 && gameRunning) {
        const bombPickup = {
          x: width + 20,
          y: Math.random() * (height - 300) + 150,
          vx: -2.5,
          isBombPickup: true
        };
        peanutButters.push(bombPickup);
      }
    }

    function spawnBullet() {
      if (!gameRunning) return;

      const bullet = {
        x: width + 20,
        y: Math.random() * (height - 200) + 100,
        vx: -4 - Math.random() * 3 - score / 500,
        size: 8
      };
      bullets.push(bullet);
    }

    function spawnMoleRat() {
      // Spawn mole rats occasionally, more as score increases
      const spawnChance = 0.003 + score / 50000;
      if (Math.random() < spawnChance && gameRunning && moleRats.length < 3) {
        const side = Math.random() < 0.5 ? -1 : 1;
        const moleRat = {
          x: side === 1 ? width + 40 : -40,
          y: height - 80,
          vx: side === -1 ? 1.5 : -1.5,
          direction: side === -1 ? 1 : -1,
          frame: 0,
          burpTimer: 120 + Math.random() * 120,
          burping: false,
          burpAnimTimer: 0,
          hp: 2
        };
        moleRats.push(moleRat);
      }
    }

    function spawnGiraffe() {
      // Spawn giraffes rarely, increasing with score
      const spawnChance = 0.002 + score / 80000;
      if (Math.random() < spawnChance && gameRunning && giraffes.length < 2) {
        const side = Math.random() < 0.5 ? -1 : 1;
        const giraffe = {
          x: side === 1 ? width + 60 : -60,
          y: height - 120,
          vx: side === -1 ? 1.2 : -1.2,
          direction: side === -1 ? 1 : -1,
          frame: 0,
          fartTimer: 100 + Math.random() * 100,
          farting: false,
          fartAnimTimer: 0,
          lickTimer: 200 + Math.random() * 150,
          licking: false,
          lickAnimTimer: 0,
          tongueX: 0,
          tongueY: 0,
          hp: 3
        };
        giraffes.push(giraffe);
      }
    }

    function spawnPeanutPickup() {
      if (Math.random() < 0.01 && gameRunning) {
        const pb = {
          x: width + 20,
          y: Math.random() * (height - 300) + 150,
          vx: -2,
          size: 25,
          isPickup: true
        };
        peanutButters.push(pb);
      }
    }

    function update() {
      if (!gameRunning) return;

      // Update invincibility
      if (invincibleTime > 0) {
        invincibleTime -= 1/60;
        if (invincibleTime <= 0) {
          invincibleTime = 0;
          hasSloppyClothes = false;
        }
        updateUI();
      }

      // Update sail bombs
      for (let i = sailBombs.length - 1; i >= 0; i--) {
        const bomb = sailBombs[i];
        bomb.x += bomb.vx;
        bomb.vy += 0.2;
        bomb.y += bomb.vy;
        bomb.rotation += 0.1;

        // Check if bomb hits ground or goes off screen - explode
        if (bomb.y > height - 60 || bomb.x > width + 50) {
          // Explosion - destroy nearby bullets
          const explosionRadius = 150;
          for (let j = bullets.length - 1; j >= 0; j--) {
            const bullet = bullets[j];
            const dist = Math.hypot(bullet.x - bomb.x, bullet.y - bomb.y);
            if (dist < explosionRadius) {
              bullets.splice(j, 1);
              score += 15;
            }
          }
          // Explosion particles
          for (let k = 0; k < 30; k++) {
            const angle = (k / 30) * Math.PI * 2;
            particles.push({
              x: bomb.x,
              y: Math.min(bomb.y, height - 60),
              vx: Math.cos(angle) * (Math.random() * 8 + 2),
              vy: Math.sin(angle) * (Math.random() * 8 + 2),
              size: Math.random() * 12 + 5,
              life: 50,
              color: ['#f44', '#f80', '#ff0'][Math.floor(Math.random() * 3)]
            });
          }
          sailBombs.splice(i, 1);
          updateUI();
        }
      }

      // Update sloppy's clothes items
      for (let i = sloppyClothesItems.length - 1; i >= 0; i--) {
        const clothes = sloppyClothesItems[i];
        clothes.x += clothes.vx;
        clothes.bob += 0.05;

        // Check if raptor catches it
        const dist = Math.hypot(clothes.x - raptor.x, clothes.y - raptor.y);
        if (dist < 60 * raptor.size) {
          hasSloppyClothes = true;
          invincibleTime = 10; // 10 seconds of invincibility
          score += 500;
          // Sparkle particles
          for (let j = 0; j < 20; j++) {
            particles.push({
              x: clothes.x,
              y: clothes.y,
              vx: (Math.random() - 0.5) * 8,
              vy: (Math.random() - 0.5) * 8,
              size: Math.random() * 10 + 5,
              life: 60,
              color: '#f0f'
            });
          }
          sloppyClothesItems.splice(i, 1);
          updateUI();
          continue;
        }

        if (clothes.x < -50) {
          sloppyClothesItems.splice(i, 1);
        }
      }

      // Raptor movement toward peanut butter (not when stunned!)
      if (!raptor.stunned) {
        let nearestPB = null;
        let nearestDist = Infinity;
        for (const pb of peanutButters) {
          if (pb.eaten || pb.isPickup) continue;
          const dist = Math.hypot(pb.x - raptor.x, pb.y - raptor.y);
          if (dist < nearestDist) {
            nearestDist = dist;
            nearestPB = pb;
          }
        }

        if (nearestPB && !raptor.eating) {
          raptor.targetX = nearestPB.x;
          raptor.targetY = nearestPB.y;
        }

        // Move raptor
        raptor.x += (raptor.targetX - raptor.x) * 0.05;
        raptor.y += (raptor.targetY - raptor.y) * 0.05;
      }

      // Raptor eating animation
      if (raptor.eating) {
        raptor.eatTimer--;
        if (raptor.eatTimer <= 0) {
          raptor.eating = false;
        }
      }

      // Animate raptor
      raptor.frame += 0.1;

      // Update peanut butters
      for (let i = peanutButters.length - 1; i >= 0; i--) {
        const pb = peanutButters[i];

        if (pb.isPickup || pb.isBombPickup) {
          pb.x += pb.vx;
          // Check if raptor catches it
          const dist = Math.hypot(pb.x - raptor.x, pb.y - raptor.y);
          if (dist < 50 * raptor.size) {
            if (pb.isBombPickup) {
              bombCount += 1;
            } else {
              peanutCount += 2;
            }
            peanutButters.splice(i, 1);
            updateUI();
            continue;
          }
          if (pb.x < -50) {
            peanutButters.splice(i, 1);
          }
          continue;
        }

        if (!pb.eaten) {
          pb.y += pb.vy;
          pb.vy += 0.1;

          // Check if raptor eats it
          const dist = Math.hypot(pb.x - raptor.x, pb.y - raptor.y);
          if (dist < 40 * raptor.size) {
            pb.eaten = true;
            raptor.eating = true;
            raptor.eatTimer = 30;
            raptor.size += 0.15;
            score += 100;

            // Growth particles
            for (let j = 0; j < 10; j++) {
              particles.push({
                x: raptor.x,
                y: raptor.y,
                vx: (Math.random() - 0.5) * 5,
                vy: (Math.random() - 0.5) * 5,
                size: Math.random() * 10 + 5,
                life: 40,
                color: '#f80'
              });
            }
            updateUI();
          }

          // Hit ground
          if (pb.y > height - 50) {
            pb.y = height - 50;
            pb.vy = 0;
          }
        }

        // Remove eaten or old peanut butters
        if (pb.eaten || pb.y > height) {
          peanutButters.splice(i, 1);
        }
      }

      // Update bullets
      for (let i = bullets.length - 1; i >= 0; i--) {
        const bullet = bullets[i];
        bullet.x += bullet.vx;

        // Check collision with gas clouds
        let blocked = false;
        for (const cloud of gasClouds) {
          const dist = Math.hypot(bullet.x - cloud.x, bullet.y - cloud.y);
          if (dist < cloud.radius) {
            blocked = true;
            score += 10;
            // Dissolve particles
            for (let j = 0; j < 5; j++) {
              particles.push({
                x: bullet.x,
                y: bullet.y,
                vx: (Math.random() - 0.5) * 4,
                vy: (Math.random() - 0.5) * 4,
                size: Math.random() * 8 + 3,
                life: 30,
                color: '#0f0'
              });
            }
            break;
          }
        }

        if (blocked) {
          bullets.splice(i, 1);
          updateUI();
          continue;
        }

        // Check collision with raptor
        const distToRaptor = Math.hypot(bullet.x - raptor.x, bullet.y - raptor.y);
        if (distToRaptor < 30 * raptor.size) {
          if (hasSloppyClothes && invincibleTime > 0) {
            // Invincible! Destroy the bullet
            bullets.splice(i, 1);
            score += 20;
            // Sparkle effect
            for (let j = 0; j < 5; j++) {
              particles.push({
                x: bullet.x,
                y: bullet.y,
                vx: (Math.random() - 0.5) * 6,
                vy: (Math.random() - 0.5) * 6,
                size: Math.random() * 8 + 3,
                life: 30,
                color: '#f0f'
              });
            }
            updateUI();
            continue;
          }
          gameOver();
          return;
        }

        // Remove off-screen bullets
        if (bullet.x < -20) {
          bullets.splice(i, 1);
          score += 5;
          updateUI();
        }
      }

      // Update gas clouds
      for (let i = gasClouds.length - 1; i >= 0; i--) {
        const cloud = gasClouds[i];
        cloud.life--;
        cloud.radius += 0.3;
        if (cloud.life <= 0) {
          gasClouds.splice(i, 1);
        }
      }

      // Update particles
      for (let i = particles.length - 1; i >= 0; i--) {
        const p = particles[i];
        p.x += p.vx;
        p.y += p.vy;
        p.life--;
        p.size *= 0.95;
        if (p.life <= 0) {
          particles.splice(i, 1);
        }
      }

      // Gassy animation
      gassy.frame += 0.1;
      if (gassy.spraying) {
        gassy.sprayTimer--;
        if (gassy.sprayTimer <= 0) {
          gassy.spraying = false;
        }
      }

      // Regenerate gas
      if (gasLevel < 100) {
        gasLevel += 0.1;
        updateUI();
      }

      // Spawn stuff
      spawnPeanutPickup();
      spawnBombPickup();
      spawnSloppyClothes();
      spawnMoleRat();
      spawnGiraffe();

      // Update stun timer
      if (raptor.stunned) {
        raptor.stunTimer--;
        if (raptor.stunTimer <= 0) {
          raptor.stunned = false;
        }
      }

      // Update mole rats
      for (let i = moleRats.length - 1; i >= 0; i--) {
        const rat = moleRats[i];
        rat.frame += 0.15;

        // Move toward raptor's x position
        const dx = raptor.x - rat.x;
        if (Math.abs(dx) > 50) {
          rat.vx = dx > 0 ? 1.5 : -1.5;
          rat.direction = dx > 0 ? 1 : -1;
        } else {
          rat.vx = 0;
        }
        rat.x += rat.vx;

        // Burp timer
        rat.burpTimer--;
        if (rat.burpTimer <= 0 && !rat.burping) {
          rat.burping = true;
          rat.burpAnimTimer = 40;

          // Release feather cloud toward raptor
          const angle = Math.atan2(raptor.y - rat.y, raptor.x - rat.x);
          const featherCloud = {
            x: rat.x,
            y: rat.y - 20,
            vx: Math.cos(angle) * 3,
            vy: Math.sin(angle) * 3 - 1,
            radius: 25,
            life: 150,
            maxLife: 150
          };
          featherClouds.push(featherCloud);

          // Burp particles
          for (let j = 0; j < 10; j++) {
            particles.push({
              x: rat.x,
              y: rat.y - 15,
              vx: (Math.random() - 0.5) * 4 + Math.cos(angle) * 2,
              vy: (Math.random() - 0.5) * 4 - 2,
              size: Math.random() * 8 + 4,
              life: 40,
              color: '#fff'
            });
          }

          rat.burpTimer = 180 + Math.random() * 120;
        }

        if (rat.burping) {
          rat.burpAnimTimer--;
          if (rat.burpAnimTimer <= 0) {
            rat.burping = false;
          }
        }

        // Check if gas cloud hits mole rat
        for (const cloud of gasClouds) {
          const dist = Math.hypot(rat.x - cloud.x, rat.y - cloud.y);
          if (dist < cloud.radius + 30) {
            rat.hp--;
            if (rat.hp <= 0) {
              // Mole rat defeated
              score += 200;
              for (let k = 0; k < 15; k++) {
                particles.push({
                  x: rat.x,
                  y: rat.y,
                  vx: (Math.random() - 0.5) * 6,
                  vy: (Math.random() - 0.5) * 6,
                  size: Math.random() * 10 + 5,
                  life: 50,
                  color: '#a86'
                });
              }
              moleRats.splice(i, 1);
              updateUI();
            }
            break;
          }
        }

        // Check if sail bomb explosion hits mole rat (handled in bomb explosion)

        // Remove if off screen
        if (rat.x < -100 || rat.x > width + 100) {
          moleRats.splice(i, 1);
        }
      }

      // Update feather clouds
      for (let i = featherClouds.length - 1; i >= 0; i--) {
        const cloud = featherClouds[i];
        cloud.x += cloud.vx;
        cloud.y += cloud.vy;
        cloud.vy += 0.02; // Slight gravity
        cloud.life--;
        cloud.radius += 0.2;

        // Check if hits raptor (stun!)
        if (!raptor.stunned && !hasSloppyClothes) {
          const dist = Math.hypot(cloud.x - raptor.x, cloud.y - raptor.y);
          if (dist < cloud.radius + 30 * raptor.size) {
            raptor.stunned = true;
            raptor.stunTimer = 120; // 2 seconds stun

            // Feather burst on raptor
            for (let j = 0; j < 20; j++) {
              particles.push({
                x: raptor.x,
                y: raptor.y,
                vx: (Math.random() - 0.5) * 5,
                vy: (Math.random() - 0.5) * 5 - 2,
                size: Math.random() * 10 + 5,
                life: 60,
                color: '#fff'
              });
            }

            featherClouds.splice(i, 1);
            continue;
          }
        }

        // Gas clouds destroy feather clouds
        for (const gasCloud of gasClouds) {
          const dist = Math.hypot(cloud.x - gasCloud.x, cloud.y - gasCloud.y);
          if (dist < gasCloud.radius) {
            featherClouds.splice(i, 1);
            score += 25;
            updateUI();
            break;
          }
        }

        if (cloud.life <= 0 || cloud.y > height) {
          featherClouds.splice(i, 1);
        }
      }

      // Update giraffes
      for (let i = giraffes.length - 1; i >= 0; i--) {
        const g = giraffes[i];
        g.frame += 0.1;

        // Move toward raptor area
        const dx = raptor.x - g.x;
        if (Math.abs(dx) > 100) {
          g.vx = dx > 0 ? 1.2 : -1.2;
          g.direction = dx > 0 ? 1 : -1;
        } else {
          g.vx = 0;
        }
        g.x += g.vx;

        // Fart timer - releases toxic clouds
        g.fartTimer--;
        if (g.fartTimer <= 0 && !g.farting) {
          g.farting = true;
          g.fartAnimTimer = 50;

          // Release fart cloud
          const fartCloud = {
            x: g.x - g.direction * 30,
            y: g.y + 40,
            vx: -g.direction * 2,
            vy: -0.5,
            radius: 35,
            life: 200,
            maxLife: 200
          };
          giraffeFarts.push(fartCloud);

          // Fart particles
          for (let j = 0; j < 15; j++) {
            particles.push({
              x: g.x - g.direction * 30,
              y: g.y + 40,
              vx: (Math.random() - 0.5) * 3 - g.direction * 2,
              vy: (Math.random() - 0.5) * 3,
              size: Math.random() * 10 + 5,
              life: 40,
              color: `hsl(${50 + Math.random() * 30}, 80%, 40%)`
            });
          }

          g.fartTimer = 180 + Math.random() * 120;
        }

        if (g.farting) {
          g.fartAnimTimer--;
          if (g.fartAnimTimer <= 0) {
            g.farting = false;
          }
        }

        // Lick attack timer - lethal tongue strike
        g.lickTimer--;
        if (g.lickTimer <= 0 && !g.licking) {
          const distToRaptor = Math.hypot(raptor.x - g.x, raptor.y - g.y);
          if (distToRaptor < 250) {
            g.licking = true;
            g.lickAnimTimer = 30;
            g.tongueX = raptor.x;
            g.tongueY = raptor.y;
          }
          g.lickTimer = 150 + Math.random() * 100;
        }

        if (g.licking) {
          g.lickAnimTimer--;
          // Check if tongue hits raptor (lethal!)
          if (g.lickAnimTimer > 15 && g.lickAnimTimer < 25) {
            const tongueEndX = g.x + g.direction * 40 + (g.tongueX - g.x) * (1 - g.lickAnimTimer / 30);
            const tongueEndY = g.y - 60 + (g.tongueY - g.y) * (1 - g.lickAnimTimer / 30);
            const distToRaptor = Math.hypot(tongueEndX - raptor.x, tongueEndY - raptor.y);
            if (distToRaptor < 40 * raptor.size && !hasSloppyClothes) {
              gameOver();
              return;
            }
          }
          if (g.lickAnimTimer <= 0) {
            g.licking = false;
          }
        }

        // Check if gas cloud hits giraffe
        for (const cloud of gasClouds) {
          const dist = Math.hypot(g.x - cloud.x, g.y - cloud.y);
          if (dist < cloud.radius + 50) {
            g.hp--;
            if (g.hp <= 0) {
              // Giraffe defeated
              score += 350;
              for (let k = 0; k < 20; k++) {
                particles.push({
                  x: g.x,
                  y: g.y - 50,
                  vx: (Math.random() - 0.5) * 8,
                  vy: (Math.random() - 0.5) * 8,
                  size: Math.random() * 12 + 5,
                  life: 60,
                  color: ['#fc0', '#f90', '#a60'][Math.floor(Math.random() * 3)]
                });
              }
              giraffes.splice(i, 1);
              updateUI();
            }
            break;
          }
        }

        // Remove if off screen
        if (g.x < -150 || g.x > width + 150) {
          giraffes.splice(i, 1);
        }
      }

      // Update giraffe fart clouds
      for (let i = giraffeFarts.length - 1; i >= 0; i--) {
        const fart = giraffeFarts[i];
        fart.x += fart.vx;
        fart.y += fart.vy;
        fart.life--;
        fart.radius += 0.15;

        // Check if hits raptor (damages!)
        if (!hasSloppyClothes) {
          const dist = Math.hypot(fart.x - raptor.x, fart.y - raptor.y);
          if (dist < fart.radius + 25 * raptor.size) {
            // Fart cloud is lethal!
            gameOver();
            return;
          }
        }

        // Player gas clouds neutralize giraffe farts
        for (const gasCloud of gasClouds) {
          const dist = Math.hypot(fart.x - gasCloud.x, fart.y - gasCloud.y);
          if (dist < gasCloud.radius + fart.radius) {
            giraffeFarts.splice(i, 1);
            score += 30;
            // Neutralize particles
            for (let j = 0; j < 8; j++) {
              particles.push({
                x: fart.x,
                y: fart.y,
                vx: (Math.random() - 0.5) * 4,
                vy: (Math.random() - 0.5) * 4,
                size: Math.random() * 8 + 3,
                life: 30,
                color: '#8f8'
              });
            }
            updateUI();
            break;
          }
        }

        if (fart.life <= 0) {
          giraffeFarts.splice(i, 1);
        }
      }
    }

    function draw() {
      // Clear
      ctx.fillStyle = '#0a0a15';
      ctx.fillRect(0, 0, width, height);

      // Ground
      ctx.fillStyle = '#1a2a1a';
      ctx.fillRect(0, height - 40, width, 40);

      // Draw gas clouds
      for (const cloud of gasClouds) {
        const alpha = cloud.life / cloud.maxLife;
        const gradient = ctx.createRadialGradient(cloud.x, cloud.y, 0, cloud.x, cloud.y, cloud.radius);
        gradient.addColorStop(0, `rgba(0, 255, 0, ${alpha * 0.6})`);
        gradient.addColorStop(0.5, `rgba(50, 200, 50, ${alpha * 0.3})`);
        gradient.addColorStop(1, 'rgba(0, 100, 0, 0)');

        ctx.beginPath();
        ctx.arc(cloud.x, cloud.y, cloud.radius, 0, Math.PI * 2);
        ctx.fillStyle = gradient;
        ctx.fill();

        // Glow
        ctx.shadowBlur = 30;
        ctx.shadowColor = '#0f0';
        ctx.beginPath();
        ctx.arc(cloud.x, cloud.y, cloud.radius * 0.5, 0, Math.PI * 2);
        ctx.fillStyle = `rgba(0, 255, 0, ${alpha * 0.2})`;
        ctx.fill();
        ctx.shadowBlur = 0;
      }

      // Draw feather clouds
      for (const cloud of featherClouds) {
        const alpha = cloud.life / cloud.maxLife;
        ctx.save();
        ctx.translate(cloud.x, cloud.y);

        // Fluffy white cloud
        ctx.fillStyle = `rgba(255, 255, 255, ${alpha * 0.7})`;
        ctx.shadowBlur = 20;
        ctx.shadowColor = '#fff';

        // Multiple circles for fluffy look
        for (let i = 0; i < 5; i++) {
          const angle = (i / 5) * Math.PI * 2 + cloud.life / 20;
          const ox = Math.cos(angle) * cloud.radius * 0.4;
          const oy = Math.sin(angle) * cloud.radius * 0.4;
          ctx.beginPath();
          ctx.arc(ox, oy, cloud.radius * 0.5, 0, Math.PI * 2);
          ctx.fill();
        }
        ctx.beginPath();
        ctx.arc(0, 0, cloud.radius * 0.6, 0, Math.PI * 2);
        ctx.fill();

        // Feather shapes
        ctx.fillStyle = `rgba(255, 240, 220, ${alpha * 0.8})`;
        for (let i = 0; i < 3; i++) {
          const angle = (i / 3) * Math.PI * 2 + cloud.life / 10;
          const fx = Math.cos(angle) * cloud.radius * 0.7;
          const fy = Math.sin(angle) * cloud.radius * 0.7;
          ctx.beginPath();
          ctx.ellipse(fx, fy, 8, 3, angle, 0, Math.PI * 2);
          ctx.fill();
        }

        ctx.shadowBlur = 0;
        ctx.restore();
      }

      // Draw mole rats
      for (const rat of moleRats) {
        ctx.save();
        ctx.translate(rat.x, rat.y);
        ctx.scale(rat.direction, 1);

        const bob = Math.sin(rat.frame * 2) * 3;
        ctx.translate(0, bob);

        // Shadow
        ctx.fillStyle = 'rgba(0,0,0,0.3)';
        ctx.beginPath();
        ctx.ellipse(0, 25, 30, 8, 0, 0, Math.PI * 2);
        ctx.fill();

        // Body (pink/tan blob)
        ctx.fillStyle = '#d9a';
        ctx.shadowBlur = 10;
        ctx.shadowColor = '#a86';
        ctx.beginPath();
        ctx.ellipse(0, 0, 35, 25, 0, 0, Math.PI * 2);
        ctx.fill();

        // Head
        ctx.fillStyle = '#eba';
        ctx.beginPath();
        ctx.ellipse(25, -5, 22, 18, 0.2, 0, Math.PI * 2);
        ctx.fill();

        // Snout
        ctx.fillStyle = '#fcc';
        ctx.beginPath();
        ctx.ellipse(42, 0, 12, 10, 0, 0, Math.PI * 2);
        ctx.fill();

        // Big front teeth
        ctx.fillStyle = '#ffe';
        ctx.beginPath();
        ctx.moveTo(48, 5);
        ctx.lineTo(52, 18);
        ctx.lineTo(44, 18);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo(38, 5);
        ctx.lineTo(42, 16);
        ctx.lineTo(34, 16);
        ctx.fill();

        // Tiny eyes
        ctx.fillStyle = '#000';
        ctx.beginPath();
        ctx.arc(30, -12, 4, 0, Math.PI * 2);
        ctx.fill();

        // Wrinkles
        ctx.strokeStyle = '#a86';
        ctx.lineWidth = 1;
        for (let i = 0; i < 3; i++) {
          ctx.beginPath();
          ctx.arc(10 - i * 8, -5, 10, -0.5, 0.5);
          ctx.stroke();
        }

        // Little legs
        ctx.fillStyle = '#d9a';
        const legKick = Math.sin(rat.frame * 3) * 5;
        ctx.beginPath();
        ctx.ellipse(-15, 20 + legKick, 8, 12, 0.2, 0, Math.PI * 2);
        ctx.fill();
        ctx.beginPath();
        ctx.ellipse(5, 20 - legKick, 8, 12, -0.2, 0, Math.PI * 2);
        ctx.fill();

        // Burping effect
        if (rat.burping) {
          ctx.fillStyle = `rgba(255, 255, 255, ${rat.burpAnimTimer / 40})`;
          ctx.beginPath();
          ctx.arc(55, -5, 15 + (40 - rat.burpAnimTimer) / 2, 0, Math.PI * 2);
          ctx.fill();

          // Open mouth
          ctx.fillStyle = '#622';
          ctx.beginPath();
          ctx.ellipse(48, 5, 10, 8, 0, 0, Math.PI * 2);
          ctx.fill();
        }

        ctx.shadowBlur = 0;
        ctx.restore();
      }

      // Draw giraffe fart clouds
      for (const fart of giraffeFarts) {
        const alpha = fart.life / fart.maxLife;
        const gradient = ctx.createRadialGradient(fart.x, fart.y, 0, fart.x, fart.y, fart.radius);
        gradient.addColorStop(0, `rgba(150, 120, 50, ${alpha * 0.7})`);
        gradient.addColorStop(0.5, `rgba(120, 100, 30, ${alpha * 0.4})`);
        gradient.addColorStop(1, 'rgba(80, 60, 20, 0)');

        ctx.beginPath();
        ctx.arc(fart.x, fart.y, fart.radius, 0, Math.PI * 2);
        ctx.fillStyle = gradient;
        ctx.fill();

        // Stink lines
        ctx.strokeStyle = `rgba(100, 80, 30, ${alpha * 0.5})`;
        ctx.lineWidth = 2;
        for (let i = 0; i < 3; i++) {
          const wave = Math.sin(Date.now() / 200 + i) * 5;
          ctx.beginPath();
          ctx.moveTo(fart.x - 10 + i * 10, fart.y - fart.radius);
          ctx.quadraticCurveTo(fart.x - 10 + i * 10 + wave, fart.y - fart.radius - 15, fart.x - 10 + i * 10, fart.y - fart.radius - 30);
          ctx.stroke();
        }
      }

      // Draw giraffes
      for (const g of giraffes) {
        ctx.save();
        ctx.translate(g.x, g.y);
        ctx.scale(g.direction, 1);

        const bob = Math.sin(g.frame * 1.5) * 4;

        // Shadow
        ctx.fillStyle = 'rgba(0,0,0,0.3)';
        ctx.beginPath();
        ctx.ellipse(0, 50, 40, 12, 0, 0, Math.PI * 2);
        ctx.fill();

        // Back legs
        ctx.fillStyle = '#c90';
        ctx.beginPath();
        ctx.moveTo(-20, 20);
        ctx.lineTo(-25, 50);
        ctx.lineTo(-15, 50);
        ctx.lineTo(-10, 20);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo(10, 20);
        ctx.lineTo(5, 50);
        ctx.lineTo(15, 50);
        ctx.lineTo(20, 20);
        ctx.fill();

        // Body
        ctx.fillStyle = '#fc0';
        ctx.shadowBlur = 15;
        ctx.shadowColor = '#f90';
        ctx.beginPath();
        ctx.ellipse(0, 0 + bob, 45, 30, 0, 0, Math.PI * 2);
        ctx.fill();

        // Spots
        ctx.fillStyle = '#a60';
        const spots = [[-15, -10], [10, 5], [-5, 10], [20, -5], [-20, 5]];
        for (const [sx, sy] of spots) {
          ctx.beginPath();
          ctx.ellipse(sx, sy + bob, 8, 6, Math.random(), 0, Math.PI * 2);
          ctx.fill();
        }

        // Neck
        ctx.fillStyle = '#fc0';
        ctx.beginPath();
        ctx.moveTo(25, -10 + bob);
        ctx.quadraticCurveTo(50, -40, 40, -90);
        ctx.lineTo(30, -90);
        ctx.quadraticCurveTo(35, -40, 15, -10 + bob);
        ctx.fill();

        // Neck spots
        ctx.fillStyle = '#a60';
        ctx.beginPath();
        ctx.ellipse(35, -50, 6, 5, 0.3, 0, Math.PI * 2);
        ctx.fill();
        ctx.beginPath();
        ctx.ellipse(38, -70, 5, 4, -0.2, 0, Math.PI * 2);
        ctx.fill();

        // Head
        ctx.fillStyle = '#fc0';
        ctx.beginPath();
        ctx.ellipse(35, -100, 18, 14, 0.2, 0, Math.PI * 2);
        ctx.fill();

        // Ossicones (horns)
        ctx.fillStyle = '#a60';
        ctx.beginPath();
        ctx.moveTo(28, -110);
        ctx.lineTo(26, -125);
        ctx.lineTo(30, -125);
        ctx.fill();
        ctx.beginPath();
        ctx.moveTo(42, -108);
        ctx.lineTo(44, -123);
        ctx.lineTo(48, -121);
        ctx.fill();

        // Ear
        ctx.fillStyle = '#da0';
        ctx.beginPath();
        ctx.ellipse(50, -105, 8, 5, 0.5, 0, Math.PI * 2);
        ctx.fill();

        // Eye
        ctx.fillStyle = '#000';
        ctx.beginPath();
        ctx.arc(42, -102, 4, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = '#fff';
        ctx.beginPath();
        ctx.arc(43, -103, 1.5, 0, Math.PI * 2);
        ctx.fill();

        // Snout/nose
        ctx.fillStyle = '#a80';
        ctx.beginPath();
        ctx.ellipse(52, -95, 8, 6, 0.3, 0, Math.PI * 2);
        ctx.fill();

        // Nostrils
        ctx.fillStyle = '#640';
        ctx.beginPath();
        ctx.ellipse(54, -93, 2, 1.5, 0, 0, Math.PI * 2);
        ctx.fill();
        ctx.beginPath();
        ctx.ellipse(56, -95, 2, 1.5, 0, 0, Math.PI * 2);
        ctx.fill();

        // Tongue for lick attack
        if (g.licking) {
          const tongueProgress = 1 - Math.abs(g.lickAnimTimer - 15) / 15;
          const tongueLen = tongueProgress * 120;
          ctx.strokeStyle = '#f0a';
          ctx.lineWidth = 8;
          ctx.lineCap = 'round';
          ctx.shadowBlur = 20;
          ctx.shadowColor = '#f0a';
          ctx.beginPath();
          ctx.moveTo(55, -92);
          const targetAngle = Math.atan2((g.tongueY - g.y + 100), (g.tongueX - g.x) * g.direction);
          ctx.lineTo(55 + Math.cos(targetAngle) * tongueLen, -92 + Math.sin(targetAngle) * tongueLen);
          ctx.stroke();

          // Tongue tip
          ctx.fillStyle = '#f08';
          ctx.beginPath();
          ctx.arc(55 + Math.cos(targetAngle) * tongueLen, -92 + Math.sin(targetAngle) * tongueLen, 6, 0, Math.PI * 2);
          ctx.fill();
        }

        // Farting effect
        if (g.farting) {
          ctx.fillStyle = `rgba(150, 120, 50, ${g.fartAnimTimer / 50})`;
          ctx.beginPath();
          ctx.arc(-30, 30, 20 + (50 - g.fartAnimTimer) / 2, 0, Math.PI * 2);
          ctx.fill();
        }

        // Tail
        ctx.strokeStyle = '#a60';
        ctx.lineWidth = 4;
        ctx.beginPath();
        ctx.moveTo(-40, 0 + bob);
        ctx.quadraticCurveTo(-55, 10, -50, 25);
        ctx.stroke();
        // Tail tuft
        ctx.fillStyle = '#640';
        ctx.beginPath();
        ctx.ellipse(-50, 28, 6, 10, 0.2, 0, Math.PI * 2);
        ctx.fill();

        ctx.shadowBlur = 0;
        ctx.restore();
      }

      // Draw sloppy's clothes items
      for (const clothes of sloppyClothesItems) {
        ctx.save();
        ctx.translate(clothes.x, clothes.y + Math.sin(clothes.bob) * 10);

        // Glowing effect
        ctx.shadowBlur = 30;
        ctx.shadowColor = '#f0f';

        // Shirt shape
        ctx.fillStyle = '#f0f';
        ctx.beginPath();
        ctx.roundRect(-25, -20, 50, 45, 8);
        ctx.fill();

        // Collar
        ctx.fillStyle = '#a0f';
        ctx.beginPath();
        ctx.moveTo(-10, -20);
        ctx.lineTo(0, -10);
        ctx.lineTo(10, -20);
        ctx.fill();

        // S logo
        ctx.fillStyle = '#fff';
        ctx.font = 'bold 24px Bangers';
        ctx.textAlign = 'center';
        ctx.fillText('S', 0, 12);

        // Sparkles
        ctx.fillStyle = '#fff';
        for (let i = 0; i < 4; i++) {
          const angle = Date.now() / 200 + i * Math.PI / 2;
          const sparkleX = Math.cos(angle) * 35;
          const sparkleY = Math.sin(angle) * 35;
          ctx.beginPath();
          ctx.arc(sparkleX, sparkleY, 4, 0, Math.PI * 2);
          ctx.fill();
        }

        ctx.shadowBlur = 0;
        ctx.restore();
      }

      // Draw sail bombs in flight
      for (const bomb of sailBombs) {
        ctx.save();
        ctx.translate(bomb.x, bomb.y);
        ctx.rotate(bomb.rotation);

        // Sail
        ctx.fillStyle = '#fff';
        ctx.shadowBlur = 15;
        ctx.shadowColor = '#f44';
        ctx.beginPath();
        ctx.moveTo(0, -25);
        ctx.lineTo(15, 0);
        ctx.lineTo(0, 5);
        ctx.fill();

        // Boat/bomb body
        ctx.fillStyle = '#f44';
        ctx.beginPath();
        ctx.ellipse(0, 8, 20, 10, 0, 0, Math.PI);
        ctx.fill();

        // Fuse spark
        ctx.fillStyle = '#ff0';
        ctx.beginPath();
        ctx.arc(-15, 0, 5 + Math.sin(Date.now() / 50) * 2, 0, Math.PI * 2);
        ctx.fill();

        ctx.shadowBlur = 0;
        ctx.restore();
      }

      // Draw peanut butters and bomb pickups
      for (const pb of peanutButters) {
        if (pb.eaten) continue;
        ctx.save();
        ctx.translate(pb.x, pb.y);

        if (pb.isBombPickup) {
          // Bomb pickup
          ctx.fillStyle = '#f44';
          ctx.shadowBlur = 15;
          ctx.shadowColor = '#f44';
          ctx.beginPath();
          ctx.arc(0, 0, 18, 0, Math.PI * 2);
          ctx.fill();

          // Sail on top
          ctx.fillStyle = '#fff';
          ctx.beginPath();
          ctx.moveTo(0, -25);
          ctx.lineTo(10, -5);
          ctx.lineTo(0, 0);
          ctx.fill();

          ctx.fillStyle = '#fff';
          ctx.font = '12px Arial';
          ctx.textAlign = 'center';
          ctx.fillText('ðŸ’£', 0, 6);
        } else {
          // Peanut butter jar
          ctx.fillStyle = pb.isPickup ? '#ffd700' : '#c90';
          ctx.shadowBlur = 15;
          ctx.shadowColor = '#f80';
          ctx.beginPath();
          ctx.ellipse(0, 0, pb.size * 0.6, pb.size * 0.8, 0, 0, Math.PI * 2);
          ctx.fill();

          // Label
          ctx.fillStyle = '#630';
          ctx.font = `${pb.size * 0.4}px Arial`;
          ctx.textAlign = 'center';
          ctx.fillText('PB', 0, 5);
        }

        ctx.shadowBlur = 0;
        ctx.restore();
      }

      // Draw The Incredible Gassy
      ctx.save();
      ctx.translate(gassy.x, gassy.y);

      const gassyBob = Math.sin(gassy.frame) * 5;
      ctx.translate(0, gassyBob);

      // Body (green blob)
      ctx.fillStyle = '#2a2';
      ctx.shadowBlur = 20;
      ctx.shadowColor = '#0f0';
      ctx.beginPath();
      ctx.ellipse(0, 0, 50, 40, 0, 0, Math.PI * 2);
      ctx.fill();

      // Face
      ctx.fillStyle = '#4f4';
      ctx.beginPath();
      ctx.ellipse(0, -5, 35, 28, 0, 0, Math.PI * 2);
      ctx.fill();

      // Eyes
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(-12, -10, 10, 0, Math.PI * 2);
      ctx.arc(12, -10, 10, 0, Math.PI * 2);
      ctx.fill();

      ctx.fillStyle = '#000';
      ctx.beginPath();
      ctx.arc(-12, -10, 5, 0, Math.PI * 2);
      ctx.arc(12, -10, 5, 0, Math.PI * 2);
      ctx.fill();

      // Mouth (gassy expression)
      ctx.strokeStyle = '#000';
      ctx.lineWidth = 3;
      ctx.beginPath();
      if (gassy.spraying) {
        ctx.arc(0, 5, 15, 0, Math.PI);
      } else {
        ctx.moveTo(-10, 8);
        ctx.quadraticCurveTo(0, 15, 10, 8);
      }
      ctx.stroke();

      // Arms
      ctx.fillStyle = '#2a2';
      ctx.beginPath();
      ctx.ellipse(-45, 10, 15, 10, -0.3, 0, Math.PI * 2);
      ctx.ellipse(45, 10, 15, 10, 0.3, 0, Math.PI * 2);
      ctx.fill();

      // Gas trail when spraying
      if (gassy.spraying) {
        for (let i = 0; i < 5; i++) {
          ctx.fillStyle = `rgba(0, 255, 0, ${0.3 - i * 0.05})`;
          ctx.beginPath();
          ctx.arc(70 + i * 20, Math.sin(Date.now() / 100 + i) * 10, 15 - i * 2, 0, Math.PI * 2);
          ctx.fill();
        }
      }

      ctx.shadowBlur = 0;
      ctx.restore();

      // Draw label for Gassy
      ctx.fillStyle = '#0f0';
      ctx.font = '14px Bangers';
      ctx.textAlign = 'center';
      ctx.fillText('THE INCREDIBLE GASSY', gassy.x, gassy.y + 70);

      // Draw Utahraptor
      ctx.save();
      ctx.translate(raptor.x, raptor.y);
      const scale = raptor.size;
      ctx.scale(scale, scale);

      const bob = Math.sin(raptor.frame * 2) * 3;
      ctx.translate(0, bob);

      // Invincibility aura
      if (hasSloppyClothes && invincibleTime > 0) {
        ctx.shadowBlur = 50;
        ctx.shadowColor = '#f0f';
        ctx.fillStyle = `rgba(255, 0, 255, ${0.2 + Math.sin(Date.now() / 100) * 0.1})`;
        ctx.beginPath();
        ctx.arc(0, 0, 70, 0, Math.PI * 2);
        ctx.fill();
        ctx.shadowBlur = 0;

        // Sloppy's shirt on raptor
        ctx.fillStyle = '#f0f';
        ctx.beginPath();
        ctx.roundRect(-20, -15, 40, 30, 5);
        ctx.fill();
        ctx.fillStyle = '#fff';
        ctx.font = 'bold 16px Bangers';
        ctx.textAlign = 'center';
        ctx.fillText('S', 0, 8);
      }

      // Shadow
      ctx.fillStyle = 'rgba(0,0,0,0.3)';
      ctx.beginPath();
      ctx.ellipse(0, 40, 40, 10, 0, 0, Math.PI * 2);
      ctx.fill();

      // Tail
      ctx.fillStyle = '#f60';
      ctx.shadowBlur = 15;
      ctx.shadowColor = '#f80';
      ctx.beginPath();
      ctx.moveTo(-20, 0);
      ctx.quadraticCurveTo(-60, -10, -80, 20);
      ctx.quadraticCurveTo(-60, 30, -20, 10);
      ctx.fill();

      // Body
      ctx.fillStyle = '#f80';
      ctx.beginPath();
      ctx.ellipse(0, 0, 35, 25, 0, 0, Math.PI * 2);
      ctx.fill();

      // Head
      ctx.fillStyle = '#fa0';
      ctx.beginPath();
      ctx.ellipse(35, -15, 25, 18, 0.3, 0, Math.PI * 2);
      ctx.fill();

      // Snout
      ctx.fillStyle = '#f90';
      ctx.beginPath();
      ctx.ellipse(55, -10, 15, 10, 0.2, 0, Math.PI * 2);
      ctx.fill();

      // Eye
      ctx.fillStyle = '#ff0';
      ctx.shadowBlur = 10;
      ctx.shadowColor = '#ff0';
      ctx.beginPath();
      ctx.arc(40, -20, 8, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = '#000';
      ctx.beginPath();
      ctx.arc(42, -20, 4, 0, Math.PI * 2);
      ctx.fill();

      // Teeth
      ctx.fillStyle = '#fff';
      ctx.shadowBlur = 0;
      for (let i = 0; i < 4; i++) {
        ctx.beginPath();
        ctx.moveTo(50 + i * 5, -5);
        ctx.lineTo(52 + i * 5, 3);
        ctx.lineTo(48 + i * 5, 3);
        ctx.fill();
      }

      // Legs
      ctx.fillStyle = '#e70';
      const legKick = raptor.eating ? Math.sin(raptor.eatTimer) * 10 : 0;
      ctx.beginPath();
      ctx.moveTo(-5, 20);
      ctx.lineTo(-15, 45 + legKick);
      ctx.lineTo(-5, 45 + legKick);
      ctx.lineTo(0, 25);
      ctx.fill();

      ctx.beginPath();
      ctx.moveTo(10, 20);
      ctx.lineTo(5, 45 - legKick);
      ctx.lineTo(15, 45 - legKick);
      ctx.lineTo(15, 25);
      ctx.fill();

      // Claws
      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.moveTo(-15, 45 + legKick);
      ctx.lineTo(-25, 50 + legKick);
      ctx.lineTo(-10, 48 + legKick);
      ctx.fill();

      ctx.beginPath();
      ctx.moveTo(5, 45 - legKick);
      ctx.lineTo(-5, 50 - legKick);
      ctx.lineTo(10, 48 - legKick);
      ctx.fill();

      // Feathers
      ctx.fillStyle = '#f40';
      for (let i = 0; i < 5; i++) {
        ctx.beginPath();
        ctx.moveTo(-10 + i * 8, -25);
        ctx.lineTo(-5 + i * 8, -40 - Math.sin(raptor.frame + i) * 5);
        ctx.lineTo(0 + i * 8, -25);
        ctx.fill();
      }

      // Arms
      ctx.fillStyle = '#f80';
      ctx.beginPath();
      ctx.moveTo(15, -5);
      ctx.lineTo(30, 10 + (raptor.eating ? Math.sin(raptor.eatTimer * 2) * 5 : 0));
      ctx.lineTo(20, 15);
      ctx.lineTo(10, 5);
      ctx.fill();

      // Stun effect - dizzy stars
      if (raptor.stunned) {
        ctx.fillStyle = '#ff0';
        ctx.shadowBlur = 15;
        ctx.shadowColor = '#ff0';
        for (let i = 0; i < 5; i++) {
          const angle = (Date.now() / 200 + i * Math.PI * 2 / 5);
          const starX = Math.cos(angle) * 50;
          const starY = Math.sin(angle) * 30 - 50;
          ctx.font = '20px Arial';
          ctx.fillText('â­', starX - 10, starY + 5);
        }
        ctx.shadowBlur = 0;
      }

      ctx.shadowBlur = 0;
      ctx.restore();

      // Draw bullets
      ctx.fillStyle = '#f00';
      ctx.shadowBlur = 10;
      ctx.shadowColor = '#f00';
      for (const bullet of bullets) {
        ctx.beginPath();
        ctx.arc(bullet.x, bullet.y, bullet.size, 0, Math.PI * 2);
        ctx.fill();

        // Trail
        ctx.fillStyle = 'rgba(255, 0, 0, 0.3)';
        ctx.beginPath();
        ctx.arc(bullet.x + 15, bullet.y, bullet.size * 0.7, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = '#f00';
      }
      ctx.shadowBlur = 0;

      // Draw particles
      for (const p of particles) {
        ctx.fillStyle = p.color;
        ctx.globalAlpha = p.life / 60;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fill();
      }
      ctx.globalAlpha = 1;
    }

    function updateUI() {
      document.getElementById('sizeVal').textContent = raptor.size.toFixed(1);
      document.getElementById('peanutsVal').textContent = peanutCount;
      document.getElementById('gasVal').textContent = Math.floor(gasLevel);
      document.getElementById('bombsVal').textContent = bombCount;
      document.getElementById('scoreVal').textContent = score;

      document.getElementById('feedBtn').disabled = peanutCount <= 0;
      document.getElementById('gasBtn').disabled = gasLevel < 20;
      document.getElementById('bombBtn').disabled = bombCount <= 0;

      // Invincibility display
      const invincibleStat = document.getElementById('invincibleStat');
      if (hasSloppyClothes && invincibleTime > 0) {
        invincibleStat.style.display = 'block';
        document.getElementById('invincibleTime').textContent = Math.ceil(invincibleTime);
      } else {
        invincibleStat.style.display = 'none';
      }
    }

    function gameOver() {
      gameRunning = false;
      document.getElementById('finalSize').textContent = raptor.size.toFixed(1);
      document.getElementById('finalScore').textContent = score;
      document.getElementById('gameOver').style.display = 'flex';
    }

    function restartGame() {
      gameRunning = true;
      score = 0;
      peanutCount = 5;
      gasLevel = 100;
      bombCount = 0;
      invincibleTime = 0;
      hasSloppyClothes = false;
      raptor.size = 1.0;
      raptor.x = width * 0.5;
      raptor.y = height * 0.6;
      raptor.targetX = raptor.x;
      raptor.targetY = raptor.y;
      bullets = [];
      peanutButters = [];
      gasClouds = [];
      particles = [];
      sailBombs = [];
      sloppyClothesItems = [];
      moleRats = [];
      featherClouds = [];
      giraffes = [];
      giraffeFarts = [];
      raptor.stunned = false;
      raptor.stunTimer = 0;
      document.getElementById('gameOver').style.display = 'none';
      updateUI();
    }

    function animate() {
      update();
      draw();
      requestAnimationFrame(animate);
    }

    // Event listeners
    document.addEventListener('keydown', (e) => {
      if (e.code === 'Space') {
        e.preventDefault();
        sprayGas();
      }
      if (e.code === 'KeyB') {
        e.preventDefault();
        throwBomb();
      }
    });

    canvas.addEventListener('click', (e) => {
      if (!gameRunning) return;
      dropPeanutButter();
    });

    // Spawn bullets periodically
    setInterval(() => {
      if (gameRunning) spawnBullet();
    }, 1500);

    // Faster bullets over time
    setInterval(() => {
      if (gameRunning) spawnBullet();
    }, 3000);

    window.addEventListener('resize', resize);

    // Initialize
    resize();
    updateUI();
    animate();
  </script>
<script src="/apps/sloppy-header/sloppy-bar.js"></script>
<script src="/vibelib-extended.js"></script>
<script>
  // Compatibility Patch for Legacy Apps
  window.addEventListener("load", () => {
    if (window.SloppyKarma && window.VibeLib.Economy) {
      // Redirect old calls to new engine
      window.SloppyKarma.track = window.VibeLib.Economy.track;
    }
  });
</script>
</body>
</html>
