<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Neon Bonsai - Interactive Light Garden</title>
  <meta name="description" content="Click the leaves to make them glow and hear soft chimes">
  <meta property="og:title" content="Neon Bonsai">
  <meta property="og:description" content="An interactive neon bonsai tree - click leaves to glow and chime">
  <meta property="og:url" content="https://app.sloppy.live/neon-bonsai">
  <meta property="og:image" content="https://app.sloppy.live/neon-bonsai/og-image.png">
  <link rel="icon" href="https://emojicdn.elk.sh/ðŸŒ³">
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-deep: #0a0a0f;
      --bg-glow: #0d1117;
      --branch: #2d1f3d;
      --branch-glow: #6b4d8a;
      --leaf-base: #1a3d2e;
      --leaf-glow: #00ff88;
      --leaf-pink: #ff6b9d;
      --leaf-cyan: #00d4ff;
      --leaf-gold: #ffd93d;
      --pot: #1a1520;
      --pot-accent: #3d2d4a;
    }

    body {
      min-height: 100vh;
      background: var(--bg-deep);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      font-family: 'Cormorant Garamond', Georgia, serif;
      overflow: hidden;
      position: relative;
    }

    .atmosphere {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background:
        radial-gradient(ellipse at 50% 100%, rgba(0, 255, 136, 0.03) 0%, transparent 50%),
        radial-gradient(ellipse at 20% 20%, rgba(0, 212, 255, 0.02) 0%, transparent 40%),
        radial-gradient(ellipse at 80% 30%, rgba(255, 107, 157, 0.02) 0%, transparent 40%);
      pointer-events: none;
    }

    .stars {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      pointer-events: none;
    }

    .star {
      position: absolute;
      width: 2px;
      height: 2px;
      background: white;
      border-radius: 50%;
      opacity: 0.3;
      animation: twinkle 3s ease-in-out infinite;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.2; }
      50% { opacity: 0.5; }
    }

    .container {
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      color: rgba(255, 255, 255, 0.6);
      font-weight: 300;
      font-size: 14px;
      letter-spacing: 8px;
      text-transform: uppercase;
      margin-bottom: 30px;
      opacity: 0;
      animation: fadeIn 2s ease forwards 0.5s;
    }

    @keyframes fadeIn {
      to { opacity: 1; }
    }

    canvas {
      cursor: pointer;
      filter: drop-shadow(0 0 20px rgba(0, 255, 136, 0.1));
    }

    .hint {
      color: rgba(255, 255, 255, 0.3);
      font-size: 12px;
      letter-spacing: 4px;
      margin-top: 30px;
      opacity: 0;
      animation: fadeIn 2s ease forwards 1s;
      transition: opacity 0.5s ease;
    }

    .hint.hidden {
      opacity: 0 !important;
    }

    .back-link {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      color: rgba(255, 255, 255, 0.2);
      text-decoration: none;
      font-size: 11px;
      letter-spacing: 2px;
      z-index: 10;
      transition: color 0.3s;
    }

    .back-link:hover {
      color: var(--leaf-glow);
    }

    .glow-counter {
      position: fixed;
      top: 20px;
      right: 20px;
      color: rgba(255, 255, 255, 0.4);
      font-size: 12px;
      letter-spacing: 2px;
    }

    .glow-counter span {
      color: var(--leaf-glow);
      text-shadow: 0 0 10px var(--leaf-glow);
    }
  </style>
</head>
<body>
  <div class="atmosphere"></div>
  <div class="stars" id="stars"></div>

  <div class="container">
    <h1>Neon Bonsai</h1>
    <canvas id="canvas"></canvas>
    <p class="hint" id="hint">touch the leaves</p>
  </div>

  <div class="glow-counter">leaves lit: <span id="counter">0</span></div>
  <a href="https://sloppy.live" class="back-link">sloppy.live</a>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    // Responsive sizing
    const size = Math.min(window.innerWidth - 40, window.innerHeight - 200, 500);
    canvas.width = size;
    canvas.height = size;

    // Audio context (created on first interaction)
    let audioCtx = null;

    // Pentatonic scale frequencies for zen chimes
    const pentatonic = [
      261.63, // C4
      293.66, // D4
      329.63, // E4
      392.00, // G4
      440.00, // A4
      523.25, // C5
      587.33, // D5
      659.25, // E5
    ];

    function initAudio() {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
    }

    function playChime(freq) {
      if (!audioCtx) return;

      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      const filter = audioCtx.createBiquadFilter();

      // Soft sine wave
      osc.type = 'sine';
      osc.frequency.value = freq;

      // Low pass filter for softer sound
      filter.type = 'lowpass';
      filter.frequency.value = 2000;

      // Gentle envelope
      gain.gain.setValueAtTime(0, audioCtx.currentTime);
      gain.gain.linearRampToValueAtTime(0.15, audioCtx.currentTime + 0.02);
      gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 1.5);

      osc.connect(filter);
      filter.connect(gain);
      gain.connect(audioCtx.destination);

      osc.start();
      osc.stop(audioCtx.currentTime + 1.5);
    }

    // Leaf colors
    const leafColors = [
      { base: '#1a4d3e', glow: '#00ff88', name: 'green' },
      { base: '#4d1a3e', glow: '#ff6b9d', name: 'pink' },
      { base: '#1a3d4d', glow: '#00d4ff', name: 'cyan' },
      { base: '#4d3d1a', glow: '#ffd93d', name: 'gold' },
    ];

    // Tree structure
    const leaves = [];
    const branches = [];
    let glowCount = 0;

    // Generate tree
    function generateTree() {
      leaves.length = 0;
      branches.length = 0;

      const cx = canvas.width / 2;
      const baseY = canvas.height - 60;

      // Trunk
      branches.push({
        x1: cx, y1: baseY,
        x2: cx, y2: baseY - 80,
        width: 12
      });

      // Recursive branch generation
      function branch(x, y, angle, length, width, depth) {
        if (depth > 6 || length < 10) return;

        const endX = x + Math.cos(angle) * length;
        const endY = y + Math.sin(angle) * length;

        branches.push({
          x1: x, y1: y,
          x2: endX, y2: endY,
          width: width
        });

        // Add leaves at branch ends
        if (depth > 3 && Math.random() > 0.3) {
          const color = leafColors[Math.floor(Math.random() * leafColors.length)];
          leaves.push({
            x: endX + (Math.random() - 0.5) * 15,
            y: endY + (Math.random() - 0.5) * 15,
            radius: 8 + Math.random() * 6,
            color: color,
            glow: 0,
            targetGlow: 0,
            phase: Math.random() * Math.PI * 2
          });
        }

        // Branch splits
        const splits = depth < 3 ? 2 + Math.floor(Math.random() * 2) : 1 + Math.floor(Math.random() * 2);

        for (let i = 0; i < splits; i++) {
          const newAngle = angle + (Math.random() - 0.5) * 1.2 - 0.3;
          const newLength = length * (0.6 + Math.random() * 0.3);
          const newWidth = width * 0.7;

          branch(endX, endY, newAngle, newLength, newWidth, depth + 1);
        }
      }

      // Start branching from trunk top
      branch(cx, baseY - 80, -Math.PI/2 - 0.3, 50, 8, 1);
      branch(cx, baseY - 80, -Math.PI/2 + 0.3, 50, 8, 1);
      branch(cx, baseY - 60, -Math.PI/2 - 0.6, 40, 6, 2);
    }

    // Draw pot
    function drawPot() {
      const cx = canvas.width / 2;
      const baseY = canvas.height - 30;

      ctx.fillStyle = '#1a1520';
      ctx.strokeStyle = '#3d2d4a';
      ctx.lineWidth = 2;

      // Pot body
      ctx.beginPath();
      ctx.moveTo(cx - 50, baseY - 30);
      ctx.lineTo(cx - 40, baseY);
      ctx.lineTo(cx + 40, baseY);
      ctx.lineTo(cx + 50, baseY - 30);
      ctx.closePath();
      ctx.fill();
      ctx.stroke();

      // Pot rim
      ctx.beginPath();
      ctx.ellipse(cx, baseY - 30, 55, 8, 0, 0, Math.PI * 2);
      ctx.fill();
      ctx.stroke();

      // Soil
      ctx.fillStyle = '#0d0a0f';
      ctx.beginPath();
      ctx.ellipse(cx, baseY - 30, 48, 6, 0, 0, Math.PI * 2);
      ctx.fill();
    }

    // Draw branches
    function drawBranches() {
      branches.forEach(b => {
        ctx.strokeStyle = '#2d1f3d';
        ctx.lineWidth = b.width;
        ctx.lineCap = 'round';

        ctx.beginPath();
        ctx.moveTo(b.x1, b.y1);
        ctx.lineTo(b.x2, b.y2);
        ctx.stroke();

        // Subtle glow
        ctx.strokeStyle = 'rgba(107, 77, 138, 0.3)';
        ctx.lineWidth = b.width + 4;
        ctx.beginPath();
        ctx.moveTo(b.x1, b.y1);
        ctx.lineTo(b.x2, b.y2);
        ctx.stroke();
      });
    }

    // Draw leaves
    function drawLeaves(time) {
      leaves.forEach(leaf => {
        // Animate glow
        leaf.glow += (leaf.targetGlow - leaf.glow) * 0.1;

        // Subtle breathing animation
        const breath = Math.sin(time / 1000 + leaf.phase) * 0.1 + 1;
        const r = leaf.radius * breath;

        // Outer glow
        if (leaf.glow > 0.01) {
          const gradient = ctx.createRadialGradient(leaf.x, leaf.y, 0, leaf.x, leaf.y, r * 3);
          gradient.addColorStop(0, leaf.color.glow + Math.floor(leaf.glow * 80).toString(16).padStart(2, '0'));
          gradient.addColorStop(1, 'transparent');
          ctx.fillStyle = gradient;
          ctx.beginPath();
          ctx.arc(leaf.x, leaf.y, r * 3, 0, Math.PI * 2);
          ctx.fill();
        }

        // Leaf body
        const alpha = 0.4 + leaf.glow * 0.6;
        ctx.fillStyle = leaf.glow > 0.5 ? leaf.color.glow : leaf.color.base;
        ctx.globalAlpha = alpha;
        ctx.beginPath();
        ctx.arc(leaf.x, leaf.y, r, 0, Math.PI * 2);
        ctx.fill();
        ctx.globalAlpha = 1;

        // Inner highlight
        if (leaf.glow > 0.3) {
          ctx.fillStyle = 'rgba(255, 255, 255, ' + (leaf.glow * 0.5) + ')';
          ctx.beginPath();
          ctx.arc(leaf.x - r * 0.2, leaf.y - r * 0.2, r * 0.3, 0, Math.PI * 2);
          ctx.fill();
        }
      });
    }

    // Check leaf click
    function checkLeafClick(mx, my) {
      for (let i = leaves.length - 1; i >= 0; i--) {
        const leaf = leaves[i];
        const dx = mx - leaf.x;
        const dy = my - leaf.y;
        const dist = Math.sqrt(dx * dx + dy * dy);

        if (dist < leaf.radius + 10) {
          // Trigger glow
          leaf.targetGlow = 1;

          // Fade after delay
          setTimeout(() => {
            leaf.targetGlow = 0.2;
          }, 2000);

          // Play chime
          const freq = pentatonic[Math.floor(Math.random() * pentatonic.length)];
          playChime(freq);

          // Update counter
          glowCount++;
          document.getElementById('counter').textContent = glowCount;

          // Hide hint after first click
          document.getElementById('hint').classList.add('hidden');

          return true;
        }
      }
      return false;
    }

    // Event handlers
    canvas.addEventListener('click', (e) => {
      initAudio();
      const rect = canvas.getBoundingClientRect();
      const mx = (e.clientX - rect.left) * (canvas.width / rect.width);
      const my = (e.clientY - rect.top) * (canvas.height / rect.height);
      checkLeafClick(mx, my);
    });

    canvas.addEventListener('touchstart', (e) => {
      e.preventDefault();
      initAudio();
      const rect = canvas.getBoundingClientRect();
      const touch = e.touches[0];
      const mx = (touch.clientX - rect.left) * (canvas.width / rect.width);
      const my = (touch.clientY - rect.top) * (canvas.height / rect.height);
      checkLeafClick(mx, my);
    });

    // Generate stars
    function generateStars() {
      const container = document.getElementById('stars');
      for (let i = 0; i < 50; i++) {
        const star = document.createElement('div');
        star.className = 'star';
        star.style.left = Math.random() * 100 + '%';
        star.style.top = Math.random() * 60 + '%';
        star.style.animationDelay = Math.random() * 3 + 's';
        container.appendChild(star);
      }
    }

    // Animation loop
    function animate(time) {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      drawPot();
      drawBranches();
      drawLeaves(time);

      requestAnimationFrame(animate);
    }

    // Initialize
    generateStars();
    generateTree();
    animate(0);
  </script>
<script src="/sloppy-header/sloppy-bar.js"></script>
<script src="/vibelib-extended.js"></script>
<script>
  // Compatibility Patch for Legacy Apps
  window.addEventListener("load", () => {
    if (window.SloppyKarma && window.VibeLib.Economy) {
      // Redirect old calls to new engine
      window.SloppyKarma.track = window.VibeLib.Economy.track;
    }
  });
</script>
</body>
</html>
