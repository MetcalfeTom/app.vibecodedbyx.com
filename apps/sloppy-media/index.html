<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sloppy Media - Lightbox & GIF Search</title>
    <link rel="icon" href="https://emojicdn.elk.sh/üéûÔ∏è">
    <meta property="og:title" content="Sloppy Media">
    <meta property="og:description" content="Image lightbox, GIF search, and sharing tools">
    <meta property="og:url" content="https://sloppy.live/sloppy-media">
    <meta property="og:image" content="https://emojicdn.elk.sh/üéûÔ∏è?style=google">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{background:transparent;font-family:'VT323',monospace,system-ui;color:#d0d0d0;overflow:hidden}

        /* === IMAGE LIGHTBOX === */
        .lightbox{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.95);
            z-index:100;justify-content:center;align-items:center;cursor:pointer}
        .lightbox.active{display:flex}
        .lightbox-image{max-width:90%;max-height:90%;object-fit:contain;
            border:2px solid #00ff88;box-shadow:0 0 30px rgba(0,255,136,0.5),0 0 60px rgba(0,255,136,0.3);
            animation:lightboxFadeIn 0.3s ease-out}
        .lightbox-close{position:absolute;top:20px;right:30px;font-size:2.5rem;color:#00ff88;
            background:none;border:none;cursor:pointer;text-shadow:0 0 10px #00ff88;transition:all 0.2s}
        .lightbox-close:hover{color:#fff;transform:scale(1.2)}
        @keyframes lightboxFadeIn{from{opacity:0;transform:scale(0.8)}to{opacity:1;transform:scale(1)}}

        /* === SHARE MODAL === */
        .share-modal{position:fixed;inset:0;background:rgba(0,0,0,0.7);
            backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);
            display:flex;align-items:center;justify-content:center;z-index:200;
            opacity:0;visibility:hidden;transition:all 0.3s ease}
        .share-modal.visible{opacity:1;visibility:visible}
        .share-modal-content{background:rgba(18,18,26,0.85);backdrop-filter:blur(20px);
            -webkit-backdrop-filter:blur(20px);border:1px solid rgba(124,152,133,0.3);
            border-radius:16px;padding:28px;width:90%;max-width:380px;
            box-shadow:0 8px 32px rgba(0,0,0,0.5);transform:translateY(20px);transition:transform 0.3s ease}
        .share-modal.visible .share-modal-content{transform:translateY(0)}
        .share-modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:24px}
        .share-modal-title{font-size:1.4rem;color:#7c9885;letter-spacing:1px}
        .share-modal-close{background:none;border:none;color:#888;font-size:1.5rem;cursor:pointer;padding:4px 8px;transition:color 0.2s}
        .share-modal-close:hover{color:#00ff88}
        .share-buttons{display:flex;flex-direction:column;gap:12px}
        .share-btn{display:flex;align-items:center;justify-content:center;gap:12px;padding:14px 20px;
            border:1px solid rgba(255,255,255,0.1);border-radius:12px;font-size:1rem;font-weight:600;
            cursor:pointer;transition:all 0.25s ease;text-decoration:none;
            background:rgba(255,255,255,0.05);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);
            font-family:inherit}
        .share-btn:hover{transform:translateY(-2px);border-color:rgba(255,255,255,0.2)}
        .share-btn.x-twitter{color:#fff;background:linear-gradient(135deg,rgba(0,0,0,0.6),rgba(30,30,30,0.6))}
        .share-btn.x-twitter:hover{box-shadow:0 4px 20px rgba(255,255,255,0.15)}
        .share-btn.reddit{color:#ff4500;background:linear-gradient(135deg,rgba(255,69,0,0.1),rgba(255,69,0,0.05))}
        .share-btn.reddit:hover{box-shadow:0 4px 20px rgba(255,69,0,0.25)}
        .share-btn.copy-link{color:#00ff88;background:linear-gradient(135deg,rgba(124,152,133,0.1),rgba(124,152,133,0.05))}
        .share-btn.copy-link:hover{box-shadow:0 4px 20px rgba(124,152,133,0.25)}
        .share-btn-icon{font-size:1.3rem;width:28px;text-align:center}
        .share-btn.copied{background:linear-gradient(135deg,rgba(0,255,65,0.2),rgba(0,255,65,0.1))!important;
            color:#00ff41!important;border-color:rgba(0,255,65,0.3)!important}

        /* === GIF SEARCH MODAL === */
        .gif-modal{position:fixed;inset:0;background:rgba(0,0,0,0.85);display:none;
            align-items:center;justify-content:center;z-index:200;padding:20px}
        .gif-modal.active{display:flex}
        .gif-content{background:#12121a;border:1px solid #333;border-radius:12px;padding:20px;
            max-width:500px;width:100%;max-height:90vh;overflow-y:auto}
        .gif-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
        .gif-title{font-size:1.3rem;color:#00ff88}
        .gif-close{background:none;border:none;color:#888;font-size:1.5rem;cursor:pointer;transition:color 0.2s}
        .gif-close:hover{color:#00ff88}
        .gif-search-row{display:flex;gap:8px;margin-bottom:12px}
        .gif-search-row input{flex:1;padding:10px 12px;background:#0a0a12;border:1px solid #333;
            color:#d0d0d0;font-family:inherit;font-size:1rem;border-radius:6px;outline:none}
        .gif-search-row input:focus{border-color:#00ff88}
        .gif-search-btn{padding:10px 16px;background:#00ff88;color:#0a0a12;border:none;border-radius:6px;
            font-family:inherit;font-size:0.9rem;font-weight:700;cursor:pointer;transition:opacity 0.2s}
        .gif-search-btn:hover{opacity:0.85}
        .gif-trending-label{font-size:0.85rem;color:#888;margin-bottom:8px}
        .gif-results{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;max-height:350px;
            overflow-y:auto;background:#0a0a12;padding:8px;border:1px solid #333;border-radius:6px}
        .gif-results img{width:100%;aspect-ratio:1;object-fit:cover;cursor:pointer;border-radius:4px;
            transition:transform 0.15s,opacity 0.15s}
        .gif-results img:hover{transform:scale(1.05);opacity:0.9}
        .gif-loading,.gif-error,.gif-empty{grid-column:1/-1;text-align:center;padding:40px 20px;color:#888}
        .giphy-attribution{margin-top:12px;text-align:center;font-size:0.75rem;color:#888;opacity:0.7}
        @media(max-width:500px){.gif-results{grid-template-columns:repeat(2,1fr);max-height:280px}}
    </style>
<script>
(function(){var Q=[],N=0,MAX=10;function send(e){var sb=window.supabase;if(!sb){Q.push(e);return;}if(N>=MAX)return;N++;sb.auth.getSession().then(function(r){var u=r&&r.data&&r.data.session&&r.data.session.user;if(!u)return;sb.from('ai_events').insert({event_type:'client_error',entity_type:'app',entity_id:u.id,username:location.pathname.split('/').filter(Boolean)[0]||'unknown',metadata:e,user_id:u.id}).then(function(){});}).catch(function(){});}window.onerror=function(m,s,l,c,e){send({type:'error',msg:String(m).slice(0,500),src:s||'',line:l,col:c,stack:e?String(e.stack).slice(0,1000):''});};window.addEventListener('unhandledrejection',function(ev){var r=ev.reason;send({type:'promise',msg:String(r&&r.message||r).slice(0,500),stack:r?String(r.stack||'').slice(0,1000):''});});var fi=setInterval(function(){if(window.supabase){Q.splice(0).forEach(send);clearInterval(fi);}},1000);setTimeout(function(){clearInterval(fi);},30000);})();
</script>
</head>
<body>
    <!-- Image Lightbox -->
    <div class="lightbox" id="lightbox" onclick="closeLightbox(event)">
        <button class="lightbox-close" onclick="closeLightbox(event)">√ó</button>
        <img class="lightbox-image" id="lightboxImage" src="" alt="Full size image" onclick="event.stopPropagation()">
    </div>

    <!-- Share Modal -->
    <div class="share-modal" id="shareModal" onclick="if(event.target===this)closeShare()">
        <div class="share-modal-content">
            <div class="share-modal-header">
                <span class="share-modal-title">üì° SHARE</span>
                <button class="share-modal-close" onclick="closeShare()">√ó</button>
            </div>
            <div class="share-buttons">
                <a href="#" class="share-btn x-twitter" id="shareTwitterBtn" target="_blank" onclick="setTimeout(closeShare,500)">
                    <span class="share-btn-icon">ùïè</span>
                    <span>Share on X</span>
                </a>
                <a href="#" class="share-btn reddit" id="shareRedditBtn" target="_blank" onclick="setTimeout(closeShare,500)">
                    <span class="share-btn-icon">ü§ñ</span>
                    <span>Share on Reddit</span>
                </a>
                <button class="share-btn copy-link" id="shareCopyBtn" onclick="copyLink()">
                    <span class="share-btn-icon">üîó</span>
                    <span>Copy Link</span>
                </button>
            </div>
        </div>
    </div>

    <!-- GIF Search Modal -->
    <div class="gif-modal" id="gifModal" onclick="if(event.target===this)closeGif()">
        <div class="gif-content">
            <div class="gif-header">
                <span class="gif-title">üéûÔ∏è GIF SEARCH</span>
                <button class="gif-close" onclick="closeGif()">√ó</button>
            </div>
            <div class="gif-search-row">
                <input type="text" id="gifSearchInput" placeholder="Search for GIFs..." onkeydown="if(event.key==='Enter')searchGifs()">
                <button class="gif-search-btn" onclick="searchGifs()">SEARCH</button>
            </div>
            <div class="gif-trending-label" id="gifTrendingLabel">üî• Trending GIFs</div>
            <div class="gif-results" id="gifResults">
                <div class="gif-loading">Loading trending GIFs...</div>
            </div>
            <div class="giphy-attribution">Powered by GIPHY</div>
        </div>
    </div>

    <script>
        var GIPHY_API_KEY = 'dc6zaTOxFJmzC';
        var IS_EMBED = new URLSearchParams(location.search).has('embed');
        var currentShareUrl = '';

        function notifyParent(data) {
            if (IS_EMBED && window.parent !== window) {
                window.parent.postMessage(data, '*');
            }
        }

        // === LIGHTBOX ===
        function openLightbox(src) {
            var img = document.getElementById('lightboxImage');
            img.src = src;
            document.getElementById('lightbox').classList.add('active');
        }

        function closeLightbox(e) {
            if (e) e.stopPropagation();
            document.getElementById('lightbox').classList.remove('active');
            notifyParent({ type: 'media-close' });
        }

        // === SHARE MODAL ===
        var SHARE_CONFIG = {
            baseUrl: 'https://sloppy.live/sloppygram',
            defaultText: 'Check out The Archive of Synthesis - retro cyber chatroom vibes from 1999!',
            hashtags: 'archiveofsynthesis,retro,chat'
        };

        function openShare(context) {
            var modal = document.getElementById('shareModal');
            modal.classList.add('visible');

            var shareUrl = (context && context.url) || SHARE_CONFIG.baseUrl;
            var shareText = (context && context.text) || SHARE_CONFIG.defaultText;
            currentShareUrl = shareUrl;

            var twitterBtn = document.getElementById('shareTwitterBtn');
            if (twitterBtn) {
                twitterBtn.href = 'https://twitter.com/intent/tweet?text=' +
                    encodeURIComponent(shareText) + '&url=' + encodeURIComponent(shareUrl) +
                    '&hashtags=' + encodeURIComponent(SHARE_CONFIG.hashtags);
            }

            var redditBtn = document.getElementById('shareRedditBtn');
            if (redditBtn) {
                redditBtn.href = 'https://reddit.com/submit?url=' +
                    encodeURIComponent(shareUrl) + '&title=' + encodeURIComponent(shareText);
            }
        }

        function closeShare() {
            document.getElementById('shareModal').classList.remove('visible');
            notifyParent({ type: 'media-close' });
        }

        async function copyLink() {
            var url = currentShareUrl || SHARE_CONFIG.baseUrl;
            var btn = document.getElementById('shareCopyBtn');
            try {
                if (navigator.clipboard && navigator.clipboard.writeText) {
                    await navigator.clipboard.writeText(url);
                } else {
                    var ta = document.createElement('textarea');
                    ta.value = url; ta.style.cssText = 'position:fixed;opacity:0;left:-9999px';
                    document.body.appendChild(ta); ta.focus(); ta.select();
                    document.execCommand('copy');
                    document.body.removeChild(ta);
                }
                if (btn) {
                    btn.classList.add('copied');
                    btn.innerHTML = '<span class="share-btn-icon">‚úì</span><span>Copied!</span>';
                    setTimeout(function() {
                        btn.classList.remove('copied');
                        btn.innerHTML = '<span class="share-btn-icon">üîó</span><span>Copy Link</span>';
                    }, 2000);
                }
                notifyParent({ type: 'link-copied' });
            } catch (err) {
                notifyParent({ type: 'copy-failed' });
            }
        }

        // === GIF SEARCH ===
        function openGif() {
            document.getElementById('gifModal').classList.add('active');
            document.getElementById('gifSearchInput').value = '';
            document.getElementById('gifTrendingLabel').style.display = 'block';
            loadTrendingGifs();
        }

        function closeGif() {
            document.getElementById('gifModal').classList.remove('active');
            notifyParent({ type: 'media-close' });
        }

        async function loadTrendingGifs() {
            var container = document.getElementById('gifResults');
            container.innerHTML = '<div class="gif-loading">Loading trending GIFs...</div>';
            try {
                var r = await fetch('https://api.giphy.com/v1/gifs/trending?api_key=' + GIPHY_API_KEY + '&limit=24&rating=pg-13');
                var data = await r.json();
                if (data.data && data.data.length > 0) {
                    renderGifResults(data.data);
                } else {
                    container.innerHTML = '<div class="gif-empty">No trending GIFs found</div>';
                }
            } catch (err) {
                container.innerHTML = '<div class="gif-error">Failed to load GIFs. Try again later.</div>';
            }
        }

        function searchGifs() {
            var query = document.getElementById('gifSearchInput').value.trim();
            if (!query) { loadTrendingGifs(); document.getElementById('gifTrendingLabel').style.display = 'block'; return; }
            document.getElementById('gifTrendingLabel').style.display = 'none';
            var container = document.getElementById('gifResults');
            container.innerHTML = '<div class="gif-loading">Searching...</div>';
            fetch('https://api.giphy.com/v1/gifs/search?api_key=' + GIPHY_API_KEY + '&q=' + encodeURIComponent(query) + '&limit=24&rating=pg-13')
                .then(function(r) { return r.json(); })
                .then(function(data) {
                    if (data.data && data.data.length > 0) {
                        renderGifResults(data.data);
                    } else {
                        container.innerHTML = '<div class="gif-empty">No GIFs found for "' + escapeHtml(query) + '"</div>';
                    }
                })
                .catch(function() {
                    container.innerHTML = '<div class="gif-error">Search failed. Try again.</div>';
                });
        }

        function renderGifResults(gifs) {
            var container = document.getElementById('gifResults');
            var html = '';
            gifs.forEach(function(gif) {
                var previewUrl = (gif.images.fixed_height_small && gif.images.fixed_height_small.url)
                    ? gif.images.fixed_height_small.url : gif.images.fixed_height.url;
                var fullUrl = gif.images.fixed_height.url;
                html += '<img src="' + previewUrl + '" alt="' + escapeHtml(gif.title || 'GIF') +
                    '" onclick="selectGif(\'' + fullUrl.replace(/'/g, "\\'") + '\')" loading="lazy">';
            });
            container.innerHTML = html;
        }

        function selectGif(gifUrl) {
            closeGif();
            notifyParent({ type: 'gif-selected', gifUrl: gifUrl });
        }

        // === ESCAPE KEY ===
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                if (document.getElementById('lightbox').classList.contains('active')) closeLightbox(e);
                else if (document.getElementById('shareModal').classList.contains('visible')) closeShare();
                else if (document.getElementById('gifModal').classList.contains('active')) closeGif();
            }
        });

        // === POSTMESSAGE LISTENER (embed mode) ===
        window.addEventListener('message', function(e) {
            if (!e.data || !e.data.type) return;
            if (e.data.type === 'open-lightbox' && e.data.src) {
                openLightbox(e.data.src);
            }
            if (e.data.type === 'open-share') {
                openShare(e.data.context || {});
            }
            if (e.data.type === 'open-gif') {
                openGif();
            }
            if (e.data.type === 'close-all') {
                document.getElementById('lightbox').classList.remove('active');
                document.getElementById('shareModal').classList.remove('visible');
                document.getElementById('gifModal').classList.remove('active');
            }
        });

        function escapeHtml(str) { var d = document.createElement('div'); d.textContent = str; return d.innerHTML; }
    </script>
</body>
</html>
